##
## RNAspace: non-coding RNA annotation platform
## Copyright (C) 2009  CNRS, INRA, INRIA, Univ. Paris-Sud 11
## 
## This program is free software: you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation, either version 3 of the License, or
## (at your option) any later version.
## 
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
## 
## You should have received a copy of the GNU General Public License
## along with this program.  If not, see <http://www.gnu.org/licenses/>.
##

#from rnaspace.ui.view.rnaspace_template import rnaspace_template
#extends rnaspace_template

#def manage_id: active
#def header_title: Manage

#def info_boxes
#if $authentification_platform
active#slurp
#else
inactive#slurp
#end if
#end def

#def predict_id
#if $authentification_platform
#if not $sequences 
notaccessible#slurp
#else
inactive#slurp
#end if
#else
notaccessible
#end if
#end def

#def explore_id
#if $authentification_platform
#if not $runs
notaccessible#slurp
#else
inactive#slurp
#end if
#else
notaccessible
#end if
#end def

#block import_ressources
<script type="text/javascript"
	src="${mount_point}ressource/js/jquery.formvalidation.1.1.5.js">
</script>
<script type="text/javascript" 
	src="${mount_point}ressource/js/jquery.ui.alerts.js">
</script>
<script type="text/javascript" 
	src="${mount_point}ressource/js/jquery.ui.core.min.js">
</script>
<script type="text/javascript" 
	src="${mount_point}ressource/js/jquery.ui.dialog.min.js">
</script>
<script type="text/javascript" 
	src="${mount_point}ressource/js/jquery.ui.draggable.min.js">
</script>
<script type="text/javascript" 
	src="${mount_point}ressource/js/jquery.ui.resizable.min.js">
</script>
<script type="text/javascript" 
	src="${mount_point}ressource/js/jquery.bgiframe.min.js">
</script>
<script type="text/javascript" src="${mount_point}ressource/js/manage.js">
</script>
<link href="${mount_point}ressource/css/jquery.ui.core.css" 
      rel="stylesheet" type="text/css" media="screen" />
<link href="${mount_point}ressource/css/jquery.ui.dialog.css" 
      rel="stylesheet" type="text/css" media="screen" />
<link href="${mount_point}ressource/css/jquery.ui.theme.css" 
      rel="stylesheet" type="text/css" media="screen" />
<link href="${mount_point}ressource/css/jquery.form.css" 
      rel="stylesheet" type="text/css" />
#end block

#block jquery
var mount_point = "${mount_point}";
manage(mount_point);
#end block

#block javascript
#end block

#block page_content

<input type="hidden" id="seq_id" value="$current_seq_id" />
<input type="hidden" id="error" value="$error" />
<input type="hidden" id="last_action" value="$last_action" />
<input type="hidden" id="authkey" value="$authkey" />
  
<div class="content_header">
  Enter the genomic sequences in Fasta or multiFasta format (the
  number of sequences is limited to $nb_sequences_limitation per
  multiFasta). For each sequence, you can describe the name, the
  domain the  species, the strain and the
  replicon. [<a href="${mount_point}help/#help3" target="blank">?</a>]<br /> 
  <i>Remark:</i>There is a global size limitation
  of <b>$sequence_size_limitation</b> for your data. <br />
</div>

<form enctype="multipart/form-data" 
      action="${mount_point}manage/index?authkey=$authkey"
      id="manage_form" name="manage_form" method="post">

  <div class="cbb_header">
    <div class="cbb_title">Upload sequence(s)</div>
    <div class="cbb_content">
      <br /><br />
   
    <table style="width:99%; align=center;">
	<tr>
	  <td valign="top" class="bluerightborder">
	    
	    <table style="width:100%;">
	      <tr>
		<td>Sequence name:</td>
		<td>
		  <input type="text" class="customizeinput" id="id" 
			 name="id" size="15"  required="true" 
			 mask="sequence_name"
			 #if $sample_sequence != None
			     value="$sample_sequence.id"
			 #else
		  	     value="$current_seq_id" 
			 #end if
			 />
			 <input type="hidden" id="current_seq_id" value="$current_seq_id" />
		</td>
	      </tr>
	      
	      <tr>
		<td>Domain:<br /> <br /></td>
		<td>
		  <select class="select" id="domain" name="domain" 
			  required="true">
		    #for $domain in $available_domain
		        #if $sample_sequence != None
		            #if $sample_sequence.domain == $domain
		            <option value="$domain" selected="selected"> $domain </option>
		            #else
		            <option value="$domain"> $domain </option>
		            #end if
		        #else
		            <option value="$domain"> $domain </option>
		        #end if
		    #end for
		  </select>
		  <br /> <br />
		</td>
	      </tr>
	   
	      <tr>
		<td colspan="2" class="bluetopborder"> 
		  <br />Optional information:<br /><br />
		</td>
	      </tr>
	      
  	      <tr>
		<td style="padding-left:10px">Species:</td>
		<td>
		  <input type="text" class="customizeinput"
			 id="species" name="species" size="15" mask="species"
			 #if $sample_sequence != None
			 value="$sample_sequence.species"
			 #else
			 value="unknown" 
			 #end if
			 />
		</td>
	      </tr>

	      <tr>
		<td style="padding-left:10px">Strain:</td>
		<td>
		  <input type="text" class="customizeinput" 
			 id="strain" name="strain" size="15" mask="strain"
			 #if $sample_sequence != None
			 value="$sample_sequence.strain"
			 #else
			 value="unknown" 
			 #end if
			 />
		</td>
	      </tr>

	      <tr>
		<td style="padding-left:10px">Replicon:</td>
		<td>
	   	  <input type="text" class="customizeinput"
			 id="replicon" name="replicon" size="15" mask="replicon"
			 #if $sample_sequence != None
			 value="$sample_sequence.replicon"
	 		 #else
			 value="unknown" 
			 #end if	
			 />
		</td>
	      </tr>
	    </table>

	  </td>


	  <td valign="top" style="padding:10px">
	    Upload sequence(s) in FASTA format from a file: <br />
	    <input type="file" id="file" class="customizeinput" 
		   value="file" name="file"/>
	    <br /> <br />
	    Or paste it here: <br />
      	<textarea class="customizeinput" id="sequences" mask="sequence"
      	 name="sequences" rows="8" cols="70"
		 	#if $sample_sequence != None
		    	>$sample_sequence.data</textarea>
		 	#else
		        ></textarea>
		    #end if
	  </td>
	</tr>
      </table>
   
      <div align="right" style="padding-right:5px;">
	<input type="button" class="button" id="clear" 
	       value="Clear"/> &nbsp; 
	<input type="button" class="button" id="sample" 
	       value="Example"/>  &nbsp; 
	<input type="button" class="button" id="add_sequence" 
	       value="Upload this sequence"/>
      </div>
    </div>
  </div>	

  <input type="hidden" name="action" id="action_manage" value="" />
  <input type="hidden" name="alignment_to_delete" 
	 id="alignment_to_delete" value="" />
  <input type="hidden" name="run_to_delete" id="run_to_delete" 
	 value="" />
</form>

#if $len($sequences) > 0
<table class="results" style="width:99%;">
  <tr>
    <th> Sequence name </th>
    <th> Size </th>
    <th> Domain </th>
    <th> Species </th>
    <th> Strain </th>
    <th> Replicon </th>
    <th> Header </th>
  </tr>
   
  #for $i in range($len($sequences))
      #if $i%2 == 0
          #set $class_id = "pair"
      #else
          #set $class_id = "impair"
      #end if
  
      <tr class="$class_id">
	<td> $sequences[$i].id </td>
	<td> $len($sequences[$i].data) </td>
	<td> $sequences[$i].domain </td>
	<td> $sequences[$i].species </td>
	<td> $sequences[$i].strain </td>
	<td> $sequences[$i].replicon </td>
	<td> $headers[$sequences[$i].id][:80] </td>
      </tr>
      #end for
</table>

<form action="${mount_point}manage/index?authkey=$authkey" 
      id="submit_form" name="submit_form" method="post">
  <div class="cob_header" style="width:40%;margin-top:11px;">
    <div class="cob_content" style="text-align:center;padding:3px">
      <input type="hidden" name="action" id="action_submit" value="" />
      Email address(es) [<a href="${mount_point}help/#email" 
			    target="blank">?</a>]: 
      <input type="text" size="30" class="customizeinput" 
	     required="true" name="email" mask="email"/>
      &nbsp; &nbsp; &nbsp; 
      <input type="button" id="configure_predictors" class="button_bp"
	     value="Submit"/>
    </div>
  </div>
  <div style="clear:right"> </div>
</form>
#end if

#end block
