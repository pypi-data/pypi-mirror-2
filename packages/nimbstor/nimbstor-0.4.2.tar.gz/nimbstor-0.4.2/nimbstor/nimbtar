#!/usr/pkg/bin/python2.6 -O

import os, sys, time
from nimbstor.tar import command_tar_arguments
from nimbstor.tar import command_create_archive
from nimbstor.tar import command_extract_archive
from nimbstor.tar import command_list_archive
from nimbstor.tar import command_copy_archive
from nimbstor.tar import command_search_archive
from nimbstor.tar import command_list_keywords

start_time = time.time()
usercfgfile = os.path.join(os.environ.get('HOME', '/'), '.nimbtarrc')
syscfgfile  = os.path.join('/etc', 'nimbtarrc')
opt = command_tar_arguments(sys.argv, [usercfgfile, syscfgfile])

if __name__ == '__main__':
  try:
    if   opt['options'].create != None: command_create_archive(opt, start_time)
    elif opt['options'].extract != None: command_extract_archive(opt, start_time)
    elif opt['options'].list != None: command_list_archive(opt, start_time)
    elif opt['options'].copy != None: command_copy_archive(opt, start_time)
    elif opt['options'].search != None: command_search_archive(opt, start_time)
    elif opt['options'].list_keywords != None: command_list_keywords(opt, start_time)
    else: opt['parser'].print_help()
  except Exception, err:
    sys.stderr.write("ERROR: %s\n" % str(err))
    sys.exit(1)
  sys.exit(0)
