<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. The Core Concepts of CubicWeb &mdash; CubicWeb 3.10.1</title>
    <link rel="stylesheet" href="../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.10.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.10.1" href="../index.html" />
    <link rel="up" title="Introduction to CubicWeb" href="index.html" />
    <link rel="next" title="Tutorials" href="../tutorials/index.html" />
    <link rel="prev" title="1. A little history..." href="history.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="../tutorials/index.html" title="Tutorials"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="history.html" title="1. A little history..."
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.10.1</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Introduction to <em>CubicWeb</em></a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">2. The Core Concepts of <em>CubicWeb</em></a><ul>
<li><a class="reference external" href="#cubes">2.1. Cubes</a></li>
<li><a class="reference external" href="#instances">2.2. Instances</a></li>
<li><a class="reference external" href="#data-repository">2.3. Data Repository</a></li>
<li><a class="reference external" href="#web-engine">2.4. Web Engine</a></li>
<li><a class="reference external" href="#schema-data-model">2.5. Schema (Data Model)</a></li>
<li><a class="reference external" href="#registries-and-application-objects">2.6. Registries and application objects</a><ul>
<li><a class="reference external" href="#application-objects">2.6.1. Application objects</a></li>
<li><a class="reference external" href="#selectors">2.6.2. Selectors</a></li>
<li><a class="reference external" href="#the-vregistry">2.6.3. The <cite>vregistry</cite></a></li>
</ul>
</li>
<li><a class="reference external" href="#the-rql-query-language">2.7. The RQL query language</a><ul>
<li><a class="reference external" href="#db-api">2.7.1. DB-API</a></li>
<li><a class="reference external" href="#result-set">2.7.2. Result set</a></li>
</ul>
</li>
<li><a class="reference external" href="#views">2.8. Views</a></li>
<li><a class="reference external" href="#hooks-and-operations">2.9. Hooks and operations</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="history.html"
                                  title="previous chapter">1. A little history...</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../tutorials/index.html"
                                  title="next chapter">Tutorials</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/intro/concepts.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-core-concepts-of-cubicweb">
<span id="concepts"></span><h1>2. The Core Concepts of <em>CubicWeb</em><a class="headerlink" href="#the-core-concepts-of-cubicweb" title="Permalink to this headline">¶</a></h1>
<p>This section defines some terms and core concepts of the <em>CubicWeb</em> framework. To
avoid confusion while reading this book, take time to go through the following
definitions and use this section as a reference during your reading.</p>
<div class="section" id="cubes">
<span id="cube"></span><h2>2.1. Cubes<a class="headerlink" href="#cubes" title="Permalink to this headline">¶</a></h2>
<p>A cube is a software component made of three parts: its data model
(<tt class="xref docutils literal"><span class="pre">schema</span></tt>), its logic (<tt class="xref docutils literal"><span class="pre">entities</span></tt>) and its user interface
(<tt class="xref docutils literal"><span class="pre">views</span></tt>).</p>
<p>A cube can use other cubes as building blocks and assemble them to provide a
whole with richer functionnalities than its parts. The cubes <a class="reference external" href="http://www.cubicweb.org/project/cubicweb-blog">cubicweb-blog</a> and
<a class="reference external" href="http://www.cubicweb.org/project/cubicweb-comment">cubicweb-comment</a> could be used to make a cube named <em>myblog</em> with commentable
blog entries.</p>
<p>The <a class="reference external" href="http://www.cubicweb.org/project/">CubicWeb.org Forge</a> offers a large number of cubes developed by the community
and available under a free software license.</p>
<p>The command <strong>cubicweb-ctl list</strong> displays the list of cubes installed on
your system.</p>
<p>On a Unix system, the available cubes are usually stored in the directory
<tt class="docutils literal"><span class="pre">/usr/share/cubicweb/cubes</span></tt>. If you&#8217;re using the cubicweb forest
(<em class="xref">SourceInstallation</em>), the cubes are searched in the directory
<tt class="docutils literal"><span class="pre">/path/to/cubicweb_forest/cubes</span></tt>. The environment variable
<span class="target" id="index-6"></span><a class="reference external" href="../admin/setup.html#envvar-CW_CUBES_PATH"><strong class="xref">CW_CUBES_PATH</strong></a> gives additionnal locations where to search for cubes.</p>
</div>
<div class="section" id="instances">
<span id="instance"></span><h2>2.2. Instances<a class="headerlink" href="#instances" title="Permalink to this headline">¶</a></h2>
<p>An instance is a runnable application installed on a computer and based on a
cube.</p>
<p>The instance directory contains the configuration files. Several instances can be
created and based on the same cube. For exemple, several software forges can be
set up on one computer system based on the <a class="reference external" href="http://www.cubicweb.org/project/cubicweb-forge">cubicweb-forge</a> cube.</p>
<p>Instances can be of three different types: all-in-one, web engine or data
repository. For applications that support high traffic, several web (front-end)
and data (back-end) instances can be set-up to share the load.</p>
<img alt="../_images/archi_globale_en.png" src="../_images/archi_globale_en.png" />
<p>The command <strong>cubicweb-ctl list</strong> also displays the list of instances
installed on your system.</p>
<p>On a Unix system, the instances are usually stored in the directory
<tt class="docutils literal"><span class="pre">/etc/cubicweb.d/</span></tt>. During development, the <tt class="docutils literal"><span class="pre">~/etc/cubicweb.d/</span></tt>
directory is looked up, as well as the paths in <span class="target" id="index-7"></span><a class="reference external" href="../admin/setup.html#envvar-CW_INSTANCES_DIR"><strong class="xref">CW_INSTANCES_DIR</strong></a>
environment variable.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The term application is used to refer to &#8220;something that should do something as
a whole&#8221;, eg more like a project and so can refer to an instance or to a cube,
depending on the context. This book will try to use <em>application</em>, <em>cube</em> and
<em>instance</em> as appropriate.</p>
</div>
</div>
<div class="section" id="data-repository">
<span id="repositoryintro"></span><h2>2.3. Data Repository<a class="headerlink" href="#data-repository" title="Permalink to this headline">¶</a></h2>
<p>The data repository <a class="footnote-reference" href="#id2" id="id1">[1]</a> provides access to one or more data sources (including
SQL databases, LDAP repositories, other <em>CubicWeb</em> instance repositories, GAE&#8217;s
DataStore, etc).</p>
<p>All interactions with the repository are done using the Relation Query Language
(<a class="reference external" href="../annexes/rql/language.html#rql"><em>RQL syntax</em></a>). The repository federates the data sources and hides them from the
querier, which does not realize when a query spans accross several data sources
and requires running sub-queries and merges to complete.</p>
<p>It is common to run the web engine and the repository in the same process (see
instances of type all-in-one above), but this is not a requirement. A repository
can be set up to be accessed remotely using Pyro (<a class="reference external" href="http://pyro.sourceforge.net/">Python Remote Objects</a>) and
act as a server. However, it&#8217;s important to know if code you&#8217;re writing is
executed on the repository side, on our client side (the web engine being a
client for instance): you don&#8217;t have the same abilities on both side. On the
repository side, you can for instance by-pass security checks, which isn&#8217;t
possible from client code.</p>
<p>Some logic can be attached to events that happen in the repository,
like creation of entities, deletion of relations, etc. This is used
for example to send email notifications when the state of an object
changes. See <a class="reference internal" href="#hookintro"><em>Hooks and operations</em></a> below.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>not to be confused with a Mercurial repository or a Debian repository.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="web-engine">
<span id="webengineintro"></span><h2>2.4. Web Engine<a class="headerlink" href="#web-engine" title="Permalink to this headline">¶</a></h2>
<p>The web engine replies to http requests and runs the user interface
and most of the application logic.</p>
<p>By default the web engine provides a <a class="reference external" href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> user interface based on
the data model of the instance. Entities can be created, displayed,
updated and deleted. As the default user interface is not very fancy,
it is usually necessary to develop your own.</p>
</div>
<div class="section" id="schema-data-model">
<span id="schemaintro"></span><h2>2.5. Schema (Data Model)<a class="headerlink" href="#schema-data-model" title="Permalink to this headline">¶</a></h2>
<p>The data model of a cube is described as an entity-relationship schema using a
comprehensive language made of Python classes imported from the <a class="reference external" href="http://www.logilab.org/project/yams/">yams</a> library.</p>
<p>An <cite>entity type</cite> defines a set of attributes and is used in some relations.
Attributes may be of the following types: <cite>String</cite>, <cite>Int</cite>, <cite>Float</cite>, <cite>Boolean</cite>,
<cite>Date</cite>, <cite>Time</cite>, <cite>Datetime</cite>, <cite>Interval</cite>, <cite>Password</cite>, <cite>Bytes</cite>, <cite>RichString</cite>.</p>
<p>A <cite>relation type</cite> is used to define an oriented binary relation between two
entity types.  The left-hand part of a relation is named the <cite>subject</cite> and the
right-hand part is named the <cite>object</cite>.</p>
<p>A <cite>relation definition</cite> is a triple (<em>subject entity type</em>, <em>relation type</em>, <em>object
entity type</em>) associated with a set of properties such as cardinality,
constraints, etc.</p>
<p>Permissions can be set on entity types and relation definition to control who
will be able to create, read, update or delete entities and relations. Permissions
are granted to groups (to which users may belong) or using rql expression (if the
rql expression returns some results, the permission is granted).</p>
<p>Some meta-data necessary to the system is added to the data model. That includes
entities like users and groups, the entities used to store the data model
itself and attributes like unique identifier, creation date, creator, etc.</p>
<p>When you create a new <em>CubicWeb</em> instance, the schema is stored in the database.
When the cubes the instance is based on evolve, they may change their data model
and provide migration scripts that will be executed when the administrator will
run the upgrade process for the instance.</p>
</div>
<div class="section" id="registries-and-application-objects">
<span id="vregistryintro"></span><h2>2.6. Registries and application objects<a class="headerlink" href="#registries-and-application-objects" title="Permalink to this headline">¶</a></h2>
<div class="section" id="application-objects">
<h3>2.6.1. Application objects<a class="headerlink" href="#application-objects" title="Permalink to this headline">¶</a></h3>
<p>Beside a few core functionalities, almost every feature of the framework is
achieved by dynamic objects (<cite>application objects</cite> or <cite>appobjects</cite>) stored in a
two-levels registry (the <cite>vregistry</cite>). Each object is affected to a registry with
an identifier in this registry. You may have more than one object sharing an
identifier in the same registry. At runtime, appobjects are selected in a
registry according to the context. Selection is done by comparing the <em>score</em>
returned by each appobject&#8217;s <em>selector</em>.</p>
<p>Application objects are stored in the vregistry using a two-level hierarchy :</p>
<blockquote>
object&#8217;s <cite>__registry__</cite> : object&#8217;s <cite>__regid__</cite> : [list of app objects]</blockquote>
<p>In other words, the <cite>vregistry</cite> contains several (sub-)registries which hold a
list of appobjects associated to an identifier.</p>
<p>The base class of appobjects is <a title="cubicweb.appobject.AppObject" class="reference external" href="../devrepo/vreg.html#cubicweb.appobject.AppObject"><tt class="xref docutils literal"><span class="pre">cubicweb.appobject.AppObject</span></tt></a>.</p>
</div>
<div class="section" id="selectors">
<h3>2.6.2. Selectors<a class="headerlink" href="#selectors" title="Permalink to this headline">¶</a></h3>
<p>Each appobject has a selector that is used to compute how well the object fits a
given context. The better the object fits the context, the higher the score. Scores
are the glue that ties appobjects to the data model. Using them appropriately is
an essential part of the construction of well behaved cubes.</p>
<p><em>CubicWeb</em> provides a set of basic selectors that may be parametrized.  Also,
selectors can be combined with the <cite>~</cite> unary operator (negation) and the binary
operators <cite>&amp;</cite> and <cite>|</cite> (respectivly &#8216;and&#8217; and &#8216;or&#8217;) to build more complex
selectors. Of course complex selectors may be combined too. Last but not least, you
can write your own selectors.</p>
</div>
<div class="section" id="the-vregistry">
<h3>2.6.3. The <cite>vregistry</cite><a class="headerlink" href="#the-vregistry" title="Permalink to this headline">¶</a></h3>
<p>At startup, the <cite>vregistry</cite> inspects a number of directories looking for
compatible classes definition. After a recording process, the objects are
assigned to registries so that they can be selected dynamically while the
instance is running.</p>
<p>In a cube, application object classes are looked in the following modules or
packages:</p>
<ul class="simple">
<li><cite>entities</cite></li>
<li><cite>views</cite></li>
<li><cite>sobjects</cite></li>
</ul>
<p>Once initialized, there are three common ways to retrieve some application object
from a registry:</p>
<ul class="simple">
<li>get the most appropriate object by specifying an identifier. In that case, the
object with the greatest score is selected. There should always be a single
appobject with a greater score than others for a particular context.</li>
<li>get all objects applying to a context by specifying a registry. In that case, a
list of objects will be returned containing the object with the highest score
(&gt; 0) for each identifier in that registry.</li>
<li>get the object within a particular registry/identifier. In that case no
selection process is involved, the vregistry will expect to find a single
object in that cell.</li>
</ul>
</div>
</div>
<div class="section" id="the-rql-query-language">
<span id="rqlintro"></span><h2>2.7. The RQL query language<a class="headerlink" href="#the-rql-query-language" title="Permalink to this headline">¶</a></h2>
<p>No need for a complicated ORM when you have a powerful data
manipulation language.</p>
<p>All the persistent data in a <em>CubicWeb</em> instance is retrieved and
modified using RQL (see <a class="reference external" href="../annexes/rql/intro.html#rql-intro"><em>Introduction</em></a>).</p>
<p>This query language is inspired by SQL but is on a higher level in order to
emphasize browsing relations.</p>
<div class="section" id="db-api">
<h3>2.7.1. DB-API<a class="headerlink" href="#db-api" title="Permalink to this headline">¶</a></h3>
<p>The repository exposes a <a class="reference external" href="http://www.python.org/dev/peps/pep-0249/">db-api</a> like api but using the RQL instead of SQL.</p>
<p>You basically get a connection using <tt class="xref docutils literal"><span class="pre">cubicweb.dbapi.connect()</span></tt> , then
get a cursor to call its <cite>execute</cite> method which will return result set for the
given rql query.</p>
<p>You can also get additional information through the connection, such as the
repository&#8217;schema, version configuration, etc.</p>
</div>
<div class="section" id="result-set">
<h3>2.7.2. Result set<a class="headerlink" href="#result-set" title="Permalink to this headline">¶</a></h3>
<p>Every request made (using RQL) to the data repository returns an object we call a
Result Set. It enables easy use of the retrieved data, providing a translation
layer between the backend&#8217;s native datatypes and <em>CubicWeb</em> schema&#8217;s EntityTypes.</p>
<p>Result sets provide access to the raw data, yielding either basic Python data
types, or schema-defined high-level entities, in a straightforward way.</p>
</div>
</div>
<div class="section" id="views">
<span id="viewintro"></span><h2>2.8. Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p><strong>CubicWeb is data driven</strong></p>
<p>The view system is loosely coupled to data through the selection system explained
above. Views are application objects with a dedicated interface to &#8216;render&#8217;
something, eg producing some html, text, xml, pdf, or whatsover that can be
displayed to a user.</p>
<p>The two main entry points of a view are:</p>
<ul class="simple">
<li><cite>call()</cite>, used to render a view on a context with no result set, or on a whole
result set</li>
<li><cite>cell_call(row, col)</cite>, used to render a view on a the cell with index <cite>row</cite> and
<cite>col</cite> of the context&#8217;s result set (remember result set may be seen as a two
dimensions array).</li>
</ul>
<p>Then view may gets refined into different kind of objects such as <cite>template</cite>,
<cite>boxes</cite>, <cite>components</cite>, which are more high-level abstraction useful to build
the user interface in an object oriented way.</p>
</div>
<div class="section" id="hooks-and-operations">
<span id="hookintro"></span><h2>2.9. Hooks and operations<a class="headerlink" href="#hooks-and-operations" title="Permalink to this headline">¶</a></h2>
<p><strong>CubicWeb provides an extensible data repository</strong></p>
<p>The data model defined using Yams types allows to express the data
model in a comfortable way. However several aspects of the data model
can not be expressed there. For instance:</p>
<ul class="simple">
<li>managing computed attributes</li>
<li>enforcing complicated structural invariants</li>
<li>real-world side-effects linked to data events (email notification
being a prime example)</li>
</ul>
<p>The hook system is much like the triggers of an SQL database engine,
except that:</p>
<ul class="simple">
<li>it is not limited to one specific SQL backend (every one of them
having an idiomatic way to encode triggers), nor to SQL backends at
all (think about LDAP or a Subversion repository)</li>
<li>it is well-coupled to the rest of the framework</li>
</ul>
<p>Hooks are also application objects registered on events such as after/before
add/update/delete on entities/relations, server startup or shutdown, etc. As all
application objects, they have a selector defining when they should be called or
not.</p>
<p><cite>Operations</cite> may be instantiated by hooks to do further processing at different
steps of the transaction&#8217;s commit / rollback, which usually can not be done
safely at the hook execution time.</p>
<p>Hooks and operation are an essential building block of any moderately complicated
cubicweb application.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">RQL queries executed in hooks and operations are <em>unsafe</em> by default, i.e. the
read and write security is deactivated unless explicitly asked.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../tutorials/index.html" title="Tutorials"
             >next</a> |</li>
        <li class="right" >
          <a href="history.html" title="1. A little history..."
             >previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.10.1</a> &raquo;</li>
          <li><a href="index.html" >Introduction to <em>CubicWeb</em></a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2001-2010, Logilab.
      Last updated on Oct 17, 2010.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>