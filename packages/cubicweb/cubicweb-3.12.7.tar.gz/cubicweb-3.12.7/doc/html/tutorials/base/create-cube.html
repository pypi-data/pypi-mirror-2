<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.2. Steps for creating your cube &mdash; CubicWeb 3.10.7</title>
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.10.7',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.10.7" href="../../index.html" />
    <link rel="up" title="1. Building a simple blog" href="index.html" />
    <link rel="next" title="1.9. Cubes" href="components.html" />
    <link rel="prev" title="1.1. Get a blog running in five minutes!" href="blog-in-five-minutes.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="components.html" title="1.9. Cubes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="blog-in-five-minutes.html" title="1.1. Get a blog running in five minutes!"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.10.7</a> &raquo;</li>
          <li><a href="../index.html" >Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">1. Building a simple blog</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">1.2. Steps for creating your cube</a></li>
<li><a class="reference external" href="#create-your-cube">1.3. Create your cube</a></li>
<li><a class="reference external" href="#define-your-data-model">1.4. Define your data model</a></li>
<li><a class="reference external" href="#create-and-explore-your-instance">1.5. Create and explore your instance</a><ul>
<li><a class="reference external" href="#create-your-instance">1.5.1. Create your instance</a></li>
<li><a class="reference external" href="#welcome-to-your-web-instance">1.5.2. Welcome to your web instance</a></li>
<li><a class="reference external" href="#add-entities">1.5.3. Add entities</a><ul>
<li><a class="reference external" href="#add-a-blog">1.5.3.1. Add a Blog</a></li>
<li><a class="reference external" href="#add-a-blogentry">1.5.3.2. Add a BlogEntry</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#define-your-entity-views">1.6. Define your entity views</a><ul>
<li><a class="reference external" href="#the-view-selection-principle">1.6.1. The view selection principle</a></li>
<li><a class="reference external" href="#primary-view-customization">1.6.2. Primary view customization</a></li>
</ul>
</li>
<li><a class="reference external" href="#write-entities-to-add-logic-in-your-data">1.7. Write entities to add logic in your data</a></li>
<li><a class="reference external" href="#updating-the-schema-and-synchronising-the-instance">1.8. Updating the schema and synchronising the instance</a></li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="blog-in-five-minutes.html"
                                  title="previous chapter">1.1. Get a blog running in five minutes!</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="components.html"
                                  title="next chapter">1.9. Cubes</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/tutorials/base/create-cube.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="steps-for-creating-your-cube">
<span id="steps"></span><h1>1.2. Steps for creating your cube<a class="headerlink" href="#steps-for-creating-your-cube" title="Permalink to this headline">¶</a></h1>
<p>The following steps will help you to create and customize a new cube.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#createyourcube"><em>Create your cube</em></a></li>
</ol>
<p>Create the directory to hold the code of your cube. The most important
files that will be useful to customize your newly created cube are:</p>
<blockquote>
<ul class="simple">
<li>schema.py: contains the data model</li>
<li>views.py: contains your custom views</li>
<li>entities.py: contains XXX</li>
</ul>
</blockquote>
<p>The detailed structure of the code directory is described in <a class="reference external" href="../../devrepo/cubes/layout.html#cubelayout"><em>Standard structure for a cube</em></a>.</p>
<ol class="arabic simple" start="2">
<li><a class="reference internal" href="#definedatamodel"><em>Define your data model</em></a></li>
</ol>
<p>Define the data model of your application.</p>
<ol class="arabic simple" start="3">
<li><a class="reference internal" href="#exploreyourinstance"><em>Create and explore your instance</em></a></li>
</ol>
<p>Create, run, and explore an instance of your cube.</p>
<ol class="arabic simple" start="4">
<li><a class="reference internal" href="#defineviews"><em>Define your entity views</em></a></li>
</ol>
<p>Customize the views of your data: how and which part of your data are showed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">views do not define the look&#8217;n&#8217;feel and the design of your application. For that, you will use CSS and the files located &#8216;blog/data/&#8217;.</p>
</div>
<ol class="arabic simple" start="5">
<li><a class="reference internal" href="#defineentities"><em>Write entities to add logic in your data</em></a></li>
</ol>
<p>Define your own entities to add useful functions when you manipulate your data, especially when you write view.</p>
</div>
<div class="section" id="create-your-cube">
<span id="createyourcube"></span><h1>1.3. Create your cube<a class="headerlink" href="#create-your-cube" title="Permalink to this headline">¶</a></h1>
<p>The packages <tt class="docutils literal"><span class="pre">cubicweb</span></tt> and <tt class="docutils literal"><span class="pre">cubicweb-dev</span></tt> install a command line
tool for <em>CubicWeb</em> called <tt class="docutils literal"><span class="pre">cubicweb-ctl</span></tt>. This tool provides a wide
range of commands described in details in <a class="reference external" href="../../admin/cubicweb-ctl.html#cubicweb-ctl"><em>cubicweb-ctl tool</em></a>.</p>
<p>Once your <em>CubicWeb</em> development environment is set up, you can create
a new cube:</p>
<div class="highlight-python"><pre>cubicweb-ctl newcube blog</pre>
</div>
<p>This will create in the cubes directory (<tt class="docutils literal"><span class="pre">/path/to/forest/cubes</span></tt> for Mercurial
installation, <tt class="docutils literal"><span class="pre">/usr/share/cubicweb/cubes</span></tt> for debian packages installation)
a directory named <tt class="docutils literal"><span class="pre">blog</span></tt> reflecting the structure described in <a class="reference external" href="../../intro/concepts.html#concepts"><em>The Core Concepts of CubicWeb</em></a>.</p>
<p>For packages installation, you can still create new cubes in your home directory using the following configuration. Let&#8217;s say you want to develop your new cubes in <cite>~src/cubes</cite>, then set the following environment variables:</p>
<div class="highlight-python"><pre>CW_CUBES_PATH=~/src/cubes
CW_MODE=user</pre>
</div>
<p>and then create your new cube using:</p>
<div class="highlight-python"><pre>cubicweb-ctl newcube --directory=~/src/cubes blog</pre>
</div>
</div>
<div class="section" id="define-your-data-model">
<span id="definedatamodel"></span><h1>1.4. Define your data model<a class="headerlink" href="#define-your-data-model" title="Permalink to this headline">¶</a></h1>
<p>The data model or schema is the core of your <em>CubicWeb</em> application.
It defines the type of content your application will handle.</p>
<p>The data model of your cube <tt class="docutils literal"><span class="pre">blog</span></tt> is defined in the file <tt class="docutils literal"><span class="pre">schema.py</span></tt>:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">yams.buildobjs</span> <span class="kn">import</span> <span class="n">EntityType</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">SubjectRelation</span><span class="p">,</span> <span class="n">Date</span>

<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">EntityType</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">description</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">BlogEntry</span><span class="p">(</span><span class="n">EntityType</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fulltextindexed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
  <span class="n">publish_date</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;TODAY&#39;</span><span class="p">)</span>
  <span class="n">content</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fulltextindexed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">entry_of</span> <span class="o">=</span> <span class="n">SubjectRelation</span><span class="p">(</span><span class="s">&#39;Blog&#39;</span><span class="p">,</span> <span class="n">cardinality</span><span class="o">=</span><span class="s">&#39;?*&#39;</span><span class="p">)</span>
</pre></div>
<p>The first step is the import of the EntityType (generic class for entity and
attributes that will be used in both Blog and BlogEntry entities.</p>
<p>A Blog has a title and a description. The title is a string that is
required and must be less than 50 characters.  The
description is a string that is not constrained.</p>
<p>A BlogEntry has a title, a publish_date and a content. The title is a
string that is required and must be less than 100 characters. The
publish_date is a Date with a default value of TODAY, meaning that
when a BlogEntry is created, its publish_date will be the current day
unless it is modified. The content is a string that will be indexed in
the database full-text index and has no constraint.</p>
<p>A BlogEntry also has a relationship <tt class="docutils literal"><span class="pre">entry_of</span></tt> that links it to a
Blog. The cardinality <tt class="docutils literal"><span class="pre">?*</span></tt> means that a BlogEntry can be part of
zero or one Blog (<tt class="docutils literal"><span class="pre">?</span></tt> means <cite>zero or one</cite>) and that a Blog can
have any number of BlogEntry (<tt class="docutils literal"><span class="pre">*</span></tt> means <cite>any number including
zero</cite>). For completeness, remember that <tt class="docutils literal"><span class="pre">+</span></tt> means <cite>one or more</cite>.</p>
</div>
<div class="section" id="create-and-explore-your-instance">
<span id="exploreyourinstance"></span><h1>1.5. Create and explore your instance<a class="headerlink" href="#create-and-explore-your-instance" title="Permalink to this headline">¶</a></h1>
<div class="section" id="create-your-instance">
<span id="createyourinstance"></span><h2>1.5.1. Create your instance<a class="headerlink" href="#create-your-instance" title="Permalink to this headline">¶</a></h2>
<p>To use this cube as an instance and create a new instance named <tt class="docutils literal"><span class="pre">blogdemo</span></tt>, do:</p>
<div class="highlight-python"><pre>cubicweb-ctl create blog blogdemo</pre>
</div>
<p>This command will create the corresponding database and initialize it.</p>
</div>
<div class="section" id="welcome-to-your-web-instance">
<span id="welcometoyourwebinstance"></span><h2>1.5.2. Welcome to your web instance<a class="headerlink" href="#welcome-to-your-web-instance" title="Permalink to this headline">¶</a></h2>
<p>Start your instance in debug mode with the following command:</p>
<div class="highlight-python"><pre>cubicweb-ctl start -D blogdemo</pre>
</div>
<p>You can now access your web instance to create blogs and post messages
by visiting the URL <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a>.</p>
<p>A login form will appear. By default, the instance will not allow anonymous
users to enter the instance. To login, you need then use the admin account
you created at the time you initialized the database with <tt class="docutils literal"><span class="pre">cubicweb-ctl</span>
<span class="pre">create</span></tt>.</p>
<img alt="../../_images/login-form.png" src="../../_images/login-form.png" />
<p>Once authenticated, you can start playing with your instance
and create entities.</p>
<img alt="../../_images/blog-demo-first-page.png" src="../../_images/blog-demo-first-page.png" />
<p>Please notice that so far, the <em>CubicWeb</em> framework managed all aspects of
the web application based on the schema provided at the beginning.</p>
</div>
<div class="section" id="add-entities">
<span id="addentities"></span><h2>1.5.3. Add entities<a class="headerlink" href="#add-entities" title="Permalink to this headline">¶</a></h2>
<p>We will now add entities in our web application.</p>
<div class="section" id="add-a-blog">
<h3>1.5.3.1. Add a Blog<a class="headerlink" href="#add-a-blog" title="Permalink to this headline">¶</a></h3>
<p>Let us create a few of these entities. Click on the <cite>[+]</cite> at the left of the
link Blog on the home page. Call this new Blog <tt class="docutils literal"><span class="pre">Tech-blog</span></tt> and type in
<tt class="docutils literal"><span class="pre">everything</span> <span class="pre">about</span> <span class="pre">technology</span></tt> as the description, then validate the form by
clicking on <tt class="docutils literal"><span class="pre">Validate</span></tt>.</p>
<img alt="from to create blog" src="../../_images/cbw-create-blog_en.png" />
<p>Click on the logo at top left to get back to the home page, then
follow the Blog link that will list for you all the existing Blog.
You should be seeing a list with a single item <tt class="docutils literal"><span class="pre">Tech-blog</span></tt> you
just created.</p>
<img alt="displaying a list of a single blog" src="../../_images/cbw-list-one-blog_en.png" />
<p>Clicking on this item will get you to its detailed description except
that in this case, there is not much to display besides the name and
the phrase <tt class="docutils literal"><span class="pre">everything</span> <span class="pre">about</span> <span class="pre">technology</span></tt>.</p>
<p>Now get back to the home page by clicking on the top-left logo, then
create a new Blog called <tt class="docutils literal"><span class="pre">MyLife</span></tt> and get back to the home page
again to follow the Blog link for the second time. The list now
has two items.</p>
<img alt="displaying a list of two blogs" src="../../_images/cbw-list-two-blog_en.png" />
</div>
<div class="section" id="add-a-blogentry">
<h3>1.5.3.2. Add a BlogEntry<a class="headerlink" href="#add-a-blogentry" title="Permalink to this headline">¶</a></h3>
<p>Get back to the home page and click on [+] at the left of the link
BlogEntry. Call this new entry <tt class="docutils literal"><span class="pre">Hello</span> <span class="pre">World</span></tt> and type in some text
before clicking on <tt class="docutils literal"><span class="pre">Validate</span></tt>. You added a new blog entry without
saying to what blog it belongs. There is a box on the left entitled
<tt class="docutils literal"><span class="pre">actions</span></tt>, click on the menu item <tt class="docutils literal"><span class="pre">modify</span></tt>. You are back to the form
to edit the blog entry you just created, except that the form now has
another section with a combobox titled <tt class="docutils literal"><span class="pre">add</span> <span class="pre">relation</span></tt>. Chose
<tt class="docutils literal"><span class="pre">entry_of</span></tt> in this menu and a second combobox appears where you pick
<tt class="docutils literal"><span class="pre">MyLife</span></tt>.</p>
<p>You could also have, at the time you started to fill the form for a
new entity BlogEntry, hit <tt class="docutils literal"><span class="pre">Apply</span></tt> instead of <tt class="docutils literal"><span class="pre">Validate</span></tt> and the
combobox titled <tt class="docutils literal"><span class="pre">add</span> <span class="pre">relation</span></tt> would have showed up.</p>
<img alt="editing a blog entry to add a relation to a blog" src="../../_images/cbw-add-relation-entryof_en.png" />
<p>Validate the changes by clicking <tt class="docutils literal"><span class="pre">Validate</span></tt>. The entity BlogEntry
that is displayed now includes a link to the entity Blog named
<tt class="docutils literal"><span class="pre">MyLife</span></tt>.</p>
<img alt="displaying the detailed view of a blogentry" src="../../_images/cbw-detail-one-blogentry_en.png" />
<p>Note that all of this was handled by the framework and that the only input
that was provided so far is the schema. To get a graphical view of the schema,
point your browser to the URL <a class="reference external" href="http://localhost:8080/schema">http://localhost:8080/schema</a></p>
<img alt="graphical view of the schema (aka data-model)" src="../../_images/cbw-schema_en.png" />
</div>
</div>
</div>
<div class="section" id="define-your-entity-views">
<span id="defineviews"></span><h1>1.6. Define your entity views<a class="headerlink" href="#define-your-entity-views" title="Permalink to this headline">¶</a></h1>
<p>Each entity defined in a model is associated with default views
allowing different renderings of the data. You can redefine each of
them according to your needs and preferences. So let&#8217;s see how the
views are defined.</p>
<div class="section" id="the-view-selection-principle">
<h2>1.6.1. The view selection principle<a class="headerlink" href="#the-view-selection-principle" title="Permalink to this headline">¶</a></h2>
<p>A view is defined by a Python class which includes:</p>
<blockquote>
<ul class="simple">
<li>an identifier (all objects in <em>CubicWeb</em> are recorded in a
registry and this identifier will be used as a key)</li>
<li>a filter to select the result sets it can be applied to</li>
</ul>
</blockquote>
<p>A view has a set of methods complying with the <cite>View</cite> class interface
(<cite>cubicweb.common.view</cite>).</p>
<p><em>CubicWeb</em> provides a lot of standard views for the type <cite>EntityView</cite>;
for a complete list, read the code in directory <tt class="docutils literal"><span class="pre">cubicweb/web/views/</span></tt>.</p>
<p>A view is applied on a <cite>result set</cite> which contains a set of entities
we are trying to display. <em>CubicWeb</em> uses a selector mechanism which
computes for each available view a score: the view with the highest
score is then used to display the given <cite>result set</cite>.  The standard
library of selectors is in <tt class="docutils literal"><span class="pre">cubicweb.selector</span></tt>.</p>
<p>It is possible to define multiple views for the same identifier
and to associate selectors and filters to allow the application
to find the most appropriate way to render the data.</p>
<p>For example, the view named <tt class="docutils literal"><span class="pre">primary</span></tt> is the one used to display a
single entity. We will now show you how to create a primary view for
BlogEntry.</p>
</div>
<div class="section" id="primary-view-customization">
<h2>1.6.2. Primary view customization<a class="headerlink" href="#primary-view-customization" title="Permalink to this headline">¶</a></h2>
<p>If you wish to modify the way a <cite>BlogEntry</cite> is rendered, you will have
to subclass the <cite>primary</cite> view, for instance in the module <tt class="docutils literal"><span class="pre">views</span></tt>
of the cube <tt class="docutils literal"><span class="pre">cubes/blog/views.py</span></tt>.</p>
<p>The standard primary view is the most sophisticated view of all. It
has more than a call() method. It is a template. Actually the entry
point calls the following sequence of (redefinable) methods:</p>
<blockquote>
<ul class="simple">
<li>render_entity_title</li>
<li>render_entity_metadata</li>
<li>render_entity_attributes</li>
<li>render_entity_relations</li>
<li>render_side_boxes</li>
</ul>
</blockquote>
<p>Excepted side boxes, we can see all of them already in action in the
blog entry view. This is all described in more details in
<a class="reference external" href="../../devweb/views/primary.html#primary-view"><em>The Primary View</em></a>.</p>
<p>We can for example add in front of the publication date a prefix
specifying that the date we see is the publication date.</p>
<p>To do so, please apply the following changes:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb.selectors</span> <span class="kn">import</span> <span class="n">is_instance</span>
<span class="kn">from</span> <span class="nn">cubicweb.web.views</span> <span class="kn">import</span> <span class="n">primary</span>

<span class="k">class</span> <span class="nc">BlogEntryPrimaryView</span><span class="p">(</span><span class="n">primary</span><span class="o">.</span><span class="n">PrimaryView</span><span class="p">):</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">is_instance</span><span class="p">(</span><span class="s">&#39;BlogEntry&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_entity_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">(</span><span class="s">u&#39;&lt;p&gt;published on </span><span class="si">%s</span><span class="s">&lt;/p&gt;&#39;</span> <span class="o">%</span>
               <span class="n">entity</span><span class="o">.</span><span class="n">publish_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BlogEntryPrimaryView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render_entity_attributes</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
</pre></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a view is modified, it is not required to restart the instance
server. Save the Python file and reload the page in your web browser
to view the changes.</p>
</div>
<p>You can now see that the publication date has a prefix.</p>
<img alt="modified primary view" src="../../_images/cbw-update-primary-view_en.png" />
<p>The above source code defines a new primary view for <tt class="docutils literal"><span class="pre">BlogEntry</span></tt>.</p>
<p>Since views are applied to result sets and result sets can be tables of
data, we have to recover the entity from its (row,col)-coordinates.
The view has a <tt class="docutils literal"><span class="pre">self.w()</span></tt> method that is used to output data, in our
example HTML output.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can find more details about views and selectors in <a class="reference external" href="../../devweb/views/views.html#views"><em>Principles</em></a>.</p>
</div>
</div>
</div>
<div class="section" id="write-entities-to-add-logic-in-your-data">
<span id="defineentities"></span><h1>1.7. Write entities to add logic in your data<a class="headerlink" href="#write-entities-to-add-logic-in-your-data" title="Permalink to this headline">¶</a></h1>
<p>By default, CubicWeb provides a default entity for each data type defined in the schema.
A default entity mainly contains the attributes defined in the data model.</p>
<p>You can redefine each entity to provide additional functions to help you write your views.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb.entities</span> <span class="kn">import</span> <span class="n">AnyEntity</span>

<span class="k">class</span> <span class="nc">BlogEntry</span><span class="p">(</span><span class="n">AnyEntity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;customized class for BlogEntry entities&quot;&quot;&quot;</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;BlogEntry&#39;</span>

    <span class="k">def</span> <span class="nf">display_cw_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;CW&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</pre></div>
<dl class="docutils">
<dt>Customizing an entity requires that your entity:</dt>
<dd><ul class="first last simple">
<li>inherits from <tt class="docutils literal"><span class="pre">cubicweb.entities</span></tt> or any subclass</li>
<li>defines a <tt class="docutils literal"><span class="pre">__regid__</span></tt> linked to the corresponding data type of your schema</li>
<li>implements the base class by explicitly using <tt class="docutils literal"><span class="pre">__implements__</span></tt>.</li>
</ul>
</dd>
</dl>
<p>We implemented here a function <tt class="docutils literal"><span class="pre">display_cw_logo</span></tt> which tests if the blog entry title contains &#8216;CW&#8217;.
This function can then be used when you customize your views. For instance, you can modify your previous <tt class="docutils literal"><span class="pre">views.py</span></tt> as follows:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">BlogEntryPrimaryView</span><span class="p">(</span><span class="n">primary</span><span class="o">.</span><span class="n">PrimaryView</span><span class="p">):</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">is_instance</span><span class="p">(</span><span class="s">&#39;BlogEntry&#39;</span><span class="p">)</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">render_entity_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">display_cw_logo</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">(</span><span class="s">u&#39;&lt;image src=&quot;http://www.cubicweb.org/doc/en/_static/cubicweb.png&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BlogEntryPrimaryView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render_entity_title</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
</pre></div>
<p>Then each blog entry whose title contains &#8216;CW&#8217; is shown with the CubicWeb logo in front of it.</p>
</div>
<div class="section" id="updating-the-schema-and-synchronising-the-instance">
<span id="updatingschemaandsynchronisinginstance"></span><h1>1.8. Updating the schema and synchronising the instance<a class="headerlink" href="#updating-the-schema-and-synchronising-the-instance" title="Permalink to this headline">¶</a></h1>
<p>While developping your cube, you may want to update your data model. Let&#8217;s say you
want to add a <tt class="docutils literal"><span class="pre">category</span></tt> attribute in the <tt class="docutils literal"><span class="pre">Blog</span></tt> data type. This is called a migration.</p>
<p>The required steps are:</p>
<ol class="arabic simple">
<li>modify the file <tt class="docutils literal"><span class="pre">schema.py</span></tt>. The <tt class="docutils literal"><span class="pre">Blog</span></tt> class looks now like this:</li>
</ol>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">EntityType</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">description</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
  <span class="n">category</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vocabulary</span><span class="o">=</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Professional&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Personal&#39;</span><span class="p">)),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;Personal&#39;</span><span class="p">)</span>
</pre></div>
<ol class="arabic simple" start="2">
<li>stop your <tt class="docutils literal"><span class="pre">blogdemo</span></tt> instance:</li>
</ol>
<div class="highlight"><pre>cubicweb-ctl stop blogdemo
</pre></div>
<ol class="arabic simple" start="3">
<li>start the cubicweb shell for your instance by running the following command:</li>
</ol>
<div class="highlight"><pre>cubicweb-ctl shell blogdemo
</pre></div>
<ol class="arabic simple" start="4">
<li>at the cubicweb shell prompt, execute:</li>
</ol>
<div class="highlight"><pre><span class="n">add_attribute</span><span class="p">(</span><span class="s">&#39;Blog&#39;</span><span class="p">,</span> <span class="s">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
<ol class="arabic simple" start="5">
<li>restart your instance:</li>
</ol>
<div class="highlight"><pre>cubicweb-ctl start blogdemo
</pre></div>
<p>6. modify a blog entity and check that the new attribute
<tt class="docutils literal"><span class="pre">category</span></tt> has been added.</p>
<p>Of course, you may also want to add relations, entity types, etc. See <a class="reference external" href="../../devrepo/migration.html#migration"><em>Migration</em></a>
for a list of all available migration commands.</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="components.html" title="1.9. Cubes"
             >next</a> |</li>
        <li class="right" >
          <a href="blog-in-five-minutes.html" title="1.1. Get a blog running in five minutes!"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.10.7</a> &raquo;</li>
          <li><a href="../index.html" >Tutorials</a> &raquo;</li>
          <li><a href="index.html" >1. Building a simple blog</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2001-2010, Logilab.
      Last updated on Jan 12, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.6.
    </div>
  </body>
</html>