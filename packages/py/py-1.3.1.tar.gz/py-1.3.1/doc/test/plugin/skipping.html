<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>skipping</title>
    <meta content="text/html;charset=ISO-8859-1" name="Content-Type"/>
    <link href="../../style.css" media="screen" rel="stylesheet" type="text/css"/></head>
  <body>
    <div id="navspace">
      <div><a href="http://pylib.org"><img alt="py lib" height="57" id="pyimg" src="http://codespeak.net/img/pylib.png" width="77"/></a></div>
      <div id="menubar">
        <div>
          <div><a class="menu" href="../../announce/release-1.3.1.html">1.3.1 ANN</a></div></div>
        <div>
          <div><a class="menu" href="../../install.html">INSTALL</a></div></div>
        <div>
          <div><a class="menu" href="../../contact.html">CONTACT</a></div></div>
        <div>
          <div><a class="menu" href="../../changelog.html">CHANGELOG</a></div></div>
        <div>
          <div><a class="menu" href="../../faq.html">FAQ</a></div></div>
        <div>
          <div>
            <h3>py.test:</h3>
            <div><a class="menu" href="../index.html">Index</a></div>
            <div><a class="menu" href="../quickstart.html">Quickstart</a></div>
            <div><a class="menu" href="../features.html">Features</a></div>
            <div><a class="menu" href="../funcargs.html">Funcargs</a></div>
            <div><a class="menu" href="index.html">Plugins</a></div>
            <div><a class="menu" href="../customize.html">Customize</a></div>
            <div><a class="menu" href="../talks.html">Tutorials</a></div><a class="menu" href="http://hudson.testrun.org">hudson-tests</a></div></div>
        <div>
          <div>
            <h3>supporting APIs:</h3>
            <div><a class="menu" href="../../index.html">Index</a></div>
            <div><a class="menu" href="../../path.html">py.path</a></div>
            <div><a class="menu" href="../../code.html">py.code</a></div></div></div></div></div>
    <div id="contentspace">


<div class="section" id="advanced-skipping-for-python-test-functions-classes-or-modules">
<h1>advanced skipping for python test functions, classes or modules.</h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#skipping-a-single-function" id="id1">Skipping a single function</a></li>
<li><a class="reference internal" href="#skip-groups-of-test-functions" id="id2">skip groups of test functions</a></li>
<li><a class="reference internal" href="#mark-a-test-function-as-expected-to-fail" id="id3">mark a test function as <strong>expected to fail</strong></a></li>
<li><a class="reference internal" href="#skipping-on-a-missing-import-dependency" id="id4">skipping on a missing import dependency</a></li>
<li><a class="reference internal" href="#imperative-skip-from-within-a-test-or-setup-function" id="id5">imperative skip from within a test or setup function</a></li>
<li><a class="reference internal" href="#command-line-options" id="id6">command line options</a></li>
</ul>
</div>
<p>With this plugin you can mark test functions for conditional skipping
or as &quot;xfail&quot;, expected-to-fail.  Skipping a test will avoid running it
while xfail-marked tests will run and result in an inverted outcome:
a pass becomes a failure and a fail becomes a semi-passing one.</p>
<p>The need for skipping a test is usually connected to a condition.
If a test fails under all conditions then it's probably better
to mark your test as 'xfail'.</p>
<p>By passing <tt class="docutils literal"><span class="pre">-rxs</span></tt> to the terminal reporter you will see extra
summary information on skips and xfail-run tests at the end of a test run.</p>
<div class="section" id="skipping-a-single-function">
<span id="skipif"></span><h2><a class="toc-backref" href="#id1">Skipping a single function</a></h2>
<p>Here is an example for marking a test function to be skipped
when run on a Python3 interpreter:</p>
<pre class="literal-block">
&#64;py.test.mark.skipif(&quot;sys.version_info &gt;= (3,0)&quot;)
def test_function():
    ...
</pre>
<p>During test function setup the skipif condition is
evaluated by calling <tt class="docutils literal">eval(expr, namespace)</tt>.  The namespace
contains the  <tt class="docutils literal">sys</tt> and <tt class="docutils literal">os</tt> modules and the test
<tt class="docutils literal">config</tt> object.  The latter allows you to skip based
on a test configuration value e.g. like this:</p>
<pre class="literal-block">
&#64;py.test.mark.skipif(&quot;not config.getvalue('db')&quot;)
def test_function(...):
    ...
</pre>
<p>Create a shortcut for your conditional skip decorator
at module level like this:</p>
<pre class="literal-block">
win32only = py.test.mark.skipif(&quot;sys.platform != 'win32'&quot;)

&#64;win32only
def test_function():
    ...
</pre>
</div>
<div class="section" id="skip-groups-of-test-functions">
<h2><a class="toc-backref" href="#id2">skip groups of test functions</a></h2>
<p>As with all metadata function marking you can do it at
<a class="reference external" href="mark.html#scoped-marking">whole class- or module level</a>.  Here is an example
for skipping all methods of a test class based on platform:</p>
<pre class="literal-block">
class TestPosixCalls:
    pytestmark = py.test.mark.skipif(&quot;sys.platform == 'win32'&quot;)

    def test_function(self):
        # will not be setup or run under 'win32' platform
        #
</pre>
<p>The <tt class="docutils literal">pytestmark</tt> decorator will be applied to each test function.
If your code targets python2.6 or above you can also use the
skipif decorator with classes:</p>
<pre class="literal-block">
&#64;py.test.mark.skipif(&quot;sys.platform == 'win32'&quot;)
class TestPosixCalls:

    def test_function(self):
        # will not be setup or run under 'win32' platform
        #
</pre>
<p>It is fine in both situations to use multiple &quot;skipif&quot; decorators
on a single function.</p>
</div>
<div class="section" id="mark-a-test-function-as-expected-to-fail">
<h2><a class="toc-backref" href="#id3">mark a test function as <strong>expected to fail</strong></a></h2>
<p>You can use the <tt class="docutils literal">xfail</tt> marker to indicate that you
expect the test to fail:</p>
<pre class="literal-block">
&#64;py.test.mark.xfail
def test_function():
    ...
</pre>
<p>This test will be run but no traceback will be reported
when it fails. Instead terminal reporting will list it in the
&quot;expected to fail&quot; or &quot;unexpectedly passing&quot; sections.</p>
<p>Same as with <a class="reference internal" href="#skipif">skipif</a> you can also selectively expect a failure
depending on platform:</p>
<pre class="literal-block">
&#64;py.test.mark.xfail(&quot;sys.version_info &gt;= (3,0)&quot;)
def test_function():
    ...
</pre>
<p>To not run a test and still regard it as &quot;xfailed&quot;:</p>
<pre class="literal-block">
&#64;py.test.mark.xfail(..., run=False)
</pre>
<p>To specify an explicit reason to be shown with xfailure detail:</p>
<pre class="literal-block">
&#64;py.test.mark.xfail(..., reason=&quot;my reason&quot;)
</pre>
</div>
<div class="section" id="skipping-on-a-missing-import-dependency">
<h2><a class="toc-backref" href="#id4">skipping on a missing import dependency</a></h2>
<p>You can use the following import helper at module level
or within a test or test setup function:</p>
<pre class="literal-block">
docutils = py.test.importorskip(&quot;docutils&quot;)
</pre>
<p>If <tt class="docutils literal">docutils</tt> cannot be imported here, this will lead to a
skip outcome of the test.  You can also skip dependeing if
if a library does not come with a high enough version:</p>
<pre class="literal-block">
docutils = py.test.importorskip(&quot;docutils&quot;, minversion=&quot;0.3&quot;)
</pre>
<p>The version will be read from the specified module's <tt class="docutils literal">__version__</tt> attribute.</p>
</div>
<div class="section" id="imperative-skip-from-within-a-test-or-setup-function">
<h2><a class="toc-backref" href="#id5">imperative skip from within a test or setup function</a></h2>
<p>If for some reason you cannot declare skip-conditions
you can also imperatively produce a Skip-outcome from
within test or setup code.  Example:</p>
<pre class="literal-block">
def test_function():
    if not valid_config():
        py.test.skip(&quot;unsuppored configuration&quot;)
</pre>
</div>
<div class="section" id="command-line-options">
<h2><a class="toc-backref" href="#id6">command line options</a></h2>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">--runxfail</span></tt></dt>
<dd>run tests even if they are marked xfail</dd>
</dl>
</div>
</div>
<div class="section" id="start-improving-this-plugin-in-30-seconds">
<h1>Start improving this plugin in 30 seconds</h1>
<ol class="arabic simple">
<li>Download <a class="reference external" href="http://bitbucket.org/hpk42/py-trunk/raw/1.3.0/py/_plugin/pytest_skipping.py">pytest_skipping.py</a> plugin source code</li>
<li>put it somewhere as <tt class="docutils literal">pytest_skipping.py</tt> into your import path</li>
<li>a subsequent <tt class="docutils literal">py.test</tt> run will use your local version</li>
</ol>
<p>Checkout <a class="reference external" href="../customize.html">customize</a>, other <a class="reference external" href="index.html">plugins</a> or <a class="reference external" href="../../contact.html">get in contact</a>.</p>
</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-7597274-3");
pageTracker._trackPageview();
} catch(err) {}</script>
</body></html>