<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>code</title>
    <meta content="text/html;charset=ISO-8859-1" name="Content-Type"/>
    <link href="style.css" media="screen" rel="stylesheet" type="text/css"/></head>
  <body>
    <div id="navspace">
      <div><a href="http://pylib.org"><img alt="py lib" height="57" id="pyimg" src="http://codespeak.net/img/pylib.png" width="77"/></a></div>
      <div id="menubar">
        <div>
          <div><a class="menu" href="announce/release-1.3.0.html">1.3.0 ANN</a></div></div>
        <div>
          <div><a class="menu" href="install.html">INSTALL</a></div></div>
        <div>
          <div><a class="menu" href="contact.html">CONTACT</a></div></div>
        <div>
          <div><a class="menu" href="changelog.html">CHANGELOG</a></div></div>
        <div>
          <div><a class="menu" href="faq.html">FAQ</a></div></div>
        <div>
          <div>
            <h3>py.test:</h3>
            <div><a class="menu" href="test/index.html">Index</a></div>
            <div><a class="menu" href="test/quickstart.html">Quickstart</a></div>
            <div><a class="menu" href="test/features.html">Features</a></div>
            <div><a class="menu" href="test/funcargs.html">Funcargs</a></div>
            <div><a class="menu" href="test/plugin/index.html">Plugins</a></div>
            <div><a class="menu" href="test/customize.html">Customize</a></div>
            <div><a class="menu" href="test/talks.html">Tutorials</a></div><a class="menu" href="http://hudson.testrun.org">hudson-tests</a></div></div>
        <div>
          <div>
            <h3>supporting APIs:</h3>
            <div><a class="menu" href="index.html">Index</a></div>
            <div><a class="menu" href="path.html">py.path</a></div>
            <div><a class="menu" href="code.html">py.code</a></div></div></div></div></div>
    <div id="contentspace">
<div class="document" id="py-code-higher-level-python-code-and-introspection-objects">
<h1 class="title">py.code: higher level python code and introspection objects</h1>

<p>The <tt class="docutils literal">py.code</tt> part of the pylib contains some functionality to help
dealing with Python code objects. Even though working with Python's internal
code objects (as found on frames and callables) can be very powerful, it's
usually also quite cumbersome, because the API provided by core Python is
relatively low level and not very accessible.</p>
<p>The <tt class="docutils literal">py.code</tt> library tries to simplify accessing the code objects as well
as creating them. There is a small set of interfaces a user needs to deal with,
all nicely bundled together, and with a rich set of 'Pythonic' functionality.</p>
<div class="section" id="contents-of-the-library">
<h1>Contents of the library</h1>
<p>Every object in the <tt class="docutils literal">py.code</tt> library wraps a code Python object related
to code objects, source code, frames and tracebacks: the <tt class="docutils literal">py.code.Code</tt>
class wraps code objects, <tt class="docutils literal">py.code.Source</tt> source snippets,
<tt class="docutils literal">py.code.Traceback` exception tracebacks, ``py.code.Frame</tt> frame
objects (as found in e.g. tracebacks) and <tt class="docutils literal">py.code.ExceptionInfo</tt> the
tuple provided by sys.exc_info() (containing exception and traceback
information when an exception occurs). Also in the library is a helper function
<tt class="docutils literal">py.code.compile()</tt> that provides the same functionality as Python's
built-in 'compile()' function, but returns a wrapped code object.</p>
</div>
<div class="section" id="the-wrappers">
<h1>The wrappers</h1>
<div class="section" id="py-code-code">
<h2><tt class="docutils literal">py.code.Code</tt></h2>
<p>Code objects are instantiated with a code object or a callable as argument,
and provide functionality to compare themselves with other Code objects, get to
the source file or its contents, create new Code objects from scratch, etc.</p>
<p>A quick example:</p>
<pre class="literal-block">
&gt;&gt;&gt; import py
&gt;&gt;&gt; c = py.code.Code(py.path.local.read)
&gt;&gt;&gt; c.path.basename
'common.py'
&gt;&gt;&gt; isinstance(c.source(), py.code.Source)
True
&gt;&gt;&gt; str(c.source()).split('\n')[0]
&quot;def read(self, mode='r'):&quot;
</pre>
</div>
<div class="section" id="py-code-source">
<h2><tt class="docutils literal">py.code.Source</tt></h2>
<p>Source objects wrap snippets of Python source code, providing a simple yet
powerful interface to read, deindent, slice, compare, compile and manipulate
them, things that are not so easy in core Python.</p>
<p>Example:</p>
<pre class="literal-block">
&gt;&gt;&gt; s = py.code.Source(&quot;&quot;&quot;\
...   def foo():
...     print &quot;foo&quot;
... &quot;&quot;&quot;)
&gt;&gt;&gt; str(s).startswith('def') # automatic de-indentation!
True
&gt;&gt;&gt; s.isparseable()
True
&gt;&gt;&gt; sub = s.getstatement(1) # get the statement starting at line 1
&gt;&gt;&gt; str(sub).strip() # XXX why is the strip() required?!?
'print &quot;foo&quot;'
</pre>
</div>
<div class="section" id="py-code-traceback">
<h2><tt class="docutils literal">py.code.Traceback</tt></h2>
<p>Tracebacks are usually not very easy to examine, you need to access certain
somewhat hidden attributes of the traceback's items (resulting in expressions
such as 'fname = tb.tb_next.tb_frame.f_code.co_filename'). The Traceback
interface (and its TracebackItem children) tries to improve this.</p>
<p>Example:</p>
<pre class="literal-block">
&gt;&gt;&gt; import sys
&gt;&gt;&gt; try:
...   py.path.local(100) # illegal argument
... except:
...   exc, e, tb = sys.exc_info()
&gt;&gt;&gt; t = py.code.Traceback(tb)
&gt;&gt;&gt; first = t[1] # get the second entry (first is in this doc)
&gt;&gt;&gt; first.path.basename # second is in py/path/local.py
'local.py'
&gt;&gt;&gt; isinstance(first.statement, py.code.Source)
True
&gt;&gt;&gt; str(first.statement).strip().startswith('raise ValueError')
True
</pre>
</div>
<div class="section" id="py-code-frame">
<h2><tt class="docutils literal">py.code.Frame</tt></h2>
<p>Frame wrappers are used in <tt class="docutils literal">py.code.Traceback</tt> items, and will usually not
directly be instantiated. They provide some nice methods to evaluate code
'inside' the frame (using the frame's local variables), get to the underlying
code (frames have a code attribute that points to a <tt class="docutils literal">py.code.Code</tt> object)
and examine the arguments.</p>
<p>Example (using the 'first' TracebackItem instance created above):</p>
<pre class="literal-block">
&gt;&gt;&gt; frame = first.frame
&gt;&gt;&gt; isinstance(frame.code, py.code.Code)
True
&gt;&gt;&gt; isinstance(frame.eval('self'), py.path.local)
True
&gt;&gt;&gt; [namevalue[0] for namevalue in frame.getargs()]
['cls', 'path']
</pre>
</div>
<div class="section" id="py-code-exceptioninfo">
<h2><tt class="docutils literal">py.code.ExceptionInfo</tt></h2>
<p>A wrapper around the tuple returned by sys.exc_info() (will call sys.exc_info()
itself if the tuple is not provided as an argument), provides some handy
attributes to easily access the traceback and exception string.</p>
<p>Example:</p>
<pre class="literal-block">
&gt;&gt;&gt; import sys
&gt;&gt;&gt; try:
...   foobar()
... except:
...   excinfo = py.code.ExceptionInfo()
&gt;&gt;&gt; excinfo.typename
'NameError'
&gt;&gt;&gt; isinstance(excinfo.traceback, py.code.Traceback)
True
&gt;&gt;&gt; excinfo.exconly()
&quot;NameError: name 'foobar' is not defined&quot;
</pre>
</div>
</div>
</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-7597274-3");
pageTracker._trackPageview();
} catch(err) {}</script>
</body></html>