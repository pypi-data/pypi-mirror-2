<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>xfail</title>
    <meta content="text/html;charset=ISO-8859-1" name="Content-Type"/>
    <link href="../../style.css" media="screen" rel="stylesheet" type="text/css"/></head>
  <body>
    <div id="navspace">
      <div><a href="http://pylib.org"><img alt="py lib" height="57" id="pyimg" src="http://codespeak.net/img/pylib.png" width="77"/></a></div>
      <div id="menubar">
        <div style="font-style: italic;">trunk</div>
        <div>
          <div><a class="menu" href="../../download.html">install</a></div></div>
        <div>
          <div><a class="menu" href="../../contact.html">contact</a></div></div>
        <div>
          <div><a class="menu" href="../../changelog.html">changelog</a></div></div>
        <div>
          <div><a class="menu" href="../../faq.html">faq</a></div></div>
        <div>
          <div>
            <h3>py.test:</h3>
            <div><a class="menu" href="../index.html">doc index</a></div>
            <div><a class="menu" href="../features.html">features</a></div>
            <div><a class="menu" href="../quickstart.html">quickstart</a></div>
            <div><a class="menu" href="../talks.html">tutorials</a></div>
            <div><a class="menu" href="index.html">plugins</a></div>
            <div><a class="menu" href="../funcargs.html">funcargs</a></div>
            <div><a class="menu" href="../customize.html">customize</a></div></div></div>
        <div>
          <div>
            <h3>supporting APIs:</h3>
            <div><a class="menu" href="../../index.html">pylib index</a></div>
            <div><a class="menu" href="../../execnet.html">py.execnet</a></div>
            <div><a class="menu" href="../../path.html">py.path</a></div>
            <div><a class="menu" href="../../code.html">py.code</a></div></div></div></div></div>
    <div id="contentspace">


<div class="section" id="pytest-xfail-plugin">
<h1>pytest_xfail plugin</h1>
<p>mark python test functions, classes or modules for conditional</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#skip-a-test-function-conditionally" id="id1">skip a test function conditionally</a></li>
<li><a class="reference internal" href="#conditionally-mark-a-function-as-expected-to-fail" id="id2">conditionally mark a function as &quot;expected to fail&quot;</a></li>
<li><a class="reference internal" href="#skip-xfail-a-whole-test-class-or-module" id="id3">skip/xfail a whole test class or module</a></li>
<li><a class="reference internal" href="#skip-if-a-dependency-cannot-be-imported" id="id4">skip if a dependency cannot be imported</a></li>
<li><a class="reference internal" href="#dynamically-skip-from-within-a-test-or-setup" id="id5">dynamically skip from within a test or setup</a></li>
</ul>
</div>
<p>skipping (skipif) or as expected-to-fail (xfail).  Both declarations
lead to special reporting and both can be systematically associated
with functions, whole classes or modules. The difference between
the two is that 'xfail' will still execute test functions
but it will revert the outcome.  A passing test is now
a failure and failing test is expected.  All skip conditions
are reported at the end of test run through the terminal
reporter.</p>
<div class="section" id="skip-a-test-function-conditionally">
<span id="skipif"></span><h2><a class="toc-backref" href="#id1">skip a test function conditionally</a></h2>
<p>Here is an example for skipping a test function on Python3:</p>
<pre class="literal-block">
&#64;py.test.mark.skipif(&quot;sys.version_info &gt;= (3,0)&quot;)
def test_function():
    ...
</pre>
<p>Conditions are specified as python expressions
and can access the <tt class="docutils literal"><span class="pre">sys</span></tt> module.  They can also
access the config object and thus depend on command
line or conftest options:</p>
<pre class="literal-block">
&#64;py.test.mark.skipif(&quot;config.getvalue('db') is None&quot;)
def test_function(...):
    ...
</pre>
</div>
<div class="section" id="conditionally-mark-a-function-as-expected-to-fail">
<h2><a class="toc-backref" href="#id2">conditionally mark a function as &quot;expected to fail&quot;</a></h2>
<p>You can use the <tt class="docutils literal"><span class="pre">xfail</span></tt> keyword to mark your test functions as
'expected to fail':</p>
<pre class="literal-block">
&#64;py.test.mark.xfail
def test_hello():
    ...
</pre>
<p>This test will be executed but no traceback will be reported
when it fails. Instead terminal reporting will list it in the
&quot;expected to fail&quot; or &quot;unexpectedly passing&quot; sections.
As with <a class="reference internal" href="#skipif">skipif</a> you may selectively expect a failure
depending on platform:</p>
<pre class="literal-block">
&#64;py.test.mark.xfail(&quot;sys.version_info &gt;= (3,0)&quot;)
def test_function():
    ...
</pre>
</div>
<div class="section" id="skip-xfail-a-whole-test-class-or-module">
<h2><a class="toc-backref" href="#id3">skip/xfail a whole test class or module</a></h2>
<p>Instead of marking single functions you can skip
a whole class of tests when runnign on a specific
platform:</p>
<pre class="literal-block">
class TestSomething:
    skipif = &quot;sys.platform == 'win32'&quot;
</pre>
<p>Or you can mark all test functions as expected
to fail for a specific test configuration:</p>
<pre class="literal-block">
xfail = &quot;config.getvalue('db') == 'mysql'&quot;
</pre>
</div>
<div class="section" id="skip-if-a-dependency-cannot-be-imported">
<h2><a class="toc-backref" href="#id4">skip if a dependency cannot be imported</a></h2>
<p>You can use a helper to skip on a failing import:</p>
<pre class="literal-block">
docutils = py.test.importorskip(&quot;docutils&quot;)
</pre>
<p>You can use this helper at module level or within
a test or setup function.</p>
<p>You can aslo skip if a library does not have the right version:</p>
<pre class="literal-block">
docutils = py.test.importorskip(&quot;docutils&quot;, minversion=&quot;0.3&quot;)
</pre>
<p>The version will be read from the specified module's <tt class="docutils literal"><span class="pre">__version__</span></tt> attribute.</p>
</div>
<div class="section" id="dynamically-skip-from-within-a-test-or-setup">
<h2><a class="toc-backref" href="#id5">dynamically skip from within a test or setup</a></h2>
<p>If you want to skip the execution of a test you can call
<tt class="docutils literal"><span class="pre">py.test.skip()</span></tt> within a test, a setup or from a
<a class="reference external" href="../funcargs.html#factory">funcarg factory</a> function.  Example:</p>
<pre class="literal-block">
def test_function():
    if not valid_config():
        py.test.skip(&quot;unsuppored configuration&quot;)
</pre>
</div>
</div>
<div class="section" id="start-improving-this-plugin-in-30-seconds">
<h1>Start improving this plugin in 30 seconds</h1>
<ol class="arabic simple">
<li>Download <a class="reference external" href="http://bitbucket.org/hpk42/py-trunk/raw/1.1.0b1/py/test/plugin/pytest_xfail.py">pytest_xfail.py</a> plugin source code</li>
<li>put it somewhere as <tt class="docutils literal"><span class="pre">pytest_xfail.py</span></tt> into your import path</li>
<li>a subsequent <tt class="docutils literal"><span class="pre">py.test</span></tt> run will use your local version</li>
</ol>
<p>Checkout <a class="reference external" href="../customize.html">customize</a>, other <a class="reference external" href="index.html">plugins</a> or <a class="reference external" href="../../contact.html">get in contact</a>.</p>
</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-7597274-3");
pageTracker._trackPageview();
} catch(err) {}</script>
</body></html>