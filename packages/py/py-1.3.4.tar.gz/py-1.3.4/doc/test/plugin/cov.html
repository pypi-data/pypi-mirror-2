<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>cov</title>
    <meta content="text/html;charset=ISO-8859-1" name="Content-Type"/>
    <link href="../../style.css" media="screen" rel="stylesheet" type="text/css"/></head>
  <body>
    <div id="navspace">
      <div><a href="http://pylib.org"><img alt="py lib" height="57" id="pyimg" src="http://codespeak.net/img/pylib.png" width="77"/></a></div>
      <div id="menubar">
        <div>
          <div><a class="menu" href="../../announce/release-1.3.4.html">1.3.4 ANN</a></div></div>
        <div>
          <div><a class="menu" href="../../install.html">INSTALL</a></div></div>
        <div>
          <div><a class="menu" href="../../contact.html">CONTACT</a></div></div>
        <div>
          <div><a class="menu" href="../../changelog.html">CHANGELOG</a></div></div>
        <div>
          <div><a class="menu" href="../../faq.html">FAQ</a></div></div>
        <div>
          <div>
            <h3>py.test:</h3>
            <div><a class="menu" href="../index.html">Index</a></div>
            <div><a class="menu" href="../quickstart.html">Quickstart</a></div>
            <div><a class="menu" href="../features.html">Features</a></div>
            <div><a class="menu" href="../funcargs.html">Funcargs</a></div>
            <div><a class="menu" href="index.html">Plugins</a></div>
            <div><a class="menu" href="../customize.html">Customize</a></div>
            <div><a class="menu" href="../talks.html">Tutorials</a></div><a class="menu" href="http://hudson.testrun.org">hudson-tests</a></div></div>
        <div>
          <div>
            <h3>supporting APIs:</h3>
            <div><a class="menu" href="../../index.html">Index</a></div>
            <div><a class="menu" href="../../path.html">py.path</a></div>
            <div><a class="menu" href="../../code.html">py.code</a></div></div></div></div></div>
    <div id="contentspace">
<div class="document" id="produce-code-coverage-reports-using-the-coverage-package-including-support-for-distributed-testing">
<h1 class="title">produce code coverage reports using the 'coverage' package, including support for distributed testing.</h1>

<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#installation" id="id1">Installation</a></li>
<li><a class="reference internal" href="#uninstallation" id="id2">Uninstallation</a></li>
<li><a class="reference internal" href="#usage" id="id3">Usage</a><ul>
<li><a class="reference internal" href="#centralised-testing" id="id4">Centralised Testing</a></li>
<li><a class="reference internal" href="#distributed-testing-load" id="id5">Distributed Testing: Load</a></li>
<li><a class="reference internal" href="#distributed-testing-each" id="id6">Distributed Testing: Each</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reporting" id="id7">Reporting</a></li>
<li><a class="reference internal" href="#coverage-data-file" id="id8">Coverage Data File</a></li>
<li><a class="reference internal" href="#limitations" id="id9">Limitations</a></li>
<li><a class="reference internal" href="#acknowledgements" id="id10">Acknowledgements</a></li>
<li><a class="reference internal" href="#command-line-options" id="id11">command line options</a></li>
</ul>
</div>
<p>This plugin produces coverage reports.  It supports centralised testing and distributed testing in
both load and each modes.  It also supports coverage of subprocesses.</p>
<p>All features offered by the coverage package should be available, either through pytest-cov or
through coverage's config file.</p>
<div class="section" id="installation">
<h1><a class="toc-backref" href="#id1">Installation</a></h1>
<p>The <a class="reference external" href="http://pypi.python.org/pypi/pytest-cov/">pytest-cov</a> package may be installed with pip or easy_install:</p>
<pre class="literal-block">
pip install pytest-cov
easy_install pytest-cov
</pre>
</div>
<div class="section" id="uninstallation">
<h1><a class="toc-backref" href="#id2">Uninstallation</a></h1>
<p>Uninstalling packages is supported by pip:</p>
<pre class="literal-block">
pip uninstall pytest-cov
</pre>
<p>However easy_install does not provide an uninstall facility.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<p>Ensure that you manually delete the init_cov_core.pth file in your site-packages directory.</p>
<p class="last">This file starts coverage collection of subprocesses if appropriate during site initialisation
at python startup.</p>
</div>
</div>
<div class="section" id="usage">
<h1><a class="toc-backref" href="#id3">Usage</a></h1>
<div class="section" id="centralised-testing">
<h2><a class="toc-backref" href="#id4">Centralised Testing</a></h2>
<p>Centralised testing will report on the combined coverage of the main process and all of it's
subprocesses.</p>
<p>Running centralised testing:</p>
<pre class="literal-block">
py.test --cov myproj tests/
</pre>
<p>Shows a terminal report:</p>
<pre class="literal-block">
-------------------- coverage: platform linux2, python 2.6.4-final-0 ---------------------
Name                 Stmts   Miss  Cover
----------------------------------------
myproj/__init__          2      0   100%
myproj/myproj          257     13    94%
myproj/feature4286      94      7    92%
----------------------------------------
TOTAL                  353     20    94%
</pre>
</div>
<div class="section" id="distributed-testing-load">
<h2><a class="toc-backref" href="#id5">Distributed Testing: Load</a></h2>
<p>Distributed testing with dist mode set to load will report on the combined coverage of all slaves.
The slaves may be spread out over any number of hosts and each slave may be located anywhere on the
file system.  Each slave will have it's subprocesses measured.</p>
<p>Running distributed testing with dist mode set to load:</p>
<pre class="literal-block">
py.test --cov myproj -n 2 tests/
</pre>
<p>Shows a terminal report:</p>
<pre class="literal-block">
-------------------- coverage: platform linux2, python 2.6.4-final-0 ---------------------
Name                 Stmts   Miss  Cover
----------------------------------------
myproj/__init__          2      0   100%
myproj/myproj          257     13    94%
myproj/feature4286      94      7    92%
----------------------------------------
TOTAL                  353     20    94%
</pre>
<p>Again but spread over different hosts and different directories:</p>
<pre class="literal-block">
py.test --cov myproj --dist load
        --tx ssh=memedough&#64;host1//chdir=testenv1
        --tx ssh=memedough&#64;host2//chdir=/tmp/testenv2//python=/tmp/env1/bin/python
        --rsyncdir myproj --rsyncdir tests --rsync examples
        tests/
</pre>
<p>Shows a terminal report:</p>
<pre class="literal-block">
-------------------- coverage: platform linux2, python 2.6.4-final-0 ---------------------
Name                 Stmts   Miss  Cover
----------------------------------------
myproj/__init__          2      0   100%
myproj/myproj          257     13    94%
myproj/feature4286      94      7    92%
----------------------------------------
TOTAL                  353     20    94%
</pre>
</div>
<div class="section" id="distributed-testing-each">
<h2><a class="toc-backref" href="#id6">Distributed Testing: Each</a></h2>
<p>Distributed testing with dist mode set to each will report on the combined coverage of all slaves.
Since each slave is running all tests this allows generating a combined coverage report for multiple
environments.</p>
<p>Running distributed testing with dist mode set to each:</p>
<pre class="literal-block">
py.test --cov myproj --dist each
        --tx popen//chdir=/tmp/testenv3//python=/usr/local/python27/bin/python
        --tx ssh=memedough&#64;host2//chdir=/tmp/testenv4//python=/tmp/env2/bin/python
        --rsyncdir myproj --rsyncdir tests --rsync examples
        tests/
</pre>
<p>Shows a terminal report:</p>
<pre class="literal-block">
---------------------------------------- coverage ----------------------------------------
                          platform linux2, python 2.6.5-final-0
                          platform linux2, python 2.7.0-final-0
Name                 Stmts   Miss  Cover
----------------------------------------
myproj/__init__          2      0   100%
myproj/myproj          257     13    94%
myproj/feature4286      94      7    92%
----------------------------------------
TOTAL                  353     20    94%
</pre>
</div>
</div>
<div class="section" id="reporting">
<h1><a class="toc-backref" href="#id7">Reporting</a></h1>
<p>It is possible to generate any combination of the reports for a single test run.</p>
<p>The available reports are terminal (with or without missing line numbers shown), HTML, XML and
annotated source code.</p>
<p>The terminal report without line numbers (default):</p>
<pre class="literal-block">
py.test --cov-report term --cov myproj tests/

-------------------- coverage: platform linux2, python 2.6.4-final-0 ---------------------
Name                 Stmts   Miss  Cover
----------------------------------------
myproj/__init__          2      0   100%
myproj/myproj          257     13    94%
myproj/feature4286      94      7    92%
----------------------------------------
TOTAL                  353     20    94%
</pre>
<p>The terminal report with line numbers:</p>
<pre class="literal-block">
py.test --cov-report term-missing --cov myproj tests/

-------------------- coverage: platform linux2, python 2.6.4-final-0 ---------------------
Name                 Stmts   Miss  Cover   Missing
--------------------------------------------------
myproj/__init__          2      0   100%
myproj/myproj          257     13    94%   24-26, 99, 149, 233-236, 297-298, 369-370
myproj/feature4286      94      7    92%   183-188, 197
--------------------------------------------------
TOTAL                  353     20    94%
</pre>
<p>The remaining three reports output to files without showing anything on the terminal (useful for
when the output is going to a continuous integration server):</p>
<pre class="literal-block">
py.test --cov-report html --cov-report xml --cov-report annotate --cov myproj tests/
</pre>
</div>
<div class="section" id="coverage-data-file">
<h1><a class="toc-backref" href="#id8">Coverage Data File</a></h1>
<p>The data file is erased at the beginning of testing to ensure clean data for each test run.</p>
<p>The data file is left at the end of testing so that it is possible to use normal coverage tools to
examine it.</p>
</div>
<div class="section" id="limitations">
<h1><a class="toc-backref" href="#id9">Limitations</a></h1>
<p>For distributed testing the slaves must have the pytest-cov package installed.  This is needed since
the plugin must be registered through setuptools / distribute for pytest to start the plugin on the
slave.</p>
<p>For subprocess measurement environment variables must make it from the main process to the
subprocess.  The python used by the subprocess must have pytest-cov installed.  The subprocess must
do normal site initialisation so that the environment variables can be detected and coverage
started.</p>
</div>
<div class="section" id="acknowledgements">
<h1><a class="toc-backref" href="#id10">Acknowledgements</a></h1>
<p>Holger Krekel for pytest with its distributed testing support.</p>
<p>Ned Batchelder for coverage and its ability to combine the coverage results of parallel runs.</p>
<p>Whilst this plugin has been built fresh from the ground up to support distributed testing it has
been influenced by the work done on pytest-coverage (Ross Lawley, James Mills, Holger Krekel) and
nose-cover (Jason Pellerin) which are other coverage plugins for pytest and nose respectively.</p>
<p>No doubt others have contributed to these tools as well.</p>
</div>
<div class="section" id="command-line-options">
<h1><a class="toc-backref" href="#id11">command line options</a></h1>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">--cov=path</span></tt></dt>
<dd>measure coverage for filesystem path (multi-allowed)</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-report=type</span></tt></dt>
<dd>type of report to generate: term, term-missing, annotate, html, xml (multi-allowed)</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-config=path</span></tt></dt>
<dd>config file for coverage, default: .coveragerc</dd>
</dl>
</div>
</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-7597274-3");
pageTracker._trackPageview();
} catch(err) {}</script>
</body></html>