<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>cov</title>
    <meta content="text/html;charset=ISO-8859-1" name="Content-Type"/>
    <link href="../../style.css" media="screen" rel="stylesheet" type="text/css"/></head>
  <body>
    <div id="navspace">
      <div><a href="http://pylib.org"><img alt="py lib" height="57" id="pyimg" src="http://codespeak.net/img/pylib.png" width="77"/></a></div>
      <div id="menubar">
        <div>
          <div><a class="menu" href="../../announce/release-1.3.2.html">1.3.2 ANN</a></div></div>
        <div>
          <div><a class="menu" href="../../install.html">INSTALL</a></div></div>
        <div>
          <div><a class="menu" href="../../contact.html">CONTACT</a></div></div>
        <div>
          <div><a class="menu" href="../../changelog.html">CHANGELOG</a></div></div>
        <div>
          <div><a class="menu" href="../../faq.html">FAQ</a></div></div>
        <div>
          <div>
            <h3>py.test:</h3>
            <div><a class="menu" href="../index.html">Index</a></div>
            <div><a class="menu" href="../quickstart.html">Quickstart</a></div>
            <div><a class="menu" href="../features.html">Features</a></div>
            <div><a class="menu" href="../funcargs.html">Funcargs</a></div>
            <div><a class="menu" href="index.html">Plugins</a></div>
            <div><a class="menu" href="../customize.html">Customize</a></div>
            <div><a class="menu" href="../talks.html">Tutorials</a></div><a class="menu" href="http://hudson.testrun.org">hudson-tests</a></div></div>
        <div>
          <div>
            <h3>supporting APIs:</h3>
            <div><a class="menu" href="../../index.html">Index</a></div>
            <div><a class="menu" href="../../path.html">py.path</a></div>
            <div><a class="menu" href="../../code.html">py.code</a></div></div></div></div></div>
    <div id="contentspace">
<div class="document" id="produce-code-coverage-reports-using-the-coverage-package-including-support-for-distributed-testing">
<h1 class="title">produce code coverage reports using the 'coverage' package, including support for distributed testing.</h1>

<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#installation" id="id1">Installation</a></li>
<li><a class="reference internal" href="#usage" id="id2">Usage</a><ul>
<li><a class="reference internal" href="#centralised-testing" id="id3">Centralised Testing</a></li>
<li><a class="reference internal" href="#distributed-testing" id="id4">Distributed Testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reporting" id="id5">Reporting</a></li>
<li><a class="reference internal" href="#coverage-data-file" id="id6">Coverage Data File</a></li>
<li><a class="reference internal" href="#coverage-config-file" id="id7">Coverage Config File</a></li>
<li><a class="reference internal" href="#limitations" id="id8">Limitations</a></li>
<li><a class="reference internal" href="#acknowledgements" id="id9">Acknowledgements</a></li>
<li><a class="reference internal" href="#command-line-options" id="id10">command line options</a></li>
</ul>
</div>
<p>This plugin produces coverage reports using the coverage package.  It
supports centralised testing and distributed testing in both load and
each modes.</p>
<p>All features offered by the coverage package should be available,
either through this plugin or through coverage's own config file.</p>
<div class="section" id="installation">
<h1><a class="toc-backref" href="#id1">Installation</a></h1>
<p>The <a class="reference external" href="http://pypi.python.org/pypi/pytest-cov/">pytest-cov pypi</a> package may be installed / uninstalled with pip:</p>
<pre class="literal-block">
pip install pytest-cov
pip uninstall pytest-cov
</pre>
<p>Alternatively easy_install can be used:</p>
<pre class="literal-block">
easy_install pytest-cov
</pre>
</div>
<div class="section" id="usage">
<h1><a class="toc-backref" href="#id2">Usage</a></h1>
<div class="section" id="centralised-testing">
<h2><a class="toc-backref" href="#id3">Centralised Testing</a></h2>
<p>Running centralised testing:</p>
<pre class="literal-block">
py.test --cov myproj tests/
</pre>
<p>Shows a terminal report:</p>
<pre class="literal-block">
-------------------- coverage: platform linux2, python 2.6.4-final-0 ---------------------
Name                 Stmts   Exec  Cover   Missing
--------------------------------------------------
myproj/__init__          2      2   100%
myproj/myproj          257    244    94%   24-26, 99, 149, 233-236, 297-298, 369-370
myproj/feature4286      94     87    92%   183-188, 197
--------------------------------------------------
TOTAL                  353    333    94%
</pre>
</div>
<div class="section" id="distributed-testing">
<h2><a class="toc-backref" href="#id4">Distributed Testing</a></h2>
<p>Distributed testing with dist mode set to load:</p>
<pre class="literal-block">
py.test --cov myproj -n 2 tests/
</pre>
<p>The results from the slaves will be combined like so:</p>
<pre class="literal-block">
-------------------- coverage: platform linux2, python 2.6.4-final-0 ---------------------
Name                 Stmts   Exec  Cover   Missing
--------------------------------------------------
myproj/__init__          2      2   100%
myproj/myproj          257    244    94%   24-26, 99, 149, 233-236, 297-298, 369-370
myproj/feature4286      94     87    92%   183-188, 197
--------------------------------------------------
TOTAL                  353    333    94%
</pre>
<p>Distributed testing in each mode:</p>
<pre class="literal-block">
py.test --cov myproj --dist=each
        --tx=popen//python=/usr/local/python265/bin/python
        --tx=popen//python=/usr/local/python27b1/bin/python
        tests/
</pre>
<p>Will produce a report for each slave:</p>
<pre class="literal-block">
-------------------- coverage: platform linux2, python 2.6.5-final-0 ---------------------
Name                 Stmts   Exec  Cover   Missing
--------------------------------------------------
myproj/__init__          2      2   100%
myproj/myproj          257    244    94%   24-26, 99, 149, 233-236, 297-298, 369-370
myproj/feature4286      94     87    92%   183-188, 197
--------------------------------------------------
TOTAL                  353    333    94%
--------------------- coverage: platform linux2, python 2.7.0-beta-1 ---------------------
Name                 Stmts   Exec  Cover   Missing
--------------------------------------------------
myproj/__init__          2      2   100%
myproj/myproj          257    244    94%   24-26, 99, 149, 233-236, 297-298, 369-370
myproj/feature4286      94     87    92%   183-188, 197
--------------------------------------------------
TOTAL                  353    333    94%
</pre>
<p>Distributed testing in each mode can also produce a single combined
report.  This is useful to get coverage information spanning things
such as all python versions:</p>
<pre class="literal-block">
py.test --cov myproj --cov-combine-each --dist=each
        --tx=popen//python=/usr/local/python265/bin/python
        --tx=popen//python=/usr/local/python27b1/bin/python
        tests/
</pre>
<p>Which looks like:</p>
<pre class="literal-block">
---------------------------------------- coverage ----------------------------------------
                          platform linux2, python 2.6.5-final-0
                           platform linux2, python 2.7.0-beta-1
Name                 Stmts   Exec  Cover   Missing
--------------------------------------------------
myproj/__init__          2      2   100%
myproj/myproj          257    244    94%   24-26, 99, 149, 233-236, 297-298, 369-370
myproj/feature4286      94     87    92%   183-188, 197
--------------------------------------------------
TOTAL                  353    333    94%
</pre>
</div>
</div>
<div class="section" id="reporting">
<h1><a class="toc-backref" href="#id5">Reporting</a></h1>
<p>By default a terminal report is output.  This report can be disabled
if desired, such as when results are going to a continuous integration
system and the terminal output won't be seen.</p>
<p>In addition and without rerunning tests it is possible to generate
annotated source code, a html report and an xml report.</p>
<p>The directories for annotated source code and html reports can be
specified as can the file name for the xml report.</p>
<p>Since testing often takes a non trivial amount of time at the end of
testing any / all of the reports may be generated.</p>
</div>
<div class="section" id="coverage-data-file">
<h1><a class="toc-backref" href="#id6">Coverage Data File</a></h1>
<p>During testing there may be many data files with coverage data.  These
will have unique suffixes and will be combined at the end of testing.</p>
<p>Upon completion, for --dist=load (and also for --dist=each when the
--cov-combine-each option is used) there will only be one data file.</p>
<p>For --dist=each there may be many data files where each one will have
the platform / python version info appended to the name.</p>
<p>These data files are left at the end of testing so that it is possible
to use normal coverage tools to examine them.</p>
<p>At the beginning of testing any data files that are about to be used
will first be erased so ensure the data is clean for each test run.</p>
<p>It is possible to set the name of the data file.  If needed the
platform / python version will be appended automatically to this name.</p>
</div>
<div class="section" id="coverage-config-file">
<h1><a class="toc-backref" href="#id7">Coverage Config File</a></h1>
<p>Coverage by default will read its own config file.  An alternative
file name may be specified or reading config can be disabled entirely.</p>
<p>Care has been taken to ensure that the coverage env vars and config
file options work the same under this plugin as they do under coverage
itself.</p>
<p>Since options may be specified in different ways the order of
precedence between pytest-cov and coverage from highest to lowest is:</p>
<ol class="arabic simple">
<li>pytest command line</li>
<li>pytest env var</li>
<li>pytest conftest</li>
<li>coverage env var</li>
<li>coverage config file</li>
<li>coverage default</li>
</ol>
</div>
<div class="section" id="limitations">
<h1><a class="toc-backref" href="#id8">Limitations</a></h1>
<p>For distributed testing the slaves must have the pytest-cov package
installed.  This is needed since the plugin must be registered through
setuptools / distribute for pytest to start the plugin on the slave.</p>
</div>
<div class="section" id="acknowledgements">
<h1><a class="toc-backref" href="#id9">Acknowledgements</a></h1>
<p>Holger Krekel for pytest with its distributed testing support.</p>
<p>Ned Batchelder for coverage and its ability to combine the coverage
results of parallel runs.</p>
<p>Whilst this plugin has been built fresh from the ground up to support
distributed testing it has been influenced by the work done on
pytest-coverage (Ross Lawley, James Mills, Holger Krekel) and
nose-cover (Jason Pellerin) which are other coverage plugins for
pytest and nose respectively.</p>
<p>No doubt others have contributed to these tools as well.</p>
</div>
<div class="section" id="command-line-options">
<h1><a class="toc-backref" href="#id10">command line options</a></h1>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">--cov-on</span></tt></dt>
<dd>enable coverage, only needed if not specifying any --cov options</dd>
<dt><tt class="docutils literal"><span class="pre">--cov=package</span></tt></dt>
<dd>collect coverage for the specified package (multi-allowed)</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-no-terminal</span></tt></dt>
<dd>disable printing a report on the terminal</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-annotate</span></tt></dt>
<dd>generate an annotated source code report</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-html</span></tt></dt>
<dd>generate a html report</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-xml</span></tt></dt>
<dd>generate an xml report</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-annotate-dir=dir</span></tt></dt>
<dd>directory for the annotate report, default: %default</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-html-dir=dir</span></tt></dt>
<dd>directory for the html report, default: coverage_html</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-xml-file=path</span></tt></dt>
<dd>file for the xml report, default: coverage.xml</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-data-file=path</span></tt></dt>
<dd>file containing coverage data, default: .coverage</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-combine-each</span></tt></dt>
<dd>for dist=each mode produce a single combined report</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-branch</span></tt></dt>
<dd>enable branch coverage</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-pylib</span></tt></dt>
<dd>enable python library coverage</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-timid</span></tt></dt>
<dd>enable slower and simpler tracing</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-no-missing-lines</span></tt></dt>
<dd>disable showing missing lines, only relevant to the terminal report</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-no-missing-files</span></tt></dt>
<dd>disable showing message about missing source files</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-omit=prefix1,prefix2,...</span></tt></dt>
<dd>ignore files with these prefixes</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-no-config</span></tt></dt>
<dd>disable coverage reading its config file</dd>
<dt><tt class="docutils literal"><span class="pre">--cov-config-file=path</span></tt></dt>
<dd>config file for coverage, default: %default</dd>
</dl>
</div>
</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-7597274-3");
pageTracker._trackPageview();
} catch(err) {}</script>
</body></html>