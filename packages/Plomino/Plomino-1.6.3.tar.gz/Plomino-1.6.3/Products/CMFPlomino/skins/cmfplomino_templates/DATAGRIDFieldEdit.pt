<tal:block tal:define="fieldname python:options['fieldname'];
                       v options/fieldvalue;
                       data python:options['field'].getSettings().tojson(v);
                       formname python:options['field'].getParentNode().id;
                       associated_form python:options['field'].getSettings().associated_form">
<input type='hidden' tal:attributes="id string:${fieldname}_gridvalue;
                                     name fieldname;
                                     value data"/>
       
        <script type="text/javascript" charset="utf-8" tal:content="string:var ${fieldname}_datatable;$$(document).ready(function() {${fieldname}_init_table();make_selectable(${fieldname}_datatable, '${fieldname}');} );">
        </script>
    
        <script type="text/javascript" charset="utf-8"
        tal:define="param python:options['field'].getSettings().getParameters();"
        tal:content="structure string:function ${fieldname}_init_table() {${fieldname}_datatable = $('#${fieldname}_datagrid').dataTable( {'aaData': ${data}, ${param} } ); }">
        </script>
        <table class="display" tal:attributes="id string:${fieldname}_datagrid">
        </table>
        <p><a class="context add-row" tal:attributes="href string:../${associated_form}/OpenForm?Plomino_Parent_Field=${fieldname}&Plomino_Parent_Form=${formname}"
             >Add row</a>
            <a class="context edit-row"
            tal:attributes="id string:${fieldname}_editrow;
                            href string:../${associated_form}/OpenForm?Plomino_Parent_Field=${fieldname}&Plomino_Parent_Form=${formname};
                            style python:test(len(v)==0,'display:none', '')"
            >Edit row</a>
            <a href="javascript:void(0)" class="context delete-row"
            tal:attributes="id string:${fieldname}_deleterow;
                            onclick string:datagrid_delete(${fieldname}_datatable, '${fieldname}');
                            style python:test(len(v)==0,'display:none', '')" 
            >Delete row</a>
        </p>
            

</tal:block>
