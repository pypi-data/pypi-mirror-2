***************
*** 100,106 ****
          if not macver:
              macver = cfgvars.get('MACOSX_DEPLOYMENT_TARGET')
  
-         if not macver:
              # Get the system version. Reading this plist is a documented
              # way to get the system version (see the documentation for
              # the Gestalt Manager)
--- 100,110 ----
          if not macver:
              macver = cfgvars.get('MACOSX_DEPLOYMENT_TARGET')
  
+         if 1:
+             # Always calculate the release of the running machine, 
+             # needed to determine if we can build fat binaries or not.
+ 
+             macrelease = macver
              # Get the system version. Reading this plist is a documented
              # way to get the system version (see the documentation for
              # the Gestalt Manager)
***************
*** 116,131 ****
                          r'<string>(.*?)</string>', f.read())
                  f.close()
                  if m is not None:
-                     macver = '.'.join(m.group(1).split('.')[:2])
                  # else: fall back to the default behaviour
  
          if macver:
              from distutils.sysconfig import get_config_vars
              release = macver
              osname = "macosx"
  
- 
-             if (release + '.') >= '10.4.' and \
                      '-arch' in get_config_vars().get('CFLAGS', '').strip():
                  # The universal build will build fat binaries, but not on
                  # systems before 10.4
--- 120,137 ----
                          r'<string>(.*?)</string>', f.read())
                  f.close()
                  if m is not None:
+                     macrelease = '.'.join(m.group(1).split('.')[:2])
                  # else: fall back to the default behaviour
  
+         if not macver:
+             macver = macrelease
+ 
          if macver:
              from distutils.sysconfig import get_config_vars
              release = macver
              osname = "macosx"
  
+             if (macrelease + '.') >= '10.4.' and \
                      '-arch' in get_config_vars().get('CFLAGS', '').strip():
                  # The universal build will build fat binaries, but not on
                  # systems before 10.4
