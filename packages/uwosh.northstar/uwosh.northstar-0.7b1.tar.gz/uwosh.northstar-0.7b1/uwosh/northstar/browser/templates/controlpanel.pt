<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="uwosh.northstar">

  <metal:override fill-slot="column_one_slot" />
  <metal:override fill-slot="column_two_slot" />
  <metal:block fill-slot="top_slot" tal:define="dummy python:request.set('disable_border',1)" />
      
  <metal:css fill-slot="style_slot">
    <link rel="stylesheet" type="text/css" href="++resource++northstar.css" media="screen" />
  </metal:css>
  <metal:javascript fill-slot="javascript_head_slot">
    <script type="text/javascript" src="++resource++northstar-jquery-1.4.2.js" 
      tal:condition="not: view/has_newish_jquery_installed"></script>
    <script type="text/javascript" src="++resource++plone.app.jquerytools.js" 
      tal:condition="not: view/has_newish_jquery_installed"></script>
    <script type="text/javascript" src="++resource++northstar.js"></script>
  </metal:javascript>
    
  <body>
    <div metal:fill-slot="main"
         tal:define="selected_workflow view/selected_workflow;
                     show python: selected_workflow is not None;">
  	  <div id="overlay"><div id="contentWrap"></div></div>
	    <div id="status-messages"></div>
	    
	    <h1 class="documentFirstHeading" i18n:translate="title_manage_contentrules">Workflow Manager</h1>
	    
	    <tal:manager tal:condition="show">
    
      <p class="documentDescription">
          You are currently working on the "<tal:replace tal:replace="view/selected_workflow/title" />" workflow.
      </p>

      <a href=""
         class="link-parent"
         tal:attributes="href string:$portal_url/@@uwosh-northstar"
         i18n:translate="label_up_to_plone_setup">
        Select or create a new workflow
      </a>
    
      <div id="northstar-container">
	      
	      <div id="tabs-menu">
          <ul class="formTabs">
            <li class="formTab firstFormTab">
              <a id="fieldsetlegend-states" href="@@uwosh-northstar#fieldsetlegend-states-anchor" class="selected">
                <span>States</span>
              </a>
            </li>
            <li class="formTab lastFormTab">
              <a id="fieldsetlegend-transitions" href="@@uwosh-northstar#fieldsetlegend-transitions-anchor" class="">
                <span>Transitions</span>
              </a>
            </li>
            
              <form class="inline">
                <input type="submit" id="save-all-button" class="inline context allowMultiSubmit" value="Save" />
              </form>
              <input id="selected-workflow" type="hidden" name="selected-workflow" tal:attributes="value selected_workflow/id" />
              <!-- disable this for now 
              <form class="inline" tal:attributes="action string:${context/absolute_url}/@@uwosh-northstar" method="POST">
                Selected Workflow: 
                <select id="selected-workflow" name="selected-workflow" onchange="form.submit()">
                  <tal:workflows tal:repeat="workflow view/available_workflows">
                    <option tal:attributes="value workflow/id; selected python: workflow.id == selected_workflow.id and 'yes' or ''" 
                            tal:content="workflow/title"></option>
                  </tal:workflows>
                </select>
                <noscript>
                  <span class="formControls">
                    <input type="Submit" class="context" value="Open up selected workflow" name="form.actions.gotoworkflow" class="form.actions.go" />
                  </span>
                </noscript>
              </form>
              -->
              <form class="inline" tal:attributes="action string:${context/absolute_url}/@@northstar-add-new-state" method="POST">
                <input type="hidden" name="selected-workflow" tal:attributes="value view/selected_workflow/id" />
                <a class="dialog-box save-first" rel="#overlay"
                  tal:attributes="href python: view.get_url('@@northstar-add-new-state');
                                  id string:add-state-box-${view/selected_workflow/id}">
                  <input type="submit" class="context allowMultiSubmit" name="add-new-state-button-two" value="Add new state" />
                </a>
              </form>
              <form class="inline" tal:attributes="action string:${context/absolute_url}/@@northstar-add-new-transition" method="POST">
                <input type="hidden" name="selected-workflow" tal:attributes="value view/selected_workflow/id" />
                <a class="dialog-box save-first" rel="#overlay"
                  tal:attributes="href python: view.get_url('@@northstar-add-new-transition');">
                  <input type="submit" class="context allowMultiSubmit" name="add-new-transition-button-two" value="Add new transition" />
                </a>
              </form>
              <!-- disable this for now.
              <form class="inline" tal:attributes="action string:${context/absolute_url}/@@northstar-add-new-workflow" method="POST">
                <a class="dialog-box" rel="#overlay"
                  tal:attributes="href string:@@northstar-add-new-workflow">
                  <input type="submit" class="context allowMultiSubmit" name="add-new-workflow-button" value="Add new workflow" />
                </a>
              </form>
              -->
              <form class="inline" tal:attributes="action python: view.get_url('@@northstar-sanity-check')" method="POST">
                <a class="dialog-box" rel="#overlay"
                   tal:attributes="href python: view.get_url('@@northstar-sanity-check')">
                  <input type="submit" class="context allowMultiSubmit" name="sanity-check-button" value="Sanity Check" />
                </a>
              </form>
              <form class="inline" tal:attributes="action python: view.get_url('@@northstar-assign')" method="POST">
                <a class="dialog-box save-first" rel="#overlay"
                   tal:attributes="href python: view.get_url('@@northstar-assign')">
                  <input type="submit" class="context allowMultiSubmit" name="assign-workflow" value="Assign" />
                </a>
              </form>

              <form class="inline" tal:attributes="action string:${context/absolute_url}/@@northstar-delete-workflow" method="POST">
                <input type="hidden" name="selected-workflow" tal:attributes="value view/selected_workflow/id" />
                <a class="dialog-box" rel="#overlay"
                   tal:attributes="href python: view.get_url('@@northstar-delete-workflow')">
                   <input type="submit" class="standalone allowMultiSubmit" name="delete-workflow-button" value="Delete Workflow" />
                </a>
              </form>

              <p class="discreet inline" style="display:none" id="unsaved-warning">| <b>you have unsaved information</b></p>
          </ul>
        </div>
        
        <tal:replace tal:replace="structure view/render_content_template" />
      </div>
      </tal:manager>
      <tal:select-workflow tal:condition="not: show">

        <a href=""
           class="link-parent"
           tal:attributes="href string:$portal_url/plone_control_panel"
           i18n:translate="label_up_to_plone_setup">
        Up to Site Setup
        </a>
        <div id="workflow-selection">
          <br />
          <p class="documentDescription">
              Please select your workflow.
          </p>
          <ul>
            <tal:workflows tal:repeat="workflow view/available_workflows">
            <li><a tal:attributes="href python: view.get_url('@@uwosh-northstar', workflow);" tal:content="workflow/title"></a>
            </li>
            </tal:workflows>
          </ul>
          <a class="dialog-box" rel="#overlay" tal:attributes="href string:@@northstar-add-new-workflow">
            <input type="submit" class="standalone allowMultiSubmit" value="Create new workflow" />
          </a>
        </div>
      </tal:select-workflow>
    </div>
  </body>
</html>

