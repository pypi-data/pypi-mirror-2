<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Advanced Topics &mdash; Py4J</title>
    <link rel="stylesheet" href="_static/py4jdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  'true'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Py4J" href="index.html" />
    <link rel="next" title="4. Py4J Python API" href="py4j_python.html" />
    <link rel="prev" title="2. Getting Started with Py4J" href="getting_started.html" /> 
  </head>
  <body>
  	<div class="page">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 5px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="py4j_python.html" title="4. Py4J Python API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="2. Getting Started with Py4J"
             accesskey="P">previous</a> |</li>
    <li><a href="index.html">Home</a> |</li>
	<li><a href="download.html">Download</a> |</li>
	<li><a href="contents.html">Documentation</a> |</li>
	<li><a href="http://py4j.wordpress.com">Blog</a> |</li>
	<li><a href="https://sourceforge.net/apps/trac/py4j/wiki">Trac</a> |</li>
	<li><a href="about.html">About</a> &raquo;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="contents.html">On This Page</a></h3>
            <ul>
<li><a class="reference external" href="#">3. Advanced Topics</a><ul>
<li><a class="reference external" href="#accessing-java-collections-and-arrays-from-python">3.1. Accessing Java collections and arrays from Python</a><ul>
<li><a class="reference external" href="#array">3.1.1. Array</a></li>
<li><a class="reference external" href="#list">3.1.2. List</a></li>
<li><a class="reference external" href="#set">3.1.3. Set</a></li>
<li><a class="reference external" href="#map">3.1.4. Map</a></li>
</ul>
</li>
<li><a class="reference external" href="#enabling-java-objects-to-call-python-objects-callback">3.2. Enabling Java objects to call Python objects (callback)</a></li>
<li><a class="reference external" href="#py4j-memory-model">3.3. Py4J memory model</a></li>
<li><a class="reference external" href="#py4j-threading-and-connection-model">3.4. Py4J Threading and connection model</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="getting_started.html"
                                  title="previous chapter">2. Getting Started with Py4J</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="py4j_python.html"
                                  title="next chapter">4. Py4J Python API</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/advanced_topics.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="advanced-topics">
<h1>3. Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="accessing-java-collections-and-arrays-from-python">
<h2>3.1. Accessing Java collections and arrays from Python<a class="headerlink" href="#accessing-java-collections-and-arrays-from-python" title="Permalink to this headline">¶</a></h2>
<p>Java collections are automatically mapped to Python collections so that standard Python operations such as slicing work
on Java collections. Here is the mapping of the collection:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="25%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Java Collection</th>
<th class="head">Python Collection</th>
<th class="head">Py4J Implementation</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Array</td>
<td>Sequence <a class="footnote-reference" href="#arraynote" id="id1">[1]</a></td>
<td><a title="py4j.java_collections.JavaArray" class="reference external" href="py4j_java_collections.html#py4j.java_collections.JavaArray"><tt class="xref docutils literal"><span class="pre">JavaArray</span></tt></a></td>
</tr>
<tr><td>java.util.List</td>
<td>MutableSequence</td>
<td><a title="py4j.java_collections.JavaList" class="reference external" href="py4j_java_collections.html#py4j.java_collections.JavaList"><tt class="xref docutils literal"><span class="pre">JavaList</span></tt></a></td>
</tr>
<tr><td>java.util.Set</td>
<td>MutableSet</td>
<td><a title="py4j.java_collections.JavaSet" class="reference external" href="py4j_java_collections.html#py4j.java_collections.JavaSet"><tt class="xref docutils literal"><span class="pre">JavaSet</span></tt></a></td>
</tr>
<tr><td>java.util.Map</td>
<td>MutableMapping</td>
<td><a title="py4j.java_collections.JavaMap" class="reference external" href="py4j_java_collections.html#py4j.java_collections.JavaMap"><tt class="xref docutils literal"><span class="pre">JavaMap</span></tt></a></td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="arraynote" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Py4J allows elements to be modified, which is not the case of true immutable sequences like tuples.</td></tr>
</tbody>
</table>
<p>Iterators are currently not automatically converted, except when accessed through a collection (e.g., <cite>for i in list</cite>).
Java methods are still accessible when using the Python version of a Java collection. Here are some usage examples for
each collection class. These examples do not cover the entire API.</p>
<div class="section" id="array">
<h3>3.1.1. Array<a class="headerlink" href="#array" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_class</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">int</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_array</span><span class="p">(</span><span class="n">int_class</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">IndexError</span>: <span class="n-Identifier">list index out of range</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">int_array</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sarray</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_array</span><span class="p">(</span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">String</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sarray</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sarray</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="go">u&#39;hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="list">
<h3>3.1.2. List<a class="headerlink" href="#list" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ArrayList</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># calling Python interface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">)</span> <span class="c"># calling Java interface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">elem</span>
<span class="gp">...</span>
<span class="go">1</span>
<span class="go">hello</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">&quot;[2, u&#39;hello&#39;, 3]&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l2</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span>
<span class="go">[2, u&#39;hello&#39;, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l2</span> <span class="c"># l2 is a copy of l and not a view so a change in l2 does not affect l</span>
<span class="go">[999, u&#39;hello&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span>
<span class="go">[u&#39;hello&#39;, 3]</span>
</pre></div>
</div>
</div>
<div class="section" id="set">
<h3>3.1.3. Set<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">HashSet</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">set([1, u&#39;hello&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="ow">in</span> <span class="n">s</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">u&#39;hello&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">set([1])</span>
</pre></div>
</div>
</div>
<div class="section" id="map">
<h3>3.1.4. Map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">HashMap</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">{u&#39;a&#39;: 0, u&#39;b&#39;: 1}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">u&quot;b&quot;</span> <span class="ow">in</span> <span class="n">m</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">{u&#39;b&#39;: 1}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%i</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
<span class="gp">...</span>
<span class="go">b:1</span>
<span class="go">c:2</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="enabling-java-objects-to-call-python-objects-callback">
<h2>3.2. Enabling Java objects to call Python objects (callback)<a class="headerlink" href="#enabling-java-objects-to-call-python-objects-callback" title="Permalink to this headline">¶</a></h2>
<p>Since version 0.3, Py4J allows Java programs to call Python objects. In other words, Python classes can implement a
Java interface and instances of these classes can be passed to a Java object. In the following example, we will play the
role of a Mad Scientist <sup>TM</sup> and we will create a program that invokes an operator with two or three random integers.</p>
<p>Here is the code of the main Java program:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="n">py4j</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">py4j.GatewayServer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OperatorExample</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">randomBinaryOperator</span><span class="o">(</span><span class="n">Operator</span> <span class="n">op</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
                <span class="n">numbers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">());</span>
                <span class="n">numbers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">());</span>
                <span class="n">numbers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">op</span><span class="o">.</span><span class="na">doOperation</span><span class="o">(</span><span class="n">numbers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="n">numbers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">)));</span>
                <span class="k">return</span> <span class="n">numbers</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">randomTernaryOperator</span><span class="o">(</span><span class="n">Operator</span> <span class="n">op</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
                <span class="n">numbers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">());</span>
                <span class="n">numbers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">());</span>
                <span class="n">numbers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">());</span>
                <span class="n">numbers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">op</span><span class="o">.</span><span class="na">doOperation</span><span class="o">(</span><span class="n">numbers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="n">numbers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">numbers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">)));</span>
                <span class="k">return</span> <span class="n">numbers</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">GatewayServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GatewayServer</span><span class="o">(</span><span class="k">new</span> <span class="n">OperatorExample</span><span class="o">());</span>
                <span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>The programs has a main method starting a <cite>GatewayServer</cite>. The entry point, a <cite>OperatorExample</cite> instance, offers two
methods that take as a parameter an <cite>Operator</cite> instance. Each method calls the operator with two or three random
integers and save the integers and the result in a list. Here is the declaration of <cite>Operator</cite>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="n">py4j</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Operator</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">doOperation</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">j</span><span class="o">);</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">doOperation</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">j</span><span class="o">,</span> <span class="kt">int</span> <span class="n">k</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Now, because the Mad Scientist <sup>TM</sup> is, well, mad, he wants to define an Operator in Python. Here is his little Python
program:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="n">JavaGateway</span>

<span class="k">class</span> <span class="nc">Addition</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">doOperation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">k</span>

    <span class="k">class</span> <span class="nc">Java</span><span class="p">:</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;py4j.examples.Operator&#39;</span><span class="p">]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">()</span>
    <span class="n">operator</span> <span class="o">=</span> <span class="n">Addition</span><span class="p">()</span>
    <span class="n">numbers</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">entry_point</span><span class="o">.</span><span class="n">randomBinaryOperator</span><span class="p">(</span><span class="n">operator</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
    <span class="n">numbers</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">entry_point</span><span class="o">.</span><span class="n">randomTernaryOperator</span><span class="p">(</span><span class="n">operator</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
    <span class="n">gateway</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
<p>The <cite>Addition</cite> class is a standard Python class that has one method, <cite>doOperation</cite>. The signature of the method contains
two parameters and an optional third parameter: this maps with the two overloaded methods in the <cite>Operator</cite> Java
interface. Each method implementing an overloaded method in a Java interface should accept all possible combinations of
parameters, otherwise, an exception will be thrown if the Java program tries to call an unsupported method.</p>
<p>Py4J recognizes that the <cite>Addition</cite> class implements a Java interface because it declares an internal class called
<cite>Java</cite>, which has a member named <cite>interfaces</cite>. This member is a list of string representing the fully qualified name of
implemented Java interfaces.</p>
<p>Finally, the Python program contains a main method that starts a gateway, initializes an Addition operator and sends it
to the <cite>OperatorExample</cite> instance on the Java side. Py4J takes care of creating the necessary proxies: the <cite>doOperation</cite>
method of the <cite>Addition</cite> class is called in the Java VM, but the method is executed in the Python interpreter.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Python classes can only implement Java interfaces. Abstract or concrete classes are not supported and there is no
plan to support them in the near future because this would probably require instrumenting the bytecode at runtime.
Java does not natively support dynamic proxies for classes.</p>
<p class="last">As a workaround, a subclass of the abstract class could be created on the Java side. The methods of the subclass
would call the methods of a custom interface that a Python class could implement.</p>
</div>
</div>
<div class="section" id="py4j-memory-model">
<span id="adv-memory"></span><h2>3.3. Py4J memory model<a class="headerlink" href="#py4j-memory-model" title="Permalink to this headline">¶</a></h2>
<p><strong>Java objects sent to the Python side</strong></p>
<p>Every time a Java object is sent to the Python side, a reference to the object is kept on the Java side (in the Gateway
class). Once the object is garbage collected on the Python VM (reference count == 0), the reference is removed on the
Java VM: if this was the last reference, the object will likely be garbage collected too. When a gateway is shut down,
the remaining references are also removed on the Java VM.</p>
<p>Because Java objects on the Python side are involved in a circular reference (<a title="py4j.java_gateway.JavaObject" class="reference external" href="py4j_java_gateway.html#py4j.java_gateway.JavaObject"><tt class="xref docutils literal"><span class="pre">JavaObject</span></tt></a> and <a title="py4j.java_gateway.JavaMember" class="reference external" href="py4j_java_gateway.html#py4j.java_gateway.JavaMember"><tt class="xref docutils literal"><span class="pre">JavaMember</span></tt></a> reference each other), these
objects are not immediately garbage collected once the last reference to the object is removed (but they are guaranteed
to be eventually collected <strong>if the Python garbage collector runs before the Python program exits</strong>).</p>
<p>In doubt, users can always call the <a title="py4j.java_gateway.JavaGateway.detach" class="reference external" href="py4j_java_gateway.html#py4j.java_gateway.JavaGateway.detach"><tt class="xref docutils literal"><span class="pre">detach</span></tt></a> function on the Python
gateway to explicitly delete a reference on the Java side. A call to <cite>gc.collect()</cite> also usually works.</p>
<p><strong>Python objects sent to the Java side (callback)</strong></p>
<p>Every time a Python object is sent to the Java side, a reference to this object is kept on the Python side (by a
<a title="py4j.java_callback.PythonProxyPool" class="reference external" href="py4j_java_callback.html#py4j.java_callback.PythonProxyPool"><tt class="xref docutils literal"><span class="pre">PythonProxyPool</span></tt></a>). Once a python object is garbage collected on the Java
side, a message is sent to the Python side to remove the reference to the Python object. When a gateway is shut down,
the remaining references are removed from the Python VM.</p>
<p>Unfortunately, there is no guarantee that the garbage collection message will ever be sent to the Python side (it
usually works on Sun/Oracle VM). It might thus be necessary to manually remove the reference to the Python objects. Some
helper functions will be developed in the future, but it is unlikely that garbage collection will be guarenteed because
of the specification of Java finalizers (which are surprisingly worse than Python finalizer strategies).</p>
</div>
<div class="section" id="py4j-threading-and-connection-model">
<span id="adv-threading"></span><h2>3.4. Py4J Threading and connection model<a class="headerlink" href="#py4j-threading-and-connection-model" title="Permalink to this headline">¶</a></h2>
<p>Py4J allocates one thread per connection. The design of Py4j is symmetrical on the Python and Java sides. A Python
communication channel communicates with the Java GatewayServer and is then associated with a GatewayConnection. A Java
communication channel (for callbacks) communicates with the Python CallbackServer and is then associated with a
CallbackConnection. Communication channels run in the calling thread.</p>
<p>And now, for the details:</p>
<p><strong>On the Python side</strong></p>
<p>Py4J explicitly creates a thread to run the <a title="py4j.java_callback.CallbackServer" class="reference external" href="py4j_java_callback.html#py4j.java_callback.CallbackServer"><tt class="xref docutils literal"><span class="pre">CallbackServer</span></tt></a>, which accepts
callback connection requests,  and a thread for each callback connection request. As long as there is no concurrent
callback on the Java side, the same callback connection/thread will be used.</p>
<p>Py4J on the Python side does not explicitly create a thread to call Java methods. When a method is called, a
communication channel (connection to the Java GatewayServer) is established in the calling thread. If multiple threads
are calling Java methods concurrently, Py4J will ensure that each thread has its own communication channel.</p>
<p><strong>On the Java side</strong></p>
<p>Py4J explicitly creates a thread to run the GatewayServer, which accepts connection requests (from a communication
channel), and a thread for each connection request. As long as there is no concurrent calls on the Python side, the same
connection/thread will be used.</p>
<p>Py4J on the Java side does not explicitly create a thread to make a callback to a Python object. When a callback is
called, a communication channel (connection to the CallbackServer) is established in the calling thread. If multiple
threads are calling Python callbacks concurrently, Py4J will ensure that each thread has its own communication channel.</p>
</div>
</div>


          </div>
		  		
				<div class="helpbar">
					<h3>Questions/Feedback?</h3>
					<ul>
						<li>Try the <a href="faq.html">FAQ</a> -- It answers many questions.</li>
						<li>Search for information in the <a href="http://sourceforge.net/mailarchive/forum.php?forum_name=py4j-users">archives of the py4j-users mailing list</a>, or <a href="https://lists.sourceforge.net/lists/listinfo/py4j-users">post a question</a>.</li>
						<li>Check out the <a href="http://sourceforge.net/apps/trac/py4j/wiki/HowTos">user-contributed how-tos</a> or contribute one yourself.</li>
						<li>If you notice errors with this documentation, <a href="http://sourceforge.net/apps/trac/py4j/newticket">open a ticket</a> and let us know. Please, only open a ticket for feedback or improvements on the docs. To get help, use the links above!</li>
					</ul>
				</div>
				<script type="text/javascript">  var disqus_developer = 0; </script> 
				<div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/py4j/embed.js"></script><noscript><a href="http://disqus.com/forums/py4j/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
				
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 5px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="py4j_python.html" title="4. Py4J Python API"
             >next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="2. Getting Started with Py4J"
             >previous</a> |</li>
    <li><a href="index.html">Home</a> |</li>
	<li><a href="download.html">Download</a> |</li>
	<li><a href="contents.html">Documentation</a> |</li>
	<li><a href="http://py4j.wordpress.com">Blog</a> |</li>
	<li><a href="https://sourceforge.net/apps/trac/py4j/wiki">Trac</a> |</li>
	<li><a href="about.html">About</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009-2010, Barthélémy Dagenais.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </div>
  
  
  <script type="text/javascript">
      //<![CDATA[
      (function(){
          var links = document.getElementsByTagName('a');
          var query = '?';
          for (var i = 0; i < links.length; i++) {
              if (links[i].href.indexOf('#disqus_thread') >= 0) {
                  query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
              }
          }
          document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/py4j/get_num_replies.js' + query + '"></' + 'script>');
      })();
      //]]>
  </script>
  
  </body>
  

</html>