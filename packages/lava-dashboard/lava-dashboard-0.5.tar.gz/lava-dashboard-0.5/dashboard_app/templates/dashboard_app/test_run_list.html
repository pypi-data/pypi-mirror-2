{% extends "dashboard_app/base.html" %}
{% load i18n %}
{% load humanize %}
{% load pagination_tags %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}lava/js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}lava/js/jquery-ui-1.8.12.custom.min.js"></script>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}lava/css/Aristo/jquery-ui-1.8.7.custom.css"/>
{% endblock %}

{% block title %}
{{ block.super }} | {% trans "Streams" %} | {% trans "Bundle Stream" %} {{ bundle_stream.pathname }}
{% endblock %}


{% block breadcrumbs %}
<li><a href="{% url dashboard_app.views.bundle_stream_list %}">{% trans "Bundle Streams" %}</a></li>
<li><a href="{{ bundle_stream.get_absolute_url }}">{{ bundle_stream }}</a></li>
{% endblock %}


{% block sidebar %}
<h3>{% trans "About" %}</h3>
<dl>
  <dt>{% trans "Pathname:" %}</dt>
  <dd>{{ bundle_stream.pathname }}</dd>
  <dt>{% trans "Name:" %}</dt>
  <dd>{{ bundle_stream.name|default:"<i>not set</i>" }}</dd>
</dl>
<h3>{% trans "Ownership" %}</h3>
{% if bundle_stream.user %}
<p>{% trans "This stream is owned by" %} <q>{{ bundle_stream.user }}</q></p>
{% else %}
<p>{% trans "This stream is owned by group called" %} <q>{{ bundle_stream.group }}</q></p>
{% endif %}
<h3>{% trans "Access rights" %}</h3>
<dl>
  <dt>{% trans "Stream type:" %}</dt>
  {% if bundle_stream.is_anonymous %}
  <dd>
  Anonymous stream <a href="#" id="what-are-anonymous-streams">(what is this?)</a>
  <div id="dialog-message" title="{% trans "About anonymous streams" %}">
    <p>The dashboard has several types of containers for test results. One of the
    most common and the oldest one is an <em>anonymous stream</em>. Anonymous
    streams act like public FTP servers. Anyone can download or upload files at
    will. There are some restrictions, nobody can change or remove existing
    files</p>

    <p>When a stream is anonymous anonyone can upload new test results and the
    identity of the uploading user is not recorded in the system. Anonymous
    streams have to be public (granting read access to everyone)</p>

    <div class="ui-widget">
      <div class="ui-state-highlight ui-corner-all" style="margin-top: 20px; padding: 0.7em">
      <span class="ui-icon ui-icon-info" style="float: left; margin-right: 0.3em;"></span>
      <strong>Note:</strong> A stream can be marked as anonymous in the administration panel
      </div>
    </div>
  </div>
  <script type="text/javascript">
    $(function() {
        $( "#dialog-message" ).dialog({
          autoOpen: false,
          modal: true,
          minWidth: 500,
          buttons: {
            Ok: function() {
              $( this ).dialog( "close" );
            }
          }
        });
        $( "#what-are-anonymous-streams" ).click(function(e) {
          $( "#dialog-message").dialog('open');
        });
      });
  </script>
  </dd>
  <dt>{% trans "Read access:" %}</dt>
  <dd>{% trans "Anyone can download or read test results uploaded here" %}</dd>
  <dt>{% trans "Write access:" %}</dt>
  <dd>{% trans "Anyone can upload test results here" %}</dt>
  {% else %}
    {% if  bundle_stream.is_public %}
    <dd>{% trans "Public stream" %}</dd>
    <dt>{% trans "Read access:" %}</dt>
    <dd>{% trans "Anyone can download or read test results uploaded here" %}</dd>
    {% else %}
    <dd>{% trans "Private stream" %}</dd>
    <dt>{% trans "Read access:" %}</dt>
    <dd>{% trans "Only the owner can download or read test results uploaded here" %}</dd>
    {% endif %}
    <dt>{% trans "Write access:" %}</dt>
    <dd>{% trans "Only the owner can upload test results here" %}</dd>
  {% endif %}
</dl>
{% endblock %}


{% block content %}

{% autopaginate test_run_list %}
{% if invalid_page %}
  <h3>{% trans "There are no test runs on this page." %}</h3>
  <p>{% trans "Try the" %} <a href="{{ bundle_stream.get_absolute_url }}">{% trans "first page" %}</a> {% trans "instead." %}</p>
{% else %}
  {% if test_run_list.count %}
  <table class="data">
    <tr>
      <th>
        {% trans "Uploaded On" %}
        <div style="font-size:smaller">
          {% trans "most recent first" %}
        </div>
      </th>
      <th>{% trans "Analyzed" %}</th>
      <th>{% trans "Test" %}</th>
      <th>{% trans "Run" %}</th>
      <th>{% trans "Pass" %}</th>
      <th>{% trans "Fail" %}</th>
      <th>{% trans "Skip" %}</th>
      <th>{% trans "Unknown" %}</th>
    </tr>
    {% for test_run in test_run_list %}
    <tr>
      <td>
        {{ test_run.bundle.uploaded_on|naturalday }}
        {{ test_run.bundle.uploaded_on|time }}
      </td>
      <td>
        {{ test_run.analyzer_assigned_date|timesince }}
        {% trans "ago" %}
      </td>
      <td>{{ test_run.test }}</td>
      <td><a href="{{ test_run.get_absolute_url }}">{{ test_run }}</a></td>
      {% with test_run.get_summary_results as summary %}
      <td>{{ summary.pass|default:0 }}</td>
      <td>{{ summary.fail|default:0 }}</td>
      <td>{{ summary.skip|default:0 }}</td>
      <td>{{ summary.unknown|default:0 }}</td>
      {% endwith %}
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>{% trans "There are no test runs in this stream yet." %}</p>
  {% endif %}
{% paginate %}
{% endif %}

{% endblock %}
