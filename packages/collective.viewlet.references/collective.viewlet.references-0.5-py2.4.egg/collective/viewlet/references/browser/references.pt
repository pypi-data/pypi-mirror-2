<tal:references define="type here/portal_type"
		condition="python:view.isValidType(type)">

<div tal:condition="python:context.restrictedTraverse('@@plone_context_state').is_view_template()" tal:omit-tag="">
<div class="expanded_relatedItems" tal:define="types view/getOrderedTypes" tal:condition="python:len(context.getRelatedItems()) > 0 or len(context.getBRefs()) > 0">
		<span tal:repeat="type types">
		<div class="related-block" tal:define="items python:view.getRelatedItemsByType(type); typeName python:view.getTypeName(type)"  tal:condition="python:len(items) > 0">
			<tal:typefilter condition="python:type != 'Image'">
				<div class="related-type-title">
					<a href="#" tal:attributes="href python:(context.absolute_url())+'#top'"  class="related-button-up" tal:condition="exists:here/button_goto_up.png"><img tal:replace="structure here/button_goto_up.png" src="" alt="Go to top"/></a>
					<a name="" tal:attributes="name typeName"></a><span tal:replace="typeName">Type</span>
				</div>
				
				<span tal:repeat="item items" tal:omit-tag="">
					<tal:gallery condition="python: type == 'Folder'">
						<div class="related-gallery-wrapper" tal:define="folderImages python:view.getFolderImages(item)">
							<div class="relatedTitle">
                                                       		<a href="#"
                                                               		class="summary url" tal:attributes="href item/getURL|item/absolute_url"
                                                               		tal:content="item/title">
                                                                       		Item Title
                                                       		</a>
							</div>
							<div class="gallery-overflow">
							<ul class="related-gallery-stream" tal:define="number repeat/item/number" tal:attributes="id python:'stream' + str(number)">
								<li class="related-gallery-item" tal:repeat="image folderImages">
									<a href="" tal:attributes="href python:image.getURL() + '/view'" 
										   tal:condition="python:image.portal_type == 'Image'">
										<img src="" tal:attributes="src python:image.getURL() + '/image_mini'" />
									</a>
									<span class="gallery-video" tal:condition="python:image.portal_type == 'File' and image.hasContentLeadImage">
									<a href="" tal:attributes="href python:image.getURL() + '/view'">
										<img src="" class="gallery-leadimage"  tal:attributes="src python:image.getURL() + '/leadImage_mini'" />
										<img tal:replace="structure here/play-button-small.png" src="" alt="play video" />
									</a>
									</span>
								</li>
							</ul>
							</div>
							<a class="gallery-move-left" 
								tal:define="number repeat/item/number" 
								tal:attributes="onClick python:'galleryMove(\'left\', ' + str(number)  + ')';
                                                                                id python:'gallery-move-left' + str(number)">
									<img tal:replace="structure here/left_arrow_big.png"/>
							</a>
							<a class="gallery-move-right" 
                                                                tal:define="number repeat/item/number"                                              
                                                                tal:attributes="onClick python:'galleryMove(\'right\', ' + str(number)  + ')';
										id python:'gallery-move-right' + str(number)">
                                                                        <img tal:replace="structure here/right_arrow_big.png"/>
                                                        </a>
						</div>
					</tal:gallery>
					<div class="" tal:define="item_type item/portal_type;
                                       				  item_type_class python: 'contenttype-' + view.normalizeString(item_type);"
						      tal:condition="python:typeName != 'Media'"
						      tal:attributes="class string:tileItem visualIEFloatFix vevent">
                    				<div class="tileHeadline">
							<a href="#"
                        	   				class="summary url" tal:attributes="href item/getURL|item/absolute_url"
                           					tal:content="item/title" tal:condition="python:item.portal_type != 'Person' and item.portal_type != 'File'">
                            						Item Title
                        				</a>
							<a href="#"
                           					class="summary url" tal:attributes="href item/getURL|item/absolute_url"
                           					tal:content="item/Title" tal:condition="python:item.portal_type == 'Person'">
                            						Item Title
                        				</a>
							
							<a href="#"
                           					class="summary url" tal:attributes="href python:(item.absolute_url())+'/view'"
                           					tal:content="item/Title" tal:condition="python:item.portal_type == 'File'">
                            						Item Title
                        				</a>
                    				</div>

						<tal:video define="isVideo python:view.isVideo(item)" condition="isVideo">
                        				<div class="tileVideo" tal:define="audio_only python:view.audio_only(item); 
											hasLeadImage python:view.hasContentLeadImage(item)">
                        						<a class="autoFlowPlayer minimal" href="" tal:attributes="href item/getURL | item/absolute_url;
                                                                          	onclick python:hasLeadImage and 'v2_video.configure(this, true)' or ''" tal:condition="python:not audio_only">
                                						<img src="" class="splash"  alt=""  tal:condition="hasLeadImage"
											tal:attributes="src python:item.absolute_url() + '/leadImage'"/>
                                						<img tal:replace="structure here/play-button.png" src="" alt="play video" 
											tal:condition="hasLeadImage" />
                        						</a>
                        						<a class="autoFlowPlayer audio" href="" tal:attributes="href item/getURL" tal:condition="audio_only">
                        						</a>
                        						<p class="tileBody" tal:condition="audio_only">
                                						<span tal:omit-tag="" tal:condition="not:item/Description">
                                    							&nbsp;
                                						</span>
                                						<span class="description" tal:content="python:view.trimDescription(item.Description(), 250)">
                                    							description
                                						</span>
                        						</p>
                        				</div>
						</tal:video>

						<tal:excludedetails condition="python:item_type != 'Topic' and item_type != 'Folder' and not view.isVideo(item)">
						<a href="#" tal:attributes="href item/getURL|item/absolute_url">
                                	                 <img src="" alt="" tal:condition="exists:item/image_thumb"
                                	                        tal:replace="structure python: path('nocall:item/tag')(scale='thumb', css_class='tileImage')" />
                                	                 <img src="" alt=""
                                	                        tal:replace="structure python:view.tag(item, css_class='tileImage')" /><br />
                                	        </a>
						
						<tal:event condition="python: item_type == 'Event'">
							<span tal:condition="python: item_type == 'Event'"
                               						i18n:translate="label_event_byline">
                                				<div class="EventDateInfo" tal:condition="python: item.end() >= view.currenttime()">
                                        			<div class="futureEventDateFrom">
                                                			<div class="eventDayInfo" tal:content="python:item.start().day()">02</div>
                                                			<div class="eventMonthInfo" tal:content="python:item.start().strftime('%b %Y').capitalize()">Jun</div>
                                        			</div>
                                        			<span tal:condition="python:item.start().strftime('%d - %m - %Y') != item.end().strftime('%d - %m - %Y')" tal:omit-tag="" >
                                        			<div class="futureEventDateUntil">
                                                			<div class="eventDayInfo" tal:content="python:item.end().day()">02</div>
                                                			<div class="eventMonthInfo" tal:content="python:item.end().strftime('%b %Y').capitalize()">Jun</div>
                                        			</div>
                                        			<div class="visualClearLeft"><!-- --></div>
                                        		</span>
                                			</div>
                                			<div class="EventDateInfo" tal:condition="python: item.end() < view.currenttime()">
                                        		<div class="pastEventDateFrom">
                                                		<div class="eventDayInfo" tal:content="python:item.start().day()">02</div>
                                                		<div class="eventMonthInfo" tal:content="python:item.start().strftime('%b %Y').capitalize()">Jun</div>
                                        		</div>
                                        		<span tal:condition="python:item.start().strftime('%d - %m - %Y') != item.end().strftime('%d - %m - %Y')" tal:omit-tag="">
                                        		<div class="pastEventDateUntil">
                                                		<div class="eventDayInfo" tal:content="python:item.end().day()">02</div>
                                                		<div class="eventMonthInfo" tal:content="python:item.end().strftime('%b %Y').capitalize()">Jun</div>
                                        		</div>
                                        		<div class="visualClearLeft"><!-- --></div>
                                        		</span>
                                			</div>
                         				</span>
                    				</tal:event>
		                	        <p class="tileBody">
                       		 			<span tal:omit-tag="" tal:condition="not:item/Description">
                        				    &nbsp;
                        				</span>
                        				<span class="description" tal:content="python:view.trimDescription(item.Description())">
                           					description
                        				</span>
                    				</p>
						</tal:excludedetails>
					</div>		
				</span>
			</tal:typefilter>
		</div>
		<div class="visualClear"><!-- --></div>
		</span>
	</div>
</div>
</tal:references>
