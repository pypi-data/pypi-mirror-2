<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>StarCluster Plugin System &mdash; StarCluster v0.91 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.91',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="StarCluster v0.91 documentation" href="index.html" />
    <link rel="prev" title="Enabling Tab Completion for Bash/Zsh" href="shell_completion.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="_static/logo.png" border="0" alt="StarCluster"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="shell_completion.html" title="Enabling Tab Completion for Bash/Zsh"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
       <li><a href="contents.html">documentation </a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">StarCluster Plugin System</a><ul>
<li><a class="reference external" href="#creating-a-new-plugin">Creating a New Plugin</a></li>
<li><a class="reference external" href="#adding-your-plugin-to-the-config">Adding Your Plugin to the Config</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="shell_completion.html"
                                  title="previous chapter">Enabling Tab Completion for Bash/Zsh</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/plugins.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="starcluster-plugin-system">
<h1>StarCluster Plugin System<a class="headerlink" href="#starcluster-plugin-system" title="Permalink to this headline">¶</a></h1>
<p>StarCluster has support for user contributed plugins. Plugins allow developers to further configure the cluster on top of
the default cluster configuration provided by StarCluster. Plugins are used to provide custom cluster configurations for a variety
of computing needs.</p>
<div class="section" id="creating-a-new-plugin">
<h2>Creating a New Plugin<a class="headerlink" href="#creating-a-new-plugin" title="Permalink to this headline">¶</a></h2>
<p>A StarCluster plugin is simply a Python class that extends <strong>starcluster.clustersetup.ClusterSetup</strong> and implements a <em>run</em> method.
This class must live in a module that is on the PYTHONPATH. By default, StarCluster will add the ~/.starcluster/plugins directory
to the PYTHONPATH automatically. The ~/.starcluster/plugins directory is not created automatically so you will need to create it if
it does not exist.</p>
<p>Below is a very simple example of a StarCluster plugin that installs a package on each node using apt-get after the cluster has been
configured:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">starcluster.clustersetup</span> <span class="kn">import</span> <span class="n">ClusterSetup</span>

<span class="k">class</span> <span class="nc">PackageInstaller</span><span class="p">(</span><span class="n">ClusterSetup</span><span class="p">):</span>
     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg_to_install</span><span class="p">):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">pkg_to_install</span> <span class="o">=</span> <span class="n">pkg_to_install</span>
     <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">user_shell</span><span class="p">,</span> <span class="n">volumes</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
               <span class="n">node</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;apt-get -y install </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pkg_to_install</span><span class="p">)</span>
</pre></div>
</div>
<p>For this example we assume that this class lives in a module file called <strong>ubuntu.py</strong> and that this file lives in the
~/.starcluster/plugins directory.</p>
<p>This is a very simple example that simply demonstrates how to execute a command on each node in the cluster. For a more sophisticated
example, have a look at StarCluster&#8217;s default setup class <strong>starcluster.clustersetup.DefaultClusterSetup</strong>. This is the class used to perform
StarCluster&#8217;s default setup routines. The DefaultClusterSetup class should provide you with a more complete example of the plugin API and
the types of things you can do with the arguments passed to a plugin&#8217;s <em>run</em> method.</p>
</div>
<div class="section" id="adding-your-plugin-to-the-config">
<h2>Adding Your Plugin to the Config<a class="headerlink" href="#adding-your-plugin-to-the-config" title="Permalink to this headline">¶</a></h2>
<p>To use a plugin we must first add it to the config and then add the plugin&#8217;s config to a <em>cluster template</em>. Below is an example config
for the example plugin above:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[plugin pkginstaller]</span>
<span class="na">setup_class</span> <span class="o">=</span> <span class="s">ubuntu.PackageInstaller</span>
<span class="na">pkg_to_install</span> <span class="o">=</span> <span class="s">htop</span>
</pre></div>
</div>
<p>In this example, pkg_to_install is an argument to the plugin&#8217;s constructor (ie __init__). A plugin can, of course, define multiple
construtor arguments and you can configure these arguments in the config similar to <em>pkg_to_install</em> in the above example.</p>
<p>After you&#8217;ve defined a <strong>[plugin]</strong> section, you can now use this plugin in a <em>cluster template</em> by configuring its <strong>plugins</strong> setting:</p>
<div class="highlight-ini"><pre>[cluster smallcluster]
....
plugins = pkginstaller</pre>
</div>
<p>This setting instructs StarCluster to run the <em>pkginstaller</em> plugin after StarCluster&#8217;s default setup routines. If you want to use more
than one plugin in a template you can do so by providing a list of plugins:</p>
<div class="highlight-ini"><pre>[cluster smallcluster]
....
plugins = pkginstaller, myplugin</pre>
</div>
<p>In the example above, starcluster would first run the <em>pkginstaller</em> plugin and then the <em>myplugin</em> plugin afterwards. In short, order matters
when defining plugins to use in a <em>cluster template</em>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="shell_completion.html" title="Enabling Tab Completion for Bash/Zsh"
             >previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
       <li><a href="contents.html">documentation </a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Software Tools for Academics and Researchers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.5.
    </div>
  </body>
</html>