
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using EBS Volumes for Persistent Storage &mdash; StarCluster v0.92rc1 documentation</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.92rc1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="StarCluster v0.92rc1 documentation" href="../index.html" />
    <link rel="up" title="StarCluster User Manual" href="index.html" />
    <link rel="next" title="Launching a StarCluster on Amazon EC2" href="launch.html" />
    <link rel="prev" title="StarCluster Configuration File" href="configuration.html" />
<link rel="stylesheet" href="../_static/nobile.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../_static/neuton.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/starcluster.ico"/>

  </head>
  <body>
<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/logo-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="launch.html" title="Launching a StarCluster on Amazon EC2"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="StarCluster Configuration File"
             accesskey="P">previous</a> |</li>
    	<li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../contents.html" >Master Table of Contents</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">StarCluster User Manual</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-ebs-volumes-for-persistent-storage">
<h1>Using EBS Volumes for Persistent Storage<a class="headerlink" href="#using-ebs-volumes-for-persistent-storage" title="Permalink to this headline">¶</a></h1>
<p>StarCluster utilizes Amazon&#8217;s Elastic Block Storage (EBS) volumes for
persistent storage. These volumes can be anywhere from 1GB to 1TB in size.
StarCluster will mount each volume specified in a cluster template to the
<strong>MOUNT_PATH</strong> specified in the volume&#8217;s configuration section on the master
node. This <strong>MOUNT_PATH</strong> is then shared on all nodes using the network file
system (NFS).</p>
<p>For example, suppose we have the following (abbreviated) configuration defined:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[vol myvol]</span>
<span class="na">volume_id</span> <span class="o">=</span> <span class="s">vol-v99999</span>
<span class="na">mount_path</span> <span class="o">=</span> <span class="s">/data</span>

<span class="k">[cluster smallcluster]</span>
<span class="na">cluster_size</span><span class="o">=</span><span class="s">3</span>
<span class="na">keyname</span><span class="o">=</span><span class="s">mykey</span>
<span class="na">node_instance_type</span><span class="o">=</span><span class="s">m1.small</span>
<span class="na">node_image_id</span><span class="o">=</span><span class="s">ami-8cf913e5</span>
<span class="na">volumes</span><span class="o">=</span><span class="s">myvol</span>
</pre></div>
</div>
<p>In this case, whenever a cluster is launched using the <em>smallcluster</em> template
StarCluster will attach the EBS volume <em>vol-v99999</em> to the <em>master</em> node on
<em>/data</em> and then NFS-share <em>/data</em> to all the nodes in the cluster.</p>
<div class="section" id="create-partition-and-format-a-new-ebs-volume">
<h2>Create, Partition, and Format a new EBS Volume<a class="headerlink" href="#create-partition-and-format-a-new-ebs-volume" title="Permalink to this headline">¶</a></h2>
<p>StarCluster&#8217;s <strong>createvolume</strong> command completely automates the process of
creating a new EBS volume, launching a <em>host</em> instance to attach the volume to,
partitioning the volume, and formatting the volume.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>createvolume</strong> command only supports partitioning the <em>entire
volume</em> into a single partition that uses all of the space on the
device. If you <em>really</em> need more than one partition you&#8217;re probably
better off creating a new volume entirely.  If this is not the case and
you have a use-case for partitioning an EBS volume into more than one
partition, please send a note to the StarCluster mailing list
(starcluster &#8216;at&#8217; mit &#8216;dot&#8217; edu).</p>
</div>
<p>To have StarCluster create, partition, and format a new volume for you
automatically simply run:</p>
<div class="highlight-python"><pre>$ starcluster createvolume 20 us-east-1c</pre>
</div>
<p>This command will launch a host instance in the us-east-1c availability zone,
create a 20GB volume in us-east-1c, attach the new volume to the host instance,
and format the entire volume.</p>
<p>You can also use the &#8211;bid option to request a spot instance when creating the
volume host:</p>
<div class="highlight-python"><pre>$ starcluster createvolume 20 us-east-1c --bid 0.50</pre>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In previous versions the <strong>createvolume</strong> command used to terminate the
host instance after creating the volume, however, the latest version
<strong>does not do this by default</strong> in order to allow multiple volumes to
be created in the same zone with a <em>single</em> host instance. You can pass
the <em>&#8211;shutdown-volume-host</em> option to the <em>createvolume</em> command to
have StarCluster automatically shutdown the volume host after creating
the new volume.</p>
</div>
<p>Let&#8217;s look at an example:</p>
<div class="highlight-python"><pre>$ starcluster createvolume 20 us-east-1c
StarCluster - (http://web.mit.edu/starcluster)
Software Tools for Academics and Researchers (STAR)
Please submit bug reports to starcluster@mit.edu

&gt;&gt;&gt; No keypair specified, picking one from config...
&gt;&gt;&gt; Using keypair: jtriley
&gt;&gt;&gt; Creating security group @sc-volumecreator...
&gt;&gt;&gt; No instance in group @sc-volumecreator for zone us-east-1c,
&gt;&gt;&gt; launching one now.
&gt;&gt;&gt; Waiting for volume host to come up... (updating every 30s)
&gt;&gt;&gt; Waiting for open spot requests to become active...
1/1 |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| 100%
&gt;&gt;&gt; Waiting for all nodes to be in a 'running' state...
1/1 |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| 100%
&gt;&gt;&gt; Waiting for SSH to come up on all nodes...
1/1 |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| 100%
&gt;&gt;&gt; Checking for required remote commands...
&gt;&gt;&gt; Creating 1GB volume in zone us-east-1c
&gt;&gt;&gt; New volume id: vol-2f3a5344
&gt;&gt;&gt; Waiting for new volume to become 'available'...
&gt;&gt;&gt; Attaching volume vol-2f3a5344 to instance i-fb9ceb95...
&gt;&gt;&gt; Formatting volume...
mke2fs 1.41.11 (14-Mar-2010)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
65536 inodes, 262144 blocks
13107 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=268435456
8 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376

Writing inode tables: done
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information: done

This filesystem will be automatically checked every 30 mounts or
180 days, whichever comes first.  Use tune2fs -c or -i to override.
&gt;&gt;&gt; Leaving volume vol-2f3a5344 attached to instance i-fb9ceb95
&gt;&gt;&gt; Not terminating host instance i-fb9ceb95
*** WARNING - There are still volume hosts running: i-fb9ceb95
*** WARNING - Run 'starcluster terminate volumecreator' to terminate
*** WARNING - *all* volume host instances once they're no longer needed
&gt;&gt;&gt; Creating volume took 7.396 mins
&gt;&gt;&gt; Your new 1GB volume vol-2f3a5344 has been created successfully</pre>
</div>
<p>Notice the warning at the bottom of the above output. StarCluster will leave
the host instance running with the new volume attached after creating and
formatting the new volume. This allows multiple volumes to be created in a
given availability zone without launching a new instance for each volume. To
see the volume hosts simply run the <em>listclusters</em> command:</p>
<div class="highlight-python"><pre>$ starcluster listclusters volumecreator
StarCluster - (http://web.mit.edu/starcluster)
Software Tools for Academics and Researchers (STAR)
Please submit bug reports to starcluster@mit.edu

-------------------------------------------------
volumecreator (security group: @sc-volumecreator)
-------------------------------------------------
Launch time: 2011-06-13 13:51:25
Uptime: 00:02:09
Zone: us-east-1c
Keypair: mykey
EBS volumes: N/A
Cluster nodes:
    volhost-us-east-1c running i-fd9clb9z  (spot sir-2a8zb4lr)
Total nodes: 1</pre>
</div>
<p>From the above example we see that we have a volume-host in us-east-1c called
<em>volhost-us-east-1c</em>. Any volumes that were created will still be attached to the
volume host until you terminate the <em>volumecreator</em> cluster. If you&#8217;d rather
detach the volume after it&#8217;s been successfully created use the
<em>&#8211;detach-volume</em> (-d) option:</p>
<div class="highlight-python"><pre>$ starcluster createvolume --detach-volume 20 us-east-1c</pre>
</div>
<p>You can login to a volume host instance using:</p>
<div class="highlight-python"><pre>$ starcluster sshnode volumecreator volhost-us-east-1c</pre>
</div>
<p>After logging in you can inspect the volume, upload data, etc.  When you&#8217;re
done using the volumecreator cluster don&#8217;t forget to terminate it:</p>
<div class="highlight-python"><pre>$ starcluster terminate volumecreator</pre>
</div>
<p>If you&#8217;d rather avoid having to terminate the volumecreator each time you can
pass the <em>&#8211;shutdown-volume-host (-s)</em> option to the <em>createvolume</em> command to
have StarCluster automatically terminate the host-instance after successfully
creating the new volume:</p>
<div class="highlight-python"><pre>$ starcluster createvolume --shutdown-volume-host 20 us-east-1c</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using EBS Volumes for Persistent Storage</a><ul>
<li><a class="reference internal" href="#create-partition-and-format-a-new-ebs-volume">Create, Partition, and Format a new EBS Volume</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="previous chapter">StarCluster Configuration File</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="launch.html"
                        title="next chapter">Launching a StarCluster on Amazon EC2</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="launch.html" title="Launching a StarCluster on Amazon EC2"
             >next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="StarCluster Configuration File"
             >previous</a> |</li>
    	<li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../contents.html" >Master Table of Contents</a> &raquo;</li>
          <li><a href="index.html" >StarCluster User Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Software Tools for Academics and Researchers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>