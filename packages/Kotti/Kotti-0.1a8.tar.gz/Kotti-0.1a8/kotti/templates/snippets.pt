<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:define-macro="snippets">
  <body>

    <!-- Messages -->
    <div metal:define-macro="messages" id="messages" class="${request.is_xhr and 'ajax-replace' or ''}">
      <div tal:repeat="queue ('notice', 'success', 'error', '')" tal:omit-tag="">
        <div class="message ${queue} round-corners"
             tal:define="messages request.session.pop_flash(queue)"
             tal:condition="messages"
             tal:repeat="message messages">
          <span tal:omit-tag="" tal:repeat="line message.splitlines()">
            ${line}
            <br/>
          </span>
        </div>
      </div>
    </div>

    <!-- User box -->
    <div metal:define-macro="user-box"
         tal:condition="api.user is not None"
         id="user-box" class="round-corners-bottom">
      <div class="username"
           style="background-image: url(${api.avatar_url(default_image='mm')})">
        <a href="#user-dropdown" class="dropdown-trigger">
          ${api.user.title} â†“
        </a>
      </div>
      <div id="user-dropdown" class="dropdown">
        <ul>
          <li tal:condition="api.has_permission('admin', api.root)">
            <a href="${api.url(api.root, '@@setup')}">Site Setup</a>
          </li>
          <li>
            <a href="${api.url(api.root, '@@prefs')}">Preferences</a>
          </li>
          <li>
            <a href="${request.application_url}/@@logout?came_from=${request.url}">Logout</a>
          </li>
        </ul>
      </div>
    </div>

  </body>
</html>
