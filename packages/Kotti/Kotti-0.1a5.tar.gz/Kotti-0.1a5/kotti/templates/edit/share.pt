<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="api['master_edit.main']">

  <div metal:fill-slot="content">
    <h1>Share <em>${api.context.title}</em></h1>

    <div class="form">
      <div metal:use-macro="api['master_edit.messages']">
      </div>

      <form action="./share" method="post">
        <h2>Assign local roles</h2>
        <ul>
          <li>
            <label for="search-query">Users and groups</label>
            <input type="text" name="query" id="search-query"
                   value="${request.params.get('query')}"
                   placeholder="Search users and groups"
                   />
            <button type="submit" name="search">
              Search
            </button>
          </li>
        </ul>
        <table tal:condition="entries">
          <tr>
            <th>Name</th>
            <th tal:repeat="role available_roles">
              ${role.title}
            </th>
          </tr>
          <tr tal:repeat="entry entries"
              class="${repeat.entry.even and 'even' or 'odd'}">
            <td>${entry[0].title}</td>
            <td tal:repeat="role available_roles" class="checkbox">
              <input type="checkbox"
                     name="role::${entry[0].id}::${role.id}"
                     checked="${role.id in entry[1][0]}"
                     disabled="${role.id in entry[1][1]}" />
              <input type="hidden"
                     name="orig-role::${entry[0].id}::${role.id}"
                     value="${role.id in entry[1][0]}" />
            </td>
          </tr>
        </table>
        <ul>
          <li>
            <button type="submit" name="apply">
              Apply changes
            </button>
          </li>
        </ul>
      </form>
    </div>
  </div>

</html>
