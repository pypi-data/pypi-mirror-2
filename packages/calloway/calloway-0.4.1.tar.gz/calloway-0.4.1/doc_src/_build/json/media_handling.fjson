{"body": "<div class=\"section\" id=\"media-configuration\">\n<h1>Media Configuration<a class=\"headerlink\" href=\"#media-configuration\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>Calloway allows for a range of media serving options. While many Django users are used to having a single directory in which everything resides, others may need to have media hosted somewhere else, and if you allow for user uploads, you may want those stored somewhere different from your regular media.</p>\n<div class=\"section\" id=\"three-different-kinds-of-media\">\n<h2>Three Different Kinds of Media<a class=\"headerlink\" href=\"#three-different-kinds-of-media\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>All media is not created equal, and you may want to handle different media, well, differently. Here are a few types we&#8217;ve identified.</p>\n<dl class=\"docutils\">\n<dt><strong>assets</strong></dt>\n<dd>Assets are files that your staff uploads, such as photos, documents and audio recordings. Django 1.1 or greater allows for custom media storage, which Calloway can use to separate the staff uploads from applications such as Massmedia from user uploads from applications like a user profile.</dd>\n<dt><strong>static</strong></dt>\n<dd>Static files are files specifically for the website, such as CSS, Javascript, and images. You should store these files in your repository. Many times you will want to combine some and minify or otherwise optimize others.</dd>\n<dt><strong>uploads</strong></dt>\n<dd>You might not allow user uploads, but if you ever do, you will want to keep these files separate from others.</dd>\n</dl>\n</div>\n<div class=\"section\" id=\"media-management-in-calloway\">\n<h2>Media Management in Calloway<a class=\"headerlink\" href=\"#media-management-in-calloway\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>By default, Django wants to store all media in the same place. Segregating different types of media requires a bit of reconfiguration to make it work. The settings here assumes that static or website media is stored in the repository in a directory named <tt class=\"docutils literal\"><span class=\"pre\">static</span></tt>. Assets and uploads are stored in directories within a directory named <tt class=\"docutils literal\"><span class=\"pre\">media</span></tt> where <tt class=\"docutils literal\"><span class=\"pre\">media</span></tt> is <em>not</em> in the repository.</p>\n<img alt=\"../_images/callowaymediahandling.png\" src=\"../_images/callowaymediahandling.png\" />\n<div class=\"section\" id=\"media-url-prefix-and-media-root-prefix-settings\">\n<h3><tt class=\"docutils literal\"><span class=\"pre\">MEDIA_URL_PREFIX</span></tt> and <tt class=\"docutils literal\"><span class=\"pre\">MEDIA_ROOT_PREFIX</span></tt> settings<a class=\"headerlink\" href=\"#media-url-prefix-and-media-root-prefix-settings\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>These settings aren&#8217;t standard Django settings, but it makes it easier to configure the multiple urls we need. If you are going to store production media on a separate server or location from your development media.</p>\n<p>The sample project template configures these:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">local_settings</span> <span class=\"kn\">import</span> <span class=\"n\">MEDIA_URL_PREFIX</span>\n<span class=\"k\">except</span> <span class=\"ne\">ImportError</span><span class=\"p\">:</span>\n    <span class=\"n\">MEDIA_URL_PREFIX</span> <span class=\"o\">=</span> <span class=\"s\">&quot;http://media.example.com/&quot;</span>\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">local_settings</span> <span class=\"kn\">import</span> <span class=\"n\">MEDIA_ROOT_PREFIX</span>\n<span class=\"k\">except</span> <span class=\"ne\">ImportError</span><span class=\"p\">:</span>\n    <span class=\"n\">MEDIA_ROOT_PREFIX</span> <span class=\"o\">=</span> <span class=\"s\">&#39;/nfs-media/website/&#39;</span>\n</pre></div>\n</div>\n<p>This configuration allows for media to be handled differently during development than deployment, and allows for custom media storage to utilize them.</p>\n</div>\n<div class=\"section\" id=\"media-root-and-media-url-settings\">\n<h3><tt class=\"docutils literal\"><span class=\"pre\">MEDIA_ROOT</span></tt> and <tt class=\"docutils literal\"><span class=\"pre\">MEDIA_URL</span></tt> settings<a class=\"headerlink\" href=\"#media-root-and-media-url-settings\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>This is the default place that Django looks for media. We are going to use this for user-generated content.</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">local_settings</span> <span class=\"kn\">import</span> <span class=\"n\">MEDIA_ROOT</span>\n<span class=\"k\">except</span> <span class=\"ne\">ImportError</span><span class=\"p\">:</span>\n    <span class=\"n\">MEDIA_ROOT</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">MEDIA_ROOT_PREFIX</span><span class=\"p\">,</span> <span class=\"s\">&#39;ugc&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">MEDIA_URL</span> <span class=\"o\">=</span> <span class=\"s\">&#39;</span><span class=\"si\">%s</span><span class=\"s\">ugc/&#39;</span> <span class=\"o\">%</span> <span class=\"n\">MEDIA_URL_PREFIX</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"static-media-and-static-url-settings\">\n<h3><tt class=\"docutils literal\"><span class=\"pre\">STATIC_MEDIA</span></tt> and <tt class=\"docutils literal\"><span class=\"pre\">STATIC_URL</span></tt> settings<a class=\"headerlink\" href=\"#static-media-and-static-url-settings\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>This is a proposed addition to Django&#8217;s default settings. Other projects, such as <a class=\"reference external\" href=\"http://pinaxproject.com/\">Pinax</a>, are already using this convention for their website media. Static Media Manager has a context processor that makes <tt class=\"docutils literal\"><span class=\"pre\">STATIC_URL</span></tt> available to the template.</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">local_settings</span> <span class=\"kn\">import</span> <span class=\"n\">STATIC_ROOT</span>\n<span class=\"k\">except</span> <span class=\"ne\">ImportError</span><span class=\"p\">:</span>\n    <span class=\"n\">STATIC_ROOT</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">MEDIA_ROOT_PREFIX</span><span class=\"p\">,</span> <span class=\"s\">&#39;static&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">STATIC_URL</span> <span class=\"o\">=</span> <span class=\"s\">&quot;</span><span class=\"si\">%s</span><span class=\"s\">static/&quot;</span> <span class=\"o\">%</span> <span class=\"n\">MEDIA_URL_PREFIX</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"massmedia-storage-setup\">\n<h3>Massmedia storage setup<a class=\"headerlink\" href=\"#massmedia-storage-setup\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>Massmedia allows for the configuration of a default storage system to be used for all types of media, and separate configurations to override the default for each type of media. In the <tt class=\"docutils literal\"><span class=\"pre\">apps</span></tt> directory is <tt class=\"docutils literal\"><span class=\"pre\">media_storage.py</span></tt>. This contains a custom file storage system for django. The following setting sets the correct storage place using the <tt class=\"docutils literal\"><span class=\"pre\">MEDIA_URL_PREFIX</span></tt> and <tt class=\"docutils literal\"><span class=\"pre\">MEDIA_ROOT_PREFIX</span></tt> settings.</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"n\">MMEDIA_DEFAULT_STORAGE</span> <span class=\"o\">=</span> <span class=\"s\">&#39;media_storage.MediaStorage&#39;</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"staticmediamgr-settings\">\n<h3>StaticMediaMgr settings<a class=\"headerlink\" href=\"#staticmediamgr-settings\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The tool we developed for managing application static media as well as site-specific static media is StaticMediaMgr. It can copy, compress, minify and join files in a configurable way.</p>\n<p>First, we need to handle application media. StaticMediaMgr looks in every application in <tt class=\"docutils literal\"><span class=\"pre\">INSTALLED_APPS</span></tt> for a <tt class=\"docutils literal\"><span class=\"pre\">media</span></tt> directory. All of these directories need a place to copy. We will set it to the destination static media directory.</p>\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">This media is copied <em>before</em> the items in the <tt class=\"docutils literal\"><span class=\"pre\">static</span></tt> directory. This allows us to override a specific media&#8217;s items similarly to overriding templates.</p>\n</div>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"n\">STATIC_MEDIA_APP_MEDIA_PATH</span> <span class=\"o\">=</span> <span class=\"n\">STATIC_ROOT</span>\n</pre></div>\n</div>\n<p>We can have StaticMediaMgr recursively copy multiple directories to different places.</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"n\">STATIC_MEDIA_COPY_PATHS</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n    <span class=\"p\">{</span><span class=\"s\">&#39;from&#39;</span><span class=\"p\">:</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">CALLOWAY_ROOT</span><span class=\"p\">,</span> <span class=\"s\">&#39;media&#39;</span><span class=\"p\">),</span> <span class=\"s\">&#39;to&#39;</span><span class=\"p\">:</span> <span class=\"n\">STATIC_ROOT</span><span class=\"p\">},</span>\n    <span class=\"p\">{</span><span class=\"s\">&#39;from&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;static&#39;</span><span class=\"p\">,</span> <span class=\"s\">&#39;to&#39;</span><span class=\"p\">:</span> <span class=\"n\">STATIC_ROOT</span><span class=\"p\">},</span>\n<span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Last, but not least, we must configure the compression. During development, we don&#8217;t want it, but we do want it for production:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"n\">STATIC_MEDIA_COMPRESS_CSS</span> <span class=\"o\">=</span> <span class=\"ow\">not</span> <span class=\"n\">DEBUG</span>\n<span class=\"n\">STATIC_MEDIA_COMPRESS_JS</span> <span class=\"o\">=</span> <span class=\"ow\">not</span> <span class=\"n\">DEBUG</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"ignoring-the-right-things\">\n<h3>Ignoring the right things<a class=\"headerlink\" href=\"#ignoring-the-right-things\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The <tt class=\"docutils literal\"><span class=\"pre\">.gitignore</span></tt> file should contain several things:</p>\n<div class=\"highlight-python\"><pre>*.pyc\n.svn\n.DS_Store\nlocal_settings.py\nexternals\npip-log.txt\ndev.db\nmedia2/\nmedia/</pre>\n</div>\n</div>\n</div>\n</div>\n", "display_toc": true, "title": "Media Configuration", "sourcename": "media_handling.txt", "customsidebar": null, "current_page_name": "media_handling", "next": {"link": "../reference/", "title": "Reference"}, "rellinks": [["genindex", "General Index", "I", "index"], ["reference/index", "Reference", "N", "next"], ["template_projects", "Template Projects", "P", "previous"]], "meta": {}, "parents": [], "sidebars": null, "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Media Configuration</a><ul>\n<li><a class=\"reference internal\" href=\"#three-different-kinds-of-media\">Three Different Kinds of Media</a></li>\n<li><a class=\"reference internal\" href=\"#media-management-in-calloway\">Media Management in Calloway</a><ul>\n<li><a class=\"reference internal\" href=\"#media-url-prefix-and-media-root-prefix-settings\"><tt class=\"docutils literal\"><span class=\"pre\">MEDIA_URL_PREFIX</span></tt> and <tt class=\"docutils literal\"><span class=\"pre\">MEDIA_ROOT_PREFIX</span></tt> settings</a></li>\n<li><a class=\"reference internal\" href=\"#media-root-and-media-url-settings\"><tt class=\"docutils literal\"><span class=\"pre\">MEDIA_ROOT</span></tt> and <tt class=\"docutils literal\"><span class=\"pre\">MEDIA_URL</span></tt> settings</a></li>\n<li><a class=\"reference internal\" href=\"#static-media-and-static-url-settings\"><tt class=\"docutils literal\"><span class=\"pre\">STATIC_MEDIA</span></tt> and <tt class=\"docutils literal\"><span class=\"pre\">STATIC_URL</span></tt> settings</a></li>\n<li><a class=\"reference internal\" href=\"#massmedia-storage-setup\">Massmedia storage setup</a></li>\n<li><a class=\"reference internal\" href=\"#staticmediamgr-settings\">StaticMediaMgr settings</a></li>\n<li><a class=\"reference internal\" href=\"#ignoring-the-right-things\">Ignoring the right things</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "prev": {"link": "../template_projects/", "title": "Template Projects"}, "metatags": ""}