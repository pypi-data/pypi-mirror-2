(function(a){String.prototype.startsWith=function(e){var c=this.length;var d=e.length;if(c<d){return false}return(this.substr(0,d)==e)};String.prototype.endsWith=function(e){var c=this.length;var d=e.length;if(c<d){return false}return(this.substr(c-d)==e)};a.ZBlog={json:{getAddr:function(){var c=window.location.href;return c.substr(0,c.lastIndexOf("/")+1)},post:function(i,g,d,c,f){var h=a.ZBlog.json.getAddr();if(f){h+="/"+f}var e={url:h,type:"POST",method:i,params:g,success:d,error:c};a.jsonRpc(e)}},ajax:{check:function(c,d,e){if(typeof(c)=="undefined"){a.getScript(d,e)}else{e()}},getAddr:function(){var c=window.location.href;return c.substr(0,c.lastIndexOf("/")+1)},post:function(f,h,d,c,g){if(f.startsWith("http://")){var i=f}else{var i=a.ZBlog.ajax.getAddr()+f}var e={url:i,type:"POST",data:h,dataType:g,success:d,error:c};a.ajax(e)},submit:function(h,f,i,d,c,g){if(f.startsWith("http://")){var j=f}else{var j=a.ZBlog.ajax.getAddr()+f}var e={url:j,type:"POST",data:i,dataType:g,success:d,error:c};a(h).ajaxSubmit(e)}},loader:{div:null,start:function(e){e.empty();var c=a('<div class="loader"></div>').appendTo(e);var d=a('<img class="loading" src="/++skin++ZBlog.BO/@@/ztfy.blog.img/loading.gif" />').appendTo(c);a.ZBlog.loader.div=c},stop:function(){if(a.ZBlog.loader.div!=null){a.ZBlog.loader.div.replaceWith("");a.ZBlog.loader.div=null}}},dialog:{src:null,options:{expose:{maskId:"mask",color:"#ccc",opacity:0.6,zIndex:9998},api:true,oneInstance:false,closeOnClick:false,onBeforeLoad:function(){a.ZBlog.loader.start(this.getContent());this.getContent().load(a.ZBlog.dialog.src);if(a.browser.msie&&(a.browser.version<"7")){a("select").css("visibility","hidden")}},onClose:function(){a.ZBlog.dialog.onClose();if(a.browser.msie&&(a.browser.version<"7")){a("select").css("visibility","hidden")}}},count:0,getCurrent:function(){return a("#dialog_"+a.ZBlog.dialog.count)},open:function(e){if(!a.ZBlog.dialog.dialogs){a.ZBlog.dialog.dialogs=new Array();a.ZBlog.dialog.count=0}a.ZBlog.dialog.count+=1;var f="dialog_"+a.ZBlog.dialog.count;var c={};var d={maskId:"mask",color:"#ccc",opacity:0.6,zIndex:a.ZBlog.dialog.options.expose.zIndex+a.ZBlog.dialog.count};a.extend(c,a.ZBlog.dialog.options,{expose:d});a.ZBlog.dialog.dialogs[a.ZBlog.dialog.count]=a('<div class="overlay"></div>').attr("id",f).appendTo(a("body"));a.ZBlog.dialog.src=e;a("#"+f).empty().overlay(c).load()},close:function(){var c="dialog_"+a.ZBlog.dialog.count;a("#"+c).overlay().close()},onClose:function(){if(typeof(tinyMCE)!="undefined"){if(tinyMCE.activeEditor){tinyMCE.execCommand("mceRemoveControl",false,tinyMCE.activeEditor.id)}}a("BODY DIV:last").remove();a.ZBlog.dialog.dialogs[a.ZBlog.dialog.count].remove();a.ZBlog.dialog.dialogs[a.ZBlog.dialog.count]=null;a.ZBlog.dialog.count-=1},},form:{check:function(c){a.ZBlog.ajax.check(a.fn.ajaxSubmit,"/++skin++ZBlog.BO/@@/ztfy.jquery.form/jquery-form.min.js",c)},hideStatus:function(){a("FORM DIV.status").animate({opacity:0,height:0},2000,function(){a(this).remove()})},reset:function(c){c.reset();a("input:first",c).focus()},add:function(d,c){a.ZBlog.form.check(function(){a.ZBlog.form._add(d,c)});return false},_add:function(d,c){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var e={};if(c){e.parent=c}a.ZBlog.form.add_action=a(d).attr("action");a.ZBlog.ajax.submit(d,a(d).attr("action")+"/@@ajax/ajaxCreate",e,a.ZBlog.form._addCallback,null,"json")},_addCallback:function(c,d){if(d=="success"){output=c.output;if(output.startsWith("<!-- OK -->")){a.ZBlog.dialog.close();a("DIV.form").replaceWith(output)}else{var e=a.ZBlog.dialog.getCurrent();a("DIV.dialog",e).replaceWith(output);a("FORM",e).attr("action",a.ZBlog.form.add_action);a("#form-buttons-add",e).bind("click",function(f){a.ZBlog.form.add(this.form,c.parent)});a("#form-buttons-cancel",e).bind("click",function(f){a.ZBlog.dialog.close()});a(".hint",e).tooltip({tip:"#tooltip",position:"bottom left",opacity:0.8,offset:[-5,0]})}}},edit:function(c,d){a.ZBlog.form.check(function(){a.ZBlog.form._edit(c,d)});return false},_edit:function(c,d){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}a.ZBlog.form.edit_action=a(c).attr("action");a.ZBlog.ajax.submit(c,a(c).attr("action")+"/@@ajax/ajaxEdit",{},a.ZBlog.form._editCallback,null,"json")},_editCallback:function(c,d){if(d=="success"){var e=c.output;if(e=="OK"){a.ZBlog.dialog.close();a("DIV.status").remove();a("DIV.required-info").after('<div class="status"><div class="summary">'+a.ZBlog.I18n.DATA_UPDATED+"</div></div>")}else{if(e=="NONE"){a.ZBlog.dialog.close();a("DIV.status").remove();a("DIV.required-info").after('<div class="status"><div class="summary">'+a.ZBlog.I18n.NO_UPDATE+"</div></div>")}else{if(e.startsWith("<!-- OK -->")){a.ZBlog.dialog.close();a("DIV.form").replaceWith(e)}else{var f=a.ZBlog.dialog.getCurrent();a("DIV.dialog",f).replaceWith(e);a("FORM",f).attr("action",a.ZBlog.form.edit_action);a("#form-buttons-dialog_submit",f).bind("click",function(g){a.ZBlog.form.edit(this.form)});a("#form-buttons-dialog_cancel",f).bind("click",function(g){a.ZBlog.dialog.close()});a(".hint",f).tooltip({tip:"#tooltip",position:"bottom left",opacity:0.8,offset:[-5,0]})}}}}},remove:function(c,d){jConfirm(a.ZBlog.I18n.CONFIRM_REMOVE,a.ZBlog.I18n.CONFIRM,function(f){if(f){var e={id:c};a.ZBlog.form.ajax_source=d;a.ZBlog.ajax.post(window.location.href+"/@@ajax/ajaxRemove",e,a.ZBlog.form._removeCallback,null,"text")}})},_removeCallback:function(c,d){if((d=="success")&&(c=="OK")){a(a.ZBlog.form.ajax_source).parents("TR").remove()}},update:function(c){a.ZBlog.form.check(function(){a.ZBlog.form._update(c)});return false},_update:function(c){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var d=a(c).formToArray(true);a.ZBlog.ajax.post(a(c).attr("action")+"/@@ajax/ajaxUpdate",d,a.ZBlog.form._updateCallback,null,"text")},_updateCallback:function(c,d){if((d=="success")&&(c=="OK")){a("DIV.status").remove();a("LEGEND").after('<div class="status"><div class="summary">Data successfully updated.</div></div>')}}},container:{remove:function(d,e){var c={_source:e,url:a.ZBlog.json.getAddr(),type:"POST",method:"remove",params:{id:d},success:function(g,f){a(this._source).parents("TR").remove()},error:function(h,f,g){jAlert(h.responseText,a.ZBlog.I18n.ERROR_OCCURED,window.location.reload)}};jConfirm(a.ZBlog.I18n.CONFIRM_REMOVE,a.ZBlog.I18n.CONFIRM,function(f){if(f){a.jsonRpc(c)}})}},sortable:{options:{handle:"IMG.handler",axis:"y",containment:"parent",placeholder:"sorting-holder",stop:function(d,f){var c=new Array();a("TABLE.orderable TD.id").each(function(g){c[c.length]=a(this).text()});var e={ids:c};a.ZBlog.ajax.post(window.location.href+"/@@ajax/ajaxUpdateOrder",e,null,function(i,g,h){jAlert(i.responseText,a.ZBlog.I18n.ERROR_OCCURED,window.location.reload)})}}},treeview:{changeParent:function(d,f){var h=a(f.draggable.parents("TR"));if(h.appendBranchTo(this)){var e=h.attr("id").substr("node-".length);var g=a(this).attr("id").substr("node-".length);var c={url:a.ZBlog.json.getAddr(),type:"POST",method:"changeParent",params:{source:parseInt(e),target:parseInt(g)},error:function(k,i,j){jAlert(k.responseText,a.ZBlog.I18n.ERROR_OCCURED,window.location.reload)}};a.jsonRpc(c)}}},reference:{activate:function(c){a("INPUT[name="+c+"]").attr("readonly","").val("").focus();a("INPUT[name="+c+"]").prev().val("")},keyPressed:function(c){if(c.which==13){a.ZBlog.reference.search(this);return false}},search:function(d){a.ZBlog.reference.source=d;var c=a(d).parents("FORM");a.ZBlog.ajax.post(c.attr("action")+"/@@ajax/ajaxSearch",{title:a(d).val()},a.ZBlog.reference._searchCallback,null,"json")},_searchCallback:function(d,e){if(e=="success"){if(d.length==1){a.ZBlog.reference.select(d[0].oid,d[0].title)}else{if(d.length>1){var h=a("#selector");if(h.length==0){h=a('<div id="selector"></div>')}h.empty();for(var f=0;f<d.length;f++){var g=d[f].oid;var j=d[f].title;a("<div onclick=\"return $.ZBlog.reference.select('"+g+"','"+j+"');\"></div>").addClass("reference").text(j).appendTo(h)}var k=a(a.ZBlog.reference.source);var c=k.position();h.css("width",k.width()-10).appendTo(k.parents("DIV.overlay")).overlay({expose:"transparent",api:true,oneInstance:false,closeOnClick:false,closeOnEsc:false,top:c.top+k.height(),left:c.left+30,absolute:true,onBeforeLoad:function(){if(a.browser.msie&&(a.browser.version<7)){a("select").css("visibility","hidden")}},onClose:function(){if(a.browser.msie&&(a.browser.version<7)){a("select").css("visibility","visible")}}}).load()}}}},select:function(c,e){var d=a.ZBlog.reference.source;a(d).prev().val(c);a(d).val(e+" (OID: "+c+")").attr("readonly","readonly");a("#selector").overlay().close();a("#selector").remove();return false}},topic:{remove:function(c){a.ZBlog.ajax.post(a(c).attr("action")+"/@@ajax/ajaxDelete",{},a.ZBlog.topic.removeCallback,null,"json");return false},removeCallback:function(c,d){if(d=="success"){window.location=c.url}}},properties:{switcher:function(c){a("DIV.properties DIV.switch").toggle()}}};var b=a("HTML").attr("lang")||a("HTML").attr("xml:lang");a.getScript("/++skin++ZBlog.BO/@@/ztfy.blog.back.js/i18n/"+b+".js");if(a.browser.safari){a.support.opacity=true}if(a.fn.fancybox){a(document).ready(function(){a("DIV.download-link IMG").parents("A").fancybox({type:"image",titleShow:false,hideOnContentClick:true})})}})(jQuery);