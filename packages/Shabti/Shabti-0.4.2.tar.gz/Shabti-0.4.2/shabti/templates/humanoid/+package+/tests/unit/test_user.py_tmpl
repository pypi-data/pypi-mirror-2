# humanoid/tests/unit/test_user
from {{package}}.tests import *
from {{package}}.model import *

class TestUser(TestModel):
    def setUp(self):
        TestModel.setUp(self)
        self.newuser = User()
        self.newuser.username = u'tester'
        self.newuser.password = 'test'
        self.newuser.password_check = 'test'
        self.newuser.email = 'test@here.com'
        self.newuser.active = True
        meta.Session.add(self.newuser)
        self.group = Group()
        self.group.name = u'New Subscription Members'
        meta.Session.add(self.group)
        self.perm = Permission()
        meta.Session.add(self.perm)
        self.perm.name = u'add_new_users'
        self.group.permissions.append(self.perm)
        meta.Session.commit()
    
    
    def tearDown(self):
        TestModel.tearDown(self)
    
    
    def test_authenticate(self):
        assert User.authenticate(u'tester', 'test')
        self.newuser.password = 'test_again'
        meta.Session.commit()
        assert User.authenticate(u'tester', 'test_again')
    
    
    def test_permissions(self):
        assert not self.newuser.has_permission(u'add_new_users')
        self.group.users.append(self.newuser)
        meta.Session.commit()
        assert self.newuser.has_permission(u'add_new_users')
    

# --- Overwritten by shabti_humanoid template

