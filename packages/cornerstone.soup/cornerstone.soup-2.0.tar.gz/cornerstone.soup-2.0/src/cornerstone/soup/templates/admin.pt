<h1>Soup Administration</h1>

<div class="portalMessage info"
     tal:condition="view/info"
     tal:content="view/info">
  message
</div>

<table style="border-spacing:0;border-collapse:collapse;">
  <tr tal:repeat="soup view/existing_soups">
    <td style="border: #333 1px solid;">
      <strong tal:content="soup">soupid</strong><br />
      <strong>Path:</strong>
      <span tal:replace="python: view.storage_path(soup)">/</span>
    </td>
    <td style="border: #333 1px solid;">
      <a href="#"
         tal:condition="python: view.storage_migrated(soup)"
         tal:attributes="href python:'@@reindex_soup?id=%s' % soup">
        reindex
      </a>
      <span tal:condition="python: not view.storage_migrated(soup)">
        reindex (you have to migrate storage first)
      </span>
    </td>
    <td style="border: #333 1px solid;">
      <a href="#"
         tal:condition="python: view.storage_migrated(soup)"
         tal:attributes="href python:'@@rebuild_soup?id=%s' % soup">
        rebuild
      </a>
      <span tal:condition="python: not view.storage_migrated(soup)">
        rebuild (you have to migrate storage first)
      </span>
    </td>
    <td style="border: #333 1px solid;">
      <a href="#"
         tal:condition="python: not view.storage_migrated(soup)"
         tal:attributes="href python:'@@migrate_storage?id=%s' % soup">
        migrate storage
      </a>
      <span tal:condition="python: view.storage_migrated(soup)">
        storage already migrated
      </span>
    </td>
    <td style="border: #333 1px solid;">
      <a href="#"
         tal:condition="python: not view.local_component_removed(soup)
                                and view.storage_migrated(soup)"
         tal:attributes="href python:'@@remove_local_component?id=%s' % soup">
        remove local component
      </a>
      <span tal:condition="python: view.local_component_removed(soup)
                                   and not view.storage_migrated(soup)">
        remove local component (you have to migrate storage first)
      </span>
      <span tal:condition="python: view.local_component_removed(soup)
                                   and view.storage_migrated(soup)">
        local component already removed
      </span>
    </td>
  </tr>
</table>

<h3>Move Soup data location (make sure storage is migrated first)</h3>

<p>
  You can move soup storage data elsewhere relative to ISoupAnnotatable
  object. This way you can put a soup with lots of records inside to a
  separate ZODB mount point.
</p>

<form action="@@move_storage" method="post">
  <select name="id">
    <option tal:repeat="soup view/existing_soups"
            tal:content="soup">
      soup_id
    </option>
  </select>
  <br />
  Path: /<input type="text" name="path" /><br />
  <input type="submit" value="move" />
</form>