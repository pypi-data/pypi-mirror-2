<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How to use the storage backends &mdash; Collectors v0.2 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Collectors v0.2 documentation" href="index.html" />
    <link rel="next" title="How to use Collectors with SimPy" href="simpy.html" />
    <link rel="prev" title="The Collector in-depth" href="collector.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="simpy.html" title="How to use Collectors with SimPy"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="collector.html" title="The Collector in-depth"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Collectors v0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="how-to-use-the-storage-backends">
<span id="storages"></span><h1>How to use the storage backends<a class="headerlink" href="#how-to-use-the-storage-backends" title="Permalink to this headline">¶</a></h1>
<p>By default, <em>Collectors</em> uses a simple python <a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/library/functions.html#list"><tt class="xref docutils literal"><span class="pre">list</span></tt></a> for each series. You
can use other storage backends to handle very large amounts of data or to get a
simple <em>MS Excel</em> export. You can also add your own storage classes very easily.</p>
<p>All storage classes can be found in submodules of <a title="" class="reference external" href="ref/storage.html#module-collectors.storage"><tt class="xref docutils literal"><span class="pre">collectors.storage</span></tt></a>
(e.g. <tt class="xref docutils literal"><span class="pre">collectors.storage.pytables.PyTables</span></tt>) but you can also import
<tt class="xref docutils literal"><span class="pre">PyTables</span></tt> and
<tt class="xref docutils literal"><span class="pre">Excel</span></tt> directly from
<a title="" class="reference external" href="ref/storage.html#module-collectors.storage"><tt class="xref docutils literal"><span class="pre">collectors.storage</span></tt></a>.</p>
<p>You must pass an instance of the storage as keyword argument <tt class="docutils literal"><span class="pre">backend</span></tt> to a
new Collector. Each storage instance should only be used with one Collector
instance.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">collectors</span> <span class="kn">import</span> <span class="n">Collector</span>
<span class="kn">from</span> <span class="nn">collectors.storage</span> <span class="kn">import</span> <span class="n">MyStorage</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Collector</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">MyStorage</span><span class="p">())</span>
</pre></div>
</div>
<div class="section" id="pytables-hdf5">
<h2>PyTables/HDF5<a class="headerlink" href="#pytables-hdf5" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.pytables.org/">PyTables</a> is not bundled with this package.
Instructions follow:</p>
<p><strong>Mac OS X (10.6 Snow Leopard)</strong></p>
<p>You should not use the precompiled version of <em>HDF5</em> because it’s linked against
<em>szip</em>, which is not bundled with <em>HDF5</em> and available under a license you might
not want. So you need to compile it yourself:</p>
<ol class="arabic simple">
<li>Download the source from <a class="reference external" href="ftp://ftp.hdfgroup.org/HDF5/current/src/">ftp://ftp.hdfgroup.org/HDF5/current/src/</a></li>
<li>Build and install (<em>PyTables</em> will auto detect it if you install it under
<tt class="docutils literal"><span class="pre">/usr/local</span></tt>):</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>./configure --prefix<span class="o">=</span>/usr/local
<span class="nv">$ </span>make
<span class="nv">$ </span>sudo make install
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Finally install <em>PyTables:</em></li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo pip install tables
</pre></div>
</div>
<p><strong>Ubuntu (9.10 Karmic Koala)</strong></p>
<p>Ubuntu’s package for PyTables is somehow broken, so you need to build your own.
If <em>gcc</em> is already installed, you just need to add the development files for
python and HDF5 before you can build and install PyTables from <a class="reference external" href="http://pypi.python.org/pypi/tables">PyPI</a>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo aptitude install python-dev libhdf5-serial-dev
<span class="nv">$ </span>sudo pip install tables
</pre></div>
</div>
<p><strong>Windows</strong></p>
<p>Download the installer from <a class="reference external" href="http://www.pytables.org/download/stable/">here</a>
and execute it. Further information can be found in the <a class="reference external" href="http://www.pytables.org/docs/manual/ch02.html#binaryInstallationDescr">PyTables manual</a>.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tables</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collectors</span> <span class="kn">import</span> <span class="n">Collector</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">storage</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Spam</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spam</span> <span class="o">=</span> <span class="n">Spam</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h5file</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">openFile</span><span class="p">(</span><span class="s">&#39;/tmp/example.h5&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collector</span> <span class="o">=</span> <span class="n">Collector</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">spam</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">backend</span><span class="o">=</span><span class="n">storage</span><span class="o">.</span><span class="n">PyTables</span><span class="p">(</span><span class="n">h5file</span><span class="p">,</span> <span class="s">&#39;spamgroup&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">))</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))):</span>
<span class="gp">... </span>    <span class="n">spam</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">spam</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">values</span>
<span class="gp">... </span>    <span class="n">collector</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">collector</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">collector</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">[0 1 2 3 4 5 6 7 8 9] [9 8 7 6 5 4 3 2 1 0]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">collector</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">collector</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="go">4.5 9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h5file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The <tt class="xref docutils literal"><span class="pre">PyTables</span></tt> storage stores the results
for multiple Collector instances in one file. For each Collector, a new group
will be create and each observed variable will have its own array within that
group, so the group name musst be unique among all collectors that use the same
HDF5 file.</p>
<p>You also need to specifiy the data types of the observed variables. They must be
passed as list of strings (like e.g. <tt class="docutils literal"><span class="pre">'int'</span></tt>, <tt class="docutils literal"><span class="pre">'float'</span></tt> or <tt class="docutils literal"><span class="pre">'bool'</span></tt>, see
the <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/arrays.scalars.html#built-in-scalar-types">NumPy Docs</a> for more details).</p>
<p>The <em>series</em> are now <a class="reference external" href="http://www.pytables.org/docs/manual/ch04.html#EArrayClassDescr">EArrays</a> instead of
simple lists. The <tt class="docutils literal"><span class="pre">read</span></tt> function returns the complete series for that
variable as a NumPy array so you can do further calculations on them very fast.</p>
</div>
</div>
<div class="section" id="ms-excel">
<h2>MS Excel<a class="headerlink" href="#ms-excel" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="xref docutils literal"><span class="pre">Excel</span></tt> storage allows you to store your
data directly in an Excel file.</p>
<p>To use this storage backend, you need to install <tt class="docutils literal"><span class="pre">xlwt</span></tt> (like “Excel
Write”—<tt class="docutils literal"><span class="pre">xlrd</span></tt> (“Excel Read”) can be used to read from an Excel file):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo pip install xlwt
</pre></div>
</div>
<div class="section" id="id1">
<h3>Example<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">xlwt</span> <span class="kn">import</span> <span class="n">Workbook</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collectors</span> <span class="kn">import</span> <span class="n">Collector</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">storage</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ObserveMe</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">ObserveMe</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Collector</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;value_a&#39;</span><span class="p">,</span> <span class="s">&#39;value_b&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">backend</span><span class="o">=</span><span class="n">storage</span><span class="o">.</span><span class="n">Excel</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">&#39;my collected data&#39;</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))):</span>
<span class="gp">... </span>    <span class="n">obj</span><span class="o">.</span><span class="n">value_a</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">value_b</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<span class="gp">... </span>    <span class="n">c</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;/tmp/example.xls&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the the Excel storage is quite easy. Just create a new <tt class="docutils literal"><span class="pre">Workbook</span></tt> and
pass it with a name for the sheet to <tt class="xref docutils literal"><span class="pre">Excel</span></tt>
constructor. Alternatively, you can create a sheet with
<tt class="docutils literal"><span class="pre">workbook.add_sheet('name')</span></tt> and pass the sheet instance instead of a string
with the sheet’s name.</p>
<p>When you are done collecting data, save the Workbook to a file by calling its
<tt class="docutils literal"><span class="pre">save()</span></tt> method.</p>
</div>
</div>
<div class="section" id="whats-next">
<h2>What’s next?<a class="headerlink" href="#whats-next" title="Permalink to this headline">¶</a></h2>
<p><em>Collectors</em> was originally developed to use it with <a class="reference external" href="http://simpy.sourceforge.net/">SimPy</a>, so we’ll show how both packages can be used
together in the next section.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">How to use the storage backends</a><ul>
<li><a class="reference external" href="#pytables-hdf5">PyTables/HDF5</a><ul>
<li><a class="reference external" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference external" href="#ms-excel">MS Excel</a><ul>
<li><a class="reference external" href="#id1">Example</a></li>
</ul>
</li>
<li><a class="reference external" href="#whats-next">What’s next?</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="collector.html"
                                  title="previous chapter">The Collector in-depth</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="simpy.html"
                                  title="next chapter">How to use <em>Collectors</em> with <em>SimPy</em></a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/storages.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="simpy.html" title="How to use Collectors with SimPy"
             >next</a> |</li>
        <li class="right" >
          <a href="collector.html" title="The Collector in-depth"
             >previous</a> |</li>
        <li><a href="index.html">Collectors v0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Stefan Scherfke and Ontje Lünsdorf.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.3.
    </div>
  </body>
</html>