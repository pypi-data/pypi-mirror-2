<script tal:content="string: minutes = ${view/data/minutes};" />
<script>
function getLiveUsers() {
    jq.getScript(pkBaseURL + '?module=API&method=Live.getUsersInLastXMin&minutes=' + minutes + '&idSite=' + site_id + '&format=json&token_auth=anonymous&jsoncallback=liveuserscb');
}

window.liveuserscb = function(jdata){
    jq('#liveUsers').html(jdata.length);
    jq('#portletOnlineUsers').show();
};

jq(window).load(function() { getLiveUsers(); });
</script>

<dl class="portlet" id="portletOnlineUsers"
    i18n:domain="collective.piwik.now" style="display:none">

    <dt class="portletHeader">
        <span class="portletTopLeft"></span>
        Online now
        <span class="portletTopRight"></span>
    </dt>

    <dd class="portletItem odd">
        <span id="liveUsers">0</span> users
    </dd>

</dl>
