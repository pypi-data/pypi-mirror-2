<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="layout.html" />
  <xi:include href="macros.html" />
  <head>

	<style type="text/css">
	#chart { height: 500px }
	</style>
	
	<script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/yahoo-dom-event/yahoo-dom-event.js"></script>
	<script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/element/element-beta-min.js"></script>
	<script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/datasource/datasource-beta-min.js"></script>
	<script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/json/json-min.js"></script>
	<!-- OPTIONAL: Connection (enables XHR) -->
	<script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/connection/connection-min.js"></script>
	<!-- Source files -->
	<script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/charts/charts-experimental-min.js"></script>

  </head>
<body class="yui-skin-sam">


<p/>
<span class="chart_title">
<h1>Test Management Statistics</h1>
</span>
<div id="content">
<div id="chart"></div>
<script type = "text/javascript">

	function rqstr(){
		return  "&#38;start_date=" + document.getElementById("dt_frm").start_date.value + 
			"&#38;end_date=" + document.getElementById("dt_frm").end_date.value +
			"&#38;resolution=" + document.getElementById("dt_frm").resolution.value +
			"&#38;testplan=" + document.getElementById("dt_frm").testplan.value;
	}
	function doRequestData(){
		myCChart.set("request",rqstr());
		updateStaticURL();
	}
	function updateStaticURL(){
		document.getElementById("static_url").innerHTML = "${baseurl}" + "/teststats?content=render" + rqstr();
	}
   function setProvided(res, mile){
      if (!res)
         res=${resolution};
      document.getElementById("resolution").selectedIndex = {1:0, 7:1, 14:2, 30:3, 60:4, 90:5, 180:6, 360:7}[res];
   }

</script>

<fieldset id="Settings">
<legend>Settings</legend>
<form method="post" id="dt_frm" action="javascript:doRequestData()">
	<label for="start_date">Start Date: </label>
	<input type="text" name="start_date" id="start_date" value="${start_date}" size="10"/>
	<label for="end_date">End Date: </label>
	<input type="text" name="end_date" id="end_date" value="${end_date}" size="10"/>
	<label for="resolution">Resolution: </label>
	<!--input type="text" name="resolution" id="resolution" value="${resolution}" size="5"/-->
   <select name="resolution" id="resolution">
      <option value="1">1 Day</option>
      <option value="7">1 Week</option>
      <option value="14">2 Weeks</option>
      <option value="30">1 Month</option>
      <option value="60">2 Months</option>
      <option value="90">3 Months</option>
      <option value="180">6 Months</option>
      <option value="360">1 Year</option>
   </select>
	<label for="testplan">Test Plan: </label>
	<select name="testplan" id="testplan">
		<option value="__all">All Test Plans</option>
		<py:for each="m in testplans">
		<option value="${m['planid']}|${m['catpath']}">${m['name']}</option>
		</py:for> 
	</select>
	<input type="submit" name="Update Chart" value="Update Chart" />
</form>
<p />
<div class="help"><small>
<b>Static URL:</b> <span id="static_url"></span>
</small></div>
</fieldset>
</div>

<script type = "text/javascript">
setProvided();
updateStaticURL();

YAHOO.widget.Chart.SWFURL = "http://yui.yahooapis.com/2.5.2/build/charts/assets/charts.swf";

var myDataSource = new YAHOO.util.DataSource( "?content=chartdata" );

myDataSource.connMethodPost = false;
myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSON;
myDataSource.responseSchema = { 
	resultsList : "chartdata", 
	fields : [
		{key: "date"}, 
		{key: "new_tcs"}, 
		{key: "successful"}, 
		{key: "failed"},
		{key: "all_tcs"}, 
		{key: "all_successful"},
		{key: "all_untested"}, 
		{key: "all_failed"}
		] 
};

var seriesDef =
[
	{ displayName: "New Test Cases", yField: "new_tcs", style: {color: 0x00ffff, size: 20} },
	{ displayName: "Successful", yField: "successful", style: {color: 0x00ff00, size:20} },
	{ displayName: "Failed", yField: "failed", style: {color: 0xff0000, size:20} },
	{ type: "line", displayName: "All Test Cases", yField: "all_tcs", style: {color: 0x0000ff} },
	{ type: "line", displayName: "Successful", yField: "all_successful", style: {color: 0x00ff00} },
	{ type: "line", displayName: "Untested", yField: "all_untested", style: {color: 0xffff00} },
	{ type: "line", displayName: "Failed", yField: "all_failed", style: {color: 0xff0000} }
];

var numtixAxis = new YAHOO.widget.NumericAxis();
numtixAxis.minimum = 0;

YAHOO.example.getDataTipText = function( item, index, series )
{
	var toolTipText = series.displayName + " for " + item.date;
	toolTipText += "\n" + item[series.yField] ;
	return toolTipText;
};

var myCChart = new YAHOO.widget.ColumnChart( "chart", myDataSource,
{
	xField: "date",
	series: seriesDef,
	yAxis: numtixAxis,
	dataTipFunction: YAHOO.example.getDataTipText,
	style: {legend: {display: "bottom"}},
	request: rqstr(),
});


</script>
<div id="myLogger"></div>
<script type="text/javascript">
    var myLogReader = new YAHOO.widget.LogReader("myLogger");
</script>

  </body>
</html>
