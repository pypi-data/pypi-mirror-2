<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
<head>
  <title>Application Server Dashboard</title>
<style type="text/css">
/*<![CDATA[*/
    @import "${dojo}/dojo/resources/dojo.css";
    @import "${dojo}/dijit/themes/tundra/tundra.css";
    @import "resource/appserver.css";

/*]]>*/
</style>
<script type="text/javascript" src="${dojo}/dojo/dojo.js"
      djconfig="isDebug: false, parseOnLoad: true, usePlainJson: true">
// usePlainJson stops JSON warning messages about not using comment filtered JSON

</script>
<script type="text/javascript">
//<![CDATA[
    dojo.require("dojo.parser");
    dojo.require("dojo.data.ItemFileReadStore");
    dojo.require("dojo.data.ItemFileWriteStore");
    dojo.require("dijit.layout.BorderContainer");
    dojo.require("dijit.layout.ContentPane");
    dojo.require("dijit.layout.AccordionContainer");
    dojo.require("dijit.form.Form");
    dojo.require("dijit.form.Textarea");
    dojo.require("dijit.form.CheckBox");
    dojo.require("dijit.form.ValidationTextBox");
    dojo.require("dijit.form.FilteringSelect");
    dojo.require("dijit.Tree");
    dojo.require("dijit.TitlePane");
    dojo.require("dojo.dnd.Source");


            
    function save_groups() {
	var items = target.getAllNodes();
	var vals = '';
	for (var i=0; i < items.length; i++) {
	    vals += items[i].id + ",";	
	}
	alert("selected: " + vals);
	
    }
    
    function save_content_form(args) { 
      //debugger;
      var f = dijit.byId("content_form");
      //alert("args: " + args);
      var target_url;
      if (args == undefined) {
	target_url = "save_content.json";      
      } else {
	//alert("alt_target_url: " + args.alt_target_url);
	target_url = args.alt_target_url;      
	if (args.other_pre_submit != undefined) {
	    alert("Executing: " + args.other_pre_submit);
	    var fn = eval(args.other_pre_submit);
	    fn();
	}
      
      }
      //debugger;
      //alert("target URL: " + target_url);
      if (f.validate()) {
          //debugger;
          dojo.xhrPost({
            url : "save_content.json",
            handleAs : 'json',
            form : "content_form",
            load :     function (data) {
                //debugger;
                var cf = dojo.byId("content_form");  
                var tablename = cf.table.value.toLowerCase();
                var row_id = cf.row_id.value.toLowerCase() == 'new' ? data.items[0].id : cf.row_id.value;

                dijit.byId(tablename + "menu_content").setHref("menu.html?table=" + cf.table.value);         
                //debugger;         
                if (tablename == 'server') {
                   var theURL = 'server_content.html?table=';
                }
                else {
                   var theURL = 'form_content.html?table=';
                }
                theURL +=  cf.table.value + '&amp;row_id=' + data.items[0].id;
                //

                  
                //alert("The URL: " + theURL);
                dijit.byId('content').setHref(theURL);
                var s = dijit.byId("statusbar");
                s.setContent('Saved');
                dojo.fx.chain([
                    dojo.fadeIn({'node' : "statusbar", 'duration' : 100}),
                    dojo.fadeOut({'node' : "statusbar", 'duration' : 5000}),
                ]).play();
            },
            error : function(data) { console.debug("An error occurred: ", data); },
            timeout : 2000,

          });
                
      } else {
         alert("Form failed validation");
      }
    }
    
    
    function commit_to_appserver() {
      var f = dijit.byId("content_form");
      if (f.validate()) {
          dojo.xhrPost({
            url : "update_appserver.json",
            handleAs : 'json',
            form : dojo.byId("content_form"),
            load : function(data) { 
                var s = dijit.byId("statusbar");
                s.setContent('Pushing to Appserver');
                // reload the iframe
                var iframe = document.getElementById('ui_frame');
                iframe.src=iframe.src;
                
                dojo.fx.chain([
                    dojo.fadeIn({'node' : "statusbar", 'duration' : 100}),
                    dojo.fadeOut({'node' : "statusbar", 'duration' : 5000}),
                ]).play();
            },
            error : function(data) { console.debug("An error occurred: ", data); },
            timeout : 2000,

          });
      }
    }

//]]>

</script>
</head>

<body class="tundra">
  <div dojotype="dijit.layout.BorderContainer"
       id="main"
       widgetid="main"
       style="padding: 0px;">
    <div dojotype="dijit.layout.ContentPane"
         region="top">
      <h2 id="apptitle">Application Server Dashboard</h2>
    </div>

    <div id="border1-left"
         dojotype="dijit.layout.ContentPane"
         region="left"
         style="overflow: hidden; width: 255px;">
      <div dojotype="dijit.layout.AccordionContainer"
           duration="200"
           style='overflow:hidden'>
        <!-- content inline -->

        <div dojotype="dijit.layout.AccordionPane"
  
             title="Monitoring">
          Reports like

          <ul>
            <li>Recent Alerts</li>

            <li>Disks</li>

            <li>Top CPU Users</li>

            <li>Top Memory Users</li>

            <li>All running processes</li>

            <li>Servers at a glance (cpu etc)</li>
            <li>Python libraries deployed on each server</li>
          </ul>
        </div><!-- loading by indirect reference -->

        <div dojotype="dijit.layout.AccordionPane"
             title="Servers"       
             py:attrs = "{'selected':'selected'} if selected == 'Server' else {}"
             >
	<div dojotype="dijit.layout.ContentPane"
               region="center"
               id="servermenu_content"
               href="menu.html?table=Server" />
          <!--
          <div dojotype="dojo.data.ItemFileReadStore"
               url="menu_data.json?table=Server"
               jsid="servermenu"></div>

          <div dojotype="dijit.Tree"
               store="servermenu"
               labelattr="name"
               id="servermenutree">
            <script type="dojo/method" event="onClick" args="item">

dijit.byId('content').setHref('server_content.html?table=Server&amp;row_id='+servermenu.getIdentity(item));
            </script>
          </div>
          -->

        </div>

        <div dojotype="dijit.layout.AccordionPane"
             title="Applications"
             py:attrs = "{'selected':'selected'} if selected in (None, 'Application') else {}"            
             >
          <div dojotype="dijit.layout.ContentPane"
               region="center"
               id="applicationmenu_content"
               href="menu.html?table=Application" />
          <!--
          <div dojotype="dojo.data.ItemFileWriteStore"
               url="menu_data.json?table=Application"
               jsid="applicationmenu"></div>

          <div dojotype="dijit.Tree"
               store="applicationmenu"
               labelattr="name" id="applicationmenutree">
            <script type="dojo/method" event="onClick" args="item">
                dijit.byId('content').setHref('form_content.html?table=Application&amp;row_id='+applicationmenu.getIdentity(item));
            </script>
          </div>
          -->

        </div>
        
        <div dojotype="dijit.layout.AccordionPane"
             title="Application Groups">
	  <div dojotype="dojo.data.ItemFileReadStore"
               url="menu.json?table=Group"
               jsid="groupmenu"></div>
          <div dojotype="dijit.layout.ContentPane"
               region="center"
               id="groupmenu_content"
               href="menu.html?table=Group" />

	
	</div>
        
        <div dojotype="dijit.layout.AccordionPane"
             title="Support Monkeys">
          <div dojotype="dojo.data.ItemFileReadStore"
               url="menu.json?table=User"
               jsid="usermenu"></div>
          <div dojotype="dijit.layout.ContentPane"
               region="center"
               id="usermenu_content"
               href="menu.html?table=User" />


        </div>
        
      </div>
    </div>

    <div dojotype="dijit.layout.ContentPane"
         region="center"
         style="background-color: #E8FFFF; padding: 0.5em;"
         id="content"
         py:attrs="{} if selected is None else {'href' : 'form_content.html?table=%s&amp;row_id=%s' % (selected, row_id)}"
	 
         >
      <!-- Data will be dynamically loaded in here depending when selecting an item from the menu -->
    </div>

    <div dojotype="dijit.layout.ContentPane"
         region="bottom"
         style= "background-color: #E8E8E8; margin:0.3em 1em 0.5em;"
         id="statusbar">
      some status. is it working? who knows!
    </div>
  </div>
</body>
</html>
