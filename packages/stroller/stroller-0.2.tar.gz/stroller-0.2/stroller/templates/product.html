<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">

  <xi:include href="master.html" />
  <xi:include href="stroller_commons.html" />

<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" py:replace="''"/>
  <title>Product: ${product.name}</title>
  <script>
    function updateCart(data, status) {
        jQuery("#cart-qty").html(data.quantity);
        jQuery("#cart-amt").html(data.price.toFixed(2));
    }
  
    function addToCart(productId) {
        var val_field = jQuery('#create_number_form_quantity_select').val();
        if (val_field == -1) 
            val_field = jQuery('#create_number_form_quantity_other').val();
        jQuery.getJSON('${h.stroller_url("/add_to_cart")}', {product:productId, qnt:val_field}, updateCart);
    }

    jQuery(document).ready(function() {
        jQuery("#create_number_form").submit(function() { return false; });
    });
  </script>
</head>

<body>
    <div id="stroller">
        ${render_cart()}
        ${stroller_search()}
        <div id="manage" style="float: right; padding-bottom: 2px; padding-top: 6px; margin-right: 10px;" py:if="request.identity and 'stroller' in request.identity['groups']">
          <a href="${h.stroller_url('/manage/list_orders')}">Manage Orders</a>
          <a href="${h.stroller_url('/manage/usermanage')}">Manage Users</a>
        </div>
        ${breadcrumbs(product)}
        <div style="clear: both;"></div>
        
        <div class="spacer"></div>
        
        <div id="product-preview">
            <img src="${h.stroller_url('/product_image', uid=product.uid)}"/>
        </div>
        
        <div id="product-buy">
            <a href="#" onclick="return addToCart(${product.uid});">
                ${Markup(h.icons['big-cart'])}
                Add To Cart
            </a>

            <div py:replace="form()">Input Form</div>

        </div>

        <div id="product-info">
            <h1><span py:replace="product.name"/></h1>
            <div id="product-sku"><span py:replace="product.sku" /></div>
            <span class="small">Price:</span>
            <span class="price big">${'%.2f' % product.price} ${tg.config.get('currency', 'EUR')}</span>
          <div py:if="product.stock">
            <span class="small">In Stock:</span>
            <span class="price big">${product.stock}</span>
          </div>
          <div py:if="product.shiptime">
            <span class="small">Shipping Days:</span>
            <span class="price big">${product.shiptime}</span>
          </div>
            <hr/>
            <div>${Markup(product.description)}</div>
        </div>
    </div>
</body>
</html>
