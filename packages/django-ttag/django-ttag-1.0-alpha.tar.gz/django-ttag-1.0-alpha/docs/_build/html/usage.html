

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>TTag reference &mdash; django-ttag v1.0-alpha documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-ttag v1.0-alpha documentation" href="index.html" />
    <link rel="prev" title="TTag reference" href="reference.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="reference.html" title="TTag reference"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">django-ttag v1.0-alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ttag-reference">
<h1>TTag reference<a class="headerlink" href="#ttag-reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>TTag replaces the normal method of creating custom template tags.  It
uses a custom template <tt class="docutils literal"><span class="pre">Node</span></tt> subclass called <tt class="docutils literal"><span class="pre">Tag</span></tt> which handles all of
the relevant aspects of a tag: defining and parsing arguments, handling
validation, resolving variables from the context, and rendering output.  It
tries to make the most common cases extremely simple, while making even complex
cases easier than they would be otherwise.</p>
<p><tt class="docutils literal"><span class="pre">TemplateTag</span></tt> and the various <tt class="docutils literal"><span class="pre">Arg</span></tt> classes are consciously modelled after
Django&#8217;s <tt class="docutils literal"><span class="pre">Model</span></tt>, <tt class="docutils literal"><span class="pre">Form</span></tt>, and respective <tt class="docutils literal"><span class="pre">Field</span></tt> classes.  <tt class="docutils literal"><span class="pre">Arg``s</span> <span class="pre">are</span>
<span class="pre">set</span> <span class="pre">on</span> <span class="pre">a</span> <span class="pre">``TemplateTag</span></tt> in the same way <tt class="docutils literal"><span class="pre">Field``s</span> <span class="pre">would</span> <span class="pre">be</span> <span class="pre">set</span> <span class="pre">on</span> <span class="pre">a</span>
<span class="pre">``Model</span></tt> or <tt class="docutils literal"><span class="pre">Form</span></tt>.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Following is a minimal example of a template tag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Welcome</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Hi there!&quot;</span>
</pre></div>
</div>
<p>This would create a tag <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">welcome</span> <span class="pre">%}</span></tt> which took no arguments and output
<tt class="docutils literal"><span class="pre">Hi</span> <span class="pre">there!</span></tt>.</p>
<div class="section" id="registering-your-tag">
<h3>Registering your tag<a class="headerlink" href="#registering-your-tag" title="Permalink to this headline">¶</a></h3>
<p>TTag <tt class="docutils literal"><span class="pre">Tag</span></tt> classes are registered just like a standard tag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="kn">import</span> <span class="nn">ttag</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Welcome</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Hi there!&quot;</span>


    <span class="n">register</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">Welcome</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tag-name">
<h3>Tag name<a class="headerlink" href="#tag-name" title="Permalink to this headline">¶</a></h3>
<p>The name of the tag is automatically based off of the class name, but this can
be explicitly specified by using an inner <tt class="xref py py-class docutils literal"><span class="pre">Meta</span></tt> class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Welcome</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;hi&quot;</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Hi there!&quot;</span>
</pre></div>
</div>
<p>This would create a tag <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">hi</span> <span class="pre">%}</span></tt>, rather than <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">welcome</span> <span class="pre">%}</span></tt>.</p>
</div>
</div>
<div class="section" id="defining-arguments">
<h2>Defining arguments<a class="headerlink" href="#defining-arguments" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s extend the basic example tag above to accept an argument so we can greet
the user personally:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Welcome</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ttag</span><span class="o">.</span><span class="n">Arg</span><span class="p">(</span><span class="n">positional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&quot;Hi, </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="n">name</span>
</pre></div>
</div>
<p>The tag now has one positional tag which will be used to get the user from the
template context.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Arguments are usually resolved against the template context. For simpler
cases, you can use <tt class="xref py py-class docutils literal"><span class="pre">ttag.BasicArg</span></tt>.</p>
</div>
<div class="section" id="named-arguments">
<h3>Named arguments<a class="headerlink" href="#named-arguments" title="Permalink to this headline">¶</a></h3>
<p>The other standard argument type is a named argument.</p>
<div class="section" id="keyword-argument-format">
<h4>Keyword argument format<a class="headerlink" href="#keyword-argument-format" title="Permalink to this headline">¶</a></h4>
<p>When using several named arguments, space-separated named arguments can start
to look a bit confusing. For these cases, you may want to use the named keyword
argument format (<tt class="docutils literal"><span class="pre">name=value</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Output</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Arg</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Arg</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This would result in a tag like this:</p>
<div class="highlight-python"><pre>{% output limit=some_limit|default:1 offset=profile.offset %}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If your tag should define a list of arbitrary keywords, you may benefit
from <tt class="xref py py-class docutils literal"><span class="pre">ttag.KeywordsArg</span></tt> instead.</p>
</div>
</div>
</div>
<div class="section" id="validation-arguments">
<h3>Validation arguments<a class="headerlink" href="#validation-arguments" title="Permalink to this headline">¶</a></h3>
<p>Some default classes are included to assist with validation of template
arguments.</p>
<p>TODO: define arguments and show an example</p>
</div>
</div>
<div class="section" id="altering-context">
<h2>Altering context<a class="headerlink" href="#altering-context" title="Permalink to this headline">¶</a></h2>
<p>TODO: explain that output() is a shortcut and that render() can be used
(with resolve())</p>
</div>
<div class="section" id="writing-a-block-tag">
<h2>Writing a block tag<a class="headerlink" href="#writing-a-block-tag" title="Permalink to this headline">¶</a></h2>
<p>For simple block tags, use the <a class="reference internal" href="reference.html#ttag.Tag.Meta.block" title="ttag.Tag.Meta.block"><tt class="xref py py-attr docutils literal"><span class="pre">block</span></tt></a> option:</p>
<div class="highlight-python"><pre>class Repeat(ttag.Tag):
    count = ttag.IntegerArg()

    class Meta():
        block = True
        end_block = 'done'

    def render(self, context):
        data = self.resolve(context)
        output = []
        for i in data['count']:
                context.push()
                output.append(self.nodelist.render(context))
                    context.pop()
            return ''.join(output)</pre>
</div>
<p>As you can see, using the block option will add a <tt class="docutils literal"><span class="pre">nodelist</span></tt> attribute to the
tag, which can then be rendered using the context.</p>
<p>The optional <tt class="docutils literal"><span class="pre">end_block</span></tt> option allows for an alternate ending block. The
default value is <tt class="docutils literal"><span class="pre">'end%(name)s'</span></tt>, so it would be <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">endrepeat</span> <span class="pre">%}</span></tt> for the
above tag if the option hadn&#8217;t been provided.</p>
<div class="section" id="working-with-multiple-blocks">
<h3>Working with multiple blocks<a class="headerlink" href="#working-with-multiple-blocks" title="Permalink to this headline">¶</a></h3>
<p>Say we wanted to expand on our repeat tag to look for an {% empty %}
alternative section for when a zero-value count is received.</p>
<blockquote>
<dl class="docutils">
<dt>class Meta():</dt>
<dd>block = {&#8216;empty&#8217;: False}
end_block = &#8216;end%(name)s&#8217;</dd>
</dl>
</blockquote>
<p>Rather than setting the <tt class="docutils literal"><span class="pre">block</span></tt> option to True, we set it to a dictionary
where the keys are the section tags to look for and the values are whether the
section is required.</p>
<p>More advanced cases can be handled using Django&#8217;s standard parser in the
<tt class="docutils literal"><span class="pre">__init__</span></tt> method of your tag:</p>
<blockquote>
<p>class AdvancedTag(ttags.Tag):</p>
<blockquote>
<dl class="docutils">
<dt>def __init__(self, parser, token):</dt>
<dd>super(Repeat, self).__init__(parser, token)
# Do whatever fancy parser modification you like.</dd>
</dl>
</blockquote>
</blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">TTag reference</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#example">Example</a><ul>
<li><a class="reference internal" href="#registering-your-tag">Registering your tag</a></li>
<li><a class="reference internal" href="#tag-name">Tag name</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defining-arguments">Defining arguments</a><ul>
<li><a class="reference internal" href="#named-arguments">Named arguments</a><ul>
<li><a class="reference internal" href="#keyword-argument-format">Keyword argument format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validation-arguments">Validation arguments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#altering-context">Altering context</a></li>
<li><a class="reference internal" href="#writing-a-block-tag">Writing a block tag</a><ul>
<li><a class="reference internal" href="#working-with-multiple-blocks">Working with multiple blocks</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="reference.html"
                        title="previous chapter">TTag reference</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/usage.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="reference.html" title="TTag reference"
             >previous</a> |</li>
        <li><a href="index.html">django-ttag v1.0-alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Lincoln Loop.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>