

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Usage &mdash; django-ttag v1.0-alpha-3 documentation</title>
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0-alpha-3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-ttag v1.0-alpha-3 documentation" href="index.html" />
    <link rel="next" title="Reference" href="reference.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <h1><a href="index.html">django-ttag v1.0-alpha-3 documentation</a></h1>
        <div class="rel">
          <a href="install.html" title="Installation"
             accesskey="P">previous</a> |
          <a href="reference.html" title="Reference"
             accesskey="N">next</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p><tt class="docutils literal"><span class="pre">Tag</span></tt> and the various <tt class="docutils literal"><span class="pre">Arg</span></tt> classes are consciously modelled after
Django&#8217;s <tt class="docutils literal"><span class="pre">Model</span></tt>, <tt class="docutils literal"><span class="pre">Form</span></tt>, and respective <tt class="docutils literal"><span class="pre">Field</span></tt> classes.</p>
<p><tt class="docutils literal"><span class="pre">Arg``s</span> <span class="pre">are</span> <span class="pre">set</span> <span class="pre">on</span> <span class="pre">a</span> <span class="pre">``Tag</span></tt> in the same way <tt class="docutils literal"><span class="pre">Field``s</span> <span class="pre">would</span> <span class="pre">be</span> <span class="pre">set</span> <span class="pre">on</span> <span class="pre">a</span>
<span class="pre">``Model</span></tt> or <tt class="docutils literal"><span class="pre">Form</span></tt>.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Following is a minimal example of a template tag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Welcome</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Hi there!&quot;</span>
</pre></div>
</div>
<p>This would create a tag <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">welcome</span> <span class="pre">%}</span></tt> which took no arguments and output
<tt class="docutils literal"><span class="pre">Hi</span> <span class="pre">there!</span></tt>.</p>
<div class="section" id="registering-your-tag">
<h3>Registering your tag<a class="headerlink" href="#registering-your-tag" title="Permalink to this headline">¶</a></h3>
<p>TTag <tt class="docutils literal"><span class="pre">Tag</span></tt> classes are registered just like a standard tag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="kn">import</span> <span class="nn">ttag</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Welcome</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Hi there!&quot;</span>


<span class="n">register</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">Welcome</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tag-name">
<h3>Tag name<a class="headerlink" href="#tag-name" title="Permalink to this headline">¶</a></h3>
<p>The name of the tag is automatically based off of the class name, but this can
be explicitly specified by using an inner <a class="reference internal" href="reference.html#ttag.Tag.Meta" title="ttag.Tag.Meta"><tt class="xref py py-class docutils literal"><span class="pre">Meta</span></tt></a> class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Welcome</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;hi&quot;</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Hi there!&quot;</span>
</pre></div>
</div>
<p>This would create a tag <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">hi</span> <span class="pre">%}</span></tt>, rather than <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">welcome</span> <span class="pre">%}</span></tt>.</p>
</div>
</div>
<div class="section" id="defining-arguments">
<h2>Defining arguments<a class="headerlink" href="#defining-arguments" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s extend the basic example tag above to accept an argument so we can greet
the user personally:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Welcome</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ttag</span><span class="o">.</span><span class="n">Arg</span><span class="p">(</span><span class="n">positional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&quot;Hi, </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="n">name</span>
</pre></div>
</div>
<p>The tag now has one positional tag which will be used to get the user from the
template context.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Arguments are usually resolved against the template context. For simpler
cases, you can use <a class="reference internal" href="reference.html#ttag.BasicArg" title="ttag.BasicArg"><tt class="xref py py-class docutils literal"><span class="pre">ttag.BasicArg</span></tt></a>.</p>
</div>
<div class="section" id="named-arguments">
<h3>Named arguments<a class="headerlink" href="#named-arguments" title="Permalink to this headline">¶</a></h3>
<p>The other standard argument type is a named argument.</p>
<div class="section" id="keyword-argument-format">
<h4>Keyword argument format<a class="headerlink" href="#keyword-argument-format" title="Permalink to this headline">¶</a></h4>
<p>When using several named arguments, space-separated named arguments can start
to look a bit confusing. For these cases, you may want to use the named keyword
argument format (<tt class="docutils literal"><span class="pre">name=value</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Output</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Arg</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Arg</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This would result in a tag like this:</p>
<div class="highlight-python"><pre>{% output limit=some_limit|default:1 offset=profile.offset %}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If your tag should define a list of arbitrary keywords, you may benefit
from <a class="reference internal" href="reference.html#ttag.KeywordsArg" title="ttag.KeywordsArg"><tt class="xref py py-class docutils literal"><span class="pre">ttag.KeywordsArg</span></tt></a> instead.</p>
</div>
</div>
</div>
<div class="section" id="validation-arguments">
<h3>Validation arguments<a class="headerlink" href="#validation-arguments" title="Permalink to this headline">¶</a></h3>
<p>Some default classes are included to assist with validation of template
arguments.</p>
</div>
</div>
<div class="section" id="altering-context">
<h2>Altering context<a class="headerlink" href="#altering-context" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="cleaning-arguments">
<h2>Cleaning arguments<a class="headerlink" href="#cleaning-arguments" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="writing-a-block-tag">
<h2>Writing a block tag<a class="headerlink" href="#writing-a-block-tag" title="Permalink to this headline">¶</a></h2>
<p>For simple block tags, use the <a class="reference internal" href="reference.html#ttag.Tag.Meta.block" title="ttag.Tag.Meta.block"><tt class="xref py py-attr docutils literal"><span class="pre">block</span></tt></a> option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Repeat</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">ttag</span><span class="o">.</span><span class="n">IntegerArg</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">end_block</span> <span class="o">=</span> <span class="s">&#39;done&#39;</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]):</span>
            <span class="n">context</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
            <span class="n">context</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, using the block option will add a <tt class="docutils literal"><span class="pre">nodelist</span></tt> attribute to the
tag, which can then be rendered using the context.</p>
<p>The optional <tt class="docutils literal"><span class="pre">end_block</span></tt> option allows for an alternate ending block. The
default value is <tt class="docutils literal"><span class="pre">'end%(name)s'</span></tt>, so it would be <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">endrepeat</span> <span class="pre">%}</span></tt> for the
above tag if the option hadn&#8217;t been provided.</p>
<div class="section" id="working-with-multiple-blocks">
<h3>Working with multiple blocks<a class="headerlink" href="#working-with-multiple-blocks" title="Permalink to this headline">¶</a></h3>
<p>Say we wanted to expand on our repeat tag to look for an <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">empty</span> <span class="pre">%}</span></tt>
alternative section for when a zero-value count is received.</p>
<p>Rather than setting the <tt class="docutils literal"><span class="pre">block</span></tt> option to <tt class="xref docutils literal"><span class="pre">True</span></tt>, we set it to a dictionary
where the keys are the section tags to look for and the values are whether the
section is required:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Repeat</span><span class="p">(</span><span class="n">ttag</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">ttag</span><span class="o">.</span><span class="n">IntegerArg</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">():</span>
        <span class="n">block</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;empty&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelist_empty</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]):</span>
            <span class="n">context</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelist</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
            <span class="n">context</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>This will cause two attributes to be added to the tag: <tt class="docutils literal"><span class="pre">nodelist</span></tt> will
contain everything collected up to the <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">empty</span> <span class="pre">%}</span></tt> section tag, and
<tt class="docutils literal"><span class="pre">nodelist_empty</span></tt> will contain everything up until the end tag.</p>
<p>If no matching section tag is found when parsing the template,
either a <tt class="docutils literal"><span class="pre">TemplateSyntaxError</span></tt> will be raised (if it&#8217;s a required section)
or an empty node list will be used.</p>
<p>More advanced cases can be handled using Django&#8217;s standard parser in the
<tt class="docutils literal"><span class="pre">__init__</span></tt> method of your tag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AdvancedTag</span><span class="p">(</span><span class="n">ttags</span><span class="o">.</span><span class="n">Tag</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Repeat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
        <span class="c"># Do whatever fancy parser modification you like.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="full-example">
<h2>Full Example<a class="headerlink" href="#full-example" title="Permalink to this headline">¶</a></h2>
<p>This example provides a template tag which outputs a tweaked version of the
instance name passed in.  It demonstrates using the various <tt class="docutils literal"><span class="pre">Arg</span></tt> types:</p>
<div class="highlight-python"><pre>class TweakName(ttag.Tag):
    """
    Provides the tweak_name template tag, which outputs a
    slightly modified version of the NamedModel instance passed in.

    {% tweak_name instance [offset=0] [limit=10] [reverse] %}
    """
    instance = ttag.ModelInstanceArg(positional=True, model=NamedModel))
    offset = ttag.IntegerArg(default=0, keyword=True)
    limit = ttag.IntegerArg(default=10, keyword=True)
    reverse = ttag.BooleanArg()

            def clean_limit(self, value):
        """
        Check that limit is not negative.
        """
        if value &lt; 0:
            raise ttag.TagValidationError("limit must be &gt;= 0")
        return value

    def output(self, data):
        name = data['instance'].name

        # Reverse if appropriate.
        if 'reverse' in data:
            name = name[::-1]

        # Apply our offset and limit.
        name = name[data['offset']:data['offset'] + data['limit']]

        # Return the tweaked name.
        return name</pre>
</div>
<p>Example usages:</p>
<div class="highlight-python"><pre>{% tweak_name obj limit=5 %}

{% tweak_name obj offset=1 %}

{% tweak_name obj reverse %}

{% tweak_name obj offset=1 limit=5 reverse %}</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-arguments">Defining arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#altering-context">Altering context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cleaning-arguments">Cleaning arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-block-tag">Writing a block tag</a></li>
<li class="toctree-l2"><a class="reference internal" href="#full-example">Full Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" size="18" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="install.html" title="Installation"
             >previous</a> |
          <a href="reference.html" title="Reference"
             >next</a> |
          <a href="genindex.html" title="General Index"
             >index</a>
            <br/>
            <a href="_sources/usage.txt"
               rel="nofollow">Show Source</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2010, Lincoln Loop.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>