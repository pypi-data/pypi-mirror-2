

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>What’s New in ToscaWidgets 2? &mdash; ToscaWidgets 2 v2.0b5 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.0b5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ToscaWidgets 2 v2.0b5 documentation" href="index.html" />
    <link rel="prev" title="tw2.devtools" href="devtools.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="devtools.html" title="tw2.devtools"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">ToscaWidgets 2 v2.0b5 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="what-s-new-in-toscawidgets-2">
<h1>What&#8217;s New in ToscaWidgets 2?<a class="headerlink" href="#what-s-new-in-toscawidgets-2" title="Permalink to this headline">¶</a></h1>
<p>ToscaWidgets 2 is a complete rewrite of ToscaWidgets. The primary motivation is to simplify the library, as the ToscaWidgets 1 code had become overly complex over time. The complexity made it difficult to write more complex widgets, such as tw.dynforms, and making changes to the library became a risky process. Where backwards compatibility can be readily maintained, this has been done. For example, the widgets in tw2.forms have almost identical names and parameters to tw.forms. However, in many cases it has been necessary to break backwards compatibility to produce a consistent and simple library.</p>
<div class="section" id="per-request-widget-instances">
<h2>Per-Request Widget Instances<a class="headerlink" href="#per-request-widget-instances" title="Permalink to this headline">¶</a></h2>
<p>A key feature for widgets is their dynamic capabilities, the ability to for a widget to adapt each time it is displayed. ToscaWidgets 2 creates a new instance of a widget every time it is used in a request. This allows widget and application code to update widget attributes in the natural, pythonic manner, without multiple threads interfering with each other. For example, you may want to customise a TableForm, so when it&#8217;s &#8220;cost&#8221; field is over 100, the &#8220;insurance&#8221; field is made bold, to draw the user&#8217;s attention. The code for this would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">MyWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">insurance</span><span class="o">.</span><span class="n">css_class</span> <span class="o">=</span> <span class="s">&#39;bold&#39;</span>
</pre></div>
</div>
<p>In ToscaWidgets 1, widget instances are singletons that exist for the life of the application. For thread safety, it&#8217;s vital that their attributes are not modified during a request. This means that all dynamic parameters must be passed around as dictionaries, resulting in highly-complex code that is prone to bugs. The equivalent code would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">update_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">MyWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;value_for&#39;</span><span class="p">](</span><span class="s">&#39;cost&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">params</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;child_args&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;insurance&#39;</span><span class="p">,</span> <span class="p">{})[</span><span class="s">&#39;css_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bold&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="simplified-form-definitions">
<h2>Simplified Form Definitions<a class="headerlink" href="#simplified-form-definitions" title="Permalink to this headline">¶</a></h2>
<p>ToscaWidgets 2 places great emphasis on making the application code that defines forms as simple as possible. It allows a natural, declarative style; defining a form is as easy as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MovieForm</span><span class="p">(</span><span class="n">twf</span><span class="o">.</span><span class="n">TableForm</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">twf</span><span class="o">.</span><span class="n">HiddenField</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">twf</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</pre></div>
</div>
<p>For comparison, the equivalent code in ToscaWidgets 1 is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MovieForm</span><span class="p">(</span><span class="n">twf</span><span class="o">.</span><span class="n">TableForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">children</span><span class="p">(</span><span class="n">twc</span><span class="o">.</span><span class="n">WidgetsList</span><span class="p">):</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">twf</span><span class="o">.</span><span class="n">HiddenField</span><span class="p">()</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">twf</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
<span class="n">movie_form</span> <span class="o">=</span> <span class="n">MovieForm</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="widget-controller-methods">
<h2>Widget Controller Methods<a class="headerlink" href="#widget-controller-methods" title="Permalink to this headline">¶</a></h2>
<p>In ToscaWidgets 1, widgets are purely view components. However, ToscaWidgets 2 allows widgets to define controller methods, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PeopleLookupField</span><span class="p">(</span><span class="n">twy</span><span class="o">.</span><span class="n">AjaxLookupField</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">twc</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">People</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s">&#39;%&#39;</span><span class="o">+</span><span class="n">req</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;search&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;%&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This allows Ajax widgets to be self-contained, rather than having functionality separated between the widget and a controller class.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You must include any required authorisation checks in the <tt class="docutils literal"><span class="pre">request</span></tt> method.</p>
</div>
</div>
<div class="section" id="built-in-validation">
<h2>Built-in Validation<a class="headerlink" href="#built-in-validation" title="Permalink to this headline">¶</a></h2>
<p>ToscaWidgets 1 uses FormEncode for validation. FormEncode is a popular validation library and works well for many use cases. However, ToscaWidgets 1 has considerable internal complexity to ensure that it interfaces correctly with FormEncode. In the past, this has been the cause of some subtle bugs related to complex forms. It also makes it difficult to correctly support validation for some complex widgets, such as HidingContainerMixin in tw.dynforms.</p>
<p>ToscaWidgets 2 has a built-in validation framework, which avoids much of the validation complexity in ToscaWidgets 1. It does not have as many validators as FormEncode, covering just the more common use cases. However, it is still possible to use FormEncode validators for individual fields (although not Schema or ForEach validators). This change has enabled validation support for GrowingGrid in tw2.dynforms. It also paves the way for future development of client-side validation.</p>
</div>
<div class="section" id="declarative-parameter-definitions">
<h2>Declarative Parameter Definitions<a class="headerlink" href="#declarative-parameter-definitions" title="Permalink to this headline">¶</a></h2>
<p>When you&#8217;re creating your own widgets, you&#8217;ll need to define parameters for the widgets, the variables that users of the widgets can set. You&#8217;ll want to provide documentation, and default values. ToscaWidgets 2 makes this straightforward:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyWidget</span><span class="p">(</span><span class="n">twc</span><span class="o">.</span><span class="n">Widget</span><span class="p">):</span>
    <span class="n">do_title</span> <span class="o">=</span> <span class="n">twc</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="s">&#39;Whether to include a title row in the table&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>For comparison, the equivalent code in ToscaWidgets 1 is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyWidget</span><span class="p">(</span><span class="n">twc</span><span class="o">.</span><span class="n">Widget</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;do_title&#39;</span><span class="p">:</span> <span class="s">&#39;Whether to include a title row in the table&#39;</span>
    <span class="p">}</span>
    <span class="n">dotitle</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>The new approach used in ToscaWidgets 2 allows more metadata to be recorded about parameters, enabling new features, such as parameters that automatically become attributes.</p>
</div>
<div class="section" id="consistency-in-ids-and-names">
<h2>Consistency in IDs and Names<a class="headerlink" href="#consistency-in-ids-and-names" title="Permalink to this headline">¶</a></h2>
<p>ToscaWidgets 2 has changed how <tt class="docutils literal"><span class="pre">id</span></tt> and <tt class="docutils literal"><span class="pre">name</span></tt> parameters are generated. Just like ToscaWidgets 1, a widget&#8217;s full ID is generated by combining it&#8217;s ID with those of its ancestors. ToscaWidgets 1 uses underscores as the separator, which causes problems when applications use underscores in widget names. ToscaWidgets 2 uses colons as the separator, and forbids colons in widget names. In additions, a widget&#8217;s full name is identical to its full id. These changes simplify the development of complex client-side widgets, such as GrowingGrid in tw2.dynforms.</p>
</div>
<div class="section" id="layouts-separated-from-containers">
<h2>Layouts Separated from Containers<a class="headerlink" href="#layouts-separated-from-containers" title="Permalink to this headline">¶</a></h2>
<p>ToscaWidgets 2 clearly separates the concept of form layouts and form containers. ToscaWidgets 1 combines these, so there are widgets for TableForm, ListForm, TableFieldSet and ListFieldSet. ToscaWidgets 2 has widgets for Form and FieldSet, and also for TableLayout and ListLayout. This enables more flexibility in defining new containers and layouts, and this enables the new GridLayout widget. For comptability, TableForm remains, which transparently converts to a Form widget containing a TableLayout, as do the other widgets from ToscaWidgets 1. This change affects tw2.dynforms, which now has GrowingGridLayout, instead of GrowingTableFieldSet and GrowingTableForm.</p>
</div>
<div class="section" id="explicitly-deferred-parameters">
<h2>Explicitly Deferred Parameters<a class="headerlink" href="#explicitly-deferred-parameters" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is desirable for parameters to be dynamically evaluated every time a widget is displayed. ToscaWidgets 1 automatically calls any parameter that is a callable, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyWidget</span><span class="p">(</span><span class="n">twc</span><span class="o">.</span><span class="n">Widget</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">/%m/%Y&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, in some cases parameters may be callables, but this behaviour is not desired. A common example is passing SQLAlchemy mapped classes to widgets. ToscaWidgets 2 only calls parameters that are explicitly marked as <tt class="docutils literal"><span class="pre">Deferred</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyWidget</span><span class="p">(</span><span class="n">twc</span><span class="o">.</span><span class="n">Widget</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">twc</span><span class="o">.</span><span class="n">Deferred</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">/%m/%Y&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="variables-in-widget-templates">
<h2>Variables in Widget Templates<a class="headerlink" href="#variables-in-widget-templates" title="Permalink to this headline">¶</a></h2>
<p>In ToscaWidgets 2, the widget instance is available in the template as <tt class="docutils literal"><span class="pre">$w</span></tt>. Parameters must be accessed as <tt class="docutils literal"><span class="pre">$w.param</span></tt>. ToscaWidgets 1 made all parameters directly accessible as <tt class="docutils literal"><span class="pre">$param</span></tt>. The behaviour can be enabled in ToscaWidgets 2 by setting the <em>params_as_vars</em> config option.</p>
</div>
<div class="section" id="toscawidgets-as-a-framework">
<h2>ToscaWidgets as a Framework<a class="headerlink" href="#toscawidgets-as-a-framework" title="Permalink to this headline">¶</a></h2>
<p>ToscaWidgets 1 was always intended to be used with another web framework, primarily TurboGears and Pylons. ToscaWidgets 2 has gained features that allow it to be used as a framework in its own right. This is primarily the <tt class="docutils literal"><span class="pre">Page</span></tt> and <tt class="docutils literal"><span class="pre">FormPage</span></tt> widgets, which enable applications to be coded like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">tw2.core</span> <span class="kn">as</span> <span class="nn">twc</span><span class="o">,</span> <span class="nn">tw2.forms</span> <span class="kn">as</span> <span class="nn">twc</span>

<span class="k">class</span> <span class="nc">Index</span><span class="p">(</span><span class="n">twf</span><span class="o">.</span><span class="n">FormPage</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My app&#39;</span>
    <span class="k">class</span> <span class="nc">child</span><span class="p">(</span><span class="n">twf</span><span class="o">.</span><span class="n">TableForm</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">twf</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">twf</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">twc</span><span class="o">.</span><span class="n">EmailValidator</span><span class="p">)</span>

<span class="n">twc</span><span class="o">.</span><span class="n">dev_server</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="minor-differences">
<h2>Minor Differences<a class="headerlink" href="#minor-differences" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Framework interfaces are almost completely removed; ToscaWidgets is just a piece of WSGI middleware.</li>
<li>Widget constructions do not accept positional arguments, as doing so is considered bad practice when multiple inheritence is in use.</li>
<li>A widget does not automatically get the <tt class="docutils literal"><span class="pre">resources</span></tt> from its base class.</li>
<li>tw.api has been removed; just use tw2.core</li>
<li>The toscawidgets simple template engine has been removed.</li>
<li>Widget.__call__ is no longer an alias for display, as this causes problems for Cheetah.</li>
<li>CalendarDatePicker is moved from tw2.forms to tw2.dynforms</li>
</ul>
</div></blockquote>
<p>In tw2.dynforms:</p>
<blockquote>
<div><ul class="simple">
<li>WriteOnlyTextField is removed; tw2.forms PasswordField has similar functionality</li>
<li>AjaxLookupField is removed; there are better widgets like this in libraries like YUI</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="toscawidgets-1">
<h2>ToscaWidgets 1<a class="headerlink" href="#toscawidgets-1" title="Permalink to this headline">¶</a></h2>
<p>Python web widgets were pioneered in TurboGears and many of the key ideas remain. Once the value of widgets was realised, a move was made to create a separate library, this is ToscaWidgets. The key differences are:</p>
<blockquote>
<div><ul class="simple">
<li>ToscaWidget is framework independent.</li>
<li>Multiple template engines are supported.</li>
<li>Resource links are injected by rewriting the page on output.</li>
<li>The forms library is separate from the core widget library.</li>
<li>The tw namespace exists for widget libraries to be located in.</li>
</ul>
</div></blockquote>
<p>ToscaWidgets had some success, but did not gain as much usage as hoped, in part due to a lack of documentation in the beginning.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">What&#8217;s New in ToscaWidgets 2?</a><ul>
<li><a class="reference internal" href="#per-request-widget-instances">Per-Request Widget Instances</a></li>
<li><a class="reference internal" href="#simplified-form-definitions">Simplified Form Definitions</a></li>
<li><a class="reference internal" href="#widget-controller-methods">Widget Controller Methods</a></li>
<li><a class="reference internal" href="#built-in-validation">Built-in Validation</a></li>
<li><a class="reference internal" href="#declarative-parameter-definitions">Declarative Parameter Definitions</a></li>
<li><a class="reference internal" href="#consistency-in-ids-and-names">Consistency in IDs and Names</a></li>
<li><a class="reference internal" href="#layouts-separated-from-containers">Layouts Separated from Containers</a></li>
<li><a class="reference internal" href="#explicitly-deferred-parameters">Explicitly Deferred Parameters</a></li>
<li><a class="reference internal" href="#variables-in-widget-templates">Variables in Widget Templates</a></li>
<li><a class="reference internal" href="#toscawidgets-as-a-framework">ToscaWidgets as a Framework</a></li>
<li><a class="reference internal" href="#minor-differences">Minor Differences</a></li>
<li><a class="reference internal" href="#toscawidgets-1">ToscaWidgets 1</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="devtools.html"
                        title="previous chapter">tw2.devtools</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/history.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="devtools.html" title="tw2.devtools"
             >previous</a> |</li>
        <li><a href="index.html">ToscaWidgets 2 v2.0b5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Paul Johnston, Alberto Valverde &amp; Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>