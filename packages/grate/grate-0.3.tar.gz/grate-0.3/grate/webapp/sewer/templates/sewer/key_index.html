{% extends "sewer/base.html" %}

{% block title %}Keys{% endblock %}

{% block head %}
<script type="text/javascript">
$(function() {
  $("textarea").keyup(pubkey_handler);
  $("textarea").focus();
  $(".remove-key").click(function(e) {
    e.preventDefault();
    var form = $(this).parent().parent();
    $.ajax({
      type: "POST",
      context: form,
      url: form.attr('action'),
      success: function() {
        $(this).remove();
        reload_messages();
      }
    });
  });
});
</script>
{% endblock %}

{% block content %}

<div id="key-form">
  <form method="post" action="{% url sewer:key-add %}">
    {% csrf_token %}
    {% for field in form %}{{ field }}{% endfor %}
    <input type="submit" value="Add"
      class="ui-button ui-state-default ui-corner-all"/>
  </form>
</div>

<div id="keys">
{% if keys %}
  Your keys:
  <ul>
    {% for k in keys %}
    <form method="post" action="{% url sewer:key-remove k.id %}">
      <li class="fingerprint">
        {% csrf_token %}
        {{ k.fingerprint }} -
        <input class="grate-button remove-key" type="submit" value="remove"/>
      </li>
    </form>
    {% endfor %}
  </ul>
{% else %}
  You do not have any keys. You should add them.
{% endif %}
</div>

{% endblock %}
