<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:main fill-slot="main">
    <div metal:define-macro="main"
         i18n:domain="pcommerce"
         tal:define="payment view/payment_method;
                     address view/order/delivery|nothing;"
         id="checkout">
                      
      <h1 class="documentFirstHeading" i18n:translate="checkout_title">
        Check out
      </h1>

      <form name=""
            id="checkout"
            method="post"
            action=""
            tal:attributes="action string:${context/absolute_url}/@@checkout">
        <div class="formControls">
          <input class="context previous" name="pcommerce.pre" value="Previous step" type="submit"
                 i18n:attributes="value" />
          <input tal:condition="not: view/post_payment" class="context next checkout" name="pcommerce.checkout" value="Send order" type="submit"
                 i18n:attributes="value" />
          <input class="standalone" name="pcommerce.cancel" value="Cancel checkout" type="submit"
                 i18n:attributes="value" />
        </div>
      </form>
        
      <fieldset id="delivery">
        
        <legend i18n:translate="">
          Delivery address
        </legend>
        
        <a href="" class="editLink" title="Edit delivery address"
           tal:attributes="href string:${portal_url}/@@checkout?pcommerce.delivery"
           i18n:attributes="title">
          <img src="edit.gif" alt="Edit" i18n:translate="alt label_edit" i18n:domain="plone" /> 
        </a>

        <metal:address use-macro="context/@@pcommerce_macros/addressInfo" />
                     
      </fieldset>
      
      <fieldset id="billing">
        
        <legend i18n:translate="">
          Payment method
        </legend>
        
        <metal:payment tal:condition="payment"
                       use-macro="context/@@pcommerce_macros/paymentInfo" />
                       
        <div tal:replace="structure view/info_payment" />
        
        <tal:main tal:condition="view/post_payment">
          <tal:macro condition="not: view/post_payment_type">
             <metal:main use-macro="view/post_payment/main" />
          </tal:macro>
          <tal:replace condition="view/post_payment_type">
             <tal:main replace="structure view/post_payment" />
          </tal:replace>
        </tal:main>
        
      </fieldset>
            
      <fieldset id="products">
        
        <legend i18n:translate="">
          Shopping cart
        </legend>
        
        <metal:payment use-macro="context/@@pcommerce_macros/cartInfo" />
        
      </fieldset>

      <form name=""
            id="checkout"
            method="post"
            action=""
            tal:attributes="action string:${context/absolute_url}/@@checkout">
        <div class="formControls">
          <input class="context previous" name="pcommerce.pre" value="Previous step" type="submit"
                 i18n:attributes="value" />
          <input tal:condition="not: view/post_payment" class="context next checkout" name="pcommerce.checkout" value="Send order" type="submit"
                 i18n:attributes="value" />
          <input class="standalone" name="pcommerce.cancel" value="Cancel checkout" type="submit"
                 i18n:attributes="value" />
        </div>
      </form>

    </div>
</metal:main>

</body>
</html>