<span metal:define-macro="portlet">
  <dl class="portlet portletMyTags">

      <dt class="portletHeader">
          <span class="portletTopLeft"></span>
          Tags for: <b tal:replace="view/user"></b>
          <span class="portletTopRight"></span>
      </dt>
      <dd class="portletItem odd">
        <ul class="navTree" tal:define="below_fold view/tags_for_current_user_below_fold">
          <li class="navTreeItem" tal:repeat="tag view/tags_for_current_user">
              <a tal:content="python: '%s (%s)' % (tag[0], tag[1])" tal:attributes="href python:'%s?tag=%s' % (view.viewurl, tag[0])"></a>
          </li>
          <span tal:condition="below_fold" tal:omit-tag="">
            <span style="display:none">
              <li class="navTreeItem" tal:repeat="tag below_fold">
              <a tal:content="python: '%s (%s)' % (tag[0], tag[1])" tal:attributes="href python:'%s?tag=%s' % (view.viewurl, tag[0])"></a>
              </li>
            </span>
            <div href="#" tal:content="structure python:'&darr; %s more &darr;' % len(below_fold)"
                  onClick="jQuery(this).toggle(); jQuery(this).prev().toggle(); jQuery(this).next().toggle();"></div>
            <div style="display:none" href="#" tal:content="structure python:'&uarr; %s less &uarr;' % len(below_fold)"
                  onClick="jQuery(this).toggle(); jQuery(this).prev().toggle().prev().toggle();"></div>
          </span>
        </ul>
        <div>
            <a id="personaltags_managelink" href="@@personaltags_manage">Manage Tags</a>
        </div>
      </dd>

      <dd class="portletFooter">
          <span class="portletBottomLeft"></span>
          <span class="portletBottomRight"></span>
      </dd>
  </dl>
<script language="javascript">
(function(jq) {
  $(document).ready(function(){
    jq('a#personaltags_managelink').prepOverlay({
      subtype: 'ajax',
      filter: '#content > *',
      config: {onLoad: function() {
        /* Cannot initialise in the document.load method */
        personalTagsManageInit();
      }}
    });
  });
})(jQuery);
</script>

</span>

