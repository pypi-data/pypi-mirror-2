{% extends 'base.html' %}
{% block body_class%}{%if pie_data%} class="tundra"{%endif%}{%endblock body_class%}
{% block headers %}{%if pie_data%}
<link rel="stylesheet" type="text/css" href="/static/js/dijit/themes/tundra/tundra.css" />
<script type="text/javascript">
    var djConfig = { parseOnLoad:true, isDebug:false };
</script>
<script type="text/javascript" src="/static/js/dojo/dojo.js"></script>
<script type="text/javascript">
//<![CDATA[
dojo.require("dojox.charting.Chart2D");
dojo.require("dojox.charting.plot2d.Pie");
dojo.require("dojox.charting.action2d.Highlight");
dojo.require("dojox.charting.action2d.MoveSlice");
dojo.require("dojox.charting.action2d.Tooltip");
dojo.require("dojox.charting.themes.MiamiNice");
dojo.addOnLoad(function() {
{% if active_filters %}
dojo.byId("fhl").style.display = "none";
dojo.create("a",{href:"#",innerHTML:"&darr;&nbsp;Show filters",id:"filter-toggle"},"fhl","before");
dojo.connect(dojo.byId("filter-toggle"),"onclick",function(e){
        e.preventDefault();
        em = dojo.byId("fhl");
        if(em.style.display == "inline"){
            em.style.display = "none";
            dojo.byId("filter-toggle").innerHTML = "&darr;&nbsp;Show filters";
        }else{
            em.style.display = "inline";
            dojo.byId("filter-toggle").innerHTML = "&uarr;&nbsp;Hide filters";
        }
});
{%endif%}
var dc = dojox.charting;
var pie_graph = new dc.Chart2D("pie_graph");
pie_graph.setTheme(dc.themes.MiamiNice).addPlot("default", {
type: "Pie",
font: "normal normal 8pt Tahoma",
fontColor: "black",
labelOffset: -30,
radius: 80
});
pie_graph.addSeries("Series A", {{pie_data|safe}});
var anim_a = new dc.action2d.MoveSlice(pie_graph, "default");
var anim_b = new dc.action2d.Highlight(pie_graph, "default");
var anim_c = new dc.action2d.Tooltip(pie_graph, "default");
pie_graph.render();
});
//]]>
</script>{%endif%}
{% endblock headers %}
{% block submenu %}
&nbsp;
{% endblock submenu %}
{% block title %}
Reports {{report_title}}
{% endblock title %}
{% block heading %}
Reports - {{report_title}}
{% endblock heading %}
{% block content %}
<div class="Grid_heading">
    <div class="Grid_hash">#</div>
    <div class="Grid_relay_address">IP address</div>
    <div class="Grid_relay_hostname">Hostname</div>
    <div class="Grid_relay_country">Country</div>
    <div class="Grid_Count">Total/S/V</div>
    <div class="Grid_Volume">Volume</div>
    <div class="Grid_Graph">&nbsp;</div>
</div>
<div class="lightblue_div">
    <div class="Graph_rows_col">
        {% load messages_extras %}
        {% for item in top_items %}
        <div class="graph_row">
            <div class="row_hash">{{ forloop.counter }}.</div>
            <div class="row_ip">
                <div class="pie_{{forloop.counter}} pie"></div>&nbsp;{{ item.clientip }}
            </div>
            <div class="row_hostname">{{ item.clientip|tds_hostname|tds_trunc:42 }}</div>
            <div class="row_country">{{ item.clientip|tds_geoip }}</div>
            <div class="row_count">{{ item.num_count}}/{{item.spam_total}}/{{item.virus_total }}</div>
            <div class="row_volume">{{ item.size|filesizeformat }}</div>
        </div>
        {% endfor %}
    </div>
    <div class="Graph_pie_col">
        <div id="pie_graph" style="width: 350px; height: 284px;">
        </div>
    </div>
</div>
{% if active_filters %}
<div class="lightblue_div">
    <div class="filterrow">
        Filters have been applied :
        <span id="fhl" style="display:inline;">
            {% for f in active_filters %}
            "<a href="/reports/#active_filters">{{f.filter_field}} {{f.filter_by}} {{f.filter_value}}</a>"{% if not forloop.last %},{% endif %}
            {% endfor %}
        </span>
    </div>
</div>
{% endif %}
{% endblock content %}
