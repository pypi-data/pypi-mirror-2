.. _installdeb:

=======================
Baruwa on Ubuntu/Debian
=======================

Baruwa deb install
==================

Download the deb from http://www.topdog-software.com/oss/baruwa/

The installation process will also configure apache, mysql and baruwa should you choose.

The install asks you for the following info

    + apache virtualhost name (The name used to configure the baruwa apache virtualhost)
    + database host (The hostname or ip of the host running your mysql database)
    + database admin user (A user account with admin access on the database server)
    + database admin password (The password fo the above user)
    + database user (The user baruwa will use to connect to the database)
    + database password (The password for the above)
    + database name (The name of the baruwa database)
    + baruwa admin user (The baruwa admin user)
    + baruwa admin password (The baruwa admin user password)
    + baruwa admin email (The baruwa admin user email address)

Install Baruwa::

    # apt-get install gdebi-core
    # gdebi baruwa_<version>_all.deb

Configure MailScanner
=====================

Enable the custom functions in your MailScanner configuration, edit the configuration
file /etc/MailScanner/MailScanner.conf and set the following::

	Is Definitely Not Spam = &BaruwaWhitelist
	Is Definitely Spam = &BaruwaBlacklist
	Always Looked Up Last = &BaruwaSQL

To actually quarantine and later process messages with in baruwa, set
'store' as one of your keywords for the "Spam Actions" and
"High Scoring Spam Actions" MailScanner options

**Integrate per user settings**

Edit the MailScanner config file /etc/MailScanner/MailScanner.conf, and
set the following options::

    Required SpamAssassin Score = &BaruwaLowScore
    High SpamAssassin Score = &BaruwaHighScore

If you want users to be able to turn off spam checks for their own profiles,
set the following options::

    Spam Checks = &BaruwaShouldScan

**Verify that is working**

Check your log files you should see

Baruwa SQL logger::

	Aug  9 18:58:27 localhost MailScanner[8470]: Logging message 1OiVg7-0003zS-9s to Baruwa SQL 
	Aug  9 18:58:27 localhost MailScanner[11052]: 1OiVg7-0003zS-9s: Logged to Baruwa SQL

Baruwa Lists::

	Aug 9 18:32:42 localhost MailScanner[27260]: Starting Baruwa whitelists 
	Aug 9 18:32:42 localhost MailScanner[27260]: Read 6 whitelist items 
	Aug 9 18:32:42 localhost MailScanner[27260]: Ip blocks whitelisted 192.168.1.0/24 192.168.2.0/24 xxx.xx.xxx.0/26

Baruwa User settings::

    Aug 9 15:00:03 localhost MailScanner[25708]: Baruwa - Populating spam score settings
    Aug 9 15:00:03 localhost MailScanner[25708]: Read 1 spam score settings
    Aug 9 14:59:53 localhost MailScanner[25668]: Baruwa - Populating high spam score settings
    Aug 9 14:59:53 localhost MailScanner[25668]: Read 1 high spam score settings

Configure Baruwa
================

Edit the settings.py file and make configuration changes to suit your site.::

	# baruwa_path=$(python -c "from distutils.sysconfig import get_python_lib; print get_python_lib()")
	# vi $baruwa_path/baruwa/settings.py

Thats it point your browser to the apache virtualhost url.
