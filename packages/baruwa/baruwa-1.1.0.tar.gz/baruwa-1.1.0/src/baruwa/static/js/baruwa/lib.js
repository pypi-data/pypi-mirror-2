function wordwrap(f,b,a,e){a=a||"<br/>\n";b=b||75;e=e||false;if(!f){return f}var d=".{1,"+b+"}(\\s|$)"+(e?"|.{"+b+"}|.+$":"|\\S+?(\\s|$)");return f.match(RegExp(d,"g")).join(a)}function stripHTML(a){if(a){return a.replace(/<(.|\n)*?>/g,"")}else{return""}}function lastupdatetime(){var e=new Date();var h,g,b,a,d,f,i;h=e.getFullYear();g=e.getMonth()+1;if(g<10){g="0"+g}b=e.getDate();a=e.getHours();d=e.getMinutes();f=e.getSeconds();if(f<10){f="0"+f}if(d<10){d="0"+d}i=h+"-"+g+"-"+b+" "+a+":"+d+":"+f;return i}function filesizeformat(a){var b=["bytes","KB","MB","GB","TB","PB"];var d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(1)+" "+b[d]}function stringtonum(a){return(typeof(a)=="number")?new Number(a):NaN}function json2html(d){if(d){rj=d.paginator;if(d.items.length){last_ts=d.items[0].timestamp}var e;var b;rows=[];len=d.items.length;len--;count=0;$("#smailtotal").empty().append(d.status.baruwa_mail_total);$("#sspamtotal").empty().append(d.status.baruwa_spam_total);$("#svirustotal").empty().append(d.status.baruwa_virus_total);$("#inq").empty().append(d.status.baruwa_in_queue);$("#outq").empty().append(d.status.baruwa_out_queue);if(d.status.baruwa_status){simg="active.png";alt="OK"}else{simg="inactive.png";alt="FAULTY"}var a=media_url+"imgs/"+simg;$("#statusimg").attr("src",a).attr("alt",alt);$.each(d.items,function(g,j){e="";c="LightBlue";b=j.to_address.split(",");for(itr=0;itr<b.length;itr++){e+=b[itr]+"<br />"}if(j.from_address.length>30){var h=j.from_address.substring(0,29)+"..."}else{var h=j.from_address}s=stripHTML(j.subject);if(s.length>38){re=/\s/g;if(re.test(s)){subject=wordwrap(s,55)}else{subject=s.substring(0,44)+"..."}}else{subject=s}var f="";if(j.spam&&!(j.virusinfected)&&!(j.nameinfected)&&!(j.otherinfected)){f=gettext("Spam");if(j.highspam){c="highspam"}else{c="spam"}}if(j.virusinfected||j.nameinfected||j.otherinfected){f=gettext("Infected");c="infected"}if(!(j.spam)&&!(j.virusinfected)&&!(j.nameinfected)&&!(j.otherinfected)){f=gettext("Clean")}if(j.whitelisted&&!(j.virusinfected)&&!(j.nameinfected)&&!(j.otherinfected)){f="WL";c="whitelisted"}if(j.blacklisted){f="BL";c="blacklisted"}if(!j.scaned){f="NS";c="LightGray"}if(d.paginator){if(d.paginator.view_type=="archive"){view="archive"}else{view="view"}}else{view="view"}rows[count++]='<div class="'+stripHTML(c)+'_div">';rows[count++]='<div class="Date_Time"><a href="/messages/'+view+"/"+j.id+'/">'+j.timestamp+"</a></div>";rows[count++]='<div class="From_row"><a href="/messages/'+view+"/"+j.id+'/">'+h+"</a></div>";rows[count++]='<div class="To_row"><a href="/messages/'+view+"/"+j.id+'/">'+e+"</a></div>";rows[count++]='<div class="Subject_row"><a href="/messages/'+view+"/"+j.id+'/">'+subject+"</a></div>";rows[count++]='<div class="Size_row"><a href="/messages/'+view+"/"+j.id+'/">'+filesizeformat(j.size)+"</a></div>";rows[count++]='<div class="Score_row"><a href="/messages/'+view+"/"+j.id+'/">'+j.sascore+"</a></div>";rows[count++]='<div class="Status_row"><a href="/messages/'+view+"/"+j.id+'/">'+f+"</a></div>";rows[count++]="</div>"});if(!rows.length){if(full_messages_listing){rows='<div class="spanrow">'+gettext("No records returned")+"</div>";$("div.Grid_heading ~ div").remove();$("div.Grid_heading").after(rows)}}else{if(full_messages_listing){$("div.Grid_heading ~ div").remove();$("div.Grid_heading").after(rows.join(""))}else{if(len==49){$("div.Grid_heading ~ div").remove();$("div.Grid_heading").after(rows.join(""))}else{remove_rows=(48-len);$("div.Grid_heading ~ div:gt("+remove_rows+")").remove();$("div.Grid_heading").after(rows.join(""))}}}}else{$("#my-spinner").empty().append(gettext("Empty response from server. check network!"))}};