{% extends "base.html" %}
{% block headers %}
<link rel="stylesheet" type="text/css" href="/static/css/smoothness/jquery-ui-custom.css" />
<script type="text/javascript" src="/static/js/jquery.js"></script>
<script type="text/javascript" src="/static/js/jquery-ui.js"></script>
<script type="text/javascript" src="/static/js/details.js"></script>
{% endblock headers %}
{% block title %}Baruwa :: Showing message - {{ message_details.id }} {% endblock %}
{% block heading %}Showing message - {{ message_details.id }} {% endblock %}
{% block messaged %} value="{{ message_details.id }}" {%endblock %}
{% block submenu %}
{% if message_details.quarantined %}
<ul>
  <li><a href="{%url preview-message message_id=message_details.id%}">Preview message</a></li>
  <li><a href="#q">Release message</a></li>
</ul>
{% else %}
&nbsp;
{% endif %}
{% endblock submenu %}
{% block content %}
<table class="maillog">
{% if message_details %}
{% load messages_extras %}
{% load relayed_via %}
  <tbody>
		<tr>
		<td class="mailitem">Message ID:</td>
		<td class="maildetail">{{ message_details.id }}</td>
		</tr>
		<tr>
		<td class="mailitem">From:</td>
		<td class="maildetail"><span id="from-addr">{{ message_details.from_address|tds_wrap:80|linebreaksbr }}</span>
    <span id="listing" class="listings">
    [{% if not message_details.spamwhitelisted %}<a id="whitelist" href="{%url whitelist-sender message_id=message_details.id%}">Whitelist</a>{%else%}Whitelist{%endif%}]
    &nbsp;
    [{% if not message_details.spamblacklisted %}<a id="blacklist" href="{%url blacklist-sender message_id=message_details.id%}">Blacklist</a>{%else%}Blacklist{%endif%}]
    </span>
    </td>
		</tr>
		<tr>
		<td class="mailitem">To:</td>
		<td class="maildetail">{{ message_details.to_address|tds_nl_commas|linebreaksbr }}</td>
		</tr>
		<tr>
		<td class="mailitem">Subject</td>
		<td class="maildetail">{{ message_details.subject }}</td>
		</tr>
		<tr>
		<td class="mailitem">Received on:</td>
		<td class="maildetail">{{ message_details.timestamp }}</td>
		</tr>
		<tr>
		<td class="mailitem">Received by:</td>
		<td class="maildetail">{{ message_details.hostname }}</td>
		</tr>
		<tr>
		<td class="mailitem">Received from:</td>
		<td class="maildetail">{{ message_details.clientip }}</td>
		</tr>
		<tr>
		<td class="mailitem">Received via:</td>
		<td>{% relayed_via message_details.headers %}</td>
		</tr>
		<tr>
		<td class="mailitem">Message Headers:</td>
		<td class="maildetail">
        <div id="mail-headers" style="display:block;">{{ message_details.headers|tds_wrap_headers|linebreaksbr }}</div>
        </td>
		</tr>
		<tr>
		<td class="mailitem">Size:</td>
		<td class="maildetail">{{ message_details.size|filesizeformat }}</td>
		</tr>
		<tr>
		<td class="mailitem">Virus:</td>
		<td class="maildetail">{% if message_details.virusinfected %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Blocked File:</td>
		<td class="maildetail">{% if message_details.nameinfected %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Other infection:</td>
		<td class="maildetail">{% if message_details.otherinfected %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td colspan="2" class="divider">Spamassassin information</td>
		</tr>
		<tr>
		<td class="mailitem">Spam:</td>
		<td class="maildetail">
        {% if message_details.isspam %}
        <span class="positive">Y</span>
        {%if not message_details.ishighspam%} Action(s): {%tds_action 1 message_details.from_address message_details.to_address%}{%endif %}
        {% else %}
        <span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">High Scoring Spam:</td>
		<td class="maildetail">
        {% if message_details.ishighspam %}
        <span class="positive">Y</span> Actions(s): {%tds_action 2 message_details.from_address message_details.to_address%}
        {% else %}
        <span class="negative">N</span>
        {% endif %}
        </td>
		</tr>
		<tr>
		<td class="mailitem">SA Spam:</td>
		<td class="maildetail">{% if message_details.issaspam %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Listed in RBL:</td>
		<td class="maildetail">{% if message_details.isrblspam %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Spam Whitelisted:</td>
		<td class="maildetail">{% if message_details.spamwhitelisted %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Spam Blacklisted:</td>
		<td class="maildetail">{% if message_details.spamblacklisted %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">SA Autolearned:</td>
		<td class="maildetail">{{message_details.spamreport|tds_is_learned}}</td>
		</tr>
		<tr>
		<td class="mailitem">SA Score:</td>
		<td class="maildetail">{{ message_details.sascore }}</td>
		</tr>
		<tr>
		<td class="mailitem">Spam Report:</td>
		<td>{% spam_report message_details.spamreport %}</td>
		</tr>
		<tr>
		<td colspan="2" class="divider">Message Content Protection (MCP)</td>
		</tr>
		<tr>
		<td class="mailitem">MCP:</td>
		<td class="maildetail">{% if message_details.ismcp %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">High Scoring MCP:</td>
		<td class="maildetail">{% if message_details.ishighmcp %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">SA MCP:</td>
		<td class="maildetail">{% if message_details.issamcp %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">MCP Whitelisted:</td>
		<td class="maildetail">{% if message_details.mcpwhitelisted %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">MCP Blacklisted:</td>
		<td class="maildetail">{% if message_details.mcpblacklisted %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		{% if message_details.quarantined %}
		<tr>
		<td colspan="2" class="divider"><a name="q">Quarantine</a></td>
		</tr>
		<tr>
		<td colspan="2">&nbsp;</td>
		</tr>
		<tr>
		<td colspan="2">
		<!-- Nested quarantine table -->
        <div id="ajax_status"></div>
		<div id="server_response">
        {% if success %}The message has been processed{% endif %}
		</div>
		<div id="quarantine_errors">
        {% if error_list %}{{error_list}}{%endif%}
		</div>
        {%if not success %}
		<div id="process_quarantine">
		<form id="qform" action="/messages/process_quarantine/" method="post">
		<table class="quarantine">
		<tbody>
		<tr>
		<td>Release</td>
		<td>Delete</td>
		<td>SA Learn</td>
		<td>Preview</td>
		<td>Dangerous</td>
		</tr>
		<tr>
		<td>
    {% if not message_details.virusinfected and not message_details.namedinfected and not message_details.otherinfected %}{{ form.release }}{%endif%}</td>
		<td>
    {% if not message_details.virusinfected and not message_details.namedinfected and not message_details.otherinfected %}{{ form.todelete }}{%endif%}</td>
		<td>
    {% if not message_details.virusinfected and not message_details.namedinfected and not message_details.otherinfected %}
		{{ form.salearn }}&nbsp;
		{{ form.salearn_as }}
    {% endif %}
		</td>
		<td>
    {% if not message_details.virusinfected and not message_details.otherinfected %}
    <a href="{%url preview-message message_id=message_details.id%}">{{ message_details.id }}</a>
    {%endif %}
    </td>
		<td>
		{% if message_details.virusinfected or message_details.namedinfected or message_details.otherinfected %}
		<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}
		</td>
		</tr>
		<tr class="last">
		<td colspan="4">
		{{ form.use_alt }}&nbsp;Alternative recipients:&nbsp;
		<input type="text" id="id_altrecipients" name="altrecipients" size="70" />
        {{ form.use_alt.errors }}
		</td>
		<td>
		<input type="hidden" name="message_id" id="id_message_id" value="{{ message_details.id }}" />
		<input type="submit" id="submit_q_request" value="Submit" />
		</td>
		</tr>
    </tbody>
    </table>
    </form>
    </div>
    {% endif %}
    <!-- End nested quarantine table -->
    </td>
    </tr>
{% endif %}
    <tr>
    <td colspan="2">&nbsp;</td>
    </tr>
{% else %}
    <tr>
    <td>The message details for the requested message id could not be retrieved</td>
    </tr>
{% endif %}
  </tbody>
</table>
{% endblock content %}
