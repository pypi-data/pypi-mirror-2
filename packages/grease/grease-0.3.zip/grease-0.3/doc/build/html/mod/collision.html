

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>grease.collision – Collision Detection &mdash; Grease v0.3 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Grease v0.3 documentation" href="../index.html" />
    <link rel="next" title="grease.color – Colors" href="color.html" />
    <link rel="prev" title="Grease Tutorial Part III" href="../tutorial/tutorial3.html" />
        <link rel="stylesheet" href="../_static/grease.css" type="text/css" />

  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<img src="../_static/grease.png" alt="Grease logo" />
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="color.html" title="grease.color – Colors"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../tutorial/tutorial3.html" title="Grease Tutorial Part III"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Grease v0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../tutorial/tutorial3.html"
                        title="previous chapter">Grease Tutorial Part III</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="color.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">grease.color</span></tt> &#8211; Colors</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/mod/collision.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-grease.collision">
<span id="grease-collision-collision-detection"></span><h1><a class="reference internal" href="#module-grease.collision" title="grease.collision: Collision detection systems"><tt class="xref py py-mod docutils literal"><span class="pre">grease.collision</span></tt></a> &#8211; Collision Detection<a class="headerlink" href="#module-grease.collision" title="Permalink to this headline">¶</a></h1>
<p><strong>Grease collision detection systems</strong></p>
<p>Grease uses two-phase broad and narrow collision detection. <em>Broad-phase</em>
collision systems are used to efficiently identify pairs that may be colliding
without resorting to a brute-force check of all possible pairs. <em>Narrow-phase</em>
collision systems use the pairs generated by the broad-phase and perform more
precise collision tests to determine if a collision has actually occurred. The
narrow-phase system also calculates more details about each collision,
including collision point and normal vector for use in collision response.</p>
<p>A typical collision detection system consists of a narrow-phase system that
contains a broad-phased system. The narrow-phase system is usually the only</p>
<p>one that the application directly interacts with, though the application is
free to use the broad-phased system directly if desired. This could be
useful in cases where speed, rather than precision is paramount.</p>
<p>The narrow-phase system can be assigned handler objects to run after
collision detection. These can perform tasks like handling collision response
or dispatching collision events to application handlers.</p>
<p>Note that broad-phase systems can return false positives, though they should
never return false negatives. Do not assume that all pairs returned by a
broad-phase system are actually in collision.</p>
<dl class="class">
<dt id="grease.collision.BroadSweepAndPrune">
<em class="property">class </em><tt class="descclassname">grease.collision.</tt><tt class="descname">BroadSweepAndPrune</tt><big>(</big><em>collision_component='collision'</em><big>)</big><a class="headerlink" href="#grease.collision.BroadSweepAndPrune" title="Permalink to this definition">¶</a></dt>
<dd><p>2D Broad-phase sweep and prune bounding box collision detector</p>
<p>This algorithm is efficient for collision detection between many
moving bodies. It has linear algorithmic complexity and takes
advantage of temporal coherence between frames. It also does
not suffer from bad worst-case performance (like RDC can). 
Unlike spacial hashing, it does not need to be optimized for 
specific space and body sizes.</p>
<p>Other algorithms may be more efficient for collision detection with
stationary bodies, bodies that are always evenly distributed, or ad-hoc
queries.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>collision_component</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Name of the collision component used by this
system, defaults to &#8216;collision&#8217;. This component supplies each
entities&#8217; aabb and collision masks.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="grease.collision.BroadSweepAndPrune.query_point">
<tt class="descname">query_point</tt><big>(</big><em>x_or_point</em>, <em>y=None</em>, <em>from_mask=4294967295L</em><big>)</big><a class="headerlink" href="#grease.collision.BroadSweepAndPrune.query_point" title="Permalink to this definition">¶</a></dt>
<dd><p>Hit test at the point specified.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x_or_point</strong> &#8211; x coordinate (float) or sequence of (x, y) floats.</li>
<li><strong>y</strong> &#8211; y coordinate (float) if x is not a sequence</li>
<li><strong>from_mask</strong> &#8211; Bit mask used to filter query results. This value
is bit ANDed with candidate entities&#8217; <tt class="docutils literal"><span class="pre">collision.into_mask</span></tt>.
If the result is non-zero, then it is considered a hit. By
default all entities colliding with the input point are
returned.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A set of entities where the point is inside their bounding
boxes as of the last time step.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="grease.collision.BroadSweepAndPrune.set_world">
<tt class="descname">set_world</tt><big>(</big><em>world</em><big>)</big><a class="headerlink" href="#grease.collision.BroadSweepAndPrune.set_world" title="Permalink to this definition">¶</a></dt>
<dd><p>Bind the system to a world</p>
</dd></dl>

<dl class="method">
<dt id="grease.collision.BroadSweepAndPrune.step">
<tt class="descname">step</tt><big>(</big><em>dt</em><big>)</big><a class="headerlink" href="#grease.collision.BroadSweepAndPrune.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the system for this time step, updates and sorts the 
axis arrays.</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.BroadSweepAndPrune.collision_component">
<tt class="descname">collision_component</tt><a class="headerlink" href="#grease.collision.BroadSweepAndPrune.collision_component" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of world&#8217;s collision component used by this system</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.BroadSweepAndPrune.collision_pairs">
<tt class="descname">collision_pairs</tt><a class="headerlink" href="#grease.collision.BroadSweepAndPrune.collision_pairs" title="Permalink to this definition">¶</a></dt>
<dd><p>Set of candidate collision pairs for this timestep</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.BroadSweepAndPrune.world">
<tt class="descname">world</tt><a class="headerlink" href="#grease.collision.BroadSweepAndPrune.world" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="world.html#grease.world.World" title="grease.world.World"><tt class="xref py py-class docutils literal"><span class="pre">World</span></tt></a> object this system belongs to</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="grease.collision.Circular">
<em class="property">class </em><tt class="descclassname">grease.collision.</tt><tt class="descname">Circular</tt><big>(</big><em>handlers=()</em>, <em>position_component='position'</em>, <em>collision_component='collision'</em>, <em>update_aabbs=True</em>, <em>broad_phase=None</em><big>)</big><a class="headerlink" href="#grease.collision.Circular" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic narrow-phase collision detector which treats all entities as
circles with their radius defined in the collision component.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>handlers</strong> (<em>sequence of functions</em>) &#8211; A sequence of collision handler functions that are invoked
after collision detection.</li>
<li><strong>collision_component</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Name of collision component for this system,
defaults to &#8216;collision&#8217;. This supplies each entity&#8217;s collision
radius and masks.</li>
<li><strong>position_component</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Name of position component for this system,
defaults to &#8216;position&#8217;. This supplies each entity&#8217;s position.</li>
<li><strong>update_aabbs</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; If True (the default), then the entities&#8217;
<cite>collision.aabb</cite> fields will be updated using their position
and collision radius before invoking the broad phase system. 
Set this False if another system updates the aabbs.</li>
<li><strong>broad_phase</strong> &#8211; A broad-phase collision system to use as a source
for collision pairs. If not specified, a <a class="reference internal" href="#grease.collision.BroadSweepAndPrune" title="grease.collision.BroadSweepAndPrune"><tt class="xref py py-class docutils literal"><span class="pre">BroadSweepAndPrune</span></tt></a>
system will be created automatically.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="grease.collision.Circular.query_point">
<tt class="descname">query_point</tt><big>(</big><em>x_or_point</em>, <em>y=None</em>, <em>from_mask=4294967295L</em><big>)</big><a class="headerlink" href="#grease.collision.Circular.query_point" title="Permalink to this definition">¶</a></dt>
<dd><p>Hit test at the point specified.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x_or_point</strong> &#8211; x coordinate (float) or sequence of (x, y) floats.</li>
<li><strong>y</strong> &#8211; y coordinate (float) if x is not a sequence</li>
<li><strong>from_mask</strong> &#8211; Bit mask used to filter query results. This value
is bit ANDed with candidate entities&#8217; <tt class="docutils literal"><span class="pre">collision.into_mask</span></tt>.
If the result is non-zero, then it is considered a hit. By
default all entities colliding with the input point are
returned.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A set of entities where the point is inside their collision
radii as of the last time step.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="grease.collision.Circular.set_world">
<tt class="descname">set_world</tt><big>(</big><em>world</em><big>)</big><a class="headerlink" href="#grease.collision.Circular.set_world" title="Permalink to this definition">¶</a></dt>
<dd><p>Bind the system to a world</p>
</dd></dl>

<dl class="method">
<dt id="grease.collision.Circular.step">
<tt class="descname">step</tt><big>(</big><em>dt</em><big>)</big><a class="headerlink" href="#grease.collision.Circular.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the collision system for this time step and invoke
the handlers</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.Circular.broad_phase">
<tt class="descname">broad_phase</tt><a class="headerlink" href="#grease.collision.Circular.broad_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Broad phase collision system used as a source for collision pairs</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.Circular.collision_component">
<tt class="descname">collision_component</tt><a class="headerlink" href="#grease.collision.Circular.collision_component" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of world&#8217;s collision component used by this system</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.Circular.collision_pairs">
<tt class="descname">collision_pairs</tt><a class="headerlink" href="#grease.collision.Circular.collision_pairs" title="Permalink to this definition">¶</a></dt>
<dd><p>The set of entity pairs in collision in this timestep</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.Circular.handlers">
<tt class="descname">handlers</tt><a class="headerlink" href="#grease.collision.Circular.handlers" title="Permalink to this definition">¶</a></dt>
<dd><p>A sequence of collision handler functions invoke after collision
detection</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.Circular.position_component">
<tt class="descname">position_component</tt><a class="headerlink" href="#grease.collision.Circular.position_component" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of world&#8217;s position component used by this system</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.Circular.update_aabbs">
<tt class="descname">update_aabbs</tt><a class="headerlink" href="#grease.collision.Circular.update_aabbs" title="Permalink to this definition">¶</a></dt>
<dd><p>Flag to indicate whether the system updates the entities&#8217; <cite>collision.aabb</cite>
field before invoking the broad phase collision system</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.Circular.world">
<tt class="descname">world</tt><a class="headerlink" href="#grease.collision.Circular.world" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="world.html#grease.world.World" title="grease.world.World"><tt class="xref py py-class docutils literal"><span class="pre">World</span></tt></a> object this system belongs to</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="grease.collision.Pair">
<em class="property">class </em><tt class="descclassname">grease.collision.</tt><tt class="descname">Pair</tt><a class="headerlink" href="#grease.collision.Pair" title="Permalink to this definition">¶</a></dt>
<dd><p>Pair of entities in collision. This is an ordered sequence of two
entities, that compares and hashes unordered.</p>
<p>Also stores additional collision point and normal vectors
for each entity.</p>
<p>Sets of <tt class="docutils literal"><span class="pre">Pair</span></tt> objects are exposed in the <tt class="docutils literal"><span class="pre">collision_pairs</span></tt>
attribute of collision systems to indicate the entity pairs in
collision.</p>
<dl class="method">
<dt id="grease.collision.Pair.set_point_normal">
<tt class="descname">set_point_normal</tt><big>(</big><em>point0</em>, <em>normal0</em>, <em>point1</em>, <em>normal1</em><big>)</big><a class="headerlink" href="#grease.collision.Pair.set_point_normal" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the collision point and normal for both entities</p>
</dd></dl>

<dl class="attribute">
<dt id="grease.collision.Pair.info">
<tt class="descname">info</tt><a class="headerlink" href="#grease.collision.Pair.info" title="Permalink to this definition">¶</a></dt>
<dd><p>A sequence of (entity, collision point, collision normal)
for each entity in the pair</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="grease.collision.dispatch_events">
<tt class="descclassname">grease.collision.</tt><tt class="descname">dispatch_events</tt><big>(</big><em>collision_system</em><big>)</big><a class="headerlink" href="#grease.collision.dispatch_events" title="Permalink to this definition">¶</a></dt>
<dd><p>Collision handler that dispatches <cite>on_collide()</cite> events to entities
marked for collision by the specified collision system. The <cite>on_collide()</cite>
event handler methods are defined by the application on the desired entity
classes. These methods should have the following signature:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">on_collide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_entity</span><span class="p">,</span> <span class="n">collision_point</span><span class="p">,</span> <span class="n">collision_normal</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Handle A collision between this entity and `other_entity`</span>

<span class="sd">        - other_entity (Entity): The other entity in collision with </span>
<span class="sd">          `self`</span>

<span class="sd">        - collision_point (Vec2d): The point on this entity (`self`)</span>
<span class="sd">          where the collision occurred. Note this may be `None` for </span>
<span class="sd">          some collision systems that do not report it.</span>

<span class="sd">        - collision_normal (Vec2d): The normal vector at the point of</span>
<span class="sd">          collision. As with `collision_point`, this may be None for</span>
<span class="sd">          some collision systems.</span>
<span class="sd">        &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Note the arguments to <cite>on_collide()</cite> are always passed positionally, so you
can use different argument names than above if desired.</p>
<p>If a pair of entities are in collision, then the event will be dispatched
to both objects in arbitrary order if all of their collision masks align.</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="color.html" title="grease.color – Colors"
             >next</a> |</li>
        <li class="right" >
          <a href="../tutorial/tutorial3.html" title="Grease Tutorial Part III"
             >previous</a> |</li>
        <li><a href="../index.html">Grease v0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Casey Duncan.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.5.
    </div>
  </body>
</html>