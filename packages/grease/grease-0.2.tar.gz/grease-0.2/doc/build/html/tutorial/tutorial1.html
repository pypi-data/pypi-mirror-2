<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Grease Tutorial Part I &mdash; Grease v0.2 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Grease v0.2 documentation" href="../index.html" />
    <link rel="next" title="Grease Tutorial Part II" href="tutorial2.html" />
    <link rel="prev" title="Grease Overview" href="../overview.html" />
        <link rel="stylesheet" href="../_static/grease.css" type="text/css" />

  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<img src="../_static/grease.png" alt="Grease logo" />
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="tutorial2.html" title="Grease Tutorial Part II"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../overview.html" title="Grease Overview"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Grease v0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Grease Tutorial Part I</a><ul>
<li><a class="reference external" href="#diving-in">Diving In</a></li>
<li><a class="reference external" href="#the-world-of-grease">The World of Grease</a><ul>
<li><a class="reference external" href="#components">Components</a></li>
<li><a class="reference external" href="#systems">Systems</a></li>
<li><a class="reference external" href="#renderers">Renderers</a></li>
</ul>
</li>
<li><a class="reference external" href="#defining-an-entity-class">Defining an Entity Class</a></li>
<li><a class="reference external" href="#tying-it-together">Tying It Together</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../overview.html"
                                  title="previous chapter">Grease Overview</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="tutorial2.html"
                                  title="next chapter">Grease Tutorial Part II</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/tutorial/tutorial1.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="grease-tutorial-part-i">
<span id="tut-chapter-1"></span><h1>Grease Tutorial Part I<a class="headerlink" href="#grease-tutorial-part-i" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will be creating a simple, but complete game. To make the most of this material, you should have a working Python 2.6 and Grease installation. The tutorial progresses through several revisions of an example game named <em>Blasteroids</em>. To keep things simple, all of the code in this game is in a single file. Each of the three tutorial parts builds a new revision of the game code. You can find the complete revisions of the tutorial game code for each part in the <em>doc/tutorial</em> subdirectory of the Grease source package.</p>
<p>This tutorial assumes basic to intermediate knowledge and experience with the Python language. You should be comfortable with concepts like defining classes, and using decorators to get the most out of it.</p>
<div class="section" id="diving-in">
<h2>Diving In<a class="headerlink" href="#diving-in" title="Permalink to this headline">¶</a></h2>
<p id="index-20">Grease is built upon the excellent <a class="reference external" href="http://www.pyglet.org/">Pyglet</a> library. Pyglet provides the basic windowing, operating system event, scheduling and OpenGL graphics support for Grease. This tutorial assumes no prior knowledge of Pyglet or OpenGL, however it is not itself anything but a basic introduction to each. One of the advantages to Grease is that it abstracts away much of the details of using OpenGL, however its full power is still available to you if you need it. In fact there is no OpenGL-specific code in this tutorial, but some simple graphic programming concepts will be introduced.</p>
<p><em>Blasteroids</em> is a facimile of the similarly named classic arcade game. I chose this game specifically because it is familiar and simple, yet still complicated enough to be a non-trivial example. It&#8217;s also still fun to play after all of these years. To implement <em>Blasteroids</em> we will need the following basic functionality:</p>
<ul class="simple">
<li>Window with a graphics context</li>
<li>A way to create polygonal shapes, move and draw them</li>
<li>Keyboard event handler</li>
<li>Collision detection</li>
<li>Game logic for game lifetime and scoring</li>
<li>Title screen and game mode handling</li>
</ul>
<p>Starting from the top of our list, we will write the code that creates the window and graphics context. Luckily Pyglet makes that very easy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyglet</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Initialize and run the game&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">window</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">pyglet</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">Window</span><span class="p">()</span>
    <span class="n">pyglet</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The above is a complete Pyglet program that creates a window and enters the event loop listening for system events. The window is declared <tt class="xref docutils literal"><span class="pre">global</span></tt> because we will need to reference it elsewhere in the program to access things like its <tt class="xref docutils literal"><span class="pre">width</span></tt> and <tt class="xref docutils literal"><span class="pre">height</span></tt>. Although the above is not very interesting yet, it already has some important functionality. In particular the program will exit if the window is closed or the escape key is pressed. This functionality is included in the window&#8217;s default <tt class="xref docutils literal"><span class="pre">on_key_press()</span></tt> event handler.</p>
<p>If you have not seen it before, the <tt class="docutils literal"><span class="pre">if</span></tt> statement at the end may appear a bit odd. This is a python idiom used in module files that can be run as scripts. Each module has a built-in <tt class="xref docutils literal"><span class="pre">__name__</span></tt> attribute set by the interpreter. The name <tt class="docutils literal"><span class="pre">&quot;__main__&quot;</span></tt> is used for a module that is being executed as a script. In our example this means that the <tt class="xref docutils literal"><span class="pre">main()</span></tt> function will be executed when the module is run as a script, but not it is imported by another module. Although our program is not intended to be imported by other programs, it can still be handy to do so from the python prompt for debugging. Without using this check, importing the module would unexpectedly execute <tt class="xref docutils literal"><span class="pre">pyglet.app.run()</span></tt> to start the event loop, which would not return control to the importing program.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You&#8217;ll notice if you run the code above that the window may be filled with random garbage. That&#8217;s because we don&#8217;t clear the window using <tt class="docutils literal"><span class="pre">window.clear()</span></tt>. Grease will take care of that for us soon, so bear with it for right now.</p>
</div>
<span class="target" id="tut-world-example"></span></div>
<div class="section" id="the-world-of-grease">
<span id="index-21"></span><h2>The World of Grease<a class="headerlink" href="#the-world-of-grease" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a window, we can move on to setting up our game environment. Grease provides a <a title="grease.world.World" class="reference external" href="../mod/world.html#grease.world.World"><tt class="xref docutils literal"><span class="pre">World</span></tt></a> class to organize and orchestrate all of the basic parts that we need. A convenient way to specify a world configuration is the subclass <a title="grease.world.World" class="reference external" href="../mod/world.html#grease.world.World"><tt class="xref docutils literal"><span class="pre">World</span></tt></a> and override the <tt class="xref docutils literal"><span class="pre">configure()</span></tt> method. This method gets called after the world is instantiated so that the application can configure it as desired. We need to configure the world with three different types of parts: components, systems and renderers. We&#8217;ll start with components.</p>
<div class="section" id="components">
<span id="index-22"></span><h3>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h3>
<p>Components specify the data fields for the entities in the game and store all of their data. If you are familiar with relational databases, components can be thought of like tables with entities as their primary keys. Don&#8217;t worry too much about what an entity is just yet, once we get the world configuration setup, we&#8217;ll delve more deeply into how they work.</p>
<p>Below is the first part of our world configuration that subclasses the <a title="grease.world.World" class="reference external" href="../mod/world.html#grease.world.World"><tt class="xref docutils literal"><span class="pre">World</span></tt></a> base class and configures some basic components:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8</pre></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">GameWorld</span><span class="p">(</span><span class="n">grease</span><span class="o">.</span><span class="n">World</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configure the game world&#39;s components, systems and renderers&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Position</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">movement</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Movement</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Shape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">renderable</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Renderable</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Components are accessed via the world attribute <tt class="xref docutils literal"><span class="pre">components</span></tt>. Above, attributes for each component we need are added. Although we can give the component attributes any names we want, other parts of the world will be easier to configure if we use standard names. The standard names of the built-in components are always the same as the class name, only lower case. If the component name has multiple words, it is recommended to use the <a class="reference external" href="http://www.python.org/dev/peps/pep-0008/">pep-8</a> naming convention of <tt class="xref docutils literal"><span class="pre">lower_case_with_underscores</span></tt>. But bear in mind that the component attribute names are not magical and can be anything you want.</p>
<p>Below the built-in components used above are explained in more detail.</p>
<dl class="docutils">
<dt><cite>Position</cite></dt>
<dd>The position component stores entity position data. It has the fields <tt class="xref docutils literal"><span class="pre">position</span></tt> amd <tt class="xref docutils literal"><span class="pre">angle</span></tt>.</dd>
<dt><cite>Movement</cite></dt>
<dd>The movement component describes how an entity moves over time. It has the fields <tt class="xref docutils literal"><span class="pre">velocity</span></tt>, <tt class="xref docutils literal"><span class="pre">accel</span></tt> and <tt class="xref docutils literal"><span class="pre">rotation</span></tt>.</dd>
<dt><cite>Shape</cite></dt>
<dd>The shape component decribes poylgonal entity shapes. It has the fields <tt class="xref docutils literal"><span class="pre">verts</span></tt> and <tt class="xref docutils literal"><span class="pre">closed</span></tt>.</dd>
<dt><cite>Renderable</cite></dt>
<dd>The renderable component stores some data about entity presentation. It has the fields <tt class="xref docutils literal"><span class="pre">depth</span></tt> and <tt class="xref docutils literal"><span class="pre">color</span></tt>.</dd>
</dl>
<p>Entities in a <tt class="xref docutils literal"><span class="pre">GameWorld</span></tt> instance can now have data in any of these components.</p>
</div>
<div class="section" id="systems">
<span id="index-23"></span><h3>Systems<a class="headerlink" href="#systems" title="Permalink to this headline">¶</a></h3>
<p>Now that we have some components for our world, let&#8217;s move on to systems. Systems define behavioral aspects of the world. They execute at regular intervals to update the state of the world in particular ways. This often means they take data from one or more components to modify the data in others.  Below we add a standard system to our world configuration:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">GameWorld</span><span class="p">(</span><span class="n">grease</span><span class="o">.</span><span class="n">World</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configure the game world&#39;s components, systems and renderers&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Position</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">movement</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Movement</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Shape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">renderable</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Renderable</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">systems</span><span class="o">.</span><span class="n">movement</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">EulerMovement</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Similar to components, the world attribute <tt class="xref docutils literal"><span class="pre">systems</span></tt> is used to access the systems. Systems are also named using attributes, like components. Unlike components, however, the order of systems in the world is important. When the systems are executed each time step, they are executed in the order they were assigned to the <tt class="xref docutils literal"><span class="pre">systems</span></tt> attribute. Many times systems use the results calculated by other systems to do their work. System ordering allows the application to ensure that the world is updated in a consistent way. Of course since we only have a single system so far, we can&#8217;t go too far wrong with the order.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to insert a system out of order using the <tt class="xref docutils literal"><span class="pre">world.systems.insert()</span></tt> method.</p>
</div>
<p>The <a title="grease.controller.EulerMovement" class="reference external" href="../mod/controller.html#grease.controller.EulerMovement"><tt class="xref docutils literal"><span class="pre">EulerMovement</span></tt></a> system is responsible for updating the position and movement components. It performs a Euler integration each time step to update the <tt class="xref docutils literal"><span class="pre">movement.velocity</span></tt>, <tt class="xref docutils literal"><span class="pre">position.position</span></tt> and <tt class="xref docutils literal"><span class="pre">position.angle</span></tt> fields for all entities with both position and movement data. Systems access components in the world by name. By default, the <a title="grease.controller.EulerMovement" class="reference external" href="../mod/controller.html#grease.controller.EulerMovement"><tt class="xref docutils literal"><span class="pre">EulerMovement</span></tt></a> controller assumes the position component it will use is named &#8220;position&#8221; and the movement controller is named &#8220;movement&#8221;. This is just a convention, however. In fact you can have multiple position and movement components with different names if desired. For this application the defaults work fine, and require less configuration.</p>
</div>
<div class="section" id="renderers">
<span id="index-24"></span><h3>Renderers<a class="headerlink" href="#renderers" title="Permalink to this headline">¶</a></h3>
<p>The last piece of the world configuration puzzle are the renderers. Their role is unsurprisingly to create the visual presentation of the world. When the window needs to be redrawn, the renders will come to life and draw the world in its current state. We add two renderers to our world config:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">GameWorld</span><span class="p">(</span><span class="n">grease</span><span class="o">.</span><span class="n">World</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configure the game world&#39;s components, systems and renderers&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Position</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">movement</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Movement</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Shape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">renderable</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Renderable</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">systems</span><span class="o">.</span><span class="n">movement</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">EulerMovement</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">Camera</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">vector</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="n">line_width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
<p>Like systems, renderer order is important. Renderers are always invoked in the order they are configured.</p>
<p>Although renderers typically make an immediate visual change to the window, some, like <tt class="xref docutils literal"><span class="pre">renderer.Camera</span></tt> change the drawing state for subsequent renderers to use. A camera renderer is a high-level way to setup the OpenGL state for further rendering. Setting the position of the camera translates all of the subsequent drawing. In our example, we position the origin point (0, 0) in the center of the window instead of the Pyglet default, which is the lower left corner. You can also set a zoom and angle for the camera to scale and rotate respectively. The camera&#8217;s settings may also be changed at run time to easily implement features like panning and zooming.</p>
<p>The main workhorse renderer in our example is the <a title="grease.renderer.Vector" class="reference external" href="../mod/renderer.html#grease.renderer.Vector"><tt class="xref docutils literal"><span class="pre">Vector</span></tt></a> renderer class. This renderer will draw shapes from the shape component in an old-school vector graphics style. As you may have guessed the <tt class="xref docutils literal"><span class="pre">line_width</span></tt> argument controls how fat the vector lines are drawn. This renderer draws all of the shapes in the component in a single batch using <tt class="xref docutils literal"><span class="pre">GL_LINES</span></tt>. Because of this, all shapes drawn by this renderer must have the same line width. Even with this restriction, it is not difficult to use this renderer in cases where multiple line widths are needed. You will just need one <a title="grease.component.Renderable" class="reference external" href="../mod/component.html#grease.component.Renderable"><tt class="xref docutils literal"><span class="pre">Renderable</span></tt></a> component and one <a title="grease.renderer.Vector" class="reference external" href="../mod/renderer.html#grease.renderer.Vector"><tt class="xref docutils literal"><span class="pre">Vector</span></tt></a> renderer per desired line width.</p>
<p>We now have all the parts configured for our second goal: to create polygonal shapes, move and draw them. Now we just need to create some entities that store data in our components.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Components, renderers, and systems coorespond closely to the models, views and controllers respectively of the <a class="reference external" href="http://en.wikipedia.org/wiki/Model–view–controller">MVC design pattern</a>.</p>
</div>
<span class="target" id="tut-entity-example"></span></div>
</div>
<div class="section" id="defining-an-entity-class">
<span id="index-25"></span><h2>Defining an Entity Class<a class="headerlink" href="#defining-an-entity-class" title="Permalink to this headline">¶</a></h2>
<p>In the abstract, entities represent the actionable items in a game. Anything that can interact or be interacted with is typically an entity. Entities are usually visible to the player and may have dynamic behavior such as movement, collision, or animation. In our example game we will be defining entities for several game objects, starting with one of the stars of the show, asteroids.</p>
<p>In concrete terms, Grease entities are rather simple things. Grease entities are instances of the <a title="grease.entity.Entity" class="reference external" href="../mod/entity.html#grease.entity.Entity"><tt class="xref docutils literal"><span class="pre">Entity</span></tt></a> class. Typically applications will define various entity types by sublclassing <a title="grease.entity.Entity" class="reference external" href="../mod/entity.html#grease.entity.Entity"><tt class="xref docutils literal"><span class="pre">Entity</span></tt></a>. Since entity data is stored in components, they have only two instance attributes: <tt class="xref docutils literal"><span class="pre">entity_id</span></tt> and <tt class="xref docutils literal"><span class="pre">world</span></tt>. The entity id is a unique identifier for the entity in the world. This is automatically assigned when the entity is created, and is usually invisible to application. The world is of course the <a title="grease.world.World" class="reference external" href="../mod/world.html#grease.world.World"><tt class="xref docutils literal"><span class="pre">World</span></tt></a> object where the entity resides. Entities are really just typed identifiers, so they are only meaningful in the context of a world, and actually cannot be created independently of a world.</p>
<p>Not let&#8217;s put that theory into practice and define the <tt class="xref docutils literal"><span class="pre">Asteroid</span></tt> entity class. Since asteroids are fairly static objects, we just need to establish their initial state. This is done in the conventional way by defining an <a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/reference/datamodel.html#object.__init__"><tt class="xref docutils literal"><span class="pre">__init__()</span></tt></a> method:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Asteroid</span><span class="p">(</span><span class="n">grease</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Big floating space rock&quot;&quot;&quot;</span>

    <span class="n">UNIT_CIRCLE</span> <span class="o">=</span> <span class="p">[(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span> 
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">360</span><span class="p">,</span> <span class="mf">18</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">45</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mf">50</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2</span><span class="p">),</span> 
            <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mf">50</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movement</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">700</span> <span class="o">/</span> <span class="n">radius</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">700</span> <span class="o">/</span> <span class="n">radius</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movement</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">15</span><span class="p">)</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">/</span> <span class="mf">7</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">/</span> <span class="mf">7</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNIT_CIRCLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="n">verts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renderable</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s">&quot;#aaa&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Let&#8217;s dissect this to see what&#8217;s going on. The class declaration is straightforward enough, we simply subclass <a title="grease.entity.Entity" class="reference external" href="../mod/entity.html#grease.entity.Entity"><tt class="xref docutils literal"><span class="pre">Entity</span></tt></a>. It&#8217;s worth stating that this is not optional. The <tt class="xref docutils literal"><span class="pre">Entity</span></tt> base class contains several essential facilities to make it fit into a world context.</p>
<p>After the docstring (always a good idea), we have a standard class attribute declaration:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">UNIT_CIRCLE</span> <span class="o">=</span> <span class="p">[(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span> 
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">360</span><span class="p">,</span> <span class="mf">18</span><span class="p">)]</span>
</pre></div>
</div>
<p>Since our asteroids are basically distorted circles, this sets up a list of points along a unit circle to use as a base shape. Although instance attributes of entities are fixed, you can define as many class attributes as desired. It&#8217;s important that their names do not clash with the component accessors (which we&#8217;ll be getting to next). Using a naming convention, such as <tt class="xref docutils literal"><span class="pre">UPPER_CASE_WITH_UNDERSCORES</span></tt> as above avoids name collision problems handily.</p>
<p>Next let&#8217;s go into the entity constructor:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">45</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mf">50</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2</span><span class="p">),</span> 
            <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mf">50</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">2</span><span class="p">))</span>
</pre></div>
</div>
<p>The method declaration is conventional, however the second <tt class="xref docutils literal"><span class="pre">world</span></tt> argument is mandatory. As you might imagine this is the world object that the entity has been created in. Although you must receive this argument, you do not need to do anything with it in your <a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/reference/datamodel.html#object.__init__"><tt class="xref docutils literal"><span class="pre">__init__()</span></tt></a> method. The <tt class="xref docutils literal"><span class="pre">Entity</span></tt> base class takes care of assigning the <tt class="xref docutils literal"><span class="pre">world</span></tt> and <tt class="xref docutils literal"><span class="pre">entity_id</span></tt> attributes for you in its <a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/reference/datamodel.html#object.__new__"><tt class="xref docutils literal"><span class="pre">__new__()</span></tt></a> method. After the <tt class="xref docutils literal"><span class="pre">world</span></tt> argument you can define any additional arguments you need. Here we add a radius argument so that asteroids of various sizes can be created with this class.</p>
<p>The first statement in our constructor sets the position of the asteroid. The position is random, though it avoids placing asteroids directly in the middle of the window. The position value is not stored in the asteroid instance, however. Accessing <tt class="xref docutils literal"><span class="pre">self.position</span></tt> provides a component accessor for the new entity. This accessor lets you inspect and manipulate data in the world&#8217;s <tt class="xref docutils literal"><span class="pre">position</span></tt> component for this entity. The attributes of the position accessor let you read and write the field values for this entity in the position component. This lets you code using a conventional style from the point of view of the entity object, while keeping the data centralized in the components.</p>
<p>There is also another important thing happening here. Components are like sets of entities. Initially a new entity belongs to none of the components. By assigning a value to a component field, the entity is automatically added to the component if it is not already a member. So our position assignment above first adds the entity to the position component, then sets the value of the position field for the entity. There is no need to add the entity to the component separately.</p>
<p>So you can read the above assignment statement as, <em>&#8220;add the entity to the position component and set the position field of the position component to a random 2D vector.&#8221;</em></p>
<p>Now let&#8217;s tackle movement:</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">movement</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">700</span> <span class="o">/</span> <span class="n">radius</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">700</span> <span class="o">/</span> <span class="n">radius</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movement</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">15</span><span class="p">)</span>
</pre></div>
</div>
<p>The velocity is a 2D vector much like position. We set it to a random value, that on average will be faster for asteroids with a smaller radius.</p>
<p>Note how we can assign 2D vectors using just a 2 element tuple. These are converted into more specialized <tt class="xref docutils literal"><span class="pre">Vec2d</span></tt> objects when the value is stored in the velocity field. Although you can assign <tt class="xref docutils literal"><span class="pre">Vec2d</span></tt> objects directly to the fields, any 2 element sequence of numbers will also work, and for initialization tuples are often very convenient.</p>
<p>The rotation is set at a slow random value centered around zero. The zero mean will result in an approximately equal number of asteroids rotating clockwise as counterclockwise. The rotation values are in degrees per second, with positive values being clockwise.</p>
<p>Next up is the shape:</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="n">verts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">/</span> <span class="mf">7</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">/</span> <span class="mf">7</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNIT_CIRCLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="n">verts</span>
</pre></div>
</div>
<p>I broke this into two lines to make it a little easier to follow, it could be done on one line if desired. The first line sets up a list of 2D vertex coordinates for a polygon shape. The shape is offset and rotated by the position component values when it is used, so the coordinates here are relative to the &#8220;local origin&#8221; which in this case is at the center of each asteroid shape. To create the desired irregular shape, we step through the unit circle multiplying each unit coordinate by the radius. The gaussian random function adds a random deviation to each vertex location. The amount of deviation is proportional to the asteroid size.</p>
<p>The second line just takes our randomized vertices and stores them in the shape component for our asteroid entity.</p>
<p>Lastly, we set the asteroid color, to a nice dusty light gray:</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">renderable</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s">&quot;#aaa&quot;</span>
</pre></div>
</div>
<p>In order for the vector renderer to draw the entity, it must be a member of the position, shape and renderable components. Now that we have added data for our asteroids in all of those components, the renderer will draw them.</p>
<p>So there there you have it, 2D procedural vector asteroids! 8^)</p>
</div>
<div class="section" id="tying-it-together">
<h2>Tying It Together<a class="headerlink" href="#tying-it-together" title="Permalink to this headline">¶</a></h2>
<p>Before we can see our ponderous space boulders plodding through space, we need to tie up a few loose ends. Before it will work, we need to:</p>
<ul class="simple">
<li>Create an instance of the <tt class="xref docutils literal"><span class="pre">GameWorld</span></tt> we defined.</li>
<li>Schedule the <tt class="xref docutils literal"><span class="pre">GameWorld</span></tt> for updates.</li>
<li>Push the <tt class="xref docutils literal"><span class="pre">GameWorld</span></tt>&#8216;s event handlers on the window to receive events.</li>
<li>Create some <tt class="xref docutils literal"><span class="pre">Asteroid</span></tt> instances.</li>
</ul>
<p>We&#8217;ll modify the <tt class="xref docutils literal"><span class="pre">main()</span></tt> function to include this functionality:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Initialize and run the game&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">window</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">pyglet</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">Window</span><span class="p">()</span>
    <span class="n">world</span> <span class="o">=</span> <span class="n">GameWorld</span><span class="p">()</span>
    <span class="n">pyglet</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">tick</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">push_handlers</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">8</span><span class="p">):</span>
        <span class="n">Asteroid</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
    <span class="n">pyglet</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>World objects contain their own local clock, which is used by default to invoke the world&#8217;s systems. To make the world clock run, we must schedule the world&#8217;s <tt class="xref docutils literal"><span class="pre">tick()</span></tt> method with the global Pyglet clock.</p>
<p>The world also contains an <tt class="xref docutils literal"><span class="pre">on_draw()</span></tt> event handler that invokes the world&#8217;s renderers. By pushing the world onto the window, the renderers will redraw the window automatically.</p>
<p>The last change was to instantiate some <tt class="xref docutils literal"><span class="pre">Asteroid</span></tt> entities. Note that we don&#8217;t actually keep any references to them in our main function. Creating the asteroids automatically stores references to them in <tt class="xref docutils literal"><span class="pre">world.entities</span></tt>, so we don&#8217;t need any outside references. You can certainly keep local references to entities if needed, but since we do not need to reference the asteroids individually in our example, we can omit them.</p>
<p>We now have a working start to the game. The full source of our first revision can be found in <a href="../_downloads/blasteroids1.py"><strong class="xref">blasteroids1.py</strong></a>. The screenshot below shows what our handiwork looks like:</p>
<img alt="../_images/blasteroids1.png" src="../_images/blasteroids1.png" />
<p><strong>Next:</strong> <a class="reference external" href="tutorial2.html#tut-chapter-2"><em>Grease Tutorial Part II: Making a Game of it</em></a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial2.html" title="Grease Tutorial Part II"
             >next</a> |</li>
        <li class="right" >
          <a href="../overview.html" title="Grease Overview"
             >previous</a> |</li>
        <li><a href="../index.html">Grease v0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Casey Duncan.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.5.
    </div>
  </body>
</html>