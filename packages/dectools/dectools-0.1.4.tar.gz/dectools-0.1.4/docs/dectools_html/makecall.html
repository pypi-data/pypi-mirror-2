<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using the Make_call_* Constructors &mdash; dectools v0.1.4 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.1.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="dectools v0.1.4 documentation" href="index.html" />
    <link rel="prev" title="Using the Prebuilt Decorators" href="library.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="library.html" title="Using the Prebuilt Decorators"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">dectools v0.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-the-make-call-constructors">
<h1>Using the Make_call_* Constructors<a class="headerlink" href="#using-the-make-call-constructors" title="Permalink to this headline">¶</a></h1>
<p>To use the library constructors, add this import line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">dectools</span>
</pre></div>
</div>
<p>Use a constructor as decorator on your function.  Your
function must have the correct function signature:  the first
argument must be &#8220;function&#8221; and the second and third arguments are probably
&#8220;args&#8221; and &#8220;kwargs&#8221;.   Put any additional arguments after these required arguments.</p>
<p>TODO:  Make these arguments optional, because only &#64;make_call_instead really needs them.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@make_call_before</span>
<span class="k">def</span> <span class="nf">my_new_call_before_decorator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">some_other_argument</span><span class="p">):</span>
     <span class="c"># do stuff</span>
     <span class="o">....</span>

<span class="nd">@my_new_call_before_decorator</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>  <span class="c"># or (some_other_argument = &quot;foo&quot;)</span>
<span class="k">def</span> <span class="nf">my_newly_decorated_function</span><span class="p">(</span><span class="n">other_args</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>We will call &#8220;my_new_call_before_decorator&#8221; the decorator and
&#8220;my_newly_decorated_function&#8221; the decorated function.</p>
<div class="section" id="quick-reference">
<h2>Quick Reference<a class="headerlink" href="#quick-reference" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="25%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Construtor</th>
<th class="head">Required Parameters</th>
<th class="head">Used For</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>&#64;make_call_once</td>
<td>function</td>
<td>registering with frameworks, global resource creation</td>
</tr>
<tr><td>&#64;make_call_before</td>
<td>funciton, args, kwargs</td>
<td>requiring login, lazy instantiation</td>
</tr>
<tr><td>&#64;make_call_if</td>
<td>function, args, kwargs</td>
<td>checking priviledges, skipping if overloaded</td>
</tr>
<tr><td>&#64;make_call_after</td>
<td>function, args, kwargs</td>
<td>converting return values to exceptions, redrawing the screen</td>
</tr>
<tr><td>&#64;make_call_instead</td>
<td>function, args, kwargs</td>
<td>everything else.  logs, caches, locking, resource handling.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="make-call-once">
<h2>&#64;make_call_once<a class="headerlink" href="#make-call-once" title="Permalink to this headline">¶</a></h2>
<blockquote>
<p>Requires:  <tt class="docutils literal"><span class="pre">(function,</span> <span class="pre">...)</span></tt></p>
<p>Call the decorator once when the decorator is applied, but does not
affect the decorated function.</p>
<p>Used for registering the function with frameworks, global resource
creation, or enforcing proprietary licensing restrictions.</p>
</blockquote>
</div>
<div class="section" id="make-call-before">
<h2>&#64;make_call_before<a class="headerlink" href="#make-call-before" title="Permalink to this headline">¶</a></h2>
<blockquote>
<p>Requires: <tt class="docutils literal"><span class="pre">(function,</span> <span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">...)</span></tt></p>
<p>Call the decorator before the decorated function, then call the decorated function.
If the decorator throws an exception, then the decorated function is not called.</p>
<p>Used for requiring users to be logged in first, lazy instantiation of
resources, and setting preconditions.</p>
</blockquote>
</div>
<div class="section" id="make-call-after">
<h2>&#64;make_call_after<a class="headerlink" href="#make-call-after" title="Permalink to this headline">¶</a></h2>
<blockquote>
<p>Requires: <tt class="docutils literal"><span class="pre">(function,</span> <span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">...)</span></tt></p>
<p>Call decorator after the decorated function.  The decorator&#8217;s return value is
returned.</p>
<p>Used for converting errors from return values into exceptions, double checking
that resources were released, and redrawing of the screen.</p>
</blockquote>
</div>
<div class="section" id="make-call-if">
<h2>&#64;make_call_if<a class="headerlink" href="#make-call-if" title="Permalink to this headline">¶</a></h2>
<blockquote>
<p>Requires: <tt class="docutils literal"><span class="pre">(function,</span> <span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">...)</span></tt></p>
<p>Call decorator first.  If decorator returns a True value, then call the decorated
function.</p>
<p>Used for checking authorization, skipping decluttering during peak times, and enforcing
some proprietary licensing.</p>
</blockquote>
</div>
<div class="section" id="make-call-instead">
<h2>&#64;make_call_instead<a class="headerlink" href="#make-call-instead" title="Permalink to this headline">¶</a></h2>
<blockquote>
<p>Requires: <tt class="docutils literal"><span class="pre">(function,</span> <span class="pre">args,</span> <span class="pre">kwargs,</span> <span class="pre">...)</span></tt></p>
<p>Call the decorator.  Do not call the decorated function.  The decorator will usually
call the function with the statement <tt class="docutils literal"><span class="pre">return_value</span> <span class="pre">=</span> <span class="pre">function(*args,</span> <span class="pre">**kwargs)</span></tt>.</p>
<p>Used for everything, including logging, caching, acquiring and releasing locks,
acquiring and releasing other resources, comparing results between an optimized
algorithm and a slow but reliable one, and more.</p>
</blockquote>
</div>
</div>
<div class="section" id="how-the-constructors-really-work">
<h1>How the Constructors Really Work<a class="headerlink" href="#how-the-constructors-really-work" title="Permalink to this headline">¶</a></h1>
<p>TODO:  Make the constructors really work this way instead of with a couple extra
levels of functino calls.  The concept is about right.</p>
<p>This follows through one example to show how it works.  Walking through it might
demystify decorators, might make you think I am an idiot, and might put you to
sleep.</p>
<div class="section" id="the-example">
<h2>The example<a class="headerlink" href="#the-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@make_call_instead</span>   <span class="c"># Step 1</span>
<span class="k">def</span> <span class="nf">notice_me</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;I see you&quot;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">message</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">function</span><span class="o">.</span><span class="n">__name__</span>
    <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

<span class="nd">@notice_me</span><span class="p">(</span><span class="s">&quot;Watching you&quot;</span><span class="p">)</span>  <span class="c"># Step 2, Parts A and B.</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">name</span>

<span class="n">hello</span><span class="p">(</span><span class="s">&quot;Charles&quot;</span><span class="p">)</span>  <span class="c"># Step 3.</span>
</pre></div>
</div>
</div>
<div class="section" id="the-example-unwrapped">
<h2>The example (unwrapped)<a class="headerlink" href="#the-example-unwrapped" title="Permalink to this headline">¶</a></h2>
<p>This is the same example, except we do some extra assignements to
temporary or differently-named variables.  It also moves the <tt class="docutils literal"><span class="pre">&#64;</span></tt>
operation to after the <tt class="docutils literal"><span class="pre">def</span></tt> statement, which is where it actually
occurs.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">notice_me</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;I see you&quot;</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">message</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">function</span><span class="o">.</span><span class="n">__name__</span>
    <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="n">widget</span> <span class="o">=</span> <span class="n">make_call_instead</span><span class="p">(</span><span class="n">notice_me</span><span class="p">)</span>  <span class="c"># Step 1</span>
<span class="n">notice_me</span> <span class="o">=</span> <span class="n">widget</span>


<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">name</span>
<span class="n">gizmo</span> <span class="o">=</span> <span class="n">widget</span><span class="p">(</span><span class="s">&quot;Watching you&quot;</span><span class="p">)</span>  <span class="c"># Step 2 Part A</span>
<span class="n">hello_out</span> <span class="o">=</span> <span class="n">gizmo</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>        <span class="c"># Step 2 Part B</span>
<span class="n">hello</span> <span class="o">=</span> <span class="n">hello_out</span>

<span class="n">hello</span><span class="p">(</span><span class="s">&quot;Charles&quot;</span><span class="p">)</span>                <span class="c"># Step 3</span>
</pre></div>
</div>
</div>
<div class="section" id="the-explanation">
<h2>The explanation<a class="headerlink" href="#the-explanation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="step-1">
<h3>Step 1<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h3>
<p>The constructor, &#64;make_call_instead, is a concrete decorator because it
takes one function as input.  The function passed in, e.g., notice_me():</p>
<ul class="simple">
<li>has &#8220;function, args, and kwargs&#8221; as first three arguments.  In the current
version, this is asserted.   In future versions, it might not be required.</li>
<li>has zero or more additional arguments.  The additional arguments may or
may not have default values.</li>
</ul>
<p>The return value, named widget here, has some properties:</p>
<ul class="simple">
<li>It has a signature of only the additional parameters.  For this case,
it has a signature of taking only the message argument.</li>
<li>It has the __name__ metadata of notice_me().</li>
<li>It has decorator data describing that &#8220;the function signature was changed&#8221; and
mentions &#8220;make_call_instead()&#8221; as the culprit.</li>
<li>It can be used in step 2.</li>
</ul>
</div>
<div class="section" id="step-2-part-a">
<h3>Step 2, Part A<a class="headerlink" href="#step-2-part-a" title="Permalink to this headline">¶</a></h3>
<p>Step 2 is divided into two parts, because two separate operations occur in the line
&#64;notice_me(&#8220;Watching you&#8221;).   notice_me(&#8220;Watching you&#8221;) resolves into an intermediate
value and the &#8216;&#64;&#8217; operation is then applied.</p>
<p>For Part A., gizmo = widget(&#8220;Watching you&#8221;) takes an argument.</p>
<ul class="simple">
<li>The argument corresponds to the additional arguments after &#8220;function, args, kwargs&#8221;.</li>
<li>The signature of widget is &#8220;def widget(message):&#8221; and widget(&#8220;watching you&#8221;) is
equivalent to <tt class="docutils literal"><span class="pre">widget(message</span> <span class="pre">=</span> <span class="pre">&quot;watching</span> <span class="pre">you&quot;)</span></tt>.  Your IDE will help get the
arguments correct.</li>
<li>Widget is a complex decorator, taking arguments and yielding a decorator.</li>
<li>dectools makes complex decorators out of functions.  &#8220;Function&#8221; is used interchangably with
&#8220;method&#8221;.</li>
<li>The output, gizmo(), is a concrete decorator for use in Step 2, Part B.  gizmo() takes
one argument, a callable function, and returns a callable function with the additional
functionality of notice_me(). This makes gizmo() a concrete decorator.</li>
<li>When you use the decorator again, like <cite>&#64;notice_me(&#8220;Still watching&#8221;)</cite>, or,
equivalently, <cite>gizmo_2 = widget(&#8220;Still_watching&#8221;)</cite> both gizmo and gizmo_2 will
have the same __code__ attribute but different __closure__ attributes.  If that
made no sense, don&#8217;t worry.  There will not be a quiz.  Just recognize that you
will use notice_me with different input parameters.</li>
<li>the output, gizmo, is used in Step 2, Part B.</li>
</ul>
</div>
<div class="section" id="step-2-part-b">
<h3>Step 2, Part B<a class="headerlink" href="#step-2-part-b" title="Permalink to this headline">¶</a></h3>
<p>This line, &#8220;hello_out = gizmo(hello)&#8221; decorates hello.</p>
<ul class="simple">
<li>gizmo() takes exactly one argument, hello, and returns the modified function.  For
the example, we call it hello_out for clarity.  Right after this line, hello_out is
assigned to hello.</li>
<li>hello_out has the same signature and <tt class="docutils literal"><span class="pre">__name__</span></tt> as hello.  These are not related to
the signature or name of notice_me or gizmo.  That is, using the decorator does
not change the signature:  one of the magic points of dectools.</li>
<li>hello is expected to be a function.  The library might support hello being a
class in the future if I can make a case for it being helpful.  It works and
is helpful for &#64;make_call_once().</li>
<li>hello_out does get additional metadata to record that it was decorated.</li>
</ul>
</div>
<div class="section" id="step-3">
<h3>Step 3<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h3>
<p>When the line hello(&#8220;charles&#8221;) is called these things happen:</p>
<ol class="arabic">
<li><p class="first">hello(&#8220;charles&#8221;) is called.  When it was decorated, the actual code for hello
was changed to call a dectools function.  Let&#8217;s call this function &#8220;call_through()&#8221;
for this example.</p>
</li>
<li><p class="first">&#8220;call_through()&#8221; then calls notice_me() with the original hello function and
additonal decorator parameters.  In this case, it&#8217;s called:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">notice_me</span><span class="p">(</span><span class="n">function</span><span class="o">=</span> <span class="n">hello</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;charles&quot;</span><span class="p">),</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Watching you&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">notice_me() then prints &#8220;Watching you: hello&#8221;, then calls hello.  I wonder if anyone
reads this documentation?  Email me if you do.</p>
</li>
<li><p class="first">The return value of hello() is returned to notice_me() which is returned to
call_through() which is returned to the main program, where it is ignored.</p>
</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Using the Make_call_* Constructors</a><ul>
<li><a class="reference external" href="#quick-reference">Quick Reference</a></li>
<li><a class="reference external" href="#make-call-once">&#64;make_call_once</a></li>
<li><a class="reference external" href="#make-call-before">&#64;make_call_before</a></li>
<li><a class="reference external" href="#make-call-after">&#64;make_call_after</a></li>
<li><a class="reference external" href="#make-call-if">&#64;make_call_if</a></li>
<li><a class="reference external" href="#make-call-instead">&#64;make_call_instead</a></li>
</ul>
</li>
<li><a class="reference external" href="#how-the-constructors-really-work">How the Constructors Really Work</a><ul>
<li><a class="reference external" href="#the-example">The example</a></li>
<li><a class="reference external" href="#the-example-unwrapped">The example (unwrapped)</a></li>
<li><a class="reference external" href="#the-explanation">The explanation</a><ul>
<li><a class="reference external" href="#step-1">Step 1</a></li>
<li><a class="reference external" href="#step-2-part-a">Step 2, Part A</a></li>
<li><a class="reference external" href="#step-2-part-b">Step 2, Part B</a></li>
<li><a class="reference external" href="#step-3">Step 3</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="library.html"
                                  title="previous chapter">Using the Prebuilt Decorators</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/makecall.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="library.html" title="Using the Prebuilt Decorators"
             >previous</a> |</li>
        <li><a href="index.html">dectools v0.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Charles Merriam.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.5.
    </div>
  </body>
</html>