<html metal:use-macro="context/@@master/macros/master">

    <metal:slot fill-slot="main"
                tal:define="d              view/getPackageInfo; 
                            release_pkgs   d/releases;
                            dev_pkgs       d/dev;
                            releases       release_pkgs/releases;
                            release_files  release_pkgs/files;
                            dev_files      dev_pkgs/files/dev | python: [];
                            ">

      <div tal:condition="python: not releases and not dev_files">
        No files available (neither release files nor development files)
      </div>

      <tal:if condition="releases">

          <h2>Available distribution files for <span tal:content="request/package" />:</h2>
          <table border="1" id="package-info"
                 tal:condition="releases">
            <thead>
                <th>Version</th>
                <th>Distribution file</th>
                <th>Size</th>
                <th>Modified</th>
                <th>Action</th>
            </thead>

            <tbody>
                <tal:loop repeat="version releases">
                    <tal:loop repeat="d release_files/?version">
                        <tr>
                            <td tal:condition="python: repeat['d'].index() == 0" 
                                tal:attributes="rowspan python: len(release_files[version])">
                                <span tal:content="version" />
                            </td>

                            <td>
                                <a tal:attributes="href string:${request/package}/${d/name}"
                                   tal:content="d/name" 
                                   title="Download distribution file"
                                 />
                            </td>
                            <td tal:content="d/size" />
                            <td tal:content="d/mtime" />
                            <td> 
                                <a tal:condition="python: d['name'].endswith('egg')"
                                   tal:attributes="href string:metadata?package=${request/package}&filename=${d/name}">
                                    [Metadata]
                                </a>
                            </td>
                       </tr>
                    </tal:loop>
                </tal:loop>
            </tbody>
          </table>
      </tal:if>


      <tal:if condition="dev_files">

          <h3>Development packages:</h3>
          <table border="1" id="package-info">
            <thead>
                <th>Distribution file</th>
                <th>Size</th>
                <th>Modified</th>
                <th>Action</th>
            </thead>
            <tbody>
                <tal:loop repeat="d dev_files">
                    <tr>
                        <td>
                            <a tal:attributes="href string:${request/package}/${d/name}"
                               tal:content="d/name" 
                               title="Download distribution file"
                             />
                        </td>
                        <td tal:content="d/size" />
                        <td tal:content="d/mtime" />
                        <td> 
                            <a tal:condition="python: d['name'].endswith('egg')"
                               tal:attributes="href string:metadata?package=${request/package}&filename=${d/name}">
                                [Metadata]
                            </a>
                        </td>
                   </tr>
                </tal:loop>
            </tbody>
          </table>
      </tal:if>

    </metal:slot>
</html>
