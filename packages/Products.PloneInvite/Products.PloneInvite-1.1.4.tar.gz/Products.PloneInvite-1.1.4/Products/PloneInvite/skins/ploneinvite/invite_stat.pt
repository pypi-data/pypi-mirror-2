<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    lang="en"
    metal:use-macro="here/prefs_main_template/macros/master"
    i18n:domain="PloneInvite">

<metal:block metal:fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<body>

<div metal:fill-slot="prefs_configlet_content"
    tal:define="Batch python:modules['Products.CMFPlone'].Batch;
                b_start request/b_start | python:0;
                b_size request/b_size | python:20;
                user request/user|nothing">

      <div id="content" class="documentEditable"
           tal:condition="python:checkPermission('PortalInvite: Manage Member Invites', here)">
    <!-- simulating views on the groups/user pages until we have real objects. -->

    <div id="region-content">
      <a name="documentContent"></a>

      <div metal:use-macro="here/global_statusmessage/macros/portal_message">
        Portal status message
      </div>
        <div tal:omit-tag="" tal:condition="user">
            <div class="configlet">
              <h1 i18n:translate="heading_user_invites_overview">
                <span tal:replace="user" i18n:name="user" />'s invite status
              </h1>
          <fieldset>
            <legend i18n:translate="legend_user_invites_overview">Status of invites</legend>


            <div class="field"
                 tal:define="error errors/invites | nothing;"
                 tal:attributes="class python:test(error, 'field error', 'field')">
                    
             <label i18n:translate="label_new_invites">New Invites</label>
                <div class="formHelp" i18n:translate="help_invite_status_help">
                
                </div>
    
                <div tal:content="error">Validation error output</div>
                <div> <span tal:replace="python:user.capitalize()" >User's Name </span> has <span
                tal:replace="python:len(here.plone_invite.getInvites(user=user,sent=0))"
                /> Invitation left in his/her account </div>

          </div>

                    

        <form action=""
              name="manage_invites"
              method="post"
              tal:attributes="action template/getId"
              tal:define="plone_invites python:here.plone_invite.getInvites(user=user,sent=1);
                          batch python:Batch(plone_invites, b_size, int(b_start), orphan=1)">

            <div class="field"
                 tal:define="error errors/invites | nothing;"
                 tal:attributes="class python:test(error, 'field error', 'field')">
                    
             <label i18n:translate="label_invites_sent">Invites Sent</label>
                <div class="formHelp" i18n:translate="help_invite_status_help">
                
                </div>
    
                <div tal:content="error">Validation error output</div>
           
          <table class="listing" summary="User Listing">
          <tal:block>
          <tr>
            <th i18n:translate="listingheader_recipient">Recipient</th>
            <th i18n:translate="listingheader_sent_address">Sent Address</th>
            <th i18n:translate="listingheader_enforce_address">Enforce email address</th>
            <th i18n:translate="listingheader_sent">Sent</th>
            <th i18n:translate="listingheader_used">Used</th>
            <th i18n:translate="listingheader_expired">Expired</th>
          </tr>
          </tal:block>

        <tal:block repeat="invite batch">
          <tr tal:define="oddrow repeat/invite/odd;
                          userid invite/sender;"
              tal:attributes="class python:test(oddrow,'odd','even')">
            <td tal:content="invite/recipient">Recipient</td>
            <td tal:content="invite/sent_address">Sent Address</td>
            <td i18n:translate="" tal:content="python:test(invite['enforce_address'],'Yes','No')">Enforce email address</td>
            <td i18n:translate="" tal:content="python:test(invite['sent'],'Yes','No')">Sent</td>
            <td i18n:translate="" tal:content="python:test(invite['used'], 'Yes','No')">Used</td>
            <td i18n:translate="" tal:content="python:test((invite['sent'] and (invite['xdate']<DateTime() or invite['used'])), 'Yes', 'No')"></td>
          </tr>
        </tal:block>
                <tr tal:condition="not:batch">
                    <td colspan="8" i18n:translate="text_noplone_invites"
                        style="text-align:center;">No portal invites.</td>
                </tr>
          </table>

          <div metal:use-macro="here/batch_macros/macros/navigation" />

          </div>

        <input type="hidden" name="form.submitted" value="1" />
                
        </form>
        </fieldset>
 
            </div>
        </div>
        <div tal:omit-tag="" tal:condition="python:not user">
            <div class="configlet">
               <h1 i18n:translate="heading_users_overview">No User Selected</h1>
               <p> Please select a user to see his invite status </p>
            </div>
        </div>

    </div>
      </div>

      <div id="content" class="documentEditable"
           tal:condition="python:not checkPermission('Manage users', here)">
        <tal:block replace="here/raiseUnauthorized" />
      </div>
    </div>

  </body>
</html>

