<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

  <metal:head fill-slot="head_slot">
    <meta name="robots" content="noindex,follow" />
  </metal:head>

  <body>

    <div metal:fill-slot="main"
         tal:define="errors options/state/getErrors;">

      <h1>Invite a person</h1>

      <div class="documentDescription">
        Use your unused invite codes to invite a new member to this site.
      </div>

      <form name="invites_form"
            action="invites_form"
            method="post"
            enctype="multipart/form-data"
            tal:attributes="action string:${here/getId}/${template/getId}">

        <fieldset>

          <legend i18n:translate="legend_send_an_invite">Send an Invite</legend>

          <div class="field"
               tal:define="error errors/invitecode|nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="invitecode" i18n:translate="label_invitecode">Invite code</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="title"
                  i18n:translate="label_required">(Required)</span>
                  
            <div class="formHelp">
              Choose from your available invite codes.
            </div>
            
            <div tal:content="error">Validation error output</div>
            
            <select id="invitecode" name="invitecode">
              <option tal:content="invite/id" tal:attributes="value invite/id"
                tal:repeat="invite python:here.plone_invite.getInvitesUser(sent=0, used=0)" />
            </select>
          </div>

          <div class="field"
               tal:define="error errors/invite_to_address|nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="invite_to_address" i18n:translate="label_invite_to_mail">Send to</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="title"
                  i18n:translate="label_required">(Required)</span>

                  <div class="formHelp">
                    The e-mail address to send an invite to.
                  </div>

                  <div tal:content="error">Validation error output</div>

                  <input type="text"
                         id="invite_to_address"
                         name="invite_to_address"
                         size="25"
                         tabindex=""
                         tal:attributes="value request/invite_to_address | nothing;
                                         tabindex tabindex/next;"
                         />
          </div>

          <div class="field">
            <label>Message</label>

            <div class="formHelp">
              A message for your friend.
            </div>

            <textarea cols="80"
                      rows="5"
                      tabindex=""
                      name="message"
                      tal:content="request/message | nothing"
                      tal:attributes="tabindex tabindex/next;"
                      >
              Comment
            </textarea>
          </div>

          <div class="formControls">
            <input class="context"
                   tabindex=""
                   type="submit"
                   name="form.button.Invite"
                   value="Invite"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;"
                   />
          </div>

          <input type="hidden" name="form.submitted" value="1" />

        </fieldset>

        <fieldset>

          <legend i18n:translate="legend_pending_invites">Pending Invites</legend>

          <div class="documentDescription">Previously sent invites that have not been used yet:</div>
          <p>
            <span tal:repeat="invite python:here.plone_invite.getInvitesUser(sent=1, used=0)"
                  tal:omit-tag="">
              <span tal:replace="string:${invite/id} - ${invite/sent_address}">Invitee</span><br />
            </span>
          </p>

        </fieldset>

        <fieldset>

          <legend i18n:translate="legend_previously_invited">Previously Invited</legend>

          <div class="documentDescription">These members accepted your invites:</div>
          <p>
            <span tal:repeat="invite python:here.plone_invite.getInvitesUser(used=1)"
                  tal:omit-tag="">
              <span class="portalUser"
                tal:content="string:${invite/id} - ${invite/recipient}">Invitee</span><br />
            </span>
          </p>

        </fieldset>

      </form>

    </div>

  </body>
</html>
