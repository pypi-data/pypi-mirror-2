<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    lang="en"
    metal:use-macro="here/prefs_main_template/macros/master"
    i18n:domain="PloneInvite">

<metal:block metal:fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<body>

<div metal:fill-slot="prefs_configlet_content"
    tal:define="Batch python:modules['Products.CMFPlone'].Batch;
                b_start request/b_start | python:0;
                b_size request/b_size | python:20;">

      <div id="content" class="documentEditable"
           tal:condition="python:checkPermission('PortalInvite: Manage Member Invites', here)">
    <!-- simulating views on the groups/user pages until we have real objects. -->

    <div id="region-content">
      <a name="documentContent"></a>

      <div metal:use-macro="here/global_statusmessage/macros/portal_message">
        Portal status message
      </div>

      <div class="configlet">
        <h1 i18n:translate="heading_existing_invites">Manage existing invites</h1>

        <p><a href="user_invites"
           i18n:translate="heading_give_invites">Give new invites to members</a></p> 

        <form action=""
              name="manage_invites"
              method="post"
              tal:attributes="action template/getId"
              tal:define="plone_invites python:here.plone_invite.getInvites(used=0);
                          batch python:Batch(plone_invites, b_size, int(b_start), orphan=1)">
        <fieldset>
            <legend i18n:translate="legend_existing_invites">Delete Existing Invites</legend>

            <div class="field"
                 tal:define="error errors/invites | nothing;"
                 tal:attributes="class python:test(error, 'field error', 'field')">
                    
             <label i18n:translate="label_delete_invites">Delete invite codes</label>
                <div class="formHelp" i18n:translate="help_delete_invites">
                Select invites you would like to delete.
                </div>
    
                <div tal:content="error">Validation error output</div>
           
          <table class="listing" summary="User Listing">
          <tal:block>
          <tr>
            <th i18n:translate="listingheader_sender">Sender</th>
            <th i18n:translate="listingheader_sent_address">Sent Address</th>
            <th i18n:translate="listingheader_enforce_address">Enforce email address</th>
            <th i18n:translate="listingheader_sent">Sent</th>
            <th i18n:translate="listingheader_used">Used</th>
            <th i18n:translate="listingheader_expired">Expired</th>
            <th i18n:translate="listingheader_delete">Delete</th>                          
          </tr>
          </tal:block>

          <tal:block repeat="invite batch">
          <tr tal:define="oddrow repeat/invite/odd;
                          userid invite/sender;"
              tal:attributes="class python:test(oddrow,'odd','even')">
            <td tal:content="invite/sender">Sender</td>
            <td tal:content="invite/sent_address">Sent to address</td>
            <td i18n:translate="" tal:content="python:test(invite['enforce_address'],'Yes','No')">Enforce email address</td>
            <td i18n:translate="" tal:content="python:test(invite['sent'],'Yes','No')">Sent</td>
            <td i18n:translate="" tal:content="python:test(invite['used'], 'Yes','No')">Used</td>
            <td i18n:translate="" tal:content="python:test((invite['sent'] and (invite['xdate']<DateTime() or invite['used'])), 'Yes', 'No')"></td>
            <td class="listingCheckbox">
              <input type="checkbox"
                             class="noborder notify"
                             name="delete:list"
                             value=""
                             tal:attributes="value invite/id" />
            </td>
          </tr>
        </tal:block>
                <tr tal:condition="not:batch">
                    <td colspan="8" i18n:translate="text_noplone_invites"
                        style="text-align:center;">No unused member invites.</td>
                </tr>
          </table>

          <div metal:use-macro="here/batch_macros/macros/navigation" />

          </div>

                    
          <input 
             tabindex=""
             type="submit"
             name="form.button.Invites"
             value="Delete these invites"
             i18n:attributes="value button_delete_invites;"
             tal:attributes="tabindex tabindex/next;"
             tal:condition="batch"
        />
        </fieldset>
        <input type="hidden" name="form.submitted" value="1" />
                
        </form>
        <div tal:define="plone_invites python:here.plone_invite.getInvites(used=1);
                batch python:Batch(plone_invites, b_size, int(b_start), orphan=1)">
        <fieldset>
            <legend i18n:translate="legend_used_invites">Used Invites</legend>

                    
             <label i18n:translate="label_used_invites">Used invites</label>
                <div class="formHelp" i18n:translate="help_used_invites">
                    These are invites that have already been used.
                </div>
    
           
          <table class="listing" summary="User Listing">
          <tal:block>
          <tr>
            <th i18n:translate="listingheader_sender">Sender</th>
            <th i18n:translate="listingheader_recipient">Recipient</th>
            <th i18n:translate="listingheader_sent_address">Sent to address</th>
            <th i18n:translate="listingheader_enforce_address">Enforce email address</th>
            <th i18n:translate="listingheader_sent">Sent</th>
            <th i18n:translate="listingheader_used">Used</th>
            <th i18n:translate="listingheader_expired">Expired</th>
          </tr>
          </tal:block>

          <tal:block repeat="invite batch">
          <tr tal:define="oddrow repeat/invite/odd;
                          userid invite/sender;"
              tal:attributes="class python:test(oddrow,'odd','even')">
            <td tal:content="invite/sender">Sender</td>
            <td tal:content="invite/recipient">Recipient</td>
            <td tal:content="invite/sent_address">Sent Address</td>
            <td i18n:translate="" tal:content="python:test(invite['enforce_address'],'Yes','No')">Enforce email address</td>
            <td i18n:translate="" tal:content="python:test(invite['sent'],'Yes','No')">Sent</td>
            <td i18n:translate="" tal:content="python:test(invite['used'], 'Yes','No')">Used</td>
            <td i18n:translate="" tal:content="python:test((invite['sent'] and (invite['xdate']<DateTime() or invite['used'])), 'Yes', 'No')"></td>
          </tr>
        </tal:block>
                <tr tal:condition="not:batch">
                    <td colspan="8" i18n:translate="text_noplone_invites"
                        style="text-align:center;">No used invites.</td>
                </tr>
          </table>

          <div metal:use-macro="here/batch_macros/macros/navigation" />



        </fieldset>
      </div>
                
      </div>
    </div>
      </div>

    </div>

  </body>
</html>

