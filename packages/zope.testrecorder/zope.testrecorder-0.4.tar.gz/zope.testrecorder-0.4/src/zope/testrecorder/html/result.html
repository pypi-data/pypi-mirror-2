<html>
<head>

<title>Test Recording</title>

<link rel="stylesheet" type="text/css" href="./style.css" />

<script type="text/javascript" src="./recorder.js"></script>
<script language="javascript" type="text/javascript"><!--

// ---------------------------------------------------------------------------
// GenericRenderer -- renders tests in a neutral intermediate format.
// ---------------------------------------------------------------------------

function GenericRenderer(document) {
  this.document = document;
  this.recorder = top.frames["control"].recorder;
  this.title = this.recorder.testcase.title;
  this.items = this.recorder.testcase.items;
  this.skip = [];
  this.row_odd_even = false;
}

generic = new GenericRenderer(document);

GenericRenderer.prototype.repr = function(text) {
  // todo: handle non--strings & quoting
  return "'" + text + "'";
}

var d = {};
d[TestRecorder.EventTypes.OpenUrl] = "openUrl";
d[TestRecorder.EventTypes.Click] = "click";
d[TestRecorder.EventTypes.Change] = "change";
d[TestRecorder.EventTypes.Comment] = "comment";
d[TestRecorder.EventTypes.Submit] = "submit";
d[TestRecorder.EventTypes.CheckPageTitle] = "checkPageTitle";
d[TestRecorder.EventTypes.CheckPageLocation] = "checkPageLocation";
d[TestRecorder.EventTypes.CheckTextPresent] = "checkTextPresent";
d[TestRecorder.EventTypes.CheckValue] = "checkValue";
d[TestRecorder.EventTypes.CheckValueContains] = "checkValueContains";
d[TestRecorder.EventTypes.CheckText] = "checkText";
d[TestRecorder.EventTypes.CheckHref] = "checkHref";
d[TestRecorder.EventTypes.CheckEnabled] = "checkEnabled";
d[TestRecorder.EventTypes.CheckDisabled] = "checkDisabled";
d[TestRecorder.EventTypes.CheckSelectValue] = "checkSelectValue";
d[TestRecorder.EventTypes.CheckSelectOptions] = "checkSelectOptions";
d[TestRecorder.EventTypes.CheckImageSrc] = "checkImageSrc";
GenericRenderer.prototype.dispatch = d;

GenericRenderer.prototype.render = function() {
  var root = this.document.getElementById("items");
  for (var i=0; i < this.items.length; i++) {
    var item = this.items[i];
    if (this.dispatch[item.type]) {
      var txt = this[this.dispatch[item.type]](item);
      var r = this.row(item, txt, i);
      root.appendChild(r);
    }
  }
}

GenericRenderer.prototype.row = function(item, txt, i) {
  this.row_odd_even = !this.row_odd_even;
  var bgcolor = this.row_odd_even ? "#c0c0c0" : "#ffffff";
  var tr = this.document.createElement("tr");
  tr.style.backgroundColor = bgcolor;
  var td = this.document.createElement("td");
  td.setAttribute("width", "16");
  tr.appendChild(td);
  var cb = this.document.createElement("input");
  cb.setAttribute("type", "checkbox");
  cb.setAttribute("name", "item");
  cb.setAttribute("value", i);
  cb.onclick = this.toggle;
  td.appendChild(cb);
  td = this.document.createElement("td");
  var tn = this.document.createTextNode(txt);
  td.appendChild(tn);
  tr.appendChild(td);
  return tr;
}

GenericRenderer.prototype.toggle = function(e) {
  var t = this;
  var row = t.parentNode.parentNode;

  var i = parseInt(t.value);
  if (generic.skip[i]) {
    row.style.backgroundColor = row.getAttribute("original_bgcolor");
    generic.skip[i] = false;
  }
  else {
    row.setAttribute("original_bgcolor", row.style.backgroundColor);
    row.style.backgroundColor = '#ff0000';
    generic.skip[i] = true;
  }
  return true;
}


GenericRenderer.prototype.bestId = function(item) {
  if (item.info && item.info.id)
    return item.info.id;
  if (item.info && item.info.name)
    return item.info.name;
  if (item.info && item.info.href)
    return item.text;
  return 'unknown';
}

GenericRenderer.prototype.niceId = function(item) {
  var id = this.repr(this.bestId(item));
  if (item.info && item.info.type) {
    var type = item.info.type;
    if ((type == "submit") || (type == "image")) {
      return "submit button " + id;
    }
    else if (item.type == "text") {
      return "text input " + id;
    }
    return item.info.type + " " + id;
  }
  if (item.info && item.info.href) {
    return "link " + id;
  }
  return id;
}

GenericRenderer.prototype.openUrl = function(item) {
  return "Open url " + this.repr(item.url);
}

GenericRenderer.prototype.click = function(item) {
  return "Click " + this.niceId(item);
}

GenericRenderer.prototype.change = function(item) {
  var id = this.niceId(item);
  var v = this.repr(item.value);
  return "Change " + id + " to " + v;
}

GenericRenderer.prototype.submit = function(item) {
  var id = this.niceId(item);
  return "Submit form " + id;
}

GenericRenderer.prototype.comment = function(item) {
  return "Comment: " + item.text;
}

GenericRenderer.prototype.checkPageTitle = function(item) {
  var title = this.repr(item.title);
  return "Check page title == " + title;
}

GenericRenderer.prototype.checkPageLocation = function(item) {
  var url = this.repr(item.url);
  return "Check page location == " + url;
}

GenericRenderer.prototype.checkTextPresent = function(item) {
  return "Check text appears on page: " + this.repr(item.text);
}

GenericRenderer.prototype.checkValue = function(item) {
  var id = this.niceId(item);
  var v = this.repr(item.info.value);
  return "Check value of " + id + " == " + v;
}

GenericRenderer.prototype.checkValueContains = function(item) {
  var id = this.niceId(item);
  var v = this.repr(item.text);
  return "Check value of " + id + " contains " + v;
}

GenericRenderer.prototype.checkText = function(item) {
  var id = this.niceId(item);
  var v = this.repr(item.text);
  return "Check text of " + id + " == " + v;
}

GenericRenderer.prototype.checkHref = function(item) {
  var id = this.niceId(item);
  var v = this.repr(item.info.href);
  return "Check href of " + id;
}

GenericRenderer.prototype.checkEnabled = function(item) {
  var id = this.niceId(item);
  return "Check enabled: " + id;
}

GenericRenderer.prototype.checkDisabled = function(item) {
  var id = this.niceId(item);
  return "check disabled: " + id;
}

GenericRenderer.prototype.checkSelectValue = function(item) {
  var id = this.repr(this.bestId(item));
  var v = this.repr(item.info.value);
  return "Check selected value of " + id + " == " + v;
}

GenericRenderer.prototype.checkSelectOptions = function(item) {
  var id = this.repr(this.bestId(item));
  var so = "Check select options for " + id + " == [";
  for (var i=0; i < item.info.options.length; i++) {
    var o = item.info.options[i];
    if (i > 0) {
      so = so + ", ";
    }
      so = so + "'" + o.value + "'";
  }
  return so + "]";
}

GenericRenderer.prototype.checkImageSrc = function(item) {
  var id = this.bestId(item);
  var src = this.repr(item.src);
  return "Check image src == " + src;
}

// page-level code

function onpageload() {
  generic.render();
}

function render() {
  var fmt = document.forms[0].elements["format"];
  var url = "./" + fmt.options[fmt.selectedIndex].value + ".html";
  document.location.href = url;
}


//--></script>
</head>
<body onload="onpageload()">

<div id="header">
<p>
The results of the test recording are listed below. Select an output format
and click <strong>render</strong> to render the test.
</p>
</div>

<form>
<div id="format">
<p>
<select name="format">
  <option value="doctest">Python Doctest</option>
  <option value="selenium">Selenium Test</option>
</select>
<input type="submit" name="submit" value="Render"
 onclick="render(); return false;">
</p>
</div>

<div>
<table width="98%" cellpadding="4" cellspacing="0" border="0" class="results">
<tbody id="items"></tbody>
</table>
</div>

</form>
</body>
</html>
