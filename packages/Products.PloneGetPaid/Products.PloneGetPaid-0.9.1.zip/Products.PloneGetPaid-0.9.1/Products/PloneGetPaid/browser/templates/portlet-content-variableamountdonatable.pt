<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plonegetpaid">

<body>
<div metal:define-macro="portlet" tal:condition="view/payable">

    <dl class="portlet" id="portlet-cart">

        <dt class="portletHeader">
            <span class="portletTopLeft"></span>
        <span class="portletTopMiddle"
              i18n:translate="text_product_details">Product Details</span>
            <span class="portletTopRight"></span>
        </dt>

        <dd class="portletItem odd">
          <div>

            <p tal:define="field context/Title"
               tal:condition="field"
               tal:content="field"
               />

            <p tal:define="field view/payable/donation_text"
               tal:condition="field">
               <i tal:content="field" />
            </p>

            <p tal:define="field python: '%.2f' % (getattr(view.payable,'price',0) or 0)"
	       i18n:translate="text_price">

            <script type="text/javascript">
            function submitDonation() {
              /* 
                 This will probably need work for international since I 
                 remove ',' and assume '.' seperates the decimal
              */
              var input = jq("#donation_amount")[0].value;

              input = input.replace(/[^0-9.]+/g, '');
              var amount = parseFloat(input);

              if (amount == NaN) {
                alert("Invalid input:" + input); 
              } else {
		var url = window.location.toString();
		if (url.charAt(url.length - 1) != '/') {
		  url += '/';
		}
                window.location = url + "@@getpaid-cart-add?add_item=True&amount=" + amount;
              }
            
            }

            </script>

                 <form action="javascript:submitDonation();">
                 Donation: <input id="donation_amount"
                                    type="text" 
                                    name="donation_amount"
                                    tal:attributes="value field" 
                                    i18n:name="value_price" />
                 </form>
            </p>

          </div>
        </dd>

        <dd class="portletFooter">

            <span style="cursor:pointer;" onclick="javascript:submitDonation();" i18n:translate="label_donate!">
               Donate!
            </span>
            <span class="portletBottomLeft"></span>
            <span class="portletBottomRight"></span>
        </dd>
    </dl>

</div>
</body>
</html>
