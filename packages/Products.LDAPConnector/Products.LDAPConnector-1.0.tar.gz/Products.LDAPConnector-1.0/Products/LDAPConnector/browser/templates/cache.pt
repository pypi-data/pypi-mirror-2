<h1 tal:replace="structure context/manage_page_header">HEADER</h1>
<h1 tal:define="management_view string:Cache"
    tal:replace="structure context/manage_tabs">TABS</h1>

<p class="form-help">
  Use this view to determine how long LDAP search results are cached
  and examine the cache contents.<br/> 
  <i>Please note: Changing the cache timeout does not affect records
  already in  the cache.</i>
</p>

<form action="manage_cache" method="post">
  <span class="form-label"> Cache timeout (seconds) </span>
  <input type="text" size="10" name="cache_timeout" value=""
         tal:attributes="value view/getCacheTimeout"/>
  <input type="submit" value=" Change "/>
</form>

<p><br/></p>

<script type="text/javascript">
<!--
    function toggle_visibility(id) {
       var e = document.getElementById(id);
       var plus = document.getElementById(id + '_plus');
       var minus = document.getElementById(id + '_minus');
       if(e.style.display == '') {
          e.style.display = 'none';
          plus.style.display = '';
          minus.style.display = 'none';
       }
       else {
          e.style.display = '';
          plus.style.display = 'none';
          minus.style.display = '';
       }
    }
//-->
</script>

<form action="manage_cache" method="post">

  <table cellspacing="0" cellpadding="2" width="98%"
         tal:define="cached view/getCacheItems;
                     timeout view/getCacheTimeout">

    <tr class="list-header">
      <td colspan="3" class="form-label"> Cache contents </td>
    </tr>

    <tr tal:repeat="rec cached">
      <td width="16" valign="top">
        <input type="checkbox" name="identifiers:list" value=""
               tal:attributes="value rec/key"/>
      </td>
      <td width="16" valign="top">
        <a href="#" id="" onClick=""
          tal:condition="rec/size|nothing"
          tal:attributes="onClick string:toggle_visibility('${rec/key}');; return false;;"
           ><img src="/p_/pl" alt="+" border="0" id=""
                 tal:attributes="id string:${rec/key}_plus" 
                 /><img src="/p_/mi" alt="-" border="0" style="display: none;" id=""
                       tal:attributes="id string:${rec/key}_minus"/></a>

      </td>
      <td class="form-text">
        <strong>
        <a href="#" onClick=""
           tal:attributes="onClick string:toggle_visibility('${rec/key}');; return false;;"
           tal:content="string:${rec/fltr} scope ${rec/scope} from ${rec/base} bound as ${rec/bound_as}"
           >dc=localhost</a>
        </strong>
        <i tal:condition="rec/size|nothing"
           tal:content="string: (${rec/size} values)">(10 values)</i>
        <i style="color:red;"
           tal:condition="rec/exception|nothing"
           tal:content="string:(${rec/exception})">(Error!)</i>
        <div id="" style="display: none;"
             tal:attributes="id rec/key">
          <tal:block repeat="dn rec/dns">
            <span tal:replace="dn"/><br/>
          </tal:block>
        </div>
      </td>
    </tr>

    <tr tal:condition="cached|nothing">
      <td width="16" class="form-label"> </td>
      <td colspan="2" class="form-label">
        <input type="submit" name="invalidate_selected" value=" Delete "/>
        <input type="submit" name="invalidate_all" value=" Delete all "/>
      </td>
    </tr>

    <tr tal:condition="not:timeout|nothing">
      <td colspan="3" class="form-text">
        Caching is disabled. Enable caching by setting a cache timeout
        value &gt;0 (see above).
      </td>
    </tr>

    <tr tal:condition="not: cached|nothing">
      <td colspan="3" class="form-text">
        The cache is empty.
      </td>
    </tr>

  </table>

</form>

<h1 tal:replace="structure context/manage_page_footer">FOOTER</h1>
