<h1 tal:replace="structure context/manage_page_header">HEADER</h1>
<h1 tal:define="management_view string:Servers"
    tal:replace="structure context/manage_tabs">TABS</h1>

<p class="form-help">
  Use this view to manage LDAP server configurations.
</p>

<form action="manage_servers" method="post">

  <table cellspacing="0" cellpadding="2" width="98%"
         tal:define="servers view/getServers">

    <tr class="list-header">
      <td colspan="5" class="form-label"> 
        LDAP server definitions 
        <span class="form-help">
          (Currently connected to: <span tal:replace="view/getConnectedServer"/>)
        </span>
      </td>
    </tr>

    <tr tal:condition="servers|nothing">
      <td width="16" class="form-label"> </td>
      <td class="form-label">URL</td>
      <td class="form-label">Connect timeout (secs)</td>
      <td class="form-label">Operations timeout (secs)</td>
      <td class="form-label">Status</td>
    </tr>

    <tr tal:repeat="svr servers">
      <td width="16">
        <input type="checkbox" name="identifiers:list" value=""
               tal:attributes="value svr/url"/>
      </td>
      <td class="form-text">
        <span tal:replace="svr/url">ldap://localhost:389/ </span>
        <span tal:condition="svr/start_tls">(StartTLS)</span>
      </td>
      <td class="form-text" 
          tal:define="tm python: int(svr['conn_timeout']);
                      tm_str python: tm > -1 and tm or 'No timeout'"
          tal:content="tm_str"> 
        5 
      </td>
      <td class="form-text" 
          tal:define="tm python: int(svr['op_timeout']);
                      tm_str python: tm > -1 and tm or 'No timeout'"
          tal:content="tm_str"> 
        5 
      </td>
      <td class="form-text" tal:content="svr/status">OK</td>
          
    </tr>

    <tr tal:condition="servers|nothing">
      <td width="16"> </td>
      <td colspan="4"> 
        <input type="submit" value=" Delete " name="svr_remove"> 
      </td>
    </tr>

    <tr tal:condition="not: servers|nothing">
      <td colspan="5" class="form-text">
        No servers defined
      </td>
    </tr>

  </table>

</form>

<p><br/></p>

<form action="manage_servers" method="post">

  <table cellspacing="0" cellpadding="2" width="98%">

    <tr class="list-header">
      <td colspan="2" class="form-label"> Add LDAP server definition </td>
    </tr>

    <tr>
      <td class="form-label">
        Host, IP or filesystem socket path
      </td>
      <td class="form-element">
        <input type="text" size="40" name="host" value="my.ldap.server">
      </td>
    </tr>

    <tr>
      <td class="form-label">
        Port
      </td>
      <td class="form-element">
        <input type="text" size="6" name="port" value="389">
      </td>
    </tr>

    <tr>
      <td class="form-label">
        Protocol
      </td>
      <td class="form-element">
        <select name="protocol">
          <option value="ldap" selected> ldap: LDAP </option>
          <option value="ldaptls"> 
            ldaptls: LDAP with StartTLS negotiated encryption 
          </option>
          <option value="ldaps"> 
            ldaps: LDAP with permanent encryption over SSL 
          </option>
          <option value="ldapi"> 
            ldapi: LDAP over IPC (filesystem socket)
          </option>
        </select>
      </td>
    </tr>

    <tr>
      <td class="form-label">
        Connection Timeout
      </td>
      <td class="form-element">
        <select name="connection_timeout:int">
          <option value="2"> 2 seconds </option>
          <option value="5" selected> 5 seconds </option>
          <option value="10"> 10 seconds </option>
          <option value="30"> 30 seconds </option>
          <option value="60"> 60 seconds </option>
          <option value="-1"> No timeout </option>
        </select>
      </td>
    </tr>

    <tr>
      <td class="form-label">
        Operation Timeout
      </td>
      <td class="form-element">
        <select name="operations_timeout:int">
          <option value="5"> 5 seconds </option>
          <option value="10"> 10 seconds </option>
          <option value="30"> 30 seconds </option>
          <option value="60"> 60 seconds </option>
          <option value="120"> 120 seconds </option>
          <option value="300"> 300 seconds </option>
          <option value="-1" selected> No timeout </option>
        </select>
      </td>
    </tr>

    <tr>
      <td colspan="2">
        <input type="submit" name=" Add " value=" Add Server " name="svr_add">
      </td>
    </tr>

  </table>

</form>

<h1 tal:replace="structure context/manage_page_footer">FOOTER</h1>
