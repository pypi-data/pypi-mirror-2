

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>List styles &mdash; mailman v3.0.0a6 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.0.0a6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="mailman v3.0.0a6 documentation" href="../../index.html" />
    <link rel="next" title="System versions" href="system.html" />
    <link rel="prev" title="Pipelines" href="pipelines.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="system.html" title="System versions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pipelines.html" title="Pipelines"
             accesskey="P">previous</a> |</li>
        <li><a href="../../docs/README.html">mailman v3.0.0a6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="list-styles">
<h1>List styles<a class="headerlink" href="#list-styles" title="Permalink to this headline">¶</a></h1>
<p>List styles are a way to name and apply a canned collection of attribute
settings.  Every style has a name, which must be unique within the context of
a specific style manager.  There is usually only one global style manager.</p>
<p>Styles also have a priority, which allows you to specify the order in which
multiple styles will be applied.  A style has a <cite>match</cite> function which is used
to determine whether the style should be applied to a particular mailing list
or not.  And finally, application of a style to a mailing list can really
modify the mailing list any way it wants.</p>
<p>Let&#8217;s start with a vanilla mailing list and a default style manager.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mailman.interfaces.listmanager</span> <span class="kn">import</span> <span class="n">IListManager</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">getUtility</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mlist</span> <span class="o">=</span> <span class="n">getUtility</span><span class="p">(</span><span class="n">IListManager</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;_xtest@example.com&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mailman.styles.manager</span> <span class="kn">import</span> <span class="n">StyleManager</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">style_manager</span> <span class="o">=</span> <span class="n">StyleManager</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">style_manager</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">styles</span><span class="p">)</span>
<span class="go">[&#39;default&#39;]</span>
</pre></div>
</div>
<div class="section" id="the-default-style">
<h2>The default style<a class="headerlink" href="#the-default-style" title="Permalink to this headline">¶</a></h2>
<p>There is a default style which implements the legacy application of list
defaults from previous versions of Mailman.  This style only matching a
mailing list when no other styles match, and it has the lowest priority.  The
low priority means that it is matched last and if it matches, it is applied
last.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">default_style</span> <span class="o">=</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">default_style</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;default&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">default_style</span><span class="o">.</span><span class="n">priority</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">styles</span><span class="p">)</span>
<span class="go">[&#39;default&#39;]</span>
</pre></div>
</div>
<p>Given a mailing list, you can ask the style manager to find all the styles
that match the list.  The registered styles will be sorted by decreasing
priority and each style&#8217;s <tt class="docutils literal"><span class="pre">match()</span></tt> method will be called in turn.  The
sorted list of matching styles will be returned &#8211; but not applied &#8211; by the
style manager&#8217;s <tt class="docutils literal"><span class="pre">lookup()</span></tt> method.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">style</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">mlist</span><span class="p">)]</span>
<span class="go">[&#39;default&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="registering-styles">
<h2>Registering styles<a class="headerlink" href="#registering-styles" title="Permalink to this headline">¶</a></h2>
<p>New styles must implement the <tt class="docutils literal"><span class="pre">IStyle</span></tt> interface.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implements</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mailman.interfaces.styles</span> <span class="kn">import</span> <span class="n">IStyle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">TestStyle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">implements</span><span class="p">(</span><span class="n">IStyle</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;test&#39;</span>
<span class="gp">... </span>    <span class="n">priority</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mailing_list</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Just does something very simple.</span>
<span class="gp">... </span>        <span class="n">mailing_list</span><span class="o">.</span><span class="n">msg_footer</span> <span class="o">=</span> <span class="s">&#39;test footer&#39;</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mailing_list</span><span class="p">,</span> <span class="n">styles</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Applies to any test list</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="s">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">mailing_list</span><span class="o">.</span><span class="n">fqdn_listname</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>You can register a new style with the style manager.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">style_manager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TestStyle</span><span class="p">())</span>
</pre></div>
</div>
<p>And now if you lookup matching styles, you should find only the new test
style.  This is because the default style only gets applied when no other
styles match the mailing list.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">mlist</span><span class="p">))</span>
<span class="go">[u&#39;test&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">mlist</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">style</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mlist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">mlist</span><span class="o">.</span><span class="n">msg_footer</span>
<span class="go">test footer</span>
</pre></div>
</div>
</div>
<div class="section" id="style-priority">
<h2>Style priority<a class="headerlink" href="#style-priority" title="Permalink to this headline">¶</a></h2>
<p>When multiple styles match a particular mailing list, they are applied in
descending order of priority.  In other words, a priority zero style would be
applied last.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">AnotherTestStyle</span><span class="p">(</span><span class="n">TestStyle</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;another&#39;</span>
<span class="gp">... </span>    <span class="n">priority</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">... </span>    <span class="c"># Use the base class&#39;s match() method.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mailing_list</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">mailing_list</span><span class="o">.</span><span class="n">msg_footer</span> <span class="o">=</span> <span class="s">&#39;another footer&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">mlist</span><span class="o">.</span><span class="n">msg_footer</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mlist</span><span class="o">.</span><span class="n">msg_footer</span>
<span class="go">u&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">style_manager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">AnotherTestStyle</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">mlist</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">style</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mlist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">mlist</span><span class="o">.</span><span class="n">msg_footer</span>
<span class="go">another footer</span>
</pre></div>
</div>
<p>You can change the priority of a style, and if you reapply the styles, they
will take effect in the new priority order.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">style_1</span> <span class="o">=</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">style_1</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">style_2</span> <span class="o">=</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;another&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">style_2</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">mlist</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">style</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mlist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">mlist</span><span class="o">.</span><span class="n">msg_footer</span>
<span class="go">test footer</span>
</pre></div>
</div>
</div>
<div class="section" id="unregistering-styles">
<h2>Unregistering styles<a class="headerlink" href="#unregistering-styles" title="Permalink to this headline">¶</a></h2>
<p>You can unregister a style, making it unavailable in the future.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">style_manager</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">style_2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">style_manager</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">mlist</span><span class="p">))</span>
<span class="go">[u&#39;test&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="corner-cases">
<h2>Corner cases<a class="headerlink" href="#corner-cases" title="Permalink to this headline">¶</a></h2>
<p>If you register a style with the same name as an already registered style, you
get an exception.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">style_manager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TestStyle</span><span class="p">())</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">DuplicateStyleError</span>: <span class="n-Identifier">test</span>
</pre></div>
</div>
<p>If you try to register an object that isn&#8217;t a style, you get an exception.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">style_manager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">object</span><span class="p">())</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">DoesNotImplement</span>: <span class="n-Identifier">An object does not implement interface</span>
<span class="go">&lt;InterfaceClass mailman.interfaces.styles.IStyle&gt;</span>
</pre></div>
</div>
<p>If you try to unregister a style that isn&#8217;t registered, you get an exception.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">style_manager</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">style_2</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">KeyError</span>: <span class="n-Identifier">u&#39;another&#39;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../docs/README.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">List styles</a><ul>
<li><a class="reference internal" href="#the-default-style">The default style</a></li>
<li><a class="reference internal" href="#registering-styles">Registering styles</a></li>
<li><a class="reference internal" href="#style-priority">Style priority</a></li>
<li><a class="reference internal" href="#unregistering-styles">Unregistering styles</a></li>
<li><a class="reference internal" href="#corner-cases">Corner cases</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pipelines.html"
                        title="previous chapter">Pipelines</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="system.html"
                        title="next chapter">System versions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/app/docs/styles.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="system.html" title="System versions"
             >next</a> |</li>
        <li class="right" >
          <a href="pipelines.html" title="Pipelines"
             >previous</a> |</li>
        <li><a href="../../docs/README.html">mailman v3.0.0a6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright The Mailman Developers.
      Last updated on Sep 20, 2010.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>