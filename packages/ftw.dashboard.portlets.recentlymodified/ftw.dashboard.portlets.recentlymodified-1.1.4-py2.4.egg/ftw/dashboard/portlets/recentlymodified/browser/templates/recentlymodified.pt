<dl class="portlet portletRecent"
    tal:define="use_view_action python: context.portal_properties.site_properties.getProperty('typesUseViewActionInListings', ())"
    i18n:domain="plone">

    <dt class="portletHeader clearfix">
	  	<span class="portletTopLeft"></span>
        <span tal:content="view/title">Recent Changes</span>
      	<span class="portletTopRight"></span>
    </dt>

    <tal:items tal:define="plone_view context/@@plone;
                           getIcon nocall:plone_view/getIcon;
                           normalizeString nocall:plone_view/normalizeString;
                           toLocalizedTime nocall:plone_view/toLocalizedTime;"
               tal:repeat="obj view/recent_items">

        <dd class="portletItem"
            tal:define="oddrow repeat/obj/odd;
                        item_icon python:getIcon(obj);
                        item_wf_state obj/review_state;
                        item_wf_state_class python:'state-' + normalizeString(item_wf_state);"
            tal:attributes="class python:oddrow and  'portletItem even' or 'portletItem odd'">
            
            <span class="title">
                <img tal:replace="structure item_icon/html_tag" />
                <tal:def tal:define="preview_link python: (context.portal_properties.get('ftw.dashboard', False) and context.portal_properties.get('ftw.dashboard').getProperty('preview_link', False))" >
                    <tal:cond tal:condition="preview_link">
                        <a tal:attributes="href string:${obj/getURL}/quick_preview"
                           class="recentlymodified_item" title="Vorschau zeigen">
                            <img tal:attributes="src string:${context/absolute_url}/info_icon.gif" alt=""/>
                        </a>
                        <a href=""
                           tal:attributes="href python: obj.portal_type in use_view_action and '%s/view' % obj.getURL() or obj.getURL();
                                           title obj/Description;
                                           class string:$item_wf_state_class"
                            tal:content="obj/pretty_title_or_id">
                            Title
                        </a>
                    </tal:cond>
                    <tal:cond tal:condition="not: preview_link">
                        <a tal:attributes="href string:${obj/getURL}/quick_preview; title obj/Description;" tal:content="obj/pretty_title_or_id" class="recentlymodified_item" title="Vorschau zeigen">
                            <img tal:attributes="src string:${context/absolute_url}/info_icon.gif" alt=""/>
                        </a>
                    </tal:cond>
                </tal:def>
                <span class="portletItemDetails"
                      tal:content="python:toLocalizedTime(obj.ModificationDate)"
                      >May 5</span>
            </span>
        </dd>
    </tal:items>

    <dd class="portletItem"
        tal:condition="not: view/recent_items"
        i18n:translate="box_recent_no_items">
        No items changed yet.
    </dd>

    <dd class="portletFooter" tal:condition="view/recent_items">
        <a href=""
           tal:attributes="href view/more_link"
           i18n:translate="box_morelink">
                More&hellip;
        </a>
    </dd>
</dl>
