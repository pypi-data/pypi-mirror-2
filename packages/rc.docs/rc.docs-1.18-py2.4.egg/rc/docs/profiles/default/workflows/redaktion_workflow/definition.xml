<?xml version="1.0"?>
<dc-workflow workflow_id="redaktion_workflow"
             title="Redaktion Workflow" description=""
             state_variable="review_state"
             initial_state="editing">
 <permission>Access contents information</permission>
 <permission>Modify portal content</permission>
 <permission>View</permission>
 <permission>List folder contents</permission>
 <state state_id="editing" title="in Bearbeitung">
  <description>in Bearbeitung</description>
  <exit-transition transition_id="show_int"/>
  <permission-map name="Access contents information"
                  acquired="True">
   <permission-role>Korrektor</permission-role>
   <permission-role>Lektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Owner</permission-role>
  </permission-map>
  <permission-map name="List folder contents"
                  acquired="False">
   <permission-role>Herausgeber</permission-role>
  </permission-map>
  <permission-map name="Modify portal content"
                  acquired="True">
   <permission-role>Korrektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Owner</permission-role>
  </permission-map>
  <permission-map name="View" acquired="True">
   <permission-role>Korrektor</permission-role>
   <permission-role>Lektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Owner</permission-role>
  </permission-map>
 </state>
 <state state_id="ext_publikation"
        title="Veroeffentlicht (extern)">
  <exit-transition transition_id="retract_int"/>
  <permission-map name="Access contents information"
                  acquired="False">
   <permission-role>Herausgeber</permission-role>
   <permission-role>Manager</permission-role>
  </permission-map>
  <permission-map name="List folder contents"
                  acquired="True">
  </permission-map>
  <permission-map name="Modify portal content"
                  acquired="False">
   <permission-role>Manager</permission-role>
  </permission-map>
  <permission-map name="View" acquired="False">
   <permission-role>Authenticated</permission-role>
   <permission-role>Autor</permission-role>
   <permission-role>Co-Autor</permission-role>
   <permission-role>Hauptredakteur</permission-role>
   <permission-role>Herausgeber</permission-role>
   <permission-role>Korrektor</permission-role>
   <permission-role>Lektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Owner</permission-role>
   <permission-role>Redakteur</permission-role>
   <permission-role>Reviewer</permission-role>
  </permission-map>
 </state>
 <state state_id="hauptredaktion" title="in Hauptredaktion">
  <exit-transition transition_id="publish_int"/>
  <exit-transition transition_id="reject_editing"/>
  <exit-transition transition_id="reject_redaktion"/>
  <exit-transition transition_id="retract"/>
  <exit-transition transition_id="retract_hredaktion"/>
  <permission-map name="Access contents information"
                  acquired="False">
   <permission-role>Hauptredakteur</permission-role>
   <permission-role>Korrektor</permission-role>
   <permission-role>Manager</permission-role>
  </permission-map>
  <permission-map name="List folder contents"
                  acquired="True">
  </permission-map>
  <permission-map name="Modify portal content"
                  acquired="False">
   <permission-role>Hauptredakteur</permission-role>
   <permission-role>Korrektor</permission-role>
   <permission-role>Manager</permission-role>
  </permission-map>
  <permission-map name="View" acquired="False">
   <permission-role>Autor</permission-role>
   <permission-role>Co-Autor</permission-role>
   <permission-role>Hauptredakteur</permission-role>
   <permission-role>Herausgeber</permission-role>
   <permission-role>Korrektor</permission-role>
   <permission-role>Lektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Owner</permission-role>
   <permission-role>Redakteur</permission-role>
  </permission-map>
 </state>
 <state state_id="int_publikation"
        title="Veroeffentlicht (intern)">
  <exit-transition transition_id="publish_ext"/>
  <exit-transition transition_id="reject_hredaktion"/>
  <exit-transition transition_id="reject_int_editing"/>
  <exit-transition transition_id="reject_int_redaktion"/>
  <exit-transition transition_id="retract"/>
  <exit-transition transition_id="retract_redaktion"/>
  <permission-map name="Access contents information"
                  acquired="False">
   <permission-role>Herausgeber</permission-role>
   <permission-role>Korrektor</permission-role>
   <permission-role>Manager</permission-role>
  </permission-map>
  <permission-map name="List folder contents"
                  acquired="True">
  </permission-map>
  <permission-map name="Modify portal content"
                  acquired="False">
   <permission-role>Herausgeber</permission-role>
   <permission-role>Korrektor</permission-role>
   <permission-role>Manager</permission-role>
  </permission-map>
  <permission-map name="View" acquired="False">
   <permission-role>Autor</permission-role>
   <permission-role>Co-Autor</permission-role>
   <permission-role>Hauptredakteur</permission-role>
   <permission-role>Herausgeber</permission-role>
   <permission-role>Korrektor</permission-role>
   <permission-role>Lektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Redakteur</permission-role>
  </permission-map>
 </state>
 <state state_id="redaktion" title="in Redaktion">
  <exit-transition transition_id="publish"/>
  <exit-transition transition_id="reject"/>
  <exit-transition transition_id="retract"/>
  <permission-map name="Access contents information"
                  acquired="False">
   <permission-role>Korrektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Redakteur</permission-role>
  </permission-map>
  <permission-map name="List folder contents"
                  acquired="True">
  </permission-map>
  <permission-map name="Modify portal content"
                  acquired="False">
   <permission-role>Korrektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Redakteur</permission-role>
  </permission-map>
  <permission-map name="View" acquired="False">
   <permission-role>Autor</permission-role>
   <permission-role>Co-Autor</permission-role>
   <permission-role>Hauptredakteur</permission-role>
   <permission-role>Herausgeber</permission-role>
   <permission-role>Korrektor</permission-role>
   <permission-role>Lektor</permission-role>
   <permission-role>Manager</permission-role>
   <permission-role>Redakteur</permission-role>
  </permission-map>
 </state>
 <transition transition_id="publish"
             title="Veroeffentlichen (Hauptredaktion)"
             new_state="hauptredaktion" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Veroeffentlichen (Hauptredaktion)</action>
  <guard>
   <guard-role>Redakteur</guard-role>
  </guard>
 </transition>
 <transition transition_id="publish_ext"
             title="Veroeffentlichen (extern)"
             new_state="ext_publikation" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Veroeffentlichen (extern)</action>
  <guard>
   <guard-role>Herausgeber</guard-role>
  </guard>
 </transition>
 <transition transition_id="publish_int"
             title="Veroeffentlichen (intern)"
             new_state="int_publikation" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Veroeffentlichen (intern)</action>
  <guard>
   <guard-role>Hauptredakteur</guard-role>
  </guard>
 </transition>
 <transition transition_id="reject" title="Ablehnen (Autor)"
             new_state="editing" trigger="USER"
             before_script="" after_script="">
  <action url="%(content_url)s/content_status_modify?workflow_action=reject"
          category="workflow">Ablehnen (Autor)</action>
  <guard>
   <guard-role>Redakteur</guard-role>
  </guard>
 </transition>
 <transition transition_id="reject_editing"
             title="Ablehnen (Autor)" new_state="editing"
             trigger="USER" before_script="" after_script="">
  <action url="%(content_url)s/content_status_modify?workflow_action=reject_editing"
          category="workflow">Ablehnen (Autor)</action>
  <guard>
   <guard-role>Hauptredakteur</guard-role>
  </guard>
 </transition>
 <transition transition_id="reject_hredaktion"
             title="Ablehnen (Hauptredaktion)"
             new_state="hauptredaktion" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Ablehnen (Hauptredaktion)</action>
  <guard>
   <guard-role>Herausgeber</guard-role>
  </guard>
 </transition>
 <transition transition_id="reject_int_editing"
             title="Ablehnen (Autor)" new_state="editing"
             trigger="USER" before_script="" after_script="">
  <action url="%(content_url)s/content_status_modify?workflow_action=reject_int_editing"
          category="workflow">Ablehnen (Autor)</action>
  <guard>
   <guard-role>Herausgeber</guard-role>
  </guard>
 </transition>
 <transition transition_id="reject_int_redaktion"
             title="Ablehnen (Redaktion)"
             new_state="redaktion" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Ablehnen (Redaktion)</action>
  <guard>
   <guard-role>Herausgeber</guard-role>
  </guard>
 </transition>
 <transition transition_id="reject_redaktion"
             title="Ablehnen (Redaktion)"
             new_state="redaktion" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Ablehnen (Redaktion)</action>
  <guard>
   <guard-role>Hauptredakteur</guard-role>
  </guard>
 </transition>
 <transition transition_id="retract" title="Zurueckziehen"
             new_state="editing" trigger="USER"
             before_script="" after_script="">
  <description>Das Dokument aus der Redaktion zurueckziehen.</description>
  <action url="" category="workflow">Zurueckziehen</action>
  <guard>
   <guard-role>Autor</guard-role>
  </guard>
 </transition>
 <transition transition_id="retract_hredaktion"
             title="Zurueckziehen (Redaktion)"
             new_state="redaktion" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Zurueckziehen (Redaktion)</action>
  <guard>
   <guard-role>Redakteur</guard-role>
  </guard>
 </transition>
 <transition transition_id="retract_int"
             title="Zurueckziehen (intern)"
             new_state="int_publikation" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Zurueckziehen (intern)</action>
  <guard>
   <guard-role>Herausgeber</guard-role>
  </guard>
 </transition>
 <transition transition_id="retract_redaktion"
             title="Zurueckziehen (Hauptredaktion)"
             new_state="hauptredaktion" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Zurueckziehen (Hauptredaktion)</action>
  <guard>
   <guard-role>Hauptredakteur</guard-role>
  </guard>
 </transition>
 <transition transition_id="show_int"
             title="Veroeffentlichen (Redaktion)"
             new_state="redaktion" trigger="USER"
             before_script="" after_script="">
  <action url="" category="workflow">Veroeffentlichen (Redaktion)</action>
  <guard>
   <guard-role>Autor</guard-role>
  </guard>
 </transition>
 <worklist worklist_id="int_publikation_queue" title="">
  <description>Intern veroeffentlichte Artikel</description>
  <action url="%(portal_url)s/search?review_state=int_redaktion"
          category="global">IntPublikation(%(count)d)</action>
  <guard>
   <guard-role>Herausgeber</guard-role>
  </guard>
  <match name="review_state" values="int_publikation"/>
 </worklist>
 <worklist worklist_id="redaktion_queue" title="">
  <description>Artikel in der Redaktion</description>
  <action url="%(portal_url)s/search?review_state=redaktion"
          category="global">Redaktion (%(count)d)</action>
  <guard>
   <guard-role>Redakteur</guard-role>
  </guard>
  <match name="review_state" values="redaktion"/>
 </worklist>
 <variable variable_id="action" for_catalog="False"
           for_status="True" update_always="True">
  <description>Previous transition</description>
  <default>
   
   <expression>transition/getId|nothing</expression>
  </default>
  <guard>
  </guard>
 </variable>
 <variable variable_id="actor" for_catalog="False"
           for_status="True" update_always="True">
  <description>The ID of the user who performed the last transition</description>
  <default>
   
   <expression>user/getId</expression>
  </default>
  <guard>
  </guard>
 </variable>
 <variable variable_id="comments" for_catalog="False"
           for_status="True" update_always="True">
  <description>Comment about the last transition </description>
  <default>
   
   <expression>python:state_change.kwargs.get('comment', '')</expression>
  </default>
  <guard>
  </guard>
 </variable>
 <variable variable_id="review_history" for_catalog="False"
           for_status="False" update_always="False">
  <description>Workflow History</description>
  <default>
   
   <expression>state_change/getHistory</expression>
  </default>
  <guard>
  </guard>
 </variable>
 <variable variable_id="time" for_catalog="False"
           for_status="True" update_always="True">
  <description>When the previous transition was performed </description>
  <default>
   
   <expression>state_change/getDateTime</expression>
  </default>
  <guard>
  </guard>
 </variable>
</dc-workflow>
