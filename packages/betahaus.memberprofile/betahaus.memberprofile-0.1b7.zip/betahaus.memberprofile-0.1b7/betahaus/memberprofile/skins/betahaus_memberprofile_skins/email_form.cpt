<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<head>
<!--    <metal:block fill-slot="top_slot"-->
<!--                 tal:define="dummy python:request.set('disable_border',1)" />-->
<!--    <metal:block fill-slot="column_one_slot" />-->
<!--    <metal:block fill-slot="column_two_slot" />-->
</head>

<body>

<div metal:fill-slot="main"
     tal:define="errors options/state/getErrors;
                 mailhost context/MailHost/smtp_host|nothing;
                 mailfrom context/email_from_address|nothing;
                 site_properties context/portal_properties/site_properties;
                 mailpw site_properties/validate_email;
                 mailconfigured python:mailhost and mailfrom;">

  <h1 class="documentFirstHeading"
      i18n:translate="heading_registration_form">Email Form</h1>


  <div tal:condition="not:mailconfigured">
    <p>
      This site has not configured its email settings. Until email has
      been configured it is not possible to send messages
    </p>
  </div>
  
  <form action=""
        class="enableAutoFocus enableUnloadProtection"
        method="post"
        tal:condition="mailconfigured"
        tal:attributes="action template_id"
        tal:define="label_send string:Send" >

<!--    <fieldset>-->


      <input type="hidden" name="came_from" value=""
             tal:condition="request/came_from|nothing"
             tal:attributes="value request/came_from" />
      <input type="hidden" name="last_visit:date" value="ZopeTime"
             tal:attributes="value here/ZopeTime" />
      <input type="hidden" name="prev_visit:date" value="ZopeTime"
             tal:attributes="value here/ZopeTime" />
      <input type="hidden" name="came_from_prefs" value=""
             tal:attributes="value request/came_from_prefs|nothing" />
 
      <!--
      <div class="row"
           tal:define="error errors/fullname| nothing;
                       fullname request/fullname | nothing;"
           tal:attributes="class python:test(error, 'field error', 'field')">

        <label for="fullname"
               i18n:translate="label_full_name">Full Name</label>

        <div class="formHelp" i18n:translate="help_full_name_creation">
          Enter full name, eg. John Smith.
        </div>

        <div tal:content="error">Validation error output</div>

        <input type="text"
               name="fullname"
               id="fullname"
               size="30"
               value="fullname"
               tal:attributes="value fullname;"
               />

      </div>
      -->
      
      
      
      <!-- To user-->
      <div class="field"
           tal:define="error errors/to_user | nothing;
                       to_user python:request.get('to_user', context.Creator());
                       authorinfo python: mtool.getMemberInfo(to_user);"
           tal:attributes="class python:test(error, 'field error', 'field')">

        <label for="to_user">To User</label>
              <div tal:content="error">Validation error output</div>
			  <div tal:content="authorinfo/fullname"/>
			  <input type="hidden" 
			  		 name="to_user" 
			  		 value=""
			  		 tal:attributes="value to_user;" 
			  		 />
             
      </div>
      
      <!-- Full Name -->
      <div class="field"
           tal:define="error errors/sender_fullname | nothing;
                       sender_fullname python:request.get('sender_fullname', member.getProperty('fullname',''));"
           tal:attributes="class python:test(error, 'field error', 'field')">

        <label for="subject">Full Name</label>

        <span class="fieldRequired" title="Required"
              i18n:attributes="title title_required;"
              i18n:translate="label_required">(Required)</span>


              <div tal:content="error">Validation error output</div>

              <input type="text"
                     name="sender_fullname"
                     id="sender_fullname"
                     size="50"
                     value="sender_fullname"
                     tal:attributes="value sender_fullname;"
                     />
      </div>

      <!-- Email -->
      <div class="field"
           tal:define="error errors/sender_email | nothing;
                       sender_email python:request.get('sender_email', member.getProperty('email',''));"
           tal:attributes="class python:test(error, 'field error', 'field')">

        <label for="subject">Your Email</label>

        <span class="fieldRequired" title="Required"
              i18n:attributes="title title_required;"
              i18n:translate="label_required">(Required)</span>


              <div tal:content="error">Validation error output</div>

              <input type="text"
                     name="sender_email"
                     id="sender_email"
                     size="50"
                     value="sender_email"
                     tal:attributes="value sender_email;"
                     />
      </div>      
      
      <!-- subject -->
      <div class="field"
           tal:define="error errors/subject | nothing;
                       subject request/subject | nothing;"
           tal:attributes="class python:test(error, 'field error', 'field')">

        <label for="subject">Subject</label>

<!--        <span class="fieldRequired" title="Required"-->
<!--              i18n:attributes="title title_required;"-->
<!--              i18n:translate="label_required">(Required)</span>-->


              <div tal:content="error">Validation error output</div>

              <input type="text"
                     name="subject"
                     id="subject"
                     size="50"
                     value="subject"
                     tal:attributes="value subject;"
                     />
      </div>

      <!-- text -->
      <div class="field"
           tal:define="error errors/body | nothing;
                       body request/body | nothing;"
           tal:attributes="class python:test(error, 'field error', 'field')">


        <label for="body">Text</label>

<!--        <span class="fieldRequired" title="Required"-->
<!--              i18n:attributes="title title_required;"-->
<!--              i18n:translate="label_required">(Required)</span>-->


              <div tal:content="error">Validation error output</div>
<!--                            <tal:define-->
<!--                                       define="binary python:True;-->
<!--                                       content string:;-->
<!--                                       inputname string:text;-->
<!--                                       inputvalue python:request.get('text', '');-->
<!--                                       tabindex tabindex/next;-->
<!--                                       rows string:2;-->
<!--                                       cols string:2;-->
<!--                                       ">-->
<!--                                <div metal:use-macro="here/wysiwyg_support/macros/wysiwygEditorBox"/>-->
<!--                            </tal:define>-->

                <textarea id="body" rows="10" name="body" 
                          tal:content="body">
                
                </textarea>
      </div>
      
<!--      <div tal:condition="isAnon">-->
<!--      <div metal:use-macro="here/captcha_widget/macros/captcha"></div>-->
<!--      </div>-->
      
      <div class="formControls">
        <input class="context"
               type="submit"
               name="form.button.Send"
               value="Send"
               i18n:attributes="value label_send;" />
      </div>

<!--    </fieldset>-->

    <input type="hidden" name="form.submitted" value="1" />

  </form>
</div>

</body>
</html>
