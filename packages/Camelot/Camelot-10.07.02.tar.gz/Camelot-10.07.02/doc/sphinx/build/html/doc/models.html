<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating models with Elixir/SQLAlchemy/Camelot &mdash; Camelot v0.1 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Camelot v0.1 documentation" href="../index.html" />
    <link rel="up" title="Camelot Documentation" href="index.html" />
    <link rel="next" title="Customizing the Admin classes" href="admin.html" />
    <link rel="prev" title="Camelot Installation" href="install.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="admin.html" title="Customizing the Admin classes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Camelot Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Camelot v0.1 documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Camelot Documentation contents</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Camelot Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-camelot.view.field_attributes">
<span id="doc-models"></span><h1>Creating models with Elixir/SQLAlchemy/Camelot<a class="headerlink" href="#module-camelot.view.field_attributes" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Release:</th><td class="field-body">0.1</td>
</tr>
<tr class="field"><th class="field-name">Date:</th><td class="field-body">July 02, 2010</td>
</tr>
</tbody>
</table>
<p>The <a class="reference external" href="http://elixir.ematia.de/trac/wiki/TutorialDivingIn">Elixir website</a> provides a complete overview of
the creation of models that should be read before reading this section.</p>
<p>This section describes the various field types that can be used to construct
models. Fields from SQLAlchemy and Camelot are described.</p>
<p>Field types handled through introspection :</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="44%" />
<col width="44%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Field type</strong></td>
<td><strong>Default delegate</strong></td>
<td><strong>Default editor</strong></td>
</tr>
<tr><td>BOOLEAN</td>
<td><a class="reference external" href="delegates.html#delegate-booldelegate"><em>BoolDelegate</em></a></td>
<td><img alt="../_images/BoolEditor_editable.png" class="first last" src="../_images/BoolEditor_editable.png" />
</td>
</tr>
<tr><td>Boolean</td>
<td><a class="reference external" href="delegates.html#delegate-booldelegate"><em>BoolDelegate</em></a></td>
<td><img alt="../_images/BoolEditor_editable.png" class="first last" src="../_images/BoolEditor_editable.png" />
</td>
</tr>
<tr><td>Code</td>
<td><a class="reference external" href="delegates.html#delegate-codedelegate"><em>CodeDelegate</em></a></td>
<td><img alt="../_images/CodeEditor_editable.png" class="first last" src="../_images/CodeEditor_editable.png" />
</td>
</tr>
<tr><td>Color</td>
<td><a class="reference external" href="delegates.html#delegate-colordelegate"><em>ColorDelegate</em></a></td>
<td><img alt="../_images/ColorEditor_editable.png" class="first last" src="../_images/ColorEditor_editable.png" />
</td>
</tr>
<tr><td>Date</td>
<td><a class="reference external" href="delegates.html#delegate-datedelegate"><em>DateDelegate</em></a></td>
<td><img alt="../_images/DateEditor_editable.png" class="first last" src="../_images/DateEditor_editable.png" />
</td>
</tr>
<tr><td>DateTime</td>
<td><a class="reference external" href="delegates.html#delegate-datetimedelegate"><em>DateTimeDelegate</em></a></td>
<td><img alt="../_images/DateTimeEditor_editable.png" class="first last" src="../_images/DateTimeEditor_editable.png" />
</td>
</tr>
<tr><td>Enumeration</td>
<td><a class="reference external" href="delegates.html#delegate-enumerationdelegate"><em>EnumerationDelegate</em></a></td>
<td><img alt="../_images/ChoicesEditor_editable.png" class="first last" src="../_images/ChoicesEditor_editable.png" />
</td>
</tr>
<tr><td>File</td>
<td><a class="reference external" href="delegates.html#delegate-filedelegate"><em>FileDelegate</em></a></td>
<td><img alt="../_images/FileEditor_editable.png" class="first last" src="../_images/FileEditor_editable.png" />
</td>
</tr>
<tr><td>Float</td>
<td><a class="reference external" href="delegates.html#delegate-floatdelegate"><em>FloatDelegate</em></a></td>
<td><img alt="../_images/FloatEditor_editable.png" class="first last" src="../_images/FloatEditor_editable.png" />
</td>
</tr>
<tr><td>INT</td>
<td><a class="reference external" href="delegates.html#delegate-integerdelegate"><em>IntegerDelegate</em></a></td>
<td><img alt="../_images/IntegerEditor_editable.png" class="first last" src="../_images/IntegerEditor_editable.png" />
</td>
</tr>
<tr><td>IPAddress</td>
<td><a class="reference external" href="delegates.html#delegate-codedelegate"><em>CodeDelegate</em></a></td>
<td><img alt="../_images/CodeEditor_editable.png" class="first last" src="../_images/CodeEditor_editable.png" />
</td>
</tr>
<tr><td>Image</td>
<td><em class="xref">ImageDelegate</em></td>
<td><img alt="../_images/ImageEditor_editable.png" class="first last" src="../_images/ImageEditor_editable.png" />
</td>
</tr>
<tr><td>Integer</td>
<td><a class="reference external" href="delegates.html#delegate-integerdelegate"><em>IntegerDelegate</em></a></td>
<td><img alt="../_images/IntegerEditor_editable.png" class="first last" src="../_images/IntegerEditor_editable.png" />
</td>
</tr>
<tr><td>Language</td>
<td><a class="reference external" href="delegates.html#delegate-enumerationdelegate"><em>EnumerationDelegate</em></a></td>
<td><img alt="../_images/ChoicesEditor_editable.png" class="first last" src="../_images/ChoicesEditor_editable.png" />
</td>
</tr>
<tr><td>Numeric</td>
<td><a class="reference external" href="delegates.html#delegate-floatdelegate"><em>FloatDelegate</em></a></td>
<td><img alt="../_images/FloatEditor_editable.png" class="first last" src="../_images/FloatEditor_editable.png" />
</td>
</tr>
<tr><td>Rating</td>
<td><a class="reference external" href="delegates.html#delegate-stardelegate"><em>StarDelegate</em></a></td>
<td><img alt="../_images/StarEditor_editable.png" class="first last" src="../_images/StarEditor_editable.png" />
</td>
</tr>
<tr><td>RichText</td>
<td><a class="reference external" href="delegates.html#delegate-richtextdelegate"><em>RichTextDelegate</em></a></td>
<td><img alt="../_images/RichTextEditor_editable.png" class="first last" src="../_images/RichTextEditor_editable.png" />
</td>
</tr>
<tr><td>String</td>
<td><a class="reference external" href="delegates.html#delegate-plaintextdelegate"><em>PlainTextDelegate</em></a></td>
<td><img alt="../_images/TextLineEditor_editable.png" class="first last" src="../_images/TextLineEditor_editable.png" />
</td>
</tr>
<tr><td>Text</td>
<td><a class="reference external" href="delegates.html#delegate-plaintextdelegate"><em>PlainTextDelegate</em></a></td>
<td><img alt="../_images/TextLineEditor_editable.png" class="first last" src="../_images/TextLineEditor_editable.png" />
</td>
</tr>
<tr><td>Time</td>
<td><a class="reference external" href="delegates.html#delegate-timedelegate"><em>TimeDelegate</em></a></td>
<td><img alt="../_images/TimeEditor_editable.png" class="first last" src="../_images/TimeEditor_editable.png" />
</td>
</tr>
<tr><td>Unicode</td>
<td><a class="reference external" href="delegates.html#delegate-plaintextdelegate"><em>PlainTextDelegate</em></a></td>
<td><img alt="../_images/TextLineEditor_editable.png" class="first last" src="../_images/TextLineEditor_editable.png" />
</td>
</tr>
<tr><td>VirtualAddress</td>
<td><a class="reference external" href="delegates.html#delegate-virtualaddressdelegate"><em>VirtualAddressDelegate</em></a></td>
<td><img alt="../_images/VirtualAddressEditor_editable.png" class="first last" src="../_images/VirtualAddressEditor_editable.png" />
</td>
</tr>
</tbody>
</table>
<div class="section" id="sqlalchemy-field-types">
<h2>SQLAlchemy field types<a class="headerlink" href="#sqlalchemy-field-types" title="Permalink to this headline">¶</a></h2>
<p>SQLAlchemy provides a number of field types that map to available data types in SQL, more information on those
can be found on the <a class="reference external" href="http://www.sqlalchemy.org/docs/reference/sqlalchemy/types.html">SQLAlchemy website</a> .</p>
</div>
<div class="section" id="module-camelot.types">
<h2>Camelot field types<a class="headerlink" href="#module-camelot.types" title="Permalink to this headline">¶</a></h2>
<p>Camelot extends the SQLAlchemy field types with a number of its own field
types. Those field types are automatically mapped to a specific delegate taking
care of the visualisation.</p>
<p>Those fields are stored in the <tt class="xref docutils literal"><span class="pre">camelot.types</span></tt> module.</p>
<dl class="class">
<dt id="camelot.types.Code">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">Code</tt><big>(</big><em>parts</em>, <em>separator=u'.'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#camelot.types.Code" title="Permalink to this definition">¶</a></dt>
<dd><p>SQLAlchemy column type to store codes.  Where a code is a list of strings
on which a regular expression can be enforced.</p>
<p>This column type accepts and returns a list of strings and stores them as a
string joined with points.</p>
<p>eg: <tt class="docutils literal"><span class="pre">['08',</span> <span class="pre">'AB']</span></tt> is stored as <tt class="docutils literal"><span class="pre">08.AB</span></tt></p>
<img alt="../_images/CodeEditor_editable.png" src="../_images/CodeEditor_editable.png" />
<dl class="attribute">
<dt id="camelot.types.Code.impl">
<tt class="descname">impl</tt><a class="headerlink" href="#camelot.types.Code.impl" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">Unicode</span></tt></dd></dl>

</dd></dl>

<dl class="class">
<dt id="camelot.types.Color">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">Color</tt><a class="headerlink" href="#camelot.types.Color" title="Permalink to this definition">¶</a></dt>
<dd><p>The Color field returns and accepts tuples of the form (r,g,b,a) where
r,g,b,a are integers between 0 and 255. The color is stored as an hexadecimal
string of the form AARRGGBB into the database, where AA is the transparency, 
RR is red, GG is green BB is blue:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MovieType</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">color</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">camelot</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Color</span><span class="p">())</span>
</pre></div>
</div>
<img alt="../_images/ColorEditor_editable.png" src="../_images/ColorEditor_editable.png" />
<p>The colors are stored in the database as strings</p>
<dl class="attribute">
<dt id="camelot.types.Color.impl">
<tt class="descname">impl</tt><a class="headerlink" href="#camelot.types.Color.impl" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">Unicode</span></tt></dd></dl>

</dd></dl>

<dl class="class">
<dt id="camelot.types.Enumeration">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">Enumeration</tt><big>(</big><em>choices=</em><span class="optional">[</span><span class="optional">]</span>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#camelot.types.Enumeration" title="Permalink to this definition">¶</a></dt>
<dd><p>The enumeration field stores integers in the database, but represents them as
strings.  This allows efficient storage and querying while preserving readable code.</p>
<p>Typical use of this field would be a status field.</p>
<p>Enumeration fields are visualized as a combo box, where the labels in the combo
box are the capitalized strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">state</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">camelot</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Enumeration</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;planned&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;recording&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&#39;finished&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&#39;canceled&#39;</span><span class="p">)]),</span> 
                                          <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;planning&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/ChoicesEditor_editable.png" src="../_images/ChoicesEditor_editable.png" />
<dl class="attribute">
<dt id="camelot.types.Enumeration.impl">
<tt class="descname">impl</tt><a class="headerlink" href="#camelot.types.Enumeration.impl" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">Integer</span></tt></dd></dl>

</dd></dl>

<dl class="class">
<dt id="camelot.types.File">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">File</tt><big>(</big><em>max_length=100</em>, <em>upload_to=''</em>, <em>storage=&lt;class 'camelot.core.files.storage.Storage'&gt;</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#camelot.types.File" title="Permalink to this definition">¶</a></dt>
<dd><p>Sqlalchemy column type to store files.  Only the location of the file is stored</p>
<p>This column type accepts and returns a StoredFile, and stores them in the directory
specified by settings.MEDIA_ROOT.  The name of the file is stored as a string in
the database.  A subdirectory upload_to can be specified:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">script</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">camelot</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;script&#39;</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/FileEditor_editable.png" src="../_images/FileEditor_editable.png" />
<dl class="attribute">
<dt id="camelot.types.File.impl">
<tt class="descname">impl</tt><a class="headerlink" href="#camelot.types.File.impl" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">Unicode</span></tt></dd></dl>

<dl class="attribute">
<dt id="camelot.types.File.stored_file_implementation">
<tt class="descname">stored_file_implementation</tt><a class="headerlink" href="#camelot.types.File.stored_file_implementation" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">StoredFile</span></tt></dd></dl>

</dd></dl>

<dl class="class">
<dt id="camelot.types.Image">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">Image</tt><big>(</big><em>max_length=100</em>, <em>upload_to=''</em>, <em>storage=&lt;class 'camelot.core.files.storage.Storage'&gt;</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#camelot.types.Image" title="Permalink to this definition">¶</a></dt>
<dd><p>Sqlalchemy column type to store images</p>
<p>This column type accepts and returns a StoredImage, and stores them in the directory
specified by settings.MEDIA_ROOT.  The name of the file is stored as a string in
the database.</p>
<p>The Image field type provides the same functionallity as the File field type, but
the files stored should be images.</p>
<img alt="../_images/ImageEditor_editable.png" src="../_images/ImageEditor_editable.png" />
<dl class="attribute">
<dt id="camelot.types.Image.stored_file_implementation">
<tt class="descname">stored_file_implementation</tt><a class="headerlink" href="#camelot.types.Image.stored_file_implementation" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">StoredImage</span></tt></dd></dl>

</dd></dl>

<dl class="class">
<dt id="camelot.types.Language">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">Language</tt><a class="headerlink" href="#camelot.types.Language" title="Permalink to this definition">¶</a></dt>
<dd><p>The languages are stored as ISO codes in the database</p>
<dl class="attribute">
<dt id="camelot.types.Language.impl">
<tt class="descname">impl</tt><a class="headerlink" href="#camelot.types.Language.impl" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">Unicode</span></tt></dd></dl>

</dd></dl>

<dl class="class">
<dt id="camelot.types.Rating">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">Rating</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#camelot.types.Rating" title="Permalink to this definition">¶</a></dt>
<dd><p>The rating field is an integer field that is visualized as a number of stars that
can be selected:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">rating</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">camelot</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Rating</span><span class="p">())</span>
</pre></div>
</div>
<img alt="../_images/StarEditor_editable.png" src="../_images/StarEditor_editable.png" />
<dl class="attribute">
<dt id="camelot.types.Rating.impl">
<tt class="descname">impl</tt><a class="headerlink" href="#camelot.types.Rating.impl" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">Integer</span></tt></dd></dl>

</dd></dl>

<dl class="class">
<dt id="camelot.types.RichText">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">RichText</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#camelot.types.RichText" title="Permalink to this definition">¶</a></dt>
<dd><p>RichText fields are unlimited text fields which contain html.  The html will be
rendered in a rich text editor.</p>
<blockquote>
<img alt="../_images/RichTextEditor_editable.png" src="../_images/RichTextEditor_editable.png" />
</blockquote>
<dl class="attribute">
<dt id="camelot.types.RichText.impl">
<tt class="descname">impl</tt><a class="headerlink" href="#camelot.types.RichText.impl" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">UnicodeText</span></tt></dd></dl>

</dd></dl>

<dl class="class">
<dt id="camelot.types.VirtualAddress">
<em class="property">class </em><tt class="descclassname">camelot.types.</tt><tt class="descname">VirtualAddress</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#camelot.types.VirtualAddress" title="Permalink to this definition">¶</a></dt>
<dd><p>A single field that can be used to enter phone numbers, fax numbers, email
addresses, im addresses.  The editor provides soft validation of the data
entered.  The address or number is stored as a string in the database.</p>
<p>This column type accepts and returns tuples of strings, the first string is
the <tt class="xref docutils literal"><span class="pre">virtual_address_type</span></tt>, and the second the address itself.</p>
<p>eg: <tt class="docutils literal"><span class="pre">('email','project-camelot&#64;conceptive.be')</span></tt> is stored as
<tt class="docutils literal"><span class="pre">mail://project-camelot&#64;conceptive.be</span></tt></p>
<img alt="../_images/virtualaddress_editor.png" src="../_images/virtualaddress_editor.png" />
<dl class="attribute">
<dt id="camelot.types.VirtualAddress.impl">
<tt class="descname">impl</tt><a class="headerlink" href="#camelot.types.VirtualAddress.impl" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">Unicode</span></tt></dd></dl>

</dd></dl>

</div>
<div class="section" id="python-properties-as-fields">
<h2>Python properties as fields<a class="headerlink" href="#python-properties-as-fields" title="Permalink to this headline">¶</a></h2>
<p>Normal python properties can be used as fields on forms as well.  In that case, there
will be no introspection to find out how to display the property.  Therefore the delegate
attribute should be specified explicitely.</p>
<blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">camelot.admin.object_admin</span> <span class="kn">import</span> <span class="n">ObjectAdmin</span>
<span class="kn">from</span> <span class="nn">camelot.view.controls</span> <span class="kn">import</span> <span class="n">delegates</span>

<span class="k">class</span> <span class="nc">Coordinate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
    
  <span class="k">class</span> <span class="nc">Admin</span><span class="p">(</span><span class="n">ObjectAdmin</span><span class="p">):</span>
    <span class="n">form_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">]</span>
    <span class="n">field_attributes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">delegate</span><span class="o">=</span><span class="n">delegates</span><span class="o">.</span><span class="n">FloatDelegate</span><span class="p">),</span>
                            <span class="n">y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">delegate</span><span class="o">=</span><span class="n">delegates</span><span class="o">.</span><span class="n">FloatDelegate</span><span class="p">),)</span>
</pre></div>
</div>
</blockquote>
</div>
<div class="section" id="attach-actions-to-field-changes">
<h2>Attach actions to field changes<a class="headerlink" href="#attach-actions-to-field-changes" title="Permalink to this headline">¶</a></h2>
<p>Whenever the value of a field is changed, an action on the model can be triggered by
using properties to manipulate the field instead of manipulating it directly.  The
example below demonstrates how the value of y should be chopped when x is changed.</p>
<blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">camelot.admin.object_admin</span> <span class="kn">import</span> <span class="n">ObjectAdmin</span>
<span class="kn">from</span> <span class="nn">camelot.view.controls</span> <span class="kn">import</span> <span class="n">delegates</span>

<span class="k">class</span> <span class="nc">Coordinate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
    
  <span class="k">def</span> <span class="nf">_get_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
  
  <span class="k">def</span> <span class="nf">_set_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    
  <span class="n">_x</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_x</span><span class="p">,</span> <span class="n">_set_x</span><span class="p">)</span>
      
  <span class="k">class</span> <span class="nc">Admin</span><span class="p">(</span><span class="n">ObjectAdmin</span><span class="p">):</span>
    <span class="n">form_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;_x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,]</span>
    <span class="n">field_attributes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">_x</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">delegate</span><span class="o">=</span><span class="n">delegates</span><span class="o">.</span><span class="n">FloatDelegate</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">),</span>
                            <span class="n">y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">delegate</span><span class="o">=</span><span class="n">delegates</span><span class="o">.</span><span class="n">FloatDelegate</span><span class="p">),)</span>
    <span class="n">form_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/fields_with_actions.png" src="../_images/fields_with_actions.png" />
</blockquote>
</div>
<div class="section" id="fields-calculated-by-the-database">
<h2>Fields calculated by the database<a class="headerlink" href="#fields-calculated-by-the-database" title="Permalink to this headline">¶</a></h2>
<p>Having certain summary fields of your models filled by the database has the advantage
that the heavy processing is moved from the client to the server.  Moreover if the
summary builds on information in related records, having the database build the summary
reduces the need to transfer additional data from the database to the server.</p>
<p>To display fields in the table and the form view that are the result of a calculation
done by the database, a ColumnProperty needs to be defined in the Elixir model.  In this
ColumnProperty, the sql query can be defined using sqlalchemy statements.  Then use the
field attributes mechanism to specify which delegate needs to be used to render the field.</p>
<img alt="../_images/budget.png" src="../_images/budget.png" />
<p>As an example we will create a budget with multiple budget lines, where the total budget
is calculated by the database</p>
<div class="highlight-python"><pre>from elixir.properties import ColumnProperty
from camelot.view.controls import delegates
from sqlalchemy import sql, and_

class Budget(Entity):
  lines = OneToMany('BudgetLine')
  total = ColumnProperty(lambda c:sql.select([sql.func.sum(BudgetLine.amount)], and_(BudgetLine.budget_id==Budget.id)))

   class Admin(EntityAdmin):
    name = 'Budgets'
    list_display = [ 'total', 'lines']
    field_attributes = {'total':{'delegate':delegates.FloatDelegate}}

class BudgetLine(Entity):
  budget = ManyToOne('Budget', required=True, ondelete='cascade', onupdate='cascade')
  amount = Field(Float(precision=2), default=0)

  class Admin(EntityAdmin):
    name = 'Budget lines'
    list_display = ['amount',]</pre>
</div>
<p>When the user presses F9, all data in the application is refreshed from the database, and thus
all fields are recalculated.</p>
<p>An explanation of the lambda function inside the ColumnProperty can be found in the <a class="reference external" href="http://elixir.ematia.de/apidocs/elixir.properties.ColumnProperty.html">ElixirColumnProperty</a> and
the <a class="reference external" href="http://www.sqlalchemy.org/docs/04/mappers.html#advdatamapping_mapper_expressions">SqlalchemyMappers</a> documentation.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Creating models with Elixir/SQLAlchemy/Camelot</a><ul>
<li><a class="reference external" href="#sqlalchemy-field-types">SQLAlchemy field types</a></li>
<li><a class="reference external" href="#module-camelot.types">Camelot field types</a></li>
<li><a class="reference external" href="#python-properties-as-fields">Python properties as fields</a></li>
<li><a class="reference external" href="#attach-actions-to-field-changes">Attach actions to field changes</a></li>
<li><a class="reference external" href="#fields-calculated-by-the-database">Fields calculated by the database</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="install.html"
                                  title="previous chapter">Camelot Installation</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="admin.html"
                                  title="next chapter">Customizing the Admin classes</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/doc/models.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="admin.html" title="Customizing the Admin classes"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Camelot Installation"
             >previous</a> |</li>
        <li><a href="../index.html">Camelot v0.1 documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Camelot Documentation contents</a> &raquo;</li>
          <li><a href="index.html" >Camelot Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; <a href="../copyright.html">Copyright</a> 2009, Conceptive Engineering.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>