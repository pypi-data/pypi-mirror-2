<dl id="document-toc" class="portlet toc" style="display:block;">
    <dt class="portletHeader"
        i18n:domain="plone" i18n:translate="">
            Add-on Products
    </dt>
    <dd class="portletItem">
        <ol class="TOC1Digit">
            <li tal:repeat="product view/productsList">
                <a tal:attributes="href string:${context/absolute_url}/${view/__name__}#${product/id}"
                    tal:content="product/title"></a>
            </li>
        </ol>
    </dd>
</dl>

<tal:products repeat="product view/productsList">
    <tal:product define="isProduct python:product['id'].find('.') == -1 and 'Products.' or ''">
    <a href="#" tal:attributes="name product/id"></a>
    <h2>
        <img src="http://cm.regione.emilia-romagna.it/protezionecivile/favicon.ico"
            tal:condition="python:product['id'].startswith('rer')"
            title="Prodotto Rer" alt=""/>
        <img src="http://www.redturtle.it/favicon.ico"
            tal:condition="python:product['id'].startswith('redturtle') or product['id'].startswith('rt')"
            title="Prodotto Redturtle" alt=""/>
        <img src="http://plone.org/favicon.ico"
            tal:condition="python:product['id'].startswith('collective') or product['id'].startswith('plone')"
            title="Prodotto Collective" alt="" />
        <img src="http://plone.org/favicon.ico"
            tal:attributes="src string:/product_icon.gif"
            tal:condition="isProduct"
            title="Prodotto Collective" alt="" />
        <span tal:content="string:${product/title}">
            First header</span>
    </h2>
    <a style="float:right"
         tal:define="link python: view.search_link(product.get('id',None))"
         tal:condition="link"
         tal:content="link/label"
         tal:attributes="href link/url">
        tal:attributes="href string:http://pypi.python.org/pypi?%3Aaction=search&term=${product/id}&submit=search">
        <img src="link_icon.gif" alt="">
        Search on pypi
    </a>
    <dl>
        <dt>Package</dt>
        <dd tal:content="string:${isProduct}${product/id}"></dd>
        <dt i18n:translate="">Version</dt>
        <dd tal:content="string:${product/version}"></dd>
        <dt i18n:domain="plone" i18n:translate="">Description</dt>
        <dd tal:content="string:${product/description}"></dd>
    <dt>Installed on sites:</dt>
    <dd>
    <div>
        <table class="listing">
            <tr>
                <th>Site</th>
                <th>Version</th>
            </tr>
            <tal:installations repeat="siteTuple view/sitesList">
                <tr tal:define="oddrow repeat/siteTuple/odd;
                                siteName python:siteTuple[0];
                                siteApp python:siteTuple[1];
                                instVersion python:view.multisite_productInstalledVersion(siteApp,product['id']);
                                latest python:instVersion and instVersion == product['version']"
                    tal:condition="instVersion"
                    tal:attributes="class python:oddrow is True and 'even' or 'odd'">
                    <td tal:content="siteName">site name</td>
                    <td>
                    <img tal:condition="latest" src="/misc_/CMFPlone/confirm_icon.gif"
                          alt="Latest version" title="Latest version"
                          i18n:attributes="title">
                    <tal:not-latest condition="python: instVersion and not latest">
                    <img alt="Not latest version" title="Not latest version"
                        tal:attributes="src string:${view/portal/absolute_url}/error_icon.gif"/>
                        <span tal:content="instVersion">version</span>
                    </tal:not-latest>
                    </td>
                </tr>
            </tal:installations>
        </table>
    </div>
    </dd>
    </dl>
    </tal:product>
</tal:products>