<div id="content">
<dl id="document-toc" class="portlet toc" style="display:block;">
    <dt class="portletHeader"
        i18n:domain="plone" i18n:translate="">
            Add-on Products
    </dt>
    <dd class="portletItem">
        <ol class="TOC1Digit">
            <li tal:repeat="product view/productsList">
                <a tal:attributes="href string:${context/absolute_url}/${view/__name__}#${product/id}"
                    tal:content="product/title"></a>
            </li>
        </ol>
    </dd>
</dl>

<tal:products repeat="product view/productsList">
    <tal:product define="isProduct python:product['id'].find('.') == -1 and 'Products.' or ''">
    <a href="#" tal:attributes="name product/id"></a>
    <h2>
        <span tal:content="string:${product/title}">First header</span>
    </h2>
    <a style="float:right" target="_blank"
         tal:define="link python: view.pypiSearch(product.get('id',None))"
         tal:condition="link"
         tal:content="link/label"
         tal:attributes="href link/url">
        <img src="link_icon.gif" alt="">
        Search on pypi
    </a>
    <dl>
        <dt>Package</dt>
        <dd tal:content="python: view.productCompleteId(product['id'])"></dd>
        <dt i18n:translate="">Version</dt>
        <dd tal:content="string:${product/version}"></dd>
        <dt i18n:domain="plone" i18n:translate="">Description</dt>
        <dd tal:content="string:${product/description}"></dd>
    <dt>Installed on sites:</dt>
    <dd>
    <div>
        <table class="listing">
            <tr>
                <th>Site</th>
                <th>Version</th>
            </tr>
            <tal:installations repeat="siteTuple view/sitesList">
                <tr tal:define="oddrow repeat/siteTuple/odd;
                                siteName python:siteTuple[0];
                                siteApp python:siteTuple[1];
                                instVersion python:view.multisite_productInstalledVersion(siteApp,product['id']);
                                latest python:instVersion and instVersion == product['version']"
                    tal:condition="instVersion"
                    tal:attributes="class python:oddrow is True and 'even' or 'odd'">
                    <td tal:content="siteName">site name</td>
                    <td>
                    <img tal:condition="latest" src="/misc_/CMFPlone/confirm_icon.gif"
                          alt="Latest version" title="Latest version"
                          i18n:attributes="title">
                    <tal:not-latest condition="python: instVersion and not latest">
	                    <img alt="Not latest version" title="Not latest version"
	                        tal:attributes="src string:${view/portal/absolute_url}/error_icon.gif"/>
	                        <span tal:content="instVersion">version</span>
							<form method="post"
	                            tal:attributes="action string:${context/absolute_url}/${view/__name__}">
	                            <input type="hidden" name="siteid"
	                                tal:attributes="value siteName">
	                            <input type="hidden" name="reinstall_pid"
	                                tal:attributes="value python:product['id']">
	                            <input type="submit"
	                                class="context"
	                                name="form_update"
	                                value="Aggiorna">
	                        </form>
							<form method="post"
                                tal:attributes="action string:${context/absolute_url}/${view/__name__}">
                                <input type="hidden" name="siteid"
                                    tal:attributes="value string:allSites">
                                <input type="hidden" name="reinstall_pid"
                                    tal:attributes="value python:product['id']">
                                <input type="submit"
                                    class="context"
                                    name="form_update"
                                    value="Aggiorna tutti i siti">
                            </form>
                    </tal:not-latest>
                    </td>
                </tr>
            </tal:installations>
        </table>
    </div>
    </dd>
    </dl>
    </tal:product>
</tal:products>
</div>