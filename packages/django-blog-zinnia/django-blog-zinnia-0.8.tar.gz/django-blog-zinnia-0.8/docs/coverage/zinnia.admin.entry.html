<html>
<head>
<title>zinnia.admin.entry</title>
</head>
<body>
zinnia.admin.entry
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 154 lines<br/>
Missed: 100 lines<br/>
Skipped 39 lines<br/>
Percent: 60 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre>  1</pre></span><pre>&quot;&quot;&quot;EntryAdmin for Zinnia&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>  2</pre></span><pre>from datetime import datetime</pre></div>
<div class="skip"><span class="num"><pre>  3</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  4</pre></span><pre>from django.forms import Media</pre></div>
<div class="cov"><span class="num"><pre>  5</pre></span><pre>from django.contrib import admin</pre></div>
<div class="cov"><span class="num"><pre>  6</pre></span><pre>from django.contrib.auth.models import User</pre></div>
<div class="cov"><span class="num"><pre>  7</pre></span><pre>from django.utils.html import strip_tags</pre></div>
<div class="cov"><span class="num"><pre>  8</pre></span><pre>from django.utils.text import truncate_words</pre></div>
<div class="cov"><span class="num"><pre>  9</pre></span><pre>from django.conf.urls.defaults import url</pre></div>
<div class="cov"><span class="num"><pre> 10</pre></span><pre>from django.conf.urls.defaults import patterns</pre></div>
<div class="cov"><span class="num"><pre> 11</pre></span><pre>from django.utils.translation import ugettext_lazy as _</pre></div>
<div class="cov"><span class="num"><pre> 12</pre></span><pre>from django.core.urlresolvers import reverse, NoReverseMatch</pre></div>
<div class="skip"><span class="num"><pre> 13</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 14</pre></span><pre>from tagging.models import Tag</pre></div>
<div class="skip"><span class="num"><pre> 15</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 16</pre></span><pre>from zinnia import settings</pre></div>
<div class="cov"><span class="num"><pre> 17</pre></span><pre>from zinnia.managers import HIDDEN</pre></div>
<div class="cov"><span class="num"><pre> 18</pre></span><pre>from zinnia.managers import PUBLISHED</pre></div>
<div class="cov"><span class="num"><pre> 19</pre></span><pre>from zinnia.ping import DirectoryPinger</pre></div>
<div class="cov"><span class="num"><pre> 20</pre></span><pre>from zinnia.admin.forms import EntryAdminForm</pre></div>
<div class="skip"><span class="num"><pre> 21</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 22</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 23</pre></span><pre>class EntryAdmin(admin.ModelAdmin):</pre></div>
<div class="cov"><span class="num"><pre> 24</pre></span><pre>    &quot;&quot;&quot;Admin for Entry model&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 25</pre></span><pre>    form = EntryAdminForm</pre></div>
<div class="cov"><span class="num"><pre> 26</pre></span><pre>    date_hierarchy = 'creation_date'</pre></div>
<div class="cov"><span class="num"><pre> 27</pre></span><pre>    fieldsets = ((_('Content'), {'fields': ('title', 'content',</pre></div>
<div class="cov"><span class="num"><pre> 28</pre></span><pre>                                            'image', 'status')}),</pre></div>
<div class="cov"><span class="num"><pre> 29</pre></span><pre>                 (_('Options'), {'fields': ('featured', 'excerpt', 'template',</pre></div>
<div class="cov"><span class="num"><pre> 30</pre></span><pre>                                            'related', 'authors',</pre></div>
<div class="cov"><span class="num"><pre> 31</pre></span><pre>                                            'creation_date', 'start_publication',</pre></div>
<div class="cov"><span class="num"><pre> 32</pre></span><pre>                                            'end_publication'),</pre></div>
<div class="cov"><span class="num"><pre> 33</pre></span><pre>                                 'classes': ('collapse', 'collapse-closed')}),</pre></div>
<div class="cov"><span class="num"><pre> 34</pre></span><pre>                 (_('Privacy'), {'fields': ('password', 'login_required',),</pre></div>
<div class="cov"><span class="num"><pre> 35</pre></span><pre>                                 'classes': ('collapse', 'collapse-closed')}),</pre></div>
<div class="cov"><span class="num"><pre> 36</pre></span><pre>                 (_('Discussion'), {'fields': ('comment_enabled',</pre></div>
<div class="cov"><span class="num"><pre> 37</pre></span><pre>                                               'pingback_enabled')}),</pre></div>
<div class="cov"><span class="num"><pre> 38</pre></span><pre>                 (_('Publication'), {'fields': ('categories', 'tags',</pre></div>
<div class="cov"><span class="num"><pre> 39</pre></span><pre>                                                'sites', 'slug')}))</pre></div>
<div class="cov"><span class="num"><pre> 40</pre></span><pre>    list_filter = ('categories', 'authors', 'status', 'featured',</pre></div>
<div class="cov"><span class="num"><pre> 41</pre></span><pre>                   'login_required', 'comment_enabled', 'pingback_enabled',</pre></div>
<div class="cov"><span class="num"><pre> 42</pre></span><pre>                   'creation_date', 'start_publication',</pre></div>
<div class="cov"><span class="num"><pre> 43</pre></span><pre>                   'end_publication', 'sites')</pre></div>
<div class="cov"><span class="num"><pre> 44</pre></span><pre>    list_display = ('get_title', 'get_authors', 'get_categories',</pre></div>
<div class="cov"><span class="num"><pre> 45</pre></span><pre>                    'get_tags', 'get_sites',</pre></div>
<div class="cov"><span class="num"><pre> 46</pre></span><pre>                    'comment_enabled', 'pingback_enabled',</pre></div>
<div class="cov"><span class="num"><pre> 47</pre></span><pre>                    'get_is_actual', 'get_is_visible', 'get_link',</pre></div>
<div class="cov"><span class="num"><pre> 48</pre></span><pre>                    'get_short_url', 'creation_date')</pre></div>
<div class="cov"><span class="num"><pre> 49</pre></span><pre>    radio_fields = {'template': admin.VERTICAL}</pre></div>
<div class="cov"><span class="num"><pre> 50</pre></span><pre>    filter_horizontal = ('categories', 'authors', 'related')</pre></div>
<div class="cov"><span class="num"><pre> 51</pre></span><pre>    prepopulated_fields = {'slug': ('title', )}</pre></div>
<div class="cov"><span class="num"><pre> 52</pre></span><pre>    search_fields = ('title', 'excerpt', 'content', 'tags')</pre></div>
<div class="cov"><span class="num"><pre> 53</pre></span><pre>    actions = ['make_mine', 'make_published', 'make_hidden',</pre></div>
<div class="cov"><span class="num"><pre> 54</pre></span><pre>               'close_comments', 'close_pingbacks',</pre></div>
<div class="cov"><span class="num"><pre> 55</pre></span><pre>               'ping_directories', 'make_tweet', 'put_on_top']</pre></div>
<div class="cov"><span class="num"><pre> 56</pre></span><pre>    actions_on_top = True</pre></div>
<div class="cov"><span class="num"><pre> 57</pre></span><pre>    actions_on_bottom = True</pre></div>
<div class="skip"><span class="num"><pre> 58</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 59</pre></span><pre>    def __init__(self, model, admin_site):</pre></div>
<div class="cov"><span class="num"><pre> 60</pre></span><pre>        self.form.admin_site = admin_site</pre></div>
<div class="cov"><span class="num"><pre> 61</pre></span><pre>        super(EntryAdmin, self).__init__(model, admin_site)</pre></div>
<div class="skip"><span class="num"><pre> 62</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 63</pre></span><pre>    # Custom Display</pre></div>
<div class="cov"><span class="num"><pre> 64</pre></span><pre>    def get_title(self, entry):</pre></div>
<div class="cov"><span class="num"><pre> 65</pre></span><pre>        &quot;&quot;&quot;Return the title with word count and number of comments&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 66</pre></span><pre>        title = _('%(title)s (%(word_count)i words)') % \</pre></div>
<div class="nocov"><span class="num"><pre> 67</pre></span><pre>                {'title': entry.title, 'word_count': entry.word_count}</pre></div>
<div class="nocov"><span class="num"><pre> 68</pre></span><pre>        comments = entry.comments.count()</pre></div>
<div class="nocov"><span class="num"><pre> 69</pre></span><pre>        if comments:</pre></div>
<div class="nocov"><span class="num"><pre> 70</pre></span><pre>            return _('%(title)s (%(comments)i comments)') % \</pre></div>
<div class="nocov"><span class="num"><pre> 71</pre></span><pre>                   {'title': title, 'comments': comments}</pre></div>
<div class="nocov"><span class="num"><pre> 72</pre></span><pre>        return title</pre></div>
<div class="cov"><span class="num"><pre> 73</pre></span><pre>    get_title.short_description = _('title')</pre></div>
<div class="skip"><span class="num"><pre> 74</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 75</pre></span><pre>    def get_authors(self, entry):</pre></div>
<div class="cov"><span class="num"><pre> 76</pre></span><pre>        &quot;&quot;&quot;Return the authors in HTML&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 77</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre> 78</pre></span><pre>            authors = ['&lt;a href=&quot;%s&quot; target=&quot;blank&quot;&gt;%s&lt;/a&gt;' %</pre></div>
<div class="nocov"><span class="num"><pre> 79</pre></span><pre>                       (reverse('zinnia_author_detail',</pre></div>
<div class="nocov"><span class="num"><pre> 80</pre></span><pre>                                args=[author.username]),</pre></div>
<div class="nocov"><span class="num"><pre> 81</pre></span><pre>                        author.username) for author in entry.authors.all()]</pre></div>
<div class="nocov"><span class="num"><pre> 82</pre></span><pre>        except NoReverseMatch:</pre></div>
<div class="nocov"><span class="num"><pre> 83</pre></span><pre>            authors = [author.username for author in entry.authors.all()]</pre></div>
<div class="nocov"><span class="num"><pre> 84</pre></span><pre>        return ', '.join(authors)</pre></div>
<div class="cov"><span class="num"><pre> 85</pre></span><pre>    get_authors.allow_tags = True</pre></div>
<div class="cov"><span class="num"><pre> 86</pre></span><pre>    get_authors.short_description = _('author(s)')</pre></div>
<div class="skip"><span class="num"><pre> 87</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 88</pre></span><pre>    def get_categories(self, entry):</pre></div>
<div class="cov"><span class="num"><pre> 89</pre></span><pre>        &quot;&quot;&quot;Return the categories linked in HTML&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 90</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre> 91</pre></span><pre>            categories = ['&lt;a href=&quot;%s&quot; target=&quot;blank&quot;&gt;%s&lt;/a&gt;' %</pre></div>
<div class="nocov"><span class="num"><pre> 92</pre></span><pre>                          (category.get_absolute_url(), category.title)</pre></div>
<div class="nocov"><span class="num"><pre> 93</pre></span><pre>                          for category in entry.categories.all()]</pre></div>
<div class="nocov"><span class="num"><pre> 94</pre></span><pre>        except NoReverseMatch:</pre></div>
<div class="nocov"><span class="num"><pre> 95</pre></span><pre>            categories = [category.title for category in</pre></div>
<div class="nocov"><span class="num"><pre> 96</pre></span><pre>                          entry.categories.all()]</pre></div>
<div class="nocov"><span class="num"><pre> 97</pre></span><pre>        return ', '.join(categories)</pre></div>
<div class="cov"><span class="num"><pre> 98</pre></span><pre>    get_categories.allow_tags = True</pre></div>
<div class="cov"><span class="num"><pre> 99</pre></span><pre>    get_categories.short_description = _('category(s)')</pre></div>
<div class="skip"><span class="num"><pre>100</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>101</pre></span><pre>    def get_tags(self, entry):</pre></div>
<div class="cov"><span class="num"><pre>102</pre></span><pre>        &quot;&quot;&quot;Return the tags linked in HTML&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>103</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>104</pre></span><pre>            return ', '.join(['&lt;a href=&quot;%s&quot; target=&quot;blank&quot;&gt;%s&lt;/a&gt;' %</pre></div>
<div class="nocov"><span class="num"><pre>105</pre></span><pre>                              (reverse('zinnia_tag_detail',</pre></div>
<div class="nocov"><span class="num"><pre>106</pre></span><pre>                                       args=[tag.name]), tag.name)</pre></div>
<div class="nocov"><span class="num"><pre>107</pre></span><pre>                              for tag in Tag.objects.get_for_object(entry)])</pre></div>
<div class="nocov"><span class="num"><pre>108</pre></span><pre>        except NoReverseMatch:</pre></div>
<div class="nocov"><span class="num"><pre>109</pre></span><pre>            return entry.tags</pre></div>
<div class="cov"><span class="num"><pre>110</pre></span><pre>    get_tags.allow_tags = True</pre></div>
<div class="cov"><span class="num"><pre>111</pre></span><pre>    get_tags.short_description = _('tag(s)')</pre></div>
<div class="skip"><span class="num"><pre>112</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>113</pre></span><pre>    def get_sites(self, entry):</pre></div>
<div class="cov"><span class="num"><pre>114</pre></span><pre>        &quot;&quot;&quot;Return the sites linked in HTML&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>115</pre></span><pre>        return ', '.join(['&lt;a href=&quot;http://%(domain)s&quot; target=&quot;blank&quot;&gt;%(name)s&lt;/a&gt;' %</pre></div>
<div class="nocov"><span class="num"><pre>116</pre></span><pre>                          site.__dict__ for site in entry.sites.all()])</pre></div>
<div class="cov"><span class="num"><pre>117</pre></span><pre>    get_sites.allow_tags = True</pre></div>
<div class="cov"><span class="num"><pre>118</pre></span><pre>    get_sites.short_description = _('site(s)')</pre></div>
<div class="skip"><span class="num"><pre>119</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>120</pre></span><pre>    def get_is_actual(self, entry):</pre></div>
<div class="cov"><span class="num"><pre>121</pre></span><pre>        &quot;&quot;&quot;Admin wrapper for entry.is_actual&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>122</pre></span><pre>        return entry.is_actual</pre></div>
<div class="cov"><span class="num"><pre>123</pre></span><pre>    get_is_actual.boolean = True</pre></div>
<div class="cov"><span class="num"><pre>124</pre></span><pre>    get_is_actual.short_description = _('is actual')</pre></div>
<div class="skip"><span class="num"><pre>125</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>126</pre></span><pre>    def get_is_visible(self, entry):</pre></div>
<div class="cov"><span class="num"><pre>127</pre></span><pre>        &quot;&quot;&quot;Admin wrapper for entry.is_visible&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>128</pre></span><pre>        return entry.is_visible</pre></div>
<div class="cov"><span class="num"><pre>129</pre></span><pre>    get_is_visible.boolean = True</pre></div>
<div class="cov"><span class="num"><pre>130</pre></span><pre>    get_is_visible.short_description = _('is visible')</pre></div>
<div class="skip"><span class="num"><pre>131</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>132</pre></span><pre>    def get_link(self, entry):</pre></div>
<div class="cov"><span class="num"><pre>133</pre></span><pre>        &quot;&quot;&quot;Return a formated link to the entry&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>134</pre></span><pre>        return _('&lt;a href=&quot;%s&quot; target=&quot;blank&quot;&gt;View&lt;/a&gt;') % \</pre></div>
<div class="nocov"><span class="num"><pre>135</pre></span><pre>               entry.get_absolute_url()</pre></div>
<div class="cov"><span class="num"><pre>136</pre></span><pre>    get_link.allow_tags = True</pre></div>
<div class="cov"><span class="num"><pre>137</pre></span><pre>    get_link.short_description = _('View on site')</pre></div>
<div class="skip"><span class="num"><pre>138</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>139</pre></span><pre>    def get_short_url(self, entry):</pre></div>
<div class="cov"><span class="num"><pre>140</pre></span><pre>        &quot;&quot;&quot;Return the short url in HTML&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>141</pre></span><pre>        short_url = entry.short_url</pre></div>
<div class="nocov"><span class="num"><pre>142</pre></span><pre>        if not short_url:</pre></div>
<div class="nocov"><span class="num"><pre>143</pre></span><pre>            return _('Unavailable')</pre></div>
<div class="nocov"><span class="num"><pre>144</pre></span><pre>        return '&lt;a href=&quot;%(url)s&quot; target=&quot;blank&quot;&gt;%(url)s&lt;/a&gt;' % \</pre></div>
<div class="nocov"><span class="num"><pre>145</pre></span><pre>               {'url': short_url}</pre></div>
<div class="cov"><span class="num"><pre>146</pre></span><pre>    get_short_url.allow_tags = True</pre></div>
<div class="cov"><span class="num"><pre>147</pre></span><pre>    get_short_url.short_description = _('short url')</pre></div>
<div class="skip"><span class="num"><pre>148</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>149</pre></span><pre>    # Custom Methods</pre></div>
<div class="cov"><span class="num"><pre>150</pre></span><pre>    def save_model(self, request, entry, form, change):</pre></div>
<div class="cov"><span class="num"><pre>151</pre></span><pre>        &quot;&quot;&quot;Save the authors, update time, make an excerpt&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>152</pre></span><pre>        if not form.cleaned_data.get('excerpt') and entry.status == PUBLISHED:</pre></div>
<div class="nocov"><span class="num"><pre>153</pre></span><pre>            entry.excerpt = truncate_words(strip_tags(entry.content), 50)</pre></div>
<div class="skip"><span class="num"><pre>154</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>155</pre></span><pre>        if entry.pk and not request.user.has_perm('zinnia.can_change_author'):</pre></div>
<div class="nocov"><span class="num"><pre>156</pre></span><pre>            form.cleaned_data['authors'] = entry.authors.all()</pre></div>
<div class="skip"><span class="num"><pre>157</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>158</pre></span><pre>        if not form.cleaned_data.get('authors'):</pre></div>
<div class="nocov"><span class="num"><pre>159</pre></span><pre>            form.cleaned_data['authors'].append(request.user)</pre></div>
<div class="skip"><span class="num"><pre>160</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>161</pre></span><pre>        entry.last_update = datetime.now()</pre></div>
<div class="nocov"><span class="num"><pre>162</pre></span><pre>        entry.save()</pre></div>
<div class="skip"><span class="num"><pre>163</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>164</pre></span><pre>    def queryset(self, request):</pre></div>
<div class="cov"><span class="num"><pre>165</pre></span><pre>        &quot;&quot;&quot;Make special filtering by user permissions&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>166</pre></span><pre>        queryset = super(EntryAdmin, self).queryset(request)</pre></div>
<div class="nocov"><span class="num"><pre>167</pre></span><pre>        if request.user.has_perm('zinnia.can_view_all'):</pre></div>
<div class="nocov"><span class="num"><pre>168</pre></span><pre>            return queryset</pre></div>
<div class="nocov"><span class="num"><pre>169</pre></span><pre>        return request.user.entry_set.all()</pre></div>
<div class="skip"><span class="num"><pre>170</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>171</pre></span><pre>    def formfield_for_manytomany(self, db_field, request, **kwargs):</pre></div>
<div class="cov"><span class="num"><pre>172</pre></span><pre>        &quot;&quot;&quot;Filters the disposable authors&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>173</pre></span><pre>        if db_field.name == 'authors':</pre></div>
<div class="cov"><span class="num"><pre>174</pre></span><pre>            if request.user.has_perm('zinnia.can_change_author'):</pre></div>
<div class="cov"><span class="num"><pre>175</pre></span><pre>                kwargs['queryset'] = User.objects.filter(is_staff=True)</pre></div>
<div class="nocov"><span class="num"><pre>176</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>177</pre></span><pre>                kwargs['queryset'] = User.objects.filter(pk=request.user.pk)</pre></div>
<div class="skip"><span class="num"><pre>178</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>179</pre></span><pre>        return super(EntryAdmin, self).formfield_for_manytomany(</pre></div>
<div class="cov"><span class="num"><pre>180</pre></span><pre>            db_field, request, **kwargs)</pre></div>
<div class="skip"><span class="num"><pre>181</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>182</pre></span><pre>    def get_actions(self, request):</pre></div>
<div class="cov"><span class="num"><pre>183</pre></span><pre>        &quot;&quot;&quot;Define user actions by permissions&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>184</pre></span><pre>        actions = super(EntryAdmin, self).get_actions(request)</pre></div>
<div class="nocov"><span class="num"><pre>185</pre></span><pre>        if not request.user.has_perm('zinnia.can_change_author') \</pre></div>
<div class="nocov"><span class="num"><pre>186</pre></span><pre>           or not request.user.has_perm('zinnia.can_view_all'):</pre></div>
<div class="nocov"><span class="num"><pre>187</pre></span><pre>            del actions['make_mine']</pre></div>
<div class="nocov"><span class="num"><pre>188</pre></span><pre>        if not settings.PING_DIRECTORIES:</pre></div>
<div class="nocov"><span class="num"><pre>189</pre></span><pre>            del actions['ping_directories']</pre></div>
<div class="nocov"><span class="num"><pre>190</pre></span><pre>        if not settings.USE_TWITTER or not settings.USE_BITLY:</pre></div>
<div class="nocov"><span class="num"><pre>191</pre></span><pre>            del actions['make_tweet']</pre></div>
<div class="skip"><span class="num"><pre>192</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>193</pre></span><pre>        return actions</pre></div>
<div class="skip"><span class="num"><pre>194</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>195</pre></span><pre>    # Custom Actions</pre></div>
<div class="cov"><span class="num"><pre>196</pre></span><pre>    def make_mine(self, request, queryset):</pre></div>
<div class="cov"><span class="num"><pre>197</pre></span><pre>        &quot;&quot;&quot;Set the entries to the user&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>198</pre></span><pre>        for entry in queryset:</pre></div>
<div class="nocov"><span class="num"><pre>199</pre></span><pre>            if request.user not in entry.authors.all():</pre></div>
<div class="nocov"><span class="num"><pre>200</pre></span><pre>                entry.authors.add(request.user)</pre></div>
<div class="cov"><span class="num"><pre>201</pre></span><pre>    make_mine.short_description = _('Set the entries to the user')</pre></div>
<div class="skip"><span class="num"><pre>202</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>203</pre></span><pre>    def make_published(self, request, queryset):</pre></div>
<div class="cov"><span class="num"><pre>204</pre></span><pre>        &quot;&quot;&quot;Set entries selected as published&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>205</pre></span><pre>        queryset.update(status=PUBLISHED)</pre></div>
<div class="cov"><span class="num"><pre>206</pre></span><pre>    make_published.short_description = _('Set entries selected as published')</pre></div>
<div class="skip"><span class="num"><pre>207</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>208</pre></span><pre>    def make_hidden(self, request, queryset):</pre></div>
<div class="cov"><span class="num"><pre>209</pre></span><pre>        &quot;&quot;&quot;Set entries selected as hidden&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>210</pre></span><pre>        queryset.update(status=HIDDEN)</pre></div>
<div class="cov"><span class="num"><pre>211</pre></span><pre>    make_hidden.short_description = _('Set entries selected as hidden')</pre></div>
<div class="skip"><span class="num"><pre>212</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>213</pre></span><pre>    def make_tweet(self, request, queryset):</pre></div>
<div class="cov"><span class="num"><pre>214</pre></span><pre>        &quot;&quot;&quot;Post an update on Twitter&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>215</pre></span><pre>        import tweepy</pre></div>
<div class="nocov"><span class="num"><pre>216</pre></span><pre>        auth = tweepy.OAuthHandler(settings.TWITTER_CONSUMER_KEY,</pre></div>
<div class="nocov"><span class="num"><pre>217</pre></span><pre>                                   settings.TWITTER_CONSUMER_SECRET)</pre></div>
<div class="nocov"><span class="num"><pre>218</pre></span><pre>        auth.set_access_token(settings.TWITTER_ACCESS_KEY,</pre></div>
<div class="nocov"><span class="num"><pre>219</pre></span><pre>                              settings.TWITTER_ACCESS_SECRET)</pre></div>
<div class="nocov"><span class="num"><pre>220</pre></span><pre>        api = tweepy.API(auth)</pre></div>
<div class="nocov"><span class="num"><pre>221</pre></span><pre>        for entry in queryset:</pre></div>
<div class="nocov"><span class="num"><pre>222</pre></span><pre>            message = '%s %s' % (entry.title[:119], entry.short_url)</pre></div>
<div class="nocov"><span class="num"><pre>223</pre></span><pre>            api.update_status(message)</pre></div>
<div class="cov"><span class="num"><pre>224</pre></span><pre>    make_tweet.short_description = _('Tweet entries selected')</pre></div>
<div class="skip"><span class="num"><pre>225</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>226</pre></span><pre>    def close_comments(self, request, queryset):</pre></div>
<div class="cov"><span class="num"><pre>227</pre></span><pre>        &quot;&quot;&quot;Close the comments for selected entries&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>228</pre></span><pre>        queryset.update(comment_enabled=False)</pre></div>
<div class="cov"><span class="num"><pre>229</pre></span><pre>    close_comments.short_description = _('Close the comments for '\</pre></div>
<div class="cov"><span class="num"><pre>230</pre></span><pre>                                         'selected entries')</pre></div>
<div class="skip"><span class="num"><pre>231</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>232</pre></span><pre>    def close_pingbacks(self, request, queryset):</pre></div>
<div class="cov"><span class="num"><pre>233</pre></span><pre>        &quot;&quot;&quot;Close the pingbacks for selected entries&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>234</pre></span><pre>        queryset.update(pingback_enabled=False)</pre></div>
<div class="cov"><span class="num"><pre>235</pre></span><pre>    close_pingbacks.short_description = _('Close the linkbacks for selected entries')</pre></div>
<div class="skip"><span class="num"><pre>236</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>237</pre></span><pre>    def put_on_top(self, request, queryset):</pre></div>
<div class="cov"><span class="num"><pre>238</pre></span><pre>        &quot;&quot;&quot;Put the selected entries on top at the current date&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>239</pre></span><pre>        queryset.update(creation_date=datetime.now())</pre></div>
<div class="cov"><span class="num"><pre>240</pre></span><pre>    put_on_top.short_description = _('Put the selected entries on top at the current date')</pre></div>
<div class="skip"><span class="num"><pre>241</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>242</pre></span><pre>    def ping_directories(self, request, queryset):</pre></div>
<div class="cov"><span class="num"><pre>243</pre></span><pre>        &quot;&quot;&quot;Ping Directories for selected entries&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>244</pre></span><pre>        for directory in settings.PING_DIRECTORIES:</pre></div>
<div class="nocov"><span class="num"><pre>245</pre></span><pre>            pinger = DirectoryPinger(directory, queryset)</pre></div>
<div class="nocov"><span class="num"><pre>246</pre></span><pre>            pinger.join()</pre></div>
<div class="nocov"><span class="num"><pre>247</pre></span><pre>            success = 0</pre></div>
<div class="nocov"><span class="num"><pre>248</pre></span><pre>            for result in pinger.results:</pre></div>
<div class="nocov"><span class="num"><pre>249</pre></span><pre>                if not result.get('flerror', True):</pre></div>
<div class="nocov"><span class="num"><pre>250</pre></span><pre>                    success += 1</pre></div>
<div class="nocov"><span class="num"><pre>251</pre></span><pre>                else:</pre></div>
<div class="nocov"><span class="num"><pre>252</pre></span><pre>                    self.message_user(request, '%s : %s' % (directory,</pre></div>
<div class="nocov"><span class="num"><pre>253</pre></span><pre>                                                            result['message']))</pre></div>
<div class="nocov"><span class="num"><pre>254</pre></span><pre>            if success:</pre></div>
<div class="nocov"><span class="num"><pre>255</pre></span><pre>                self.message_user(request,</pre></div>
<div class="nocov"><span class="num"><pre>256</pre></span><pre>                                  _('%(directory)s directory succesfully ' \</pre></div>
<div class="nocov"><span class="num"><pre>257</pre></span><pre>                                    'pinged %(success)d entries.') %</pre></div>
<div class="nocov"><span class="num"><pre>258</pre></span><pre>                                  {'directory': directory, 'success': success})</pre></div>
<div class="cov"><span class="num"><pre>259</pre></span><pre>    ping_directories.short_description = _('Ping Directories for ' \</pre></div>
<div class="cov"><span class="num"><pre>260</pre></span><pre>                                           'selected entries')</pre></div>
<div class="skip"><span class="num"><pre>261</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>262</pre></span><pre>    def get_urls(self):</pre></div>
<div class="cov"><span class="num"><pre>263</pre></span><pre>        entry_admin_urls = super(EntryAdmin, self).get_urls()</pre></div>
<div class="cov"><span class="num"><pre>264</pre></span><pre>        urls = patterns('django.views.generic.simple',</pre></div>
<div class="cov"><span class="num"><pre>265</pre></span><pre>                        url(r'^autocomplete_tags/$', 'direct_to_template',</pre></div>
<div class="cov"><span class="num"><pre>266</pre></span><pre>                            {'template': 'admin/zinnia/entry/autocomplete_tags.js',</pre></div>
<div class="cov"><span class="num"><pre>267</pre></span><pre>                             'mimetype': 'application/javascript'},</pre></div>
<div class="cov"><span class="num"><pre>268</pre></span><pre>                            name='zinnia_entry_autocomplete_tags'),</pre></div>
<div class="cov"><span class="num"><pre>269</pre></span><pre>                        url(r'^wymeditor/$', 'direct_to_template',</pre></div>
<div class="cov"><span class="num"><pre>270</pre></span><pre>                            {'template': 'admin/zinnia/entry/wymeditor.js',</pre></div>
<div class="cov"><span class="num"><pre>271</pre></span><pre>                             'mimetype': 'application/javascript'},</pre></div>
<div class="cov"><span class="num"><pre>272</pre></span><pre>                            name='zinnia_entry_wymeditor'),)</pre></div>
<div class="cov"><span class="num"><pre>273</pre></span><pre>        return urls + entry_admin_urls</pre></div>
<div class="skip"><span class="num"><pre>274</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>275</pre></span><pre>    def _media(self):</pre></div>
<div class="cov"><span class="num"><pre>276</pre></span><pre>        MEDIA_URL = settings.MEDIA_URL</pre></div>
<div class="cov"><span class="num"><pre>277</pre></span><pre>        media = super(EntryAdmin, self).media + \</pre></div>
<div class="cov"><span class="num"><pre>278</pre></span><pre>                Media(css={'all': ('%scss/jquery.autocomplete.css' % MEDIA_URL,)},</pre></div>
<div class="cov"><span class="num"><pre>279</pre></span><pre>                      js=('%sjs/jquery.js' % MEDIA_URL,</pre></div>
<div class="cov"><span class="num"><pre>280</pre></span><pre>                          '%sjs/jquery.bgiframe.js' % MEDIA_URL,</pre></div>
<div class="cov"><span class="num"><pre>281</pre></span><pre>                          '%sjs/jquery.autocomplete.js' % MEDIA_URL,</pre></div>
<div class="cov"><span class="num"><pre>282</pre></span><pre>                          reverse('admin:zinnia_entry_autocomplete_tags'),))</pre></div>
<div class="skip"><span class="num"><pre>283</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>284</pre></span><pre>        if settings.WYSIWYG == 'wymeditor':</pre></div>
<div class="cov"><span class="num"><pre>285</pre></span><pre>            media += Media(js=('%sjs/wymeditor/jquery.wymeditor.pack.js' % MEDIA_URL,</pre></div>
<div class="cov"><span class="num"><pre>286</pre></span><pre>                               reverse('admin:zinnia_entry_wymeditor')))</pre></div>
<div class="nocov"><span class="num"><pre>287</pre></span><pre>        elif settings.WYSIWYG == 'tinymce':</pre></div>
<div class="nocov"><span class="num"><pre>288</pre></span><pre>            from tinymce.widgets import TinyMCE</pre></div>
<div class="nocov"><span class="num"><pre>289</pre></span><pre>            media += TinyMCE().media + Media(</pre></div>
<div class="nocov"><span class="num"><pre>290</pre></span><pre>                js=(reverse('tinymce-js', args=('admin/zinnia/entry',)),))</pre></div>
<div class="cov"><span class="num"><pre>291</pre></span><pre>        return media</pre></div>
<div class="cov"><span class="num"><pre>292</pre></span><pre>    media = property(_media)</pre></div>
<div class="skip"><span class="num"><pre>293</pre></span><pre></pre></div>
</div>
</body>
</html>
