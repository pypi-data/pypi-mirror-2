<html>
<head>
<title>zinnia.views.decorators</title>
</head>
<body>
zinnia.views.decorators
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 53 lines<br/>
Missed: 0 lines<br/>
Skipped 13 lines<br/>
Percent: 100 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre> 1</pre></span><pre>&quot;&quot;&quot;Decorators for zinnia.views&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 2</pre></span><pre>from django.template import RequestContext</pre></div>
<div class="cov"><span class="num"><pre> 3</pre></span><pre>from django.contrib.auth.views import login</pre></div>
<div class="cov"><span class="num"><pre> 4</pre></span><pre>from django.shortcuts import redirect</pre></div>
<div class="cov"><span class="num"><pre> 5</pre></span><pre>from django.shortcuts import get_object_or_404</pre></div>
<div class="cov"><span class="num"><pre> 6</pre></span><pre>from django.shortcuts import render_to_response</pre></div>
<div class="cov"><span class="num"><pre> 7</pre></span><pre>from django.views.decorators.csrf import csrf_protect</pre></div>
<div class="cov"><span class="num"><pre> 8</pre></span><pre>from django.views.decorators.cache import never_cache</pre></div>
<div class="skip"><span class="num"><pre> 9</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>10</pre></span><pre>from zinnia.models import Entry</pre></div>
<div class="skip"><span class="num"><pre>11</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>12</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>13</pre></span><pre>def update_queryset(view, queryset,</pre></div>
<div class="cov"><span class="num"><pre>14</pre></span><pre>                    queryset_parameter='queryset'):</pre></div>
<div class="cov"><span class="num"><pre>15</pre></span><pre>    &quot;&quot;&quot;Decorator around views based on a queryset</pre></div>
<div class="cov"><span class="num"><pre>16</pre></span><pre>    passed in parameter, who will force the update</pre></div>
<div class="cov"><span class="num"><pre>17</pre></span><pre>    of the queryset before executing the view.</pre></div>
<div class="cov"><span class="num"><pre>18</pre></span><pre>    Related to issue http://code.djangoproject.com/ticket/8378&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>19</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>20</pre></span><pre>    def wrap(*args, **kwargs):</pre></div>
<div class="cov"><span class="num"><pre>21</pre></span><pre>        &quot;&quot;&quot;Regenerate the queryset before passing it to the view.&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>22</pre></span><pre>        kwargs[queryset_parameter] = queryset()</pre></div>
<div class="cov"><span class="num"><pre>23</pre></span><pre>        return view(*args, **kwargs)</pre></div>
<div class="skip"><span class="num"><pre>24</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>25</pre></span><pre>    return wrap</pre></div>
<div class="skip"><span class="num"><pre>26</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>27</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>28</pre></span><pre>@csrf_protect</pre></div>
<div class="cov"><span class="num"><pre>29</pre></span><pre>@never_cache</pre></div>
<div class="cov"><span class="num"><pre>30</pre></span><pre>def password(request, entry):</pre></div>
<div class="cov"><span class="num"><pre>31</pre></span><pre>    &quot;&quot;&quot;Displays the password form and handle validation</pre></div>
<div class="cov"><span class="num"><pre>32</pre></span><pre>    by setting the valid password in a cookie.&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>33</pre></span><pre>    error = False</pre></div>
<div class="cov"><span class="num"><pre>34</pre></span><pre>    if request.method == 'POST':</pre></div>
<div class="cov"><span class="num"><pre>35</pre></span><pre>        if request.POST.get('password') == entry.password:</pre></div>
<div class="cov"><span class="num"><pre>36</pre></span><pre>            request.session[</pre></div>
<div class="cov"><span class="num"><pre>37</pre></span><pre>                'zinnia_entry_%s_password' % entry.pk] = entry.password</pre></div>
<div class="cov"><span class="num"><pre>38</pre></span><pre>            return redirect(entry)</pre></div>
<div class="cov"><span class="num"><pre>39</pre></span><pre>        error = True</pre></div>
<div class="cov"><span class="num"><pre>40</pre></span><pre>    return render_to_response('zinnia/password.html', {'error': error},</pre></div>
<div class="cov"><span class="num"><pre>41</pre></span><pre>                              context_instance=RequestContext(request))</pre></div>
<div class="skip"><span class="num"><pre>42</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>43</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>44</pre></span><pre>def protect_entry(view):</pre></div>
<div class="cov"><span class="num"><pre>45</pre></span><pre>    &quot;&quot;&quot;Decorator performing a security check if needed</pre></div>
<div class="cov"><span class="num"><pre>46</pre></span><pre>    around the generic.date_based.entry_detail view</pre></div>
<div class="cov"><span class="num"><pre>47</pre></span><pre>    and specify the template used to render the entry&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>48</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>49</pre></span><pre>    def wrap(*ka, **kw):</pre></div>
<div class="cov"><span class="num"><pre>50</pre></span><pre>        &quot;&quot;&quot;Do security check and retrieve the template&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>51</pre></span><pre>        request = ka[0]</pre></div>
<div class="cov"><span class="num"><pre>52</pre></span><pre>        entry = get_object_or_404(Entry, slug=kw['slug'],</pre></div>
<div class="cov"><span class="num"><pre>53</pre></span><pre>                                  creation_date__year=kw['year'],</pre></div>
<div class="cov"><span class="num"><pre>54</pre></span><pre>                                  creation_date__month=kw['month'],</pre></div>
<div class="cov"><span class="num"><pre>55</pre></span><pre>                                  creation_date__day=kw['day'])</pre></div>
<div class="skip"><span class="num"><pre>56</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>57</pre></span><pre>        if entry.login_required and not request.user.is_authenticated():</pre></div>
<div class="cov"><span class="num"><pre>58</pre></span><pre>            return login(request, 'zinnia/login.html')</pre></div>
<div class="cov"><span class="num"><pre>59</pre></span><pre>        if entry.password and entry.password != \</pre></div>
<div class="cov"><span class="num"><pre>60</pre></span><pre>               request.session.get('zinnia_entry_%s_password' % entry.pk):</pre></div>
<div class="cov"><span class="num"><pre>61</pre></span><pre>            return password(request, entry)</pre></div>
<div class="cov"><span class="num"><pre>62</pre></span><pre>        kw['template_name'] = entry.template</pre></div>
<div class="cov"><span class="num"><pre>63</pre></span><pre>        return view(*ka, **kw)</pre></div>
<div class="skip"><span class="num"><pre>64</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>65</pre></span><pre>    return wrap</pre></div>
<div class="skip"><span class="num"><pre>66</pre></span><pre></pre></div>
</div>
</body>
</html>
