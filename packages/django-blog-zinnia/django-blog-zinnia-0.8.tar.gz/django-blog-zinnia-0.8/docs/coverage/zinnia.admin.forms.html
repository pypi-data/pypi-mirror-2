<html>
<head>
<title>zinnia.admin.forms</title>
</head>
<body>
zinnia.admin.forms
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 40 lines<br/>
Missed: 9 lines<br/>
Skipped 11 lines<br/>
Percent: 81 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre> 1</pre></span><pre>&quot;&quot;&quot;Forms for Zinnia admin&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 2</pre></span><pre>from django import forms</pre></div>
<div class="cov"><span class="num"><pre> 3</pre></span><pre>from django.db.models import ManyToOneRel</pre></div>
<div class="cov"><span class="num"><pre> 4</pre></span><pre>from django.db.models import ManyToManyRel</pre></div>
<div class="cov"><span class="num"><pre> 5</pre></span><pre>from django.contrib.sites.models import Site</pre></div>
<div class="cov"><span class="num"><pre> 6</pre></span><pre>from django.utils.translation import ugettext_lazy as _</pre></div>
<div class="cov"><span class="num"><pre> 7</pre></span><pre>from django.contrib.admin.widgets import RelatedFieldWidgetWrapper</pre></div>
<div class="skip"><span class="num"><pre> 8</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 9</pre></span><pre>from zinnia.models import Entry</pre></div>
<div class="cov"><span class="num"><pre>10</pre></span><pre>from zinnia.models import Category</pre></div>
<div class="cov"><span class="num"><pre>11</pre></span><pre>from zinnia.admin.widgets import TreeNodeChoiceField</pre></div>
<div class="cov"><span class="num"><pre>12</pre></span><pre>from zinnia.admin.widgets import MPTTFilteredSelectMultiple</pre></div>
<div class="cov"><span class="num"><pre>13</pre></span><pre>from zinnia.admin.widgets import MPTTModelMultipleChoiceField</pre></div>
<div class="skip"><span class="num"><pre>14</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>15</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>16</pre></span><pre>class CategoryAdminForm(forms.ModelForm):</pre></div>
<div class="cov"><span class="num"><pre>17</pre></span><pre>    &quot;&quot;&quot;Form for Category's Admin&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>18</pre></span><pre>    parent = TreeNodeChoiceField(label=_('parent category').capitalize(),</pre></div>
<div class="cov"><span class="num"><pre>19</pre></span><pre>                                 required=False,</pre></div>
<div class="cov"><span class="num"><pre>20</pre></span><pre>                                 empty_label=_('No parent category'),</pre></div>
<div class="cov"><span class="num"><pre>21</pre></span><pre>                                 queryset=Category.tree.all(),</pre></div>
<div class="cov"><span class="num"><pre>22</pre></span><pre>                                 level_indicator=u'|--')</pre></div>
<div class="skip"><span class="num"><pre>23</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>24</pre></span><pre>    def __init__(self, *args, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>25</pre></span><pre>        super(CategoryAdminForm, self).__init__(*args, **kwargs)</pre></div>
<div class="nocov"><span class="num"><pre>26</pre></span><pre>        rel = ManyToOneRel(Category, 'id')</pre></div>
<div class="nocov"><span class="num"><pre>27</pre></span><pre>        self.fields['parent'].widget = RelatedFieldWidgetWrapper(</pre></div>
<div class="nocov"><span class="num"><pre>28</pre></span><pre>            self.fields['parent'].widget, rel, self.admin_site)</pre></div>
<div class="skip"><span class="num"><pre>29</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>30</pre></span><pre>    def clean_parent(self):</pre></div>
<div class="cov"><span class="num"><pre>31</pre></span><pre>        &quot;&quot;&quot;Check if category parent is not selfish&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>32</pre></span><pre>        data = self.cleaned_data['parent']</pre></div>
<div class="nocov"><span class="num"><pre>33</pre></span><pre>        if data == self.instance:</pre></div>
<div class="nocov"><span class="num"><pre>34</pre></span><pre>            raise forms.ValidationError(</pre></div>
<div class="nocov"><span class="num"><pre>35</pre></span><pre>                _('A category cannot be parent of itself.'))</pre></div>
<div class="nocov"><span class="num"><pre>36</pre></span><pre>        return data</pre></div>
<div class="skip"><span class="num"><pre>37</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>38</pre></span><pre>    class Meta:</pre></div>
<div class="cov"><span class="num"><pre>39</pre></span><pre>        &quot;&quot;&quot;CategoryAdminForm's Meta&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>40</pre></span><pre>        model = Category</pre></div>
<div class="skip"><span class="num"><pre>41</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>42</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>43</pre></span><pre>class EntryAdminForm(forms.ModelForm):</pre></div>
<div class="cov"><span class="num"><pre>44</pre></span><pre>    &quot;&quot;&quot;Form for Entry's Admin&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>45</pre></span><pre>    categories = MPTTModelMultipleChoiceField(</pre></div>
<div class="cov"><span class="num"><pre>46</pre></span><pre>        Category.objects.all(), required=False, label=_('Categories'),</pre></div>
<div class="cov"><span class="num"><pre>47</pre></span><pre>        widget=MPTTFilteredSelectMultiple(_('categories'), False,</pre></div>
<div class="cov"><span class="num"><pre>48</pre></span><pre>                                          attrs={'rows': '10'}))</pre></div>
<div class="skip"><span class="num"><pre>49</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>50</pre></span><pre>    def __init__(self, *args, **kwargs):</pre></div>
<div class="cov"><span class="num"><pre>51</pre></span><pre>        super(EntryAdminForm, self).__init__(*args, **kwargs)</pre></div>
<div class="cov"><span class="num"><pre>52</pre></span><pre>        rel = ManyToManyRel(Category, 'id')</pre></div>
<div class="cov"><span class="num"><pre>53</pre></span><pre>        self.fields['categories'].widget = RelatedFieldWidgetWrapper(</pre></div>
<div class="cov"><span class="num"><pre>54</pre></span><pre>            self.fields['categories'].widget, rel, self.admin_site)</pre></div>
<div class="cov"><span class="num"><pre>55</pre></span><pre>        self.fields['sites'].initial = [Site.objects.get_current()]</pre></div>
<div class="skip"><span class="num"><pre>56</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>57</pre></span><pre>    class Meta:</pre></div>
<div class="cov"><span class="num"><pre>58</pre></span><pre>        &quot;&quot;&quot;EntryAdminForm's Meta&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>59</pre></span><pre>        model = Entry</pre></div>
<div class="skip"><span class="num"><pre>60</pre></span><pre></pre></div>
</div>
</body>
</html>
