<html>
<head>
<title>zinnia.templatetags.zinnia_tags</title>
</head>
<body>
zinnia.templatetags.zinnia_tags
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 189 lines<br/>
Missed: 5 lines<br/>
Skipped 59 lines<br/>
Percent: 97 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre>  1</pre></span><pre>&quot;&quot;&quot;Template tags and filters for Zinnia&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>  2</pre></span><pre>try:</pre></div>
<div class="cov"><span class="num"><pre>  3</pre></span><pre>    from hashlib import md5</pre></div>
<div class="nocov"><span class="num"><pre>  4</pre></span><pre>except ImportError:</pre></div>
<div class="nocov"><span class="num"><pre>  5</pre></span><pre>    from md5 import new as md5</pre></div>
<div class="skip"><span class="num"><pre>  6</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  7</pre></span><pre>from random import sample</pre></div>
<div class="cov"><span class="num"><pre>  8</pre></span><pre>from urllib import urlencode</pre></div>
<div class="cov"><span class="num"><pre>  9</pre></span><pre>from datetime import datetime</pre></div>
<div class="skip"><span class="num"><pre> 10</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 11</pre></span><pre>from django.db import connection</pre></div>
<div class="cov"><span class="num"><pre> 12</pre></span><pre>from django.template import Library</pre></div>
<div class="cov"><span class="num"><pre> 13</pre></span><pre>from django.contrib.comments.models import Comment</pre></div>
<div class="cov"><span class="num"><pre> 14</pre></span><pre>from django.contrib.contenttypes.models import ContentType</pre></div>
<div class="cov"><span class="num"><pre> 15</pre></span><pre>from django.utils.encoding import smart_unicode</pre></div>
<div class="skip"><span class="num"><pre> 16</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 17</pre></span><pre>from zinnia.models import Entry</pre></div>
<div class="cov"><span class="num"><pre> 18</pre></span><pre>from zinnia.models import Author</pre></div>
<div class="cov"><span class="num"><pre> 19</pre></span><pre>from zinnia.models import Category</pre></div>
<div class="cov"><span class="num"><pre> 20</pre></span><pre>from zinnia.comparison import VectorBuilder</pre></div>
<div class="cov"><span class="num"><pre> 21</pre></span><pre>from zinnia.comparison import pearson_score</pre></div>
<div class="cov"><span class="num"><pre> 22</pre></span><pre>from zinnia.templatetags.zbreadcrumbs import retrieve_breadcrumbs</pre></div>
<div class="skip"><span class="num"><pre> 23</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 24</pre></span><pre>register = Library()</pre></div>
<div class="skip"><span class="num"><pre> 25</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 26</pre></span><pre>VECTORS = None</pre></div>
<div class="cov"><span class="num"><pre> 27</pre></span><pre>VECTORS_FACTORY = lambda: VectorBuilder({'queryset': Entry.published.all(),</pre></div>
<div class="cov"><span class="num"><pre> 28</pre></span><pre>                                         'fields': ['title', 'excerpt',</pre></div>
<div class="cov"><span class="num"><pre> 29</pre></span><pre>                                                    'content']})</pre></div>
<div class="cov"><span class="num"><pre> 30</pre></span><pre>CACHE_ENTRIES_RELATED = {}</pre></div>
<div class="skip"><span class="num"><pre> 31</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 32</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 33</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre> 34</pre></span><pre>def get_categories(template='zinnia/tags/categories.html'):</pre></div>
<div class="cov"><span class="num"><pre> 35</pre></span><pre>    &quot;&quot;&quot;Return the categories&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 36</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre> 37</pre></span><pre>            'categories': Category.tree.all()}</pre></div>
<div class="skip"><span class="num"><pre> 38</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 39</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 40</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre> 41</pre></span><pre>def get_authors(template='zinnia/tags/authors.html'):</pre></div>
<div class="cov"><span class="num"><pre> 42</pre></span><pre>    &quot;&quot;&quot;Return the published authors&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 43</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre> 44</pre></span><pre>            'authors': Author.published.all()}</pre></div>
<div class="skip"><span class="num"><pre> 45</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 46</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 47</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre> 48</pre></span><pre>def get_recent_entries(number=5, template='zinnia/tags/recent_entries.html'):</pre></div>
<div class="cov"><span class="num"><pre> 49</pre></span><pre>    &quot;&quot;&quot;Return the most recent entries&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 50</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre> 51</pre></span><pre>            'entries': Entry.published.all()[:number]}</pre></div>
<div class="skip"><span class="num"><pre> 52</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 53</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 54</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre> 55</pre></span><pre>def get_featured_entries(number=5, template='zinnia/tags/featured_entries.html'):</pre></div>
<div class="cov"><span class="num"><pre> 56</pre></span><pre>    &quot;&quot;&quot;Return the featured entries&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 57</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre> 58</pre></span><pre>            'entries': Entry.published.filter(featured=True)[:number]}</pre></div>
<div class="skip"><span class="num"><pre> 59</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 60</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 61</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre> 62</pre></span><pre>def get_random_entries(number=5, template='zinnia/tags/random_entries.html'):</pre></div>
<div class="cov"><span class="num"><pre> 63</pre></span><pre>    &quot;&quot;&quot;Return random entries&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 64</pre></span><pre>    entries = Entry.published.all()</pre></div>
<div class="cov"><span class="num"><pre> 65</pre></span><pre>    if number &gt; len(entries):</pre></div>
<div class="cov"><span class="num"><pre> 66</pre></span><pre>        number = len(entries)</pre></div>
<div class="cov"><span class="num"><pre> 67</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre> 68</pre></span><pre>            'entries': sample(entries, number)}</pre></div>
<div class="skip"><span class="num"><pre> 69</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 70</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 71</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre> 72</pre></span><pre>def get_popular_entries(number=5, template='zinnia/tags/popular_entries.html'):</pre></div>
<div class="cov"><span class="num"><pre> 73</pre></span><pre>    &quot;&quot;&quot;Return popular  entries&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 74</pre></span><pre>    ctype = ContentType.objects.get_for_model(Entry)</pre></div>
<div class="cov"><span class="num"><pre> 75</pre></span><pre>    query = &quot;&quot;&quot;SELECT object_pk, COUNT(*) AS score</pre></div>
<div class="cov"><span class="num"><pre> 76</pre></span><pre>    FROM %s</pre></div>
<div class="cov"><span class="num"><pre> 77</pre></span><pre>    WHERE content_type_id = %%s</pre></div>
<div class="cov"><span class="num"><pre> 78</pre></span><pre>    AND is_public = '1'</pre></div>
<div class="cov"><span class="num"><pre> 79</pre></span><pre>    GROUP BY object_pk</pre></div>
<div class="cov"><span class="num"><pre> 80</pre></span><pre>    ORDER BY score DESC&quot;&quot;&quot; % Comment._meta.db_table</pre></div>
<div class="skip"><span class="num"><pre> 81</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 82</pre></span><pre>    cursor = connection.cursor()</pre></div>
<div class="cov"><span class="num"><pre> 83</pre></span><pre>    cursor.execute(query, [ctype.id])</pre></div>
<div class="cov"><span class="num"><pre> 84</pre></span><pre>    object_ids = [int(row[0]) for row in cursor.fetchall()]</pre></div>
<div class="skip"><span class="num"><pre> 85</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 86</pre></span><pre>    # Use ``in_bulk`` here instead of an ``id__in`` filter, because ``id__in``</pre></div>
<div class="skip"><span class="num"><pre> 87</pre></span><pre>    # would clobber the ordering.</pre></div>
<div class="cov"><span class="num"><pre> 88</pre></span><pre>    object_dict = Entry.published.in_bulk(object_ids)</pre></div>
<div class="skip"><span class="num"><pre> 89</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 90</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre> 91</pre></span><pre>            'entries': [object_dict[object_id]</pre></div>
<div class="cov"><span class="num"><pre> 92</pre></span><pre>                        for object_id in object_ids</pre></div>
<div class="cov"><span class="num"><pre> 93</pre></span><pre>                        if object_id in object_dict][:number]}</pre></div>
<div class="skip"><span class="num"><pre> 94</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 95</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 96</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html', takes_context=True)</pre></div>
<div class="cov"><span class="num"><pre> 97</pre></span><pre>def get_similar_entries(context, number=5,</pre></div>
<div class="cov"><span class="num"><pre> 98</pre></span><pre>                        template='zinnia/tags/similar_entries.html',</pre></div>
<div class="cov"><span class="num"><pre> 99</pre></span><pre>                        flush=False):</pre></div>
<div class="cov"><span class="num"><pre>100</pre></span><pre>    &quot;&quot;&quot;Return similar entries&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>101</pre></span><pre>    global VECTORS</pre></div>
<div class="cov"><span class="num"><pre>102</pre></span><pre>    global CACHE_ENTRIES_RELATED</pre></div>
<div class="skip"><span class="num"><pre>103</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>104</pre></span><pre>    if VECTORS is None or flush:</pre></div>
<div class="cov"><span class="num"><pre>105</pre></span><pre>        VECTORS = VECTORS_FACTORY()</pre></div>
<div class="cov"><span class="num"><pre>106</pre></span><pre>        CACHE_ENTRIES_RELATED = {}</pre></div>
<div class="skip"><span class="num"><pre>107</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>108</pre></span><pre>    def compute_related(object_id, dataset):</pre></div>
<div class="cov"><span class="num"><pre>109</pre></span><pre>        &quot;&quot;&quot;Compute related entries to an entry with a dataset&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>110</pre></span><pre>        object_vector = None</pre></div>
<div class="cov"><span class="num"><pre>111</pre></span><pre>        for entry, e_vector in dataset.items():</pre></div>
<div class="cov"><span class="num"><pre>112</pre></span><pre>            if entry.pk == object_id:</pre></div>
<div class="cov"><span class="num"><pre>113</pre></span><pre>                object_vector = e_vector</pre></div>
<div class="skip"><span class="num"><pre>114</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>115</pre></span><pre>        if not object_vector:</pre></div>
<div class="cov"><span class="num"><pre>116</pre></span><pre>            return []</pre></div>
<div class="skip"><span class="num"><pre>117</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>118</pre></span><pre>        entry_related = {}</pre></div>
<div class="cov"><span class="num"><pre>119</pre></span><pre>        for entry, e_vector in dataset.items():</pre></div>
<div class="cov"><span class="num"><pre>120</pre></span><pre>            if entry.pk != object_id:</pre></div>
<div class="cov"><span class="num"><pre>121</pre></span><pre>                score = pearson_score(object_vector, e_vector)</pre></div>
<div class="cov"><span class="num"><pre>122</pre></span><pre>                if score:</pre></div>
<div class="cov"><span class="num"><pre>123</pre></span><pre>                    entry_related[entry] = score</pre></div>
<div class="skip"><span class="num"><pre>124</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>125</pre></span><pre>        related = sorted(entry_related.items(), key=lambda(k, v): (v, k))</pre></div>
<div class="cov"><span class="num"><pre>126</pre></span><pre>        return [rel[0] for rel in related]</pre></div>
<div class="skip"><span class="num"><pre>127</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>128</pre></span><pre>    object_id = context['object'].pk</pre></div>
<div class="cov"><span class="num"><pre>129</pre></span><pre>    columns, dataset = VECTORS()</pre></div>
<div class="cov"><span class="num"><pre>130</pre></span><pre>    key = '%s-%s' % (object_id, VECTORS.key)</pre></div>
<div class="cov"><span class="num"><pre>131</pre></span><pre>    if not key in CACHE_ENTRIES_RELATED.keys():</pre></div>
<div class="cov"><span class="num"><pre>132</pre></span><pre>        CACHE_ENTRIES_RELATED[key] = compute_related(object_id, dataset)</pre></div>
<div class="skip"><span class="num"><pre>133</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>134</pre></span><pre>    entries = CACHE_ENTRIES_RELATED[key][:number]</pre></div>
<div class="cov"><span class="num"><pre>135</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre>136</pre></span><pre>            'entries': entries}</pre></div>
<div class="skip"><span class="num"><pre>137</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>138</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>139</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre>140</pre></span><pre>def get_archives_entries(template='zinnia/tags/archives_entries.html'):</pre></div>
<div class="cov"><span class="num"><pre>141</pre></span><pre>    &quot;&quot;&quot;Return archives entries&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>142</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre>143</pre></span><pre>            'archives': Entry.published.dates('creation_date', 'month',</pre></div>
<div class="cov"><span class="num"><pre>144</pre></span><pre>                                              order='DESC')}</pre></div>
<div class="skip"><span class="num"><pre>145</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>146</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>147</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre>148</pre></span><pre>def get_archives_entries_tree(</pre></div>
<div class="cov"><span class="num"><pre>149</pre></span><pre>    template='zinnia/tags/archives_entries_tree.html'):</pre></div>
<div class="cov"><span class="num"><pre>150</pre></span><pre>    &quot;&quot;&quot;Return archives entries as a Tree&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>151</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre>152</pre></span><pre>            'archives': Entry.published.dates('creation_date', 'day',</pre></div>
<div class="cov"><span class="num"><pre>153</pre></span><pre>                                              order='ASC')}</pre></div>
<div class="skip"><span class="num"><pre>154</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>155</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>156</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html', takes_context=True)</pre></div>
<div class="cov"><span class="num"><pre>157</pre></span><pre>def get_calendar_entries(context, year=None, month=None,</pre></div>
<div class="cov"><span class="num"><pre>158</pre></span><pre>                         template='zinnia/tags/calendar.html'):</pre></div>
<div class="cov"><span class="num"><pre>159</pre></span><pre>    &quot;&quot;&quot;Return an HTML calendar of entries&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>160</pre></span><pre>    if not year or not month:</pre></div>
<div class="cov"><span class="num"><pre>161</pre></span><pre>        date_month = context.get('month') or context.get('day') or \</pre></div>
<div class="cov"><span class="num"><pre>162</pre></span><pre>                     getattr(context.get('object'), 'creation_date', None) or \</pre></div>
<div class="cov"><span class="num"><pre>163</pre></span><pre>                     datetime.today()</pre></div>
<div class="cov"><span class="num"><pre>164</pre></span><pre>        year, month = date_month.timetuple()[:2]</pre></div>
<div class="skip"><span class="num"><pre>165</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>166</pre></span><pre>    try:</pre></div>
<div class="cov"><span class="num"><pre>167</pre></span><pre>        from zinnia.templatetags.zcalendar import ZinniaCalendar</pre></div>
<div class="nocov"><span class="num"><pre>168</pre></span><pre>    except ImportError:</pre></div>
<div class="nocov"><span class="num"><pre>169</pre></span><pre>        return {'calendar':</pre></div>
<div class="nocov"><span class="num"><pre>170</pre></span><pre>                '&lt;p class=&quot;notice&quot;&gt;Calendar is unavailable for Python&lt;2.5.&lt;/p&gt;'}</pre></div>
<div class="skip"><span class="num"><pre>171</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>172</pre></span><pre>    calendar = ZinniaCalendar()</pre></div>
<div class="cov"><span class="num"><pre>173</pre></span><pre>    current_month = datetime(year, month, 1)</pre></div>
<div class="skip"><span class="num"><pre>174</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>175</pre></span><pre>    dates = list(Entry.published.dates('creation_date', 'month'))</pre></div>
<div class="skip"><span class="num"><pre>176</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>177</pre></span><pre>    if not current_month in dates:</pre></div>
<div class="cov"><span class="num"><pre>178</pre></span><pre>        dates.append(current_month)</pre></div>
<div class="cov"><span class="num"><pre>179</pre></span><pre>        dates.sort()</pre></div>
<div class="cov"><span class="num"><pre>180</pre></span><pre>    index = dates.index(current_month)</pre></div>
<div class="skip"><span class="num"><pre>181</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>182</pre></span><pre>    previous_month = index &gt; 0 and dates[index - 1] or None</pre></div>
<div class="cov"><span class="num"><pre>183</pre></span><pre>    next_month = index != len(dates) - 1 and dates[index + 1] or None</pre></div>
<div class="skip"><span class="num"><pre>184</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>185</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre>186</pre></span><pre>            'next_month': next_month,</pre></div>
<div class="cov"><span class="num"><pre>187</pre></span><pre>            'previous_month': previous_month,</pre></div>
<div class="cov"><span class="num"><pre>188</pre></span><pre>            'calendar': calendar.formatmonth(year, month)}</pre></div>
<div class="skip"><span class="num"><pre>189</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>190</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>191</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre>192</pre></span><pre>def get_recent_comments(number=5, template='zinnia/tags/recent_comments.html'):</pre></div>
<div class="cov"><span class="num"><pre>193</pre></span><pre>    &quot;&quot;&quot;Return the most recent comments&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>194</pre></span><pre>    # Using map(smart_unicode... fix bug related to issue #8554</pre></div>
<div class="cov"><span class="num"><pre>195</pre></span><pre>    entry_published_pks = map(smart_unicode,</pre></div>
<div class="cov"><span class="num"><pre>196</pre></span><pre>                              Entry.published.values_list('id', flat=True))</pre></div>
<div class="cov"><span class="num"><pre>197</pre></span><pre>    content_type = ContentType.objects.get_for_model(Entry)</pre></div>
<div class="skip"><span class="num"><pre>198</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>199</pre></span><pre>    comments = Comment.objects.filter(</pre></div>
<div class="cov"><span class="num"><pre>200</pre></span><pre>        content_type=content_type,</pre></div>
<div class="cov"><span class="num"><pre>201</pre></span><pre>        object_pk__in=entry_published_pks,</pre></div>
<div class="cov"><span class="num"><pre>202</pre></span><pre>        flags__flag=None, is_public=True).order_by(</pre></div>
<div class="cov"><span class="num"><pre>203</pre></span><pre>        '-submit_date')[:number]</pre></div>
<div class="skip"><span class="num"><pre>204</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>205</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre>206</pre></span><pre>            'comments': comments}</pre></div>
<div class="skip"><span class="num"><pre>207</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>208</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>209</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html')</pre></div>
<div class="cov"><span class="num"><pre>210</pre></span><pre>def get_recent_linkbacks(number=5,</pre></div>
<div class="cov"><span class="num"><pre>211</pre></span><pre>                         template='zinnia/tags/recent_linkbacks.html'):</pre></div>
<div class="cov"><span class="num"><pre>212</pre></span><pre>    &quot;&quot;&quot;Return the most recent linkbacks&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>213</pre></span><pre>    entry_published_pks = map(smart_unicode,</pre></div>
<div class="cov"><span class="num"><pre>214</pre></span><pre>                              Entry.published.values_list('id', flat=True))</pre></div>
<div class="cov"><span class="num"><pre>215</pre></span><pre>    content_type = ContentType.objects.get_for_model(Entry)</pre></div>
<div class="skip"><span class="num"><pre>216</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>217</pre></span><pre>    linkbacks = Comment.objects.filter(</pre></div>
<div class="cov"><span class="num"><pre>218</pre></span><pre>        content_type=content_type,</pre></div>
<div class="cov"><span class="num"><pre>219</pre></span><pre>        object_pk__in=entry_published_pks,</pre></div>
<div class="cov"><span class="num"><pre>220</pre></span><pre>        flags__flag__in=['pingback', 'trackback'],</pre></div>
<div class="cov"><span class="num"><pre>221</pre></span><pre>        is_public=True).order_by(</pre></div>
<div class="cov"><span class="num"><pre>222</pre></span><pre>        '-submit_date')[:number]</pre></div>
<div class="skip"><span class="num"><pre>223</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>224</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre>225</pre></span><pre>            'linkbacks': linkbacks}</pre></div>
<div class="skip"><span class="num"><pre>226</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>227</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>228</pre></span><pre>@register.inclusion_tag('zinnia/tags/dummy.html', takes_context=True)</pre></div>
<div class="cov"><span class="num"><pre>229</pre></span><pre>def zinnia_breadcrumbs(context, separator='/', root_name='Blog',</pre></div>
<div class="cov"><span class="num"><pre>230</pre></span><pre>                       template='zinnia/tags/breadcrumbs.html',):</pre></div>
<div class="cov"><span class="num"><pre>231</pre></span><pre>    &quot;&quot;&quot;Return a breadcrumb for the application&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>232</pre></span><pre>    path = context['request'].path</pre></div>
<div class="cov"><span class="num"><pre>233</pre></span><pre>    page_object = context.get('object') or context.get('category') or \</pre></div>
<div class="cov"><span class="num"><pre>234</pre></span><pre>                  context.get('tag') or context.get('author')</pre></div>
<div class="cov"><span class="num"><pre>235</pre></span><pre>    breadcrumbs = retrieve_breadcrumbs(path, page_object, root_name)</pre></div>
<div class="skip"><span class="num"><pre>236</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>237</pre></span><pre>    return {'template': template,</pre></div>
<div class="cov"><span class="num"><pre>238</pre></span><pre>            'separator': separator,</pre></div>
<div class="cov"><span class="num"><pre>239</pre></span><pre>            'breadcrumbs': breadcrumbs}</pre></div>
<div class="skip"><span class="num"><pre>240</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>241</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>242</pre></span><pre>@register.simple_tag</pre></div>
<div class="cov"><span class="num"><pre>243</pre></span><pre>def get_gravatar(email, size=80, rating='g', default=None):</pre></div>
<div class="cov"><span class="num"><pre>244</pre></span><pre>    &quot;&quot;&quot;Return url for a Gravatar&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>245</pre></span><pre>    url = 'http://www.gravatar.com/avatar/%s.jpg' % \</pre></div>
<div class="cov"><span class="num"><pre>246</pre></span><pre>          md5(email.strip().lower()).hexdigest()</pre></div>
<div class="cov"><span class="num"><pre>247</pre></span><pre>    options = {'s': size, 'r': rating}</pre></div>
<div class="cov"><span class="num"><pre>248</pre></span><pre>    if default:</pre></div>
<div class="cov"><span class="num"><pre>249</pre></span><pre>        options['d'] = default</pre></div>
<div class="skip"><span class="num"><pre>250</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>251</pre></span><pre>    url = '%s?%s' % (url, urlencode(options))</pre></div>
<div class="cov"><span class="num"><pre>252</pre></span><pre>    return url.replace('&amp;', '&amp;amp;')</pre></div>
<div class="skip"><span class="num"><pre>253</pre></span><pre></pre></div>
</div>
</body>
</html>
