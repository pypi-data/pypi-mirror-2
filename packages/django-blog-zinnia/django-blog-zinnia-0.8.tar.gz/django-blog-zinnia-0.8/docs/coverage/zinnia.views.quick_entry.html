<html>
<head>
<title>zinnia.views.quick_entry</title>
</head>
<body>
zinnia.views.quick_entry
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 44 lines<br/>
Missed: 0 lines<br/>
Skipped 10 lines<br/>
Percent: 100 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre> 1</pre></span><pre>&quot;&quot;&quot;Views for Zinnia quick entry&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 2</pre></span><pre>from urllib import urlencode</pre></div>
<div class="skip"><span class="num"><pre> 3</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 4</pre></span><pre>from django import forms</pre></div>
<div class="cov"><span class="num"><pre> 5</pre></span><pre>from django.utils.html import linebreaks</pre></div>
<div class="cov"><span class="num"><pre> 6</pre></span><pre>from django.shortcuts import redirect</pre></div>
<div class="cov"><span class="num"><pre> 7</pre></span><pre>from django.core.urlresolvers import reverse</pre></div>
<div class="cov"><span class="num"><pre> 8</pre></span><pre>from django.contrib.sites.models import Site</pre></div>
<div class="cov"><span class="num"><pre> 9</pre></span><pre>from django.template.defaultfilters import slugify</pre></div>
<div class="cov"><span class="num"><pre>10</pre></span><pre>from django.utils.encoding import smart_str</pre></div>
<div class="cov"><span class="num"><pre>11</pre></span><pre>from django.contrib.auth.decorators import permission_required</pre></div>
<div class="skip"><span class="num"><pre>12</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>13</pre></span><pre>from zinnia.models import Entry</pre></div>
<div class="cov"><span class="num"><pre>14</pre></span><pre>from zinnia.managers import DRAFT</pre></div>
<div class="cov"><span class="num"><pre>15</pre></span><pre>from zinnia.managers import PUBLISHED</pre></div>
<div class="skip"><span class="num"><pre>16</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>17</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>18</pre></span><pre>class QuickEntryForm(forms.Form):</pre></div>
<div class="cov"><span class="num"><pre>19</pre></span><pre>    &quot;&quot;&quot;Form for posting an entry quickly&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>20</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>21</pre></span><pre>    title = forms.CharField(required=True, max_length=255)</pre></div>
<div class="cov"><span class="num"><pre>22</pre></span><pre>    content = forms.CharField(required=True)</pre></div>
<div class="cov"><span class="num"><pre>23</pre></span><pre>    tags = forms.CharField(required=False, max_length=255)</pre></div>
<div class="skip"><span class="num"><pre>24</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>25</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>26</pre></span><pre>@permission_required('zinnia.add_entry')</pre></div>
<div class="cov"><span class="num"><pre>27</pre></span><pre>def view_quick_entry(request):</pre></div>
<div class="cov"><span class="num"><pre>28</pre></span><pre>    &quot;&quot;&quot;View for quickly post an Entry&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>29</pre></span><pre>    if request.POST:</pre></div>
<div class="cov"><span class="num"><pre>30</pre></span><pre>        form = QuickEntryForm(request.POST)</pre></div>
<div class="cov"><span class="num"><pre>31</pre></span><pre>        if form.is_valid():</pre></div>
<div class="cov"><span class="num"><pre>32</pre></span><pre>            entry_dict = form.cleaned_data</pre></div>
<div class="cov"><span class="num"><pre>33</pre></span><pre>            status = PUBLISHED</pre></div>
<div class="cov"><span class="num"><pre>34</pre></span><pre>            if 'save_draft' in request.POST:</pre></div>
<div class="cov"><span class="num"><pre>35</pre></span><pre>                status = DRAFT</pre></div>
<div class="cov"><span class="num"><pre>36</pre></span><pre>            entry_dict['content'] = linebreaks(entry_dict['content'])</pre></div>
<div class="cov"><span class="num"><pre>37</pre></span><pre>            entry_dict['slug'] = slugify(entry_dict['title'])</pre></div>
<div class="cov"><span class="num"><pre>38</pre></span><pre>            entry_dict['status'] = status</pre></div>
<div class="cov"><span class="num"><pre>39</pre></span><pre>            entry = Entry.objects.create(**entry_dict)</pre></div>
<div class="cov"><span class="num"><pre>40</pre></span><pre>            entry.sites.add(Site.objects.get_current())</pre></div>
<div class="cov"><span class="num"><pre>41</pre></span><pre>            entry.authors.add(request.user)</pre></div>
<div class="cov"><span class="num"><pre>42</pre></span><pre>            return redirect(entry)</pre></div>
<div class="skip"><span class="num"><pre>43</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>44</pre></span><pre>        data = {'title': smart_str(request.POST.get('title', '')),</pre></div>
<div class="cov"><span class="num"><pre>45</pre></span><pre>                'content': smart_str(linebreaks(request.POST.get('content', ''))),</pre></div>
<div class="cov"><span class="num"><pre>46</pre></span><pre>                'tags': smart_str(request.POST.get('tags', '')),</pre></div>
<div class="cov"><span class="num"><pre>47</pre></span><pre>                'slug': slugify(request.POST.get('title', '')),</pre></div>
<div class="cov"><span class="num"><pre>48</pre></span><pre>                'authors': request.user.pk,</pre></div>
<div class="cov"><span class="num"><pre>49</pre></span><pre>                'sites': Site.objects.get_current().pk}</pre></div>
<div class="cov"><span class="num"><pre>50</pre></span><pre>        return redirect('%s?%s' % (reverse('admin:zinnia_entry_add'),</pre></div>
<div class="cov"><span class="num"><pre>51</pre></span><pre>                                   urlencode(data)))</pre></div>
<div class="skip"><span class="num"><pre>52</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>53</pre></span><pre>    return redirect('admin:zinnia_entry_add')</pre></div>
<div class="skip"><span class="num"><pre>54</pre></span><pre></pre></div>
</div>
</body>
</html>
