<html>
<head>
<title>zinnia.templatetags.zbreadcrumbs</title>
</head>
<body>
zinnia.templatetags.zbreadcrumbs
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 80 lines<br/>
Missed: 0 lines<br/>
Skipped 23 lines<br/>
Percent: 100 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre>  1</pre></span><pre>&quot;&quot;&quot;Breadcrumb module for Zinnia templatetags&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>  2</pre></span><pre>import re</pre></div>
<div class="cov"><span class="num"><pre>  3</pre></span><pre>from datetime import datetime</pre></div>
<div class="skip"><span class="num"><pre>  4</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  5</pre></span><pre>from django.core.urlresolvers import reverse</pre></div>
<div class="cov"><span class="num"><pre>  6</pre></span><pre>from django.utils.translation import ugettext as _</pre></div>
<div class="skip"><span class="num"><pre>  7</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>  8</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  9</pre></span><pre>class Crumb(object):</pre></div>
<div class="cov"><span class="num"><pre> 10</pre></span><pre>    &quot;&quot;&quot;Part of the Breadcrumbs&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 11</pre></span><pre>    def __init__(self, name, url=None):</pre></div>
<div class="cov"><span class="num"><pre> 12</pre></span><pre>        self.name = name</pre></div>
<div class="cov"><span class="num"><pre> 13</pre></span><pre>        self.url = url</pre></div>
<div class="skip"><span class="num"><pre> 14</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 15</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 16</pre></span><pre>def year_crumb(creation_date):</pre></div>
<div class="cov"><span class="num"><pre> 17</pre></span><pre>    &quot;&quot;&quot;Crumb for a year&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 18</pre></span><pre>    year = creation_date.strftime('%Y')</pre></div>
<div class="cov"><span class="num"><pre> 19</pre></span><pre>    return Crumb(year, reverse('zinnia_entry_archive_year',</pre></div>
<div class="cov"><span class="num"><pre> 20</pre></span><pre>                               args=[year]))</pre></div>
<div class="skip"><span class="num"><pre> 21</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 22</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 23</pre></span><pre>def month_crumb(creation_date):</pre></div>
<div class="cov"><span class="num"><pre> 24</pre></span><pre>    &quot;&quot;&quot;Crumb for a month&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 25</pre></span><pre>    year = creation_date.strftime('%Y')</pre></div>
<div class="cov"><span class="num"><pre> 26</pre></span><pre>    month = creation_date.strftime('%m')</pre></div>
<div class="cov"><span class="num"><pre> 27</pre></span><pre>    month_text = creation_date.strftime('%b').capitalize()</pre></div>
<div class="cov"><span class="num"><pre> 28</pre></span><pre>    return Crumb(month_text, reverse('zinnia_entry_archive_month',</pre></div>
<div class="cov"><span class="num"><pre> 29</pre></span><pre>                                     args=[year, month]))</pre></div>
<div class="skip"><span class="num"><pre> 30</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 31</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 32</pre></span><pre>def day_crumb(creation_date):</pre></div>
<div class="cov"><span class="num"><pre> 33</pre></span><pre>    &quot;&quot;&quot;Crumb for a day&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 34</pre></span><pre>    year = creation_date.strftime('%Y')</pre></div>
<div class="cov"><span class="num"><pre> 35</pre></span><pre>    month = creation_date.strftime('%m')</pre></div>
<div class="cov"><span class="num"><pre> 36</pre></span><pre>    day = creation_date.strftime('%d')</pre></div>
<div class="cov"><span class="num"><pre> 37</pre></span><pre>    return Crumb(day, reverse('zinnia_entry_archive_day',</pre></div>
<div class="cov"><span class="num"><pre> 38</pre></span><pre>                              args=[year, month, day]))</pre></div>
<div class="skip"><span class="num"><pre> 39</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 40</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 41</pre></span><pre>ZINNIA_ROOT_URL = lambda: reverse('zinnia_entry_archive_index')</pre></div>
<div class="skip"><span class="num"><pre> 42</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 43</pre></span><pre>MODEL_BREADCRUMBS = {'Tag': lambda x: [Crumb(_('Tags'),</pre></div>
<div class="cov"><span class="num"><pre> 44</pre></span><pre>                                             reverse('zinnia_tag_list')),</pre></div>
<div class="cov"><span class="num"><pre> 45</pre></span><pre>                                       Crumb(x.name)],</pre></div>
<div class="cov"><span class="num"><pre> 46</pre></span><pre>                     'Author': lambda x: [Crumb(_('Authors'),</pre></div>
<div class="cov"><span class="num"><pre> 47</pre></span><pre>                                              reverse('zinnia_author_list')),</pre></div>
<div class="cov"><span class="num"><pre> 48</pre></span><pre>                                        Crumb(x.username)],</pre></div>
<div class="cov"><span class="num"><pre> 49</pre></span><pre>                     'Category': lambda x: [Crumb(_('Categories'),</pre></div>
<div class="cov"><span class="num"><pre> 50</pre></span><pre>                                                  reverse('zinnia_category_list'))] + \</pre></div>
<div class="cov"><span class="num"><pre> 51</pre></span><pre>                                           [Crumb(anc.title,</pre></div>
<div class="cov"><span class="num"><pre> 52</pre></span><pre>                                                  anc.get_absolute_url())</pre></div>
<div class="cov"><span class="num"><pre> 53</pre></span><pre>                                            for anc in x.get_ancestors()] + \</pre></div>
<div class="cov"><span class="num"><pre> 54</pre></span><pre>                                           [Crumb(x.title)],</pre></div>
<div class="cov"><span class="num"><pre> 55</pre></span><pre>                     'Entry': lambda x: [year_crumb(x.creation_date),</pre></div>
<div class="cov"><span class="num"><pre> 56</pre></span><pre>                                         month_crumb(x.creation_date),</pre></div>
<div class="cov"><span class="num"><pre> 57</pre></span><pre>                                         day_crumb(x.creation_date),</pre></div>
<div class="cov"><span class="num"><pre> 58</pre></span><pre>                                         Crumb(x.title)]}</pre></div>
<div class="skip"><span class="num"><pre> 59</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 60</pre></span><pre>DATE_REGEXP = re.compile(</pre></div>
<div class="cov"><span class="num"><pre> 61</pre></span><pre>    r'.*(?P&lt;year&gt;\d{4})/(?P&lt;month&gt;\d{2})?/(?P&lt;day&gt;\d{2})?.*')</pre></div>
<div class="skip"><span class="num"><pre> 62</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 63</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 64</pre></span><pre>def retrieve_breadcrumbs(path, model_instance, root_name=''):</pre></div>
<div class="cov"><span class="num"><pre> 65</pre></span><pre>    &quot;&quot;&quot;Build a semi-hardcoded breadcrumbs</pre></div>
<div class="cov"><span class="num"><pre> 66</pre></span><pre>    based of the model's url handled by Zinnia&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 67</pre></span><pre>    breadcrumbs = []</pre></div>
<div class="skip"><span class="num"><pre> 68</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 69</pre></span><pre>    if root_name:</pre></div>
<div class="cov"><span class="num"><pre> 70</pre></span><pre>        breadcrumbs.append(Crumb(root_name, ZINNIA_ROOT_URL()))</pre></div>
<div class="skip"><span class="num"><pre> 71</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 72</pre></span><pre>    if model_instance is not None:</pre></div>
<div class="cov"><span class="num"><pre> 73</pre></span><pre>        key = model_instance.__class__.__name__</pre></div>
<div class="cov"><span class="num"><pre> 74</pre></span><pre>        if key in MODEL_BREADCRUMBS:</pre></div>
<div class="cov"><span class="num"><pre> 75</pre></span><pre>            breadcrumbs.extend(MODEL_BREADCRUMBS[key](model_instance))</pre></div>
<div class="cov"><span class="num"><pre> 76</pre></span><pre>            return breadcrumbs</pre></div>
<div class="skip"><span class="num"><pre> 77</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 78</pre></span><pre>    date_match = DATE_REGEXP.match(path)</pre></div>
<div class="cov"><span class="num"><pre> 79</pre></span><pre>    if date_match:</pre></div>
<div class="cov"><span class="num"><pre> 80</pre></span><pre>        date_dict = date_match.groupdict()</pre></div>
<div class="cov"><span class="num"><pre> 81</pre></span><pre>        path_date = datetime(</pre></div>
<div class="cov"><span class="num"><pre> 82</pre></span><pre>            int(date_dict['year']),</pre></div>
<div class="cov"><span class="num"><pre> 83</pre></span><pre>            date_dict.get('month') is not None and \</pre></div>
<div class="cov"><span class="num"><pre> 84</pre></span><pre>            int(date_dict.get('month')) or 1,</pre></div>
<div class="cov"><span class="num"><pre> 85</pre></span><pre>            date_dict.get('day') is not None and \</pre></div>
<div class="cov"><span class="num"><pre> 86</pre></span><pre>            int(date_dict.get('day')) or 1)</pre></div>
<div class="skip"><span class="num"><pre> 87</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 88</pre></span><pre>        date_breadcrumbs = [year_crumb(path_date)]</pre></div>
<div class="cov"><span class="num"><pre> 89</pre></span><pre>        if date_dict['month']:</pre></div>
<div class="cov"><span class="num"><pre> 90</pre></span><pre>            date_breadcrumbs.append(month_crumb(path_date))</pre></div>
<div class="cov"><span class="num"><pre> 91</pre></span><pre>        if date_dict['day']:</pre></div>
<div class="cov"><span class="num"><pre> 92</pre></span><pre>            date_breadcrumbs.append(day_crumb(path_date))</pre></div>
<div class="cov"><span class="num"><pre> 93</pre></span><pre>        breadcrumbs.extend(date_breadcrumbs)</pre></div>
<div class="skip"><span class="num"><pre> 94</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 95</pre></span><pre>        return breadcrumbs</pre></div>
<div class="skip"><span class="num"><pre> 96</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 97</pre></span><pre>    url_components = [comp for comp in</pre></div>
<div class="cov"><span class="num"><pre> 98</pre></span><pre>                      path.replace(ZINNIA_ROOT_URL(), '').split('/') if comp]</pre></div>
<div class="cov"><span class="num"><pre> 99</pre></span><pre>    if len(url_components):</pre></div>
<div class="cov"><span class="num"><pre>100</pre></span><pre>        breadcrumbs.append(Crumb(_(url_components[-1].capitalize())))</pre></div>
<div class="skip"><span class="num"><pre>101</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>102</pre></span><pre>    return breadcrumbs</pre></div>
<div class="skip"><span class="num"><pre>103</pre></span><pre></pre></div>
</div>
</body>
</html>
