{% extends "person/master.html"%}

{% block title %}
  {% if isSessionPerson %}
    {{ person.getLabelValue|escape }} - Your page
  {% else %}
    {% if person %}
    {{ person.getLabelValue|escape }} - Profile
    {% else %}
    Profile - No name specified!
    {% endif %}
  {% endif %}
{% endblock %}

{% block content %}

  {% if person %}
    {% if isSessionPerson %}
    <h2>Welcome, {{ person.getFirstName|escape }}</h2>
    <p><strong>Login name:</strong> {{ person.name|escape }}</p>
    <p><strong>Registered name:</strong> {{ person.fullname|escape }}</p>
    <p><strong>Registered email:</strong> {{ person.email|escape }}</p>
    <p>
      This page gives you an overview of the projects you&rsquo;re associated with, and other useful information about your {{ systemServiceName|escape }} account.
    </p>
    {% else %}
    <h2>{{ person.getFirstName|escape }}&rsquo;s profile page</h2>
    <p>
      This is the profile page for {{ person.getLabelValue|escape }}.
    </p>
    {% endif %}

    {% if person.memberships.count %}
    <h3>Project memberships</h3>
    <table>
      <tr>
        <th>Project</th>
        <th>Role</th>
        <th>Actions</th>
      </tr>
      {% for membership in person.memberships %}
      <tr>
        <td><a href="{{uriPrefix}}/project/{{ membership.project.name}}/">{{membership.project.getLabelValue|escape}}</a></td>
        <td>{{ membership.role.getLabelValue }}</td>
        <td>
        {% if view.canDeleteMember or isSessionPerson %}
        <a href="{{uriPrefix}}/project/{{ membership.project.name }}/members/{{ person.name }}/delete/" title="Leave project ({{ membership.project.getLabelValue }})"><img height="20" width="20" src="{{ kforge_media_url }}/images/icon-delete.png" alt="Leave" /></a>
        {% endif %}
        {% if view.canUpdateMember %}
        <a href="{{uriPrefix}}/project/{{ membership.project.name }}/members/{{ person.name }}/edit/" title="Edit membership ({{ membership.project.getLabelValue }})"><img height="20" width="20" src="{{ kforge_media_url }}/images/icon-edit.png" alt="Edit" /></a>
        {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}

    {% if view.isSshPluginEnabled %}
    {% if view.canUpdatePerson %}
    {% if person.sshKeys.count %}
    <h3>Registered SSH keys</h3>
    <table>
      <tr>
        <th>Key string</th>
        <th>Actions</th>
      </tr>
      {% for sshKey in person.sshKeys %}
      <tr>
        <!-- Insert &#8203; characters to allow Firefox to look like CSS "word-wrap: break-word". -->
        <td><code>{{sshKey.keyString|escape|join:"&#8203;"}}</code></td>
        <td><a href="{{uriPrefix}}/person/{{ person.name }}/sshKeys/{{ sshKey.id }}/delete/" title="Remove this key"><img height="20" width="20" src="{{ kforge_media_url }}/images/icon-delete.png" alt="Remove" /></a></td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}

    <strong>Do you wish to register an SSH key?</strong><br />
    <form action="{{uriPrefix}}/person/{{ person.name }}/sshKeys/create/" method="get">
      <p>
        <input type="submit" value="Add SSH key &raquo;" />
      </p>
    </form>
    {% endif %}
    {% endif %}
    {% if view.canUpdatePerson %}
    <strong>Do you wish to edit this profile?</strong><br />
    <form action="{{uriPrefix}}/person/{{ person.name }}/edit/" method="post">
      <p>
        <input type="submit" value="Edit profile" />
      </p>
    </form>
    {% if view.canDeletePerson %}
    <strong>Do you wish to delete this account?</strong><br />
    <form action="{{uriPrefix}}/person/{{ person.name }}/delete/" method="post">
      <p>
        <input type="submit" value="Delete account" />
      </p>
    </form>
    {% endif %}
    {% endif %}
  {% else %}
    <h2>No name specified</h2>
    <p class="flash-error">
      You'll need to <a href="{{uriPrefix}}/person/">select a user</a> in order to see a user's profile page.<br />
      <br />
      If you were looking for your profile page, please <a href="{{uriPrefix}}/login/">log in</a>.
    </p>
  {% endif %}  

{% endblock %}

{% block primarysidebar %}
  {% if isSessionPerson %}
    <div class="box">
      <h2>Your Projects</h2>
      <ul>
      {% for member in person.memberships %} 
        <li><a href="{{uriPrefix}}/project/{{ member.project.name }}/">{{ member.project.getLabelValue|escape }}</a></li>
      {% endfor %}
      </ul>
      <ul>
        <li><a href="{{uriPrefix}}/project/create/">Register new project</a></li>
        <li><a href="{{uriPrefix}}/project/">Join project</a></li>
        {% if view.isSshPluginEnabled %}
        <li><a href="{{uriPrefix}}/person/{{domainObject.name}}/sshKeys/create/">Register SSH key</a></li>
        {% endif %}
      </ul>
    </div>
  {% endif %}
<div class="box">
  <h2>Using KForge</h2>
  <ul>
    <li><a href="http://www.kforgeproject.com/doc/">Documentation</a></li>
    <li><a href="http://lists.okfn.org/mailman/listinfo/kforge-user">KForge-User Mailing list</a></li>
  </ul>
</div>
{% endblock %}
