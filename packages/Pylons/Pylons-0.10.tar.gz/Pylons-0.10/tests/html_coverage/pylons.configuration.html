<html>
<head>
<title>pylons.configuration</title>
</head>
<body>
pylons.configuration
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 44 lines<br/>
Missed: 112 lines<br/>
Skipped 50 lines<br/>
Percent: 28 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre>  1</pre></span><pre>&quot;&quot;&quot;Configuration object and defaults setup</pre></div>
<div class="skip"><span class="num"><pre>  2</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  3</pre></span><pre>The PylonsConfig object is initialized in pylons projects inside the</pre></div>
<div class="cov"><span class="num"><pre>  4</pre></span><pre>:file:`config/environment.py` module. Importing the :data:`config`</pre></div>
<div class="cov"><span class="num"><pre>  5</pre></span><pre>object from module causes the PylonsConfig object to be created, and</pre></div>
<div class="cov"><span class="num"><pre>  6</pre></span><pre>setup in  app-safe manner so that multiple apps being setup avoid</pre></div>
<div class="cov"><span class="num"><pre>  7</pre></span><pre>conflicts.</pre></div>
<div class="skip"><span class="num"><pre>  8</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  9</pre></span><pre>After importing :data:`config`, the project should then call</pre></div>
<div class="cov"><span class="num"><pre> 10</pre></span><pre>:meth:`~PylonsConfig.init_app` with the appropriate options to setup</pre></div>
<div class="cov"><span class="num"><pre> 11</pre></span><pre>the configuration. In the config data passed with</pre></div>
<div class="cov"><span class="num"><pre> 12</pre></span><pre>:meth:`~PylonsConfig.init_app`, various defaults are set use with Paste</pre></div>
<div class="cov"><span class="num"><pre> 13</pre></span><pre>and Routes.</pre></div>
<div class="skip"><span class="num"><pre> 14</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 15</pre></span><pre>&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 16</pre></span><pre>import copy</pre></div>
<div class="nocov"><span class="num"><pre> 17</pre></span><pre>import logging</pre></div>
<div class="nocov"><span class="num"><pre> 18</pre></span><pre>import os</pre></div>
<div class="skip"><span class="num"><pre> 19</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 20</pre></span><pre>from paste.config import DispatchingConfig</pre></div>
<div class="nocov"><span class="num"><pre> 21</pre></span><pre>from paste.deploy.converters import asbool</pre></div>
<div class="nocov"><span class="num"><pre> 22</pre></span><pre>from webhelpers.mimehelper import MIMETypes</pre></div>
<div class="skip"><span class="num"><pre> 23</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 24</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 25</pre></span><pre>default_template_engine = 'mako'</pre></div>
<div class="skip"><span class="num"><pre> 26</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 27</pre></span><pre>request_defaults = dict(charset='utf-8', errors='replace',</pre></div>
<div class="nocov"><span class="num"><pre> 28</pre></span><pre>                        decode_param_names=False, language='en-us')</pre></div>
<div class="nocov"><span class="num"><pre> 29</pre></span><pre>response_defaults = dict(content_type='text/html',</pre></div>
<div class="nocov"><span class="num"><pre> 30</pre></span><pre>                         charset='utf-8', errors='strict', </pre></div>
<div class="nocov"><span class="num"><pre> 31</pre></span><pre>                         headers={'Cache-Control': 'no-cache', </pre></div>
<div class="nocov"><span class="num"><pre> 32</pre></span><pre>                                  'Pragma': 'no-cache'})</pre></div>
<div class="skip"><span class="num"><pre> 33</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 34</pre></span><pre>log = logging.getLogger(__name__)</pre></div>
<div class="skip"><span class="num"><pre> 35</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 36</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 37</pre></span><pre>config = DispatchingConfig()</pre></div>
<div class="skip"><span class="num"><pre> 38</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 39</pre></span><pre>class PylonsConfig(dict):</pre></div>
<div class="nocov"><span class="num"><pre> 40</pre></span><pre>    &quot;&quot;&quot;Pylons configuration object</pre></div>
<div class="skip"><span class="num"><pre> 41</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 42</pre></span><pre>    The Pylons configuration object is a per-application instance</pre></div>
<div class="nocov"><span class="num"><pre> 43</pre></span><pre>    object that retains the information regarding the global and app</pre></div>
<div class="nocov"><span class="num"><pre> 44</pre></span><pre>    conf's as well as per-application instance specific data such as</pre></div>
<div class="nocov"><span class="num"><pre> 45</pre></span><pre>    the mapper, and the paths for this instance.</pre></div>
<div class="skip"><span class="num"><pre> 46</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 47</pre></span><pre>    The config object is available in your application as the Pylons</pre></div>
<div class="nocov"><span class="num"><pre> 48</pre></span><pre>    global :data:`pylons.config`. For example::</pre></div>
<div class="skip"><span class="num"><pre> 49</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 50</pre></span><pre>        from pylons import config</pre></div>
<div class="skip"><span class="num"><pre> 51</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 52</pre></span><pre>        template_paths = config['pylons.paths']['templates']</pre></div>
<div class="skip"><span class="num"><pre> 53</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 54</pre></span><pre>    There's several useful keys of the config object most people will</pre></div>
<div class="nocov"><span class="num"><pre> 55</pre></span><pre>    be interested in:</pre></div>
<div class="skip"><span class="num"><pre> 56</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 57</pre></span><pre>    ``pylons.paths``</pre></div>
<div class="nocov"><span class="num"><pre> 58</pre></span><pre>        A dict of absolute paths that were defined in the applications</pre></div>
<div class="nocov"><span class="num"><pre> 59</pre></span><pre>        ``config/environment.py`` module.</pre></div>
<div class="nocov"><span class="num"><pre> 60</pre></span><pre>    ``pylons.environ_config``</pre></div>
<div class="nocov"><span class="num"><pre> 61</pre></span><pre>        Dict of environ keys for where in the environ to pickup various</pre></div>
<div class="nocov"><span class="num"><pre> 62</pre></span><pre>        objects for registering with Pylons. If these are present then</pre></div>
<div class="nocov"><span class="num"><pre> 63</pre></span><pre>        PylonsApp will use them from environ rather than using default</pre></div>
<div class="nocov"><span class="num"><pre> 64</pre></span><pre>        middleware from Beaker. Valid keys are: ``session, cache``</pre></div>
<div class="nocov"><span class="num"><pre> 65</pre></span><pre>    ``pylons.strict_tmpl_context``</pre></div>
<div class="nocov"><span class="num"><pre> 66</pre></span><pre>        Whether or not the ``tmpl_context`` object should throw an</pre></div>
<div class="nocov"><span class="num"><pre> 67</pre></span><pre>        attribute error when access is attempted to an attribute that</pre></div>
<div class="nocov"><span class="num"><pre> 68</pre></span><pre>        doesn't exist. Defaults to True.</pre></div>
<div class="nocov"><span class="num"><pre> 69</pre></span><pre>    ``pylons.tmpl_context_attach_args``</pre></div>
<div class="nocov"><span class="num"><pre> 70</pre></span><pre>        Whethor or not Routes variables should automatically be</pre></div>
<div class="nocov"><span class="num"><pre> 71</pre></span><pre>        attached to the tmpl_context object when specified in a</pre></div>
<div class="nocov"><span class="num"><pre> 72</pre></span><pre>        controllers method.</pre></div>
<div class="nocov"><span class="num"><pre> 73</pre></span><pre>    ``pylons.request_options``</pre></div>
<div class="nocov"><span class="num"><pre> 74</pre></span><pre>        A dict of Content-Type related default settings for new</pre></div>
<div class="nocov"><span class="num"><pre> 75</pre></span><pre>        instances of :class:`~pylons.controllers.util.Request`. May</pre></div>
<div class="nocov"><span class="num"><pre> 76</pre></span><pre>        contain the values ``charset`` and ``errors`` and </pre></div>
<div class="nocov"><span class="num"><pre> 77</pre></span><pre>        ``decode_param_names``. Overrides the Pylons default values</pre></div>
<div class="nocov"><span class="num"><pre> 78</pre></span><pre>        specified by the ``request_defaults`` dict.</pre></div>
<div class="nocov"><span class="num"><pre> 79</pre></span><pre>    ``pylons.response_options``</pre></div>
<div class="nocov"><span class="num"><pre> 80</pre></span><pre>        A dict of Content-Type related default settings for new </pre></div>
<div class="nocov"><span class="num"><pre> 81</pre></span><pre>        instances of :class:`~pylons.controllers.util.Response`. May</pre></div>
<div class="nocov"><span class="num"><pre> 82</pre></span><pre>        contain the values ``content_type``, ``charset`` and</pre></div>
<div class="nocov"><span class="num"><pre> 83</pre></span><pre>        ``errors``. Overrides the Pylons default values specified by</pre></div>
<div class="nocov"><span class="num"><pre> 84</pre></span><pre>        the ``response_defaults`` dict.</pre></div>
<div class="nocov"><span class="num"><pre> 85</pre></span><pre>    ``routes.map``</pre></div>
<div class="nocov"><span class="num"><pre> 86</pre></span><pre>        Mapper object used for Routing. Yes, it is possible to add</pre></div>
<div class="nocov"><span class="num"><pre> 87</pre></span><pre>        routes after your application has started running.</pre></div>
<div class="skip"><span class="num"><pre> 88</pre></span><pre>    </pre></div>
<div class="nocov"><span class="num"><pre> 89</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 90</pre></span><pre>    defaults = {</pre></div>
<div class="nocov"><span class="num"><pre> 91</pre></span><pre>        'debug': False,</pre></div>
<div class="nocov"><span class="num"><pre> 92</pre></span><pre>        'pylons.package': None,</pre></div>
<div class="nocov"><span class="num"><pre> 93</pre></span><pre>        'pylons.paths': {'root': None,</pre></div>
<div class="nocov"><span class="num"><pre> 94</pre></span><pre>                         'controllers': None,</pre></div>
<div class="nocov"><span class="num"><pre> 95</pre></span><pre>                         'templates': [],</pre></div>
<div class="nocov"><span class="num"><pre> 96</pre></span><pre>                         'static_files': None},</pre></div>
<div class="nocov"><span class="num"><pre> 97</pre></span><pre>        'pylons.environ_config': dict(session='beaker.session', </pre></div>
<div class="nocov"><span class="num"><pre> 98</pre></span><pre>                                      cache='beaker.cache'),</pre></div>
<div class="nocov"><span class="num"><pre> 99</pre></span><pre>        'pylons.app_globals': None,</pre></div>
<div class="nocov"><span class="num"><pre>100</pre></span><pre>        'pylons.h': None,</pre></div>
<div class="nocov"><span class="num"><pre>101</pre></span><pre>        'pylons.request_options': request_defaults.copy(),</pre></div>
<div class="nocov"><span class="num"><pre>102</pre></span><pre>        'pylons.response_options': response_defaults.copy(),</pre></div>
<div class="nocov"><span class="num"><pre>103</pre></span><pre>        'pylons.strict_tmpl_context': True,</pre></div>
<div class="nocov"><span class="num"><pre>104</pre></span><pre>        'pylons.tmpl_context_attach_args': False,</pre></div>
<div class="nocov"><span class="num"><pre>105</pre></span><pre>    }</pre></div>
<div class="skip"><span class="num"><pre>106</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>107</pre></span><pre>    def init_app(self, global_conf, app_conf, package=None, paths=None):</pre></div>
<div class="nocov"><span class="num"><pre>108</pre></span><pre>        &quot;&quot;&quot;Initialize configuration for the application</pre></div>
<div class="skip"><span class="num"><pre>109</pre></span><pre>        </pre></div>
<div class="nocov"><span class="num"><pre>110</pre></span><pre>        .. note</pre></div>
<div class="nocov"><span class="num"><pre>111</pre></span><pre>            This *must* be called at least once, as soon as possible </pre></div>
<div class="nocov"><span class="num"><pre>112</pre></span><pre>            to setup all the configuration options.</pre></div>
<div class="skip"><span class="num"><pre>113</pre></span><pre>        </pre></div>
<div class="nocov"><span class="num"><pre>114</pre></span><pre>        ``global_conf``</pre></div>
<div class="nocov"><span class="num"><pre>115</pre></span><pre>            Several options are expected to be set for a Pylons web</pre></div>
<div class="nocov"><span class="num"><pre>116</pre></span><pre>            application. They will be loaded from the global_config </pre></div>
<div class="nocov"><span class="num"><pre>117</pre></span><pre>            which has the main Paste options. If ``debug`` is not </pre></div>
<div class="nocov"><span class="num"><pre>118</pre></span><pre>            enabled as a global config option, the following option</pre></div>
<div class="nocov"><span class="num"><pre>119</pre></span><pre>            *must* be set:</pre></div>
<div class="skip"><span class="num"><pre>120</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>121</pre></span><pre>            * error_to - The email address to send the debug error to</pre></div>
<div class="skip"><span class="num"><pre>122</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>123</pre></span><pre>            The optional config options in this case are:</pre></div>
<div class="skip"><span class="num"><pre>124</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>125</pre></span><pre>            * smtp_server - The SMTP server to use, defaults to </pre></div>
<div class="nocov"><span class="num"><pre>126</pre></span><pre>              'localhost'</pre></div>
<div class="nocov"><span class="num"><pre>127</pre></span><pre>            * error_log - A logfile to write the error to</pre></div>
<div class="nocov"><span class="num"><pre>128</pre></span><pre>            * error_subject_prefix - The prefix of the error email</pre></div>
<div class="nocov"><span class="num"><pre>129</pre></span><pre>              subject</pre></div>
<div class="nocov"><span class="num"><pre>130</pre></span><pre>            * from_address - Whom the error email should be from</pre></div>
<div class="nocov"><span class="num"><pre>131</pre></span><pre>        ``app_conf``</pre></div>
<div class="nocov"><span class="num"><pre>132</pre></span><pre>            Defaults supplied via the [app:main] section from the Paste</pre></div>
<div class="nocov"><span class="num"><pre>133</pre></span><pre>            config file. ``load_config`` only cares about whether a </pre></div>
<div class="nocov"><span class="num"><pre>134</pre></span><pre>            'prefix' option is set, if so it will update Routes to</pre></div>
<div class="nocov"><span class="num"><pre>135</pre></span><pre>            ensure URL's take that into account.</pre></div>
<div class="nocov"><span class="num"><pre>136</pre></span><pre>        ``package``</pre></div>
<div class="nocov"><span class="num"><pre>137</pre></span><pre>            The name of the application package, to be stored in the </pre></div>
<div class="nocov"><span class="num"><pre>138</pre></span><pre>            app_conf.</pre></div>
<div class="skip"><span class="num"><pre>139</pre></span><pre>        </pre></div>
<div class="nocov"><span class="num"><pre>140</pre></span><pre>        .. versionchanged:: 1.0</pre></div>
<div class="nocov"><span class="num"><pre>141</pre></span><pre>            ``template_engine`` option is no longer supported.</pre></div>
<div class="skip"><span class="num"><pre>142</pre></span><pre>                </pre></div>
<div class="nocov"><span class="num"><pre>143</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>144</pre></span><pre>        log.debug(&quot;Initializing configuration, package: '%s'&quot;, package)</pre></div>
<div class="cov"><span class="num"><pre>145</pre></span><pre>        conf = global_conf.copy()</pre></div>
<div class="cov"><span class="num"><pre>146</pre></span><pre>        conf.update(app_conf)</pre></div>
<div class="cov"><span class="num"><pre>147</pre></span><pre>        conf.update(dict(app_conf=app_conf, global_conf=global_conf))</pre></div>
<div class="cov"><span class="num"><pre>148</pre></span><pre>        conf.update(self.pop('environment_load', {}))</pre></div>
<div class="skip"><span class="num"><pre>149</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>150</pre></span><pre>        if paths:</pre></div>
<div class="cov"><span class="num"><pre>151</pre></span><pre>            conf['pylons.paths'] = paths</pre></div>
<div class="cov"><span class="num"><pre>152</pre></span><pre>        conf['pylons.package'] = package</pre></div>
<div class="skip"><span class="num"><pre>153</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>154</pre></span><pre>        conf['debug'] = asbool(conf.get('debug'))</pre></div>
<div class="skip"><span class="num"><pre>155</pre></span><pre>                </pre></div>
<div class="skip"><span class="num"><pre>156</pre></span><pre>        # Load the MIMETypes with its default types</pre></div>
<div class="cov"><span class="num"><pre>157</pre></span><pre>        MIMETypes.init()</pre></div>
<div class="skip"><span class="num"><pre>158</pre></span><pre>        </pre></div>
<div class="skip"><span class="num"><pre>159</pre></span><pre>        # Ensure all the keys from defaults are present, load them if not</pre></div>
<div class="cov"><span class="num"><pre>160</pre></span><pre>        for key, val in copy.deepcopy(PylonsConfig.defaults).iteritems():</pre></div>
<div class="cov"><span class="num"><pre>161</pre></span><pre>            conf.setdefault(key, val)</pre></div>
<div class="skip"><span class="num"><pre>162</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>163</pre></span><pre>        # Load the errorware configuration from the Paste configuration file</pre></div>
<div class="skip"><span class="num"><pre>164</pre></span><pre>        # These all have defaults, and emails are only sent if configured and</pre></div>
<div class="skip"><span class="num"><pre>165</pre></span><pre>        # if this application is running in production mode</pre></div>
<div class="cov"><span class="num"><pre>166</pre></span><pre>        errorware = {}</pre></div>
<div class="cov"><span class="num"><pre>167</pre></span><pre>        errorware['debug'] = conf['debug']</pre></div>
<div class="cov"><span class="num"><pre>168</pre></span><pre>        if not errorware['debug']:</pre></div>
<div class="cov"><span class="num"><pre>169</pre></span><pre>            errorware['debug'] = False</pre></div>
<div class="cov"><span class="num"><pre>170</pre></span><pre>            errorware['error_email'] = conf.get('email_to')</pre></div>
<div class="cov"><span class="num"><pre>171</pre></span><pre>            errorware['error_log'] = conf.get('error_log', None)</pre></div>
<div class="cov"><span class="num"><pre>172</pre></span><pre>            errorware['smtp_server'] = conf.get('smtp_server',</pre></div>
<div class="cov"><span class="num"><pre>173</pre></span><pre>                'localhost')</pre></div>
<div class="cov"><span class="num"><pre>174</pre></span><pre>            errorware['error_subject_prefix'] = conf.get(</pre></div>
<div class="cov"><span class="num"><pre>175</pre></span><pre>                'error_subject_prefix', 'WebApp Error: ')</pre></div>
<div class="cov"><span class="num"><pre>176</pre></span><pre>            errorware['from_address'] = conf.get(</pre></div>
<div class="cov"><span class="num"><pre>177</pre></span><pre>                'from_address', conf.get('error_email_from',</pre></div>
<div class="cov"><span class="num"><pre>178</pre></span><pre>                                         'pylons@yourapp.com'))</pre></div>
<div class="cov"><span class="num"><pre>179</pre></span><pre>            errorware['error_message'] = conf.get('error_message',</pre></div>
<div class="cov"><span class="num"><pre>180</pre></span><pre>                'An internal server error occurred')</pre></div>
<div class="skip"><span class="num"><pre>181</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>182</pre></span><pre>        # Copy in some defaults</pre></div>
<div class="cov"><span class="num"><pre>183</pre></span><pre>        if 'cache_dir' in conf:</pre></div>
<div class="nocov"><span class="num"><pre>184</pre></span><pre>            conf.setdefault('beaker.session.data_dir',</pre></div>
<div class="nocov"><span class="num"><pre>185</pre></span><pre>                            os.path.join(conf['cache_dir'], 'sessions'))</pre></div>
<div class="nocov"><span class="num"><pre>186</pre></span><pre>            conf.setdefault('beaker.cache.data_dir',</pre></div>
<div class="nocov"><span class="num"><pre>187</pre></span><pre>                            os.path.join(conf['cache_dir'], 'cache'))</pre></div>
<div class="skip"><span class="num"><pre>188</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>189</pre></span><pre>        conf['pylons.cache_dir'] = conf.pop('cache_dir', </pre></div>
<div class="cov"><span class="num"><pre>190</pre></span><pre>                                            conf['app_conf'].get('cache_dir'))</pre></div>
<div class="skip"><span class="num"><pre>191</pre></span><pre>        # Save our errorware values</pre></div>
<div class="cov"><span class="num"><pre>192</pre></span><pre>        conf['pylons.errorware'] = errorware</pre></div>
<div class="skip"><span class="num"><pre>193</pre></span><pre>        </pre></div>
<div class="skip"><span class="num"><pre>194</pre></span><pre>        # Load conf dict into self</pre></div>
<div class="cov"><span class="num"><pre>195</pre></span><pre>        self.update(conf)</pre></div>
<div class="skip"><span class="num"><pre>196</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>197</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>198</pre></span><pre>pylons_config = PylonsConfig()</pre></div>
<div class="skip"><span class="num"><pre>199</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>200</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>201</pre></span><pre># Push an empty config so all accesses to config at import time have something</pre></div>
<div class="skip"><span class="num"><pre>202</pre></span><pre># to look at and modify. This config will be merged with the app's when it's</pre></div>
<div class="skip"><span class="num"><pre>203</pre></span><pre># built in the paste.app_factory entry point.</pre></div>
<div class="nocov"><span class="num"><pre>204</pre></span><pre>pylons_config.update(copy.deepcopy(PylonsConfig.defaults))</pre></div>
<div class="nocov"><span class="num"><pre>205</pre></span><pre>config.push_process_config(pylons_config)</pre></div>
<div class="skip"><span class="num"><pre>206</pre></span><pre></pre></div>
</div>
</body>
</html>
