<html>
<head>
<title>pylons.i18n.translation</title>
</head>
<body>
pylons.i18n.translation
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 27 lines<br/>
Missed: 117 lines<br/>
Skipped 57 lines<br/>
Percent: 18 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre>  1</pre></span><pre>&quot;&quot;&quot;Translation/Localization functions.</pre></div>
<div class="skip"><span class="num"><pre>  2</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  3</pre></span><pre>Provides :mod:`gettext` translation functions via an app's</pre></div>
<div class="cov"><span class="num"><pre>  4</pre></span><pre>``pylons.translator`` and get/set_lang for changing the language</pre></div>
<div class="cov"><span class="num"><pre>  5</pre></span><pre>translated to.</pre></div>
<div class="skip"><span class="num"><pre>  6</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  7</pre></span><pre>&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>  8</pre></span><pre>import os</pre></div>
<div class="nocov"><span class="num"><pre>  9</pre></span><pre>from gettext import NullTranslations, translation</pre></div>
<div class="skip"><span class="num"><pre> 10</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 11</pre></span><pre>import pylons</pre></div>
<div class="skip"><span class="num"><pre> 12</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 13</pre></span><pre>__all__ = ['_', 'add_fallback', 'get_lang', 'gettext', 'gettext_noop',</pre></div>
<div class="nocov"><span class="num"><pre> 14</pre></span><pre>           'lazy_gettext', 'lazy_ngettext', 'lazy_ugettext', 'lazy_ungettext',</pre></div>
<div class="nocov"><span class="num"><pre> 15</pre></span><pre>           'ngettext', 'set_lang', 'ugettext', 'ungettext', 'LanguageError',</pre></div>
<div class="nocov"><span class="num"><pre> 16</pre></span><pre>           'N_']</pre></div>
<div class="skip"><span class="num"><pre> 17</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 18</pre></span><pre>class LanguageError(Exception):</pre></div>
<div class="nocov"><span class="num"><pre> 19</pre></span><pre>    &quot;&quot;&quot;Exception raised when a problem occurs with changing languages&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 20</pre></span><pre>    pass</pre></div>
<div class="skip"><span class="num"><pre> 21</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 22</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 23</pre></span><pre>class LazyString(object):</pre></div>
<div class="nocov"><span class="num"><pre> 24</pre></span><pre>    &quot;&quot;&quot;Has a number of lazily evaluated functions replicating a </pre></div>
<div class="nocov"><span class="num"><pre> 25</pre></span><pre>    string. Just override the eval() method to produce the actual value.</pre></div>
<div class="skip"><span class="num"><pre> 26</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 27</pre></span><pre>    This method copied from TurboGears.</pre></div>
<div class="skip"><span class="num"><pre> 28</pre></span><pre>    </pre></div>
<div class="nocov"><span class="num"><pre> 29</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 30</pre></span><pre>    def __init__(self, func, *args, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre> 31</pre></span><pre>        self.func = func</pre></div>
<div class="nocov"><span class="num"><pre> 32</pre></span><pre>        self.args = args</pre></div>
<div class="nocov"><span class="num"><pre> 33</pre></span><pre>        self.kwargs = kwargs</pre></div>
<div class="skip"><span class="num"><pre> 34</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 35</pre></span><pre>    def eval(self):</pre></div>
<div class="nocov"><span class="num"><pre> 36</pre></span><pre>        return self.func(*self.args, **self.kwargs)</pre></div>
<div class="skip"><span class="num"><pre> 37</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 38</pre></span><pre>    def __unicode__(self):</pre></div>
<div class="nocov"><span class="num"><pre> 39</pre></span><pre>        return unicode(self.eval())</pre></div>
<div class="skip"><span class="num"><pre> 40</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 41</pre></span><pre>    def __str__(self):</pre></div>
<div class="nocov"><span class="num"><pre> 42</pre></span><pre>        return str(self.eval())</pre></div>
<div class="skip"><span class="num"><pre> 43</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 44</pre></span><pre>    def __mod__(self, other):</pre></div>
<div class="nocov"><span class="num"><pre> 45</pre></span><pre>        return self.eval() % other</pre></div>
<div class="skip"><span class="num"><pre> 46</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 47</pre></span><pre>    def format(self, other):</pre></div>
<div class="nocov"><span class="num"><pre> 48</pre></span><pre>        return self.eval().format(other)</pre></div>
<div class="skip"><span class="num"><pre> 49</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 50</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 51</pre></span><pre>def lazify(func):</pre></div>
<div class="nocov"><span class="num"><pre> 52</pre></span><pre>    &quot;&quot;&quot;Decorator to return a lazy-evaluated version of the original&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 53</pre></span><pre>    def newfunc(*args, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre> 54</pre></span><pre>        return LazyString(func, *args, **kwargs)</pre></div>
<div class="nocov"><span class="num"><pre> 55</pre></span><pre>    newfunc.__name__ = 'lazy_%s' % func.__name__</pre></div>
<div class="nocov"><span class="num"><pre> 56</pre></span><pre>    newfunc.__doc__ = 'Lazy-evaluated version of the %s function\n\n%s' % \</pre></div>
<div class="nocov"><span class="num"><pre> 57</pre></span><pre>        (func.__name__, func.__doc__)</pre></div>
<div class="nocov"><span class="num"><pre> 58</pre></span><pre>    return newfunc</pre></div>
<div class="skip"><span class="num"><pre> 59</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 60</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 61</pre></span><pre>def gettext_noop(value):</pre></div>
<div class="nocov"><span class="num"><pre> 62</pre></span><pre>    &quot;&quot;&quot;Mark a string for translation without translating it. Returns</pre></div>
<div class="nocov"><span class="num"><pre> 63</pre></span><pre>    value.</pre></div>
<div class="skip"><span class="num"><pre> 64</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 65</pre></span><pre>    Used for global strings, e.g.::</pre></div>
<div class="skip"><span class="num"><pre> 66</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 67</pre></span><pre>        foo = N_('Hello')</pre></div>
<div class="skip"><span class="num"><pre> 68</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 69</pre></span><pre>        class Bar:</pre></div>
<div class="nocov"><span class="num"><pre> 70</pre></span><pre>            def __init__(self):</pre></div>
<div class="nocov"><span class="num"><pre> 71</pre></span><pre>                self.local_foo = _(foo)</pre></div>
<div class="skip"><span class="num"><pre> 72</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 73</pre></span><pre>        h.set_lang('fr')</pre></div>
<div class="nocov"><span class="num"><pre> 74</pre></span><pre>        assert Bar().local_foo == 'Bonjour'</pre></div>
<div class="nocov"><span class="num"><pre> 75</pre></span><pre>        h.set_lang('es')</pre></div>
<div class="nocov"><span class="num"><pre> 76</pre></span><pre>        assert Bar().local_foo == 'Hola'</pre></div>
<div class="nocov"><span class="num"><pre> 77</pre></span><pre>        assert foo == 'Hello'</pre></div>
<div class="skip"><span class="num"><pre> 78</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 79</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 80</pre></span><pre>    return value</pre></div>
<div class="nocov"><span class="num"><pre> 81</pre></span><pre>N_ = gettext_noop</pre></div>
<div class="skip"><span class="num"><pre> 82</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 83</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 84</pre></span><pre>def gettext(value):</pre></div>
<div class="nocov"><span class="num"><pre> 85</pre></span><pre>    &quot;&quot;&quot;Mark a string for translation. Returns the localized string of</pre></div>
<div class="nocov"><span class="num"><pre> 86</pre></span><pre>    value.</pre></div>
<div class="skip"><span class="num"><pre> 87</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 88</pre></span><pre>    Mark a string to be localized as follows::</pre></div>
<div class="skip"><span class="num"><pre> 89</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 90</pre></span><pre>        gettext('This should be in lots of languages')</pre></div>
<div class="skip"><span class="num"><pre> 91</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 92</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 93</pre></span><pre>    return pylons.translator.gettext(value)</pre></div>
<div class="nocov"><span class="num"><pre> 94</pre></span><pre>lazy_gettext = lazify(gettext)</pre></div>
<div class="skip"><span class="num"><pre> 95</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 96</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 97</pre></span><pre>def ugettext(value):</pre></div>
<div class="nocov"><span class="num"><pre> 98</pre></span><pre>    &quot;&quot;&quot;Mark a string for translation. Returns the localized unicode</pre></div>
<div class="nocov"><span class="num"><pre> 99</pre></span><pre>    string of value.</pre></div>
<div class="skip"><span class="num"><pre>100</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>101</pre></span><pre>    Mark a string to be localized as follows::</pre></div>
<div class="skip"><span class="num"><pre>102</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>103</pre></span><pre>        _('This should be in lots of languages')</pre></div>
<div class="skip"><span class="num"><pre>104</pre></span><pre>    </pre></div>
<div class="nocov"><span class="num"><pre>105</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>106</pre></span><pre>    return pylons.translator.ugettext(value)</pre></div>
<div class="nocov"><span class="num"><pre>107</pre></span><pre>_ = ugettext</pre></div>
<div class="nocov"><span class="num"><pre>108</pre></span><pre>lazy_ugettext = lazify(ugettext)</pre></div>
<div class="skip"><span class="num"><pre>109</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>110</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>111</pre></span><pre>def ngettext(singular, plural, n):</pre></div>
<div class="nocov"><span class="num"><pre>112</pre></span><pre>    &quot;&quot;&quot;Mark a string for translation. Returns the localized string of</pre></div>
<div class="nocov"><span class="num"><pre>113</pre></span><pre>    the pluralized value.</pre></div>
<div class="skip"><span class="num"><pre>114</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>115</pre></span><pre>    This does a plural-forms lookup of a message id. ``singular`` is</pre></div>
<div class="nocov"><span class="num"><pre>116</pre></span><pre>    used as the message id for purposes of lookup in the catalog, while</pre></div>
<div class="nocov"><span class="num"><pre>117</pre></span><pre>    ``n`` is used to determine which plural form to use. The returned</pre></div>
<div class="nocov"><span class="num"><pre>118</pre></span><pre>    message is a string.</pre></div>
<div class="skip"><span class="num"><pre>119</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>120</pre></span><pre>    Mark a string to be localized as follows::</pre></div>
<div class="skip"><span class="num"><pre>121</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>122</pre></span><pre>        ngettext('There is %(num)d file here', 'There are %(num)d files here',</pre></div>
<div class="nocov"><span class="num"><pre>123</pre></span><pre>                 n) % {'num': n}</pre></div>
<div class="skip"><span class="num"><pre>124</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>125</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>126</pre></span><pre>    return pylons.translator.ngettext(singular, plural, n)</pre></div>
<div class="nocov"><span class="num"><pre>127</pre></span><pre>lazy_ngettext = lazify(ngettext)</pre></div>
<div class="skip"><span class="num"><pre>128</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>129</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>130</pre></span><pre>def ungettext(singular, plural, n):</pre></div>
<div class="nocov"><span class="num"><pre>131</pre></span><pre>    &quot;&quot;&quot;Mark a string for translation. Returns the localized unicode</pre></div>
<div class="nocov"><span class="num"><pre>132</pre></span><pre>    string of the pluralized value.</pre></div>
<div class="skip"><span class="num"><pre>133</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>134</pre></span><pre>    This does a plural-forms lookup of a message id. ``singular`` is</pre></div>
<div class="nocov"><span class="num"><pre>135</pre></span><pre>    used as the message id for purposes of lookup in the catalog, while</pre></div>
<div class="nocov"><span class="num"><pre>136</pre></span><pre>    ``n`` is used to determine which plural form to use. The returned</pre></div>
<div class="nocov"><span class="num"><pre>137</pre></span><pre>    message is a Unicode string.</pre></div>
<div class="skip"><span class="num"><pre>138</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>139</pre></span><pre>    Mark a string to be localized as follows::</pre></div>
<div class="skip"><span class="num"><pre>140</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>141</pre></span><pre>        ungettext('There is %(num)d file here', 'There are %(num)d files here',</pre></div>
<div class="nocov"><span class="num"><pre>142</pre></span><pre>                  n) % {'num': n}</pre></div>
<div class="skip"><span class="num"><pre>143</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>144</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>145</pre></span><pre>    return pylons.translator.ungettext(singular, plural, n)</pre></div>
<div class="nocov"><span class="num"><pre>146</pre></span><pre>lazy_ungettext = lazify(ungettext)</pre></div>
<div class="skip"><span class="num"><pre>147</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>148</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>149</pre></span><pre>def _get_translator(lang, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>150</pre></span><pre>    &quot;&quot;&quot;Utility method to get a valid translator object from a language</pre></div>
<div class="nocov"><span class="num"><pre>151</pre></span><pre>    name&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>152</pre></span><pre>    if not lang:</pre></div>
<div class="cov"><span class="num"><pre>153</pre></span><pre>        return NullTranslations()</pre></div>
<div class="cov"><span class="num"><pre>154</pre></span><pre>    if 'pylons_config' in kwargs:</pre></div>
<div class="nocov"><span class="num"><pre>155</pre></span><pre>        conf = kwargs.pop('pylons_config')</pre></div>
<div class="cov"><span class="num"><pre>156</pre></span><pre>    else:</pre></div>
<div class="cov"><span class="num"><pre>157</pre></span><pre>        conf = pylons.config.current_conf()</pre></div>
<div class="cov"><span class="num"><pre>158</pre></span><pre>    localedir = os.path.join(conf['pylons.paths']['root'], 'i18n')</pre></div>
<div class="cov"><span class="num"><pre>159</pre></span><pre>    if not isinstance(lang, list):</pre></div>
<div class="cov"><span class="num"><pre>160</pre></span><pre>        lang = [lang]</pre></div>
<div class="cov"><span class="num"><pre>161</pre></span><pre>    try:</pre></div>
<div class="cov"><span class="num"><pre>162</pre></span><pre>        translator = translation(conf['pylons.package'], localedir,</pre></div>
<div class="cov"><span class="num"><pre>163</pre></span><pre>                                 languages=lang, **kwargs)</pre></div>
<div class="cov"><span class="num"><pre>164</pre></span><pre>    except IOError, ioe:</pre></div>
<div class="cov"><span class="num"><pre>165</pre></span><pre>        raise LanguageError('IOError: %s' % ioe)</pre></div>
<div class="cov"><span class="num"><pre>166</pre></span><pre>    translator.pylons_lang = lang</pre></div>
<div class="cov"><span class="num"><pre>167</pre></span><pre>    return translator</pre></div>
<div class="skip"><span class="num"><pre>168</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>169</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>170</pre></span><pre>def set_lang(lang, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>171</pre></span><pre>    &quot;&quot;&quot;Set the current language used for translations.</pre></div>
<div class="skip"><span class="num"><pre>172</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>173</pre></span><pre>    ``lang`` should be a string or a list of strings. If a list of</pre></div>
<div class="nocov"><span class="num"><pre>174</pre></span><pre>    strings, the first language is set as the main and the subsequent</pre></div>
<div class="nocov"><span class="num"><pre>175</pre></span><pre>    languages are added as fallbacks.</pre></div>
<div class="nocov"><span class="num"><pre>176</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>177</pre></span><pre>    translator = _get_translator(lang, **kwargs)</pre></div>
<div class="cov"><span class="num"><pre>178</pre></span><pre>    environ = pylons.request.environ</pre></div>
<div class="cov"><span class="num"><pre>179</pre></span><pre>    environ['pylons.pylons'].translator = translator</pre></div>
<div class="cov"><span class="num"><pre>180</pre></span><pre>    if 'paste.registry' in environ:</pre></div>
<div class="cov"><span class="num"><pre>181</pre></span><pre>        environ['paste.registry'].replace(pylons.translator, translator)</pre></div>
<div class="skip"><span class="num"><pre>182</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>183</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>184</pre></span><pre>def get_lang():</pre></div>
<div class="nocov"><span class="num"><pre>185</pre></span><pre>    &quot;&quot;&quot;Return the current i18n language used&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>186</pre></span><pre>    return getattr(pylons.translator, 'pylons_lang', None)</pre></div>
<div class="skip"><span class="num"><pre>187</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>188</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>189</pre></span><pre>def add_fallback(lang, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>190</pre></span><pre>    &quot;&quot;&quot;Add a fallback language from which words not matched in other</pre></div>
<div class="nocov"><span class="num"><pre>191</pre></span><pre>    languages will be translated to.</pre></div>
<div class="skip"><span class="num"><pre>192</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>193</pre></span><pre>    This fallback will be associated with the currently selected</pre></div>
<div class="nocov"><span class="num"><pre>194</pre></span><pre>    language -- that is, resetting the language via set_lang() resets</pre></div>
<div class="nocov"><span class="num"><pre>195</pre></span><pre>    the current fallbacks.</pre></div>
<div class="skip"><span class="num"><pre>196</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>197</pre></span><pre>    This function can be called multiple times to add multiple</pre></div>
<div class="nocov"><span class="num"><pre>198</pre></span><pre>    fallbacks.</pre></div>
<div class="nocov"><span class="num"><pre>199</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>200</pre></span><pre>    return pylons.translator.add_fallback(_get_translator(lang, **kwargs))</pre></div>
<div class="skip"><span class="num"><pre>201</pre></span><pre></pre></div>
</div>
</body>
</html>
